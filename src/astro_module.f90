!********************************************************************************
!>
!  Modern Fortran implementations of standard models used in fundamental astronomy
!
!### Notes
!
!  This library is based on the IAU SOFA library.
!  The routines have been changed in the following ways:
!
!  * Conversion from Fixed-form (FORTRAN 77) to Free-form (Fortran 2008) format.
!  * Removal of the "iau_" prefix on all routines.
!  * All routines were combined into this module.
!
!### Original SOFA Copyright Notice
!
!  Copyright (C) 2019
!  Standards Of Fundamental Astronomy Board
!  of the International Astronomical Union.
!
!  =====================
!  SOFA Software License
!  =====================
!
!  NOTICE TO USER:
!
!  BY USING THIS SOFTWARE YOU ACCEPT THE FOLLOWING SIX TERMS AND
!  CONDITIONS WHICH APPLY TO ITS USE.
!
!  1. The Software is owned by the IAU SOFA Board ("SOFA").
!
!  2. Permission is granted to anyone to use the SOFA software for any
!     purpose, including commercial applications, free of charge and
!     without payment of royalties, subject to the conditions and
!     restrictions listed below.
!
!  3. You (the user) may copy and distribute SOFA source code to others,
!     and use and adapt its code and algorithms in your own software,
!     on a world-wide, royalty-free basis.  That portion of your
!     distribution that does not consist of intact and unchanged copies
!     of SOFA source code files is a "derived work" that must comply
!     with the following requirements:
!
!     a) Your work shall be marked or carry a statement that it
!        (i) uses routines and computations derived by you from
!        software provided by SOFA under license to you; and
!        (ii) does not itself constitute software provided by and/or
!        endorsed by SOFA.
!
!     b) The source code of your derived work must contain descriptions
!        of how the derived work is based upon, contains and/or differs
!        from the original SOFA software.
!
!     c) The names of all routines in your derived work shall not
!        include the prefix "iau" or "sofa" or trivial modifications
!        thereof such as changes of case.
!
!     d) The origin of the SOFA components of your derived work must
!        not be misrepresented;  you must not claim that you wrote the
!        original software, nor file a patent application for SOFA
!        software or algorithms embedded in the SOFA software.
!
!     e) These requirements must be reproduced intact in any source
!        distribution and shall apply to anyone to whom you have
!        granted a further right to modify the source code of your
!        derived work.
!
!     Note that, as originally distributed, the SOFA software is
!     intended to be a definitive implementation of the IAU standards,
!     and consequently third-party modifications are discouraged.  All
!     variations, no matter how minor, must be explicitly marked as
!     such, as explained above.
!
!  4. You shall not cause the SOFA software to be brought into
!     disrepute, either by misuse, or use for inappropriate tasks, or
!     by inappropriate modification.
!
!  5. The SOFA software is provided "as is" and SOFA makes no warranty
!     as to its use or performance.   SOFA does not and cannot warrant
!     the performance or results which the user may obtain by using the
!     SOFA software.  SOFA makes no warranties, express or implied, as
!     to non-infringement of third party rights, merchantability, or
!     fitness for any particular purpose.  In no event will SOFA be
!     liable to the user for any consequential, incidental, or special
!     damages, including any lost profits or lost savings, even if a
!     SOFA representative has been advised of such damages, or for any
!     claim by any third party.
!
!  6. The provision of any version of the SOFA software under the terms
!     and conditions specified herein does not imply that future
!     versions will also be made available under the same terms and
!     conditions.
!
!  In any published work or commercial product which uses the SOFA
!  software directly, acknowledgement (see www.iausofa.org) is
!  appreciated.
!
!  Correspondence concerning SOFA software should be addressed as
!  follows:
!
!      By email:  sofa@ukho.gov.uk
!      By post:   IAU SOFA Center
!                 HM Nautical Almanac Office
!                 UK Hydrographic Office
!                 Admiralty Way, Taunton
!                 Somerset, TA1 2DN
!                 United Kingdom
!
!********************************************************************************

module astro_module

implicit none

public

contains
!********************************************************************************

!-----------------------------------------------------------------------
subroutine A2AF ( ndp, angle, sign, idmsf )
!>
!  Decompose radians into degrees, arcminutes, arcseconds, fraction.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     NDP       i        resolution (Note 1)
!     ANGLE     d        angle in radians
!
!  Returned:
!     SIGN      c        '+' or '-'
!     IDMSF     i(4)     degrees, arcminutes, arcseconds, fraction
!
!  Called:
!     D2TF     decompose days to hms
!
!  Notes:
!
!  1) NDP is interpreted as follows:
!
!     NDP         resolution
!      :      ...0000 00 00
!     -7         1000 00 00
!     -6          100 00 00
!     -5           10 00 00
!     -4            1 00 00
!     -3            0 10 00
!     -2            0 01 00
!     -1            0 00 10
!      0            0 00 01
!      1            0 00 00.1
!      2            0 00 00.01
!      3            0 00 00.001
!      :            0 00 00.000...
!
!  2) The largest positive useful value for NDP is determined by the
!     size of ANGLE, the format of DOUBLE PRECISION floating-point
!     numbers on the target platform, and the risk of overflowing
!     IDMSF(4).  On a typical platform, for ANGLE up to 2pi, the
!     available floating-point precision might correspond to NDP=12.
!     However, the practical limit is typically NDP=9, set by the
!     capacity of a 32-bit IDMSF(4).
!
!  3) The absolute value of ANGLE may exceed 2pi.  In cases where it
!     does not, it is up to the caller to test for and handle the
!     case where ANGLE is very nearly 2pi and rounds up to 360 degrees,
!     by testing for IDMSF(1)=360 and setting IDMSF(1-4) to zero.
!
!  This revision:  2007 December 3
!
!-----------------------------------------------------------------------

implicit none

integer ndp
double precision angle
character sign*(*)
integer idmsf(4)

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Hours to degrees * radians to turns
double precision f
parameter ( f = 15d0/d2pi )

!  Scale then use days to h,m,s routine.
call D2TF ( ndp, angle*f, sign, idmsf )

end subroutine A2AF
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine A2TF ( ndp, angle, sign, ihmsf )
!>
!  Decompose radians into hours, minutes, seconds, fraction.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     NDP       i        resolution (Note 1)
!     ANGLE     d        angle in radians
!
!  Returned:
!     SIGN      c        '+' or '-'
!     IHMSF     i(4)     hours, minutes, seconds, fraction
!
!  Called:
!     D2TF     decompose days to hms
!
!  Notes:
!
!  1) NDP is interpreted as follows:
!
!     NDP         resolution
!      :      ...0000 00 00
!     -7         1000 00 00
!     -6          100 00 00
!     -5           10 00 00
!     -4            1 00 00
!     -3            0 10 00
!     -2            0 01 00
!     -1            0 00 10
!      0            0 00 01
!      1            0 00 00.1
!      2            0 00 00.01
!      3            0 00 00.001
!      :            0 00 00.000...
!
!  2) The largest useful value for NDP is determined by the size
!     of ANGLE, the format of DOUBLE PRECISION floating-point numbers
!     on the target platform, and the risk of overflowing IHMSF(4).
!     On a typical platform, for ANGLE up to 2pi, the available
!     floating-point precision might correspond to NDP=12.  However,
!     the practical limit is typically NDP=9, set by the capacity of
!     a 32-bit IHMSF(4).
!
!  3) The absolute value of ANGLE may exceed 2pi.  In cases where it
!     does not, it is up to the caller to test for and handle the
!     case where ANGLE is very nearly 2pi and rounds up to 24 hours,
!     by testing for IHMSF(1)=24 and setting IHMSF(1-4) to zero.
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

integer ndp
double precision angle
character sign*(*)
integer ihmsf(4)

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Scale then use days to h,m,s routine.
call D2TF ( ndp, angle/d2pi, sign, ihmsf )

end subroutine A2TF
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine AB ( pnat, v, s, bm1, ppr )
!>
!  Apply aberration to transform natural direction into proper
!  direction.
!
!  Status:  support routine.
!
!  Given:
!    PNAT      d(3)   natural direction to the source (unit vector)
!    V         d(3)   observer barycentric velocity in units of c
!    S         d      distance between the Sun and the observer (au)
!    BM1       d      sqrt(1-|v|^2): reciprocal of Lorenz factor
!
!  Returned:
!    PPR       d(3)   proper direction to source (unit vector)
!
!  Notes:
!
!  1) The algorithm is based on Expr. (7.40) in the Explanatory
!     Supplement (Urban & Seidelmann 2013), but with the following
!     changes:
!
!     o  Rigorous rather than approximate normalization is applied.
!
!     o  The gravitational potential term from Expr. (7) in
!        Klioner (2003) is added, taking into account only the Sun's
!        contribution.  This has a maximum effect of about
!        0.4 microarcsecond.
!
!  2) In almost all cases, the maximum accuracy will be limited by the
!     supplied velocity.  For example, if the SOFA EPV00 routine is
!     used, errors of up to 5 microarcseconds could occur.
!
!  References:
!
!     Urban, S. & Seidelmann, P. K. (eds), Explanatory Supplement to
!     the Astronomical Almanac, 3rd ed., University Science Books
!     (2013).
!
!     Klioner, Sergei A., "A practical relativistic model for micro-
!     arcsecond astrometry in space", Astr. J. 125, 1580-1597 (2003).
!
!  Called:
!     PDP      scalar product of two p-vectors
!
!  This revision:   2013 August 31
!
!-----------------------------------------------------------------------

implicit none
double precision pnat(3), v(3), s, bm1, ppr(3)

!  Schwarzschild radius of the Sun (au)
!  = 2 * 1.32712440041 D20 / (2.99792458 D8)^2 / 1.49597870700 D11
double precision srs
parameter ( srs = 1.97412574336d-08 )

integer i
double precision pdv, w1, w2, r2, w, p(3), r

call PDP ( pnat, v, pdv )
w1 = 1d0 + pdv/(1d0+bm1)
w2 = srs / s
r2 = 0d0
do 1 i=1,3
   w = pnat(i)*bm1 + w1*v(i) + w2*(v(i)-pdv*pnat(i))
   p(i) = w
   r2 = r2 + w*w
1 continue
r = sqrt ( r2 )
do 2 i=1,3
   ppr(i) = p(i) / r
2 continue

end subroutine AB
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine AE2HD (az, el, phi, ha, dec)
!>
!  Horizon to equatorial coordinates:  transform azimuth and altitude
!  to hour angle and declination.
!
!  Status:  support routine.
!
!  Given:
!     AZ       d     azimuth
!     EL       d     elevation
!     PHI      d     observatory latitude
!
!  Returned:
!     HA       d     hour angle
!     DEC      d     declination
!
!  Notes:
!
!  1)  All the arguments are angles in radians.
!
!  2)  The sign convention for azimuth is north zero, east +pi/2.
!
!  3)  HA is returned in the range +/-pi.  Declination is returned in
!      the range +/-pi/2.
!
!  4)  The latitude PHI is pi/2 minus the angle between the Earth's
!      rotation axis and the adopted zenith.  In many applications it
!      will be sufficient to use the published geodetic latitude of the
!      site.  In very precise (sub-arcsecond) applications, PHI can be
!      corrected for polar motion.
!
!  5)  The azimuth AZ must be with respect to the rotational north pole,
!      as opposed to the ITRS pole, and an azimuth with respect to north
!      on a map of the Earth's surface will need to be adjusted for
!      polar motion if sub-arcsecond accuracy is required.
!
!  6)  Should the user wish to work with respect to the astronomical
!      zenith rather than the geodetic zenith, PHI will need to be
!      adjusted for deflection of the vertical (often tens of
!      arcseconds), and the zero point of HA will also be affected.
!
!  7)  The transformation is the same as Ve = Ry(phi-pi/2)*Rz(pi)*Vh,
!      where Ve and Vh are lefthanded unit vectors in the (ha,dec) and
!      (az,el) systems respectively and Rz and Ry are rotations about
!      first the z-axis and then the y-axis.  (n.b. Rz(pi) simply
!      reverses the signs of the x and y components.)  For efficiency,
!      the algorithm is written out rather than calling other utility
!      functions.  For applications that require even greater
!      efficiency, additional savings are possible if constant terms
!      such as functions of latitude are computed once and for all.
!
!  8)  Again for efficiency, no range checking of arguments is carried
!      out.
!
!  Last revision:   2018 January 2
!
!-----------------------------------------------------------------------

implicit none

double precision az, el, phi, ha, dec

double precision sa, ca, se, ce, sp, cp, x, y, z, r

!  Useful trig functions.
sa = sin(az)
ca = cos(az)
se = sin(el)
ce = cos(el)
sp = sin(phi)
cp = cos(phi)

!  Az,Alt unit vector.
x = - ca*ce*sp + se*cp
y = - sa*ce
z = ca*ce*cp + se*sp

!  To spherical.
r = sqrt(x*x + y*y)
if ( r==0d0 ) then
   ha = 0d0
else
   ha = atan2(y,x)
end if
dec = atan2(z,r)

end subroutine AE2HD
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine AF2A ( s, ideg, iamin, asec, rad, j )
!>
!  Convert degrees, arcminutes, arcseconds to radians.
!
!  Status:  support routine.
!
!  Given:
!     S          c      sign:  '-' = negative, otherwise positive
!     IDEG       i      degrees
!     IAMIN      i      arcminutes
!     ASEC       d      arcseconds
!
!  Returned:
!     RAD        d      angle in radians
!     J          i      status:  0 = OK
!                                1 = IDEG outside range 0-359
!                                2 = IAMIN outside range 0-59
!                                3 = ASEC outside range 0-59.999...
!
!  Notes:
!
!  1)  If the s argument is a string, only the leftmost character is
!      used and no warning status is provided.
!
!  2)  The result is computed even if any of the range checks fail.
!
!  3)  Negative IDEG, IAMIN and/or ASEC produce a warning status, but
!      the absolute value is used in the conversion.
!
!  4)  If there are multiple errors, the status value reflects only the
!      first, the smallest taking precedence.
!
!
!  This revision:  2013 December 2
!
!-----------------------------------------------------------------------

implicit none

character s
integer ideg, iamin
double precision asec, rad
integer j

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

double precision w

!  Preset the status.
j = 0

!  Validate arcseconds, arcminutes, degrees.
if ( asec<0d0 .or. asec>=60d0 ) j=3
if ( iamin<0 .or. iamin>59 ) j=2
if ( ideg<0 .or. ideg>359 ) j=1

!  Compute the angle.
w = ( 60d0 * ( 60d0 * dble( abs(ideg) ) + &
                      dble( abs(iamin) ) ) + &
                      abs(asec) ) * das2r

!  Apply the sign.
if ( s == '-' ) w = -w

!  Return the result.
rad = w

end subroutine AF2A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function ANP ( a )
!>
!  Normalize angle into the range 0 <= A < 2pi.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A          d       angle (radians)
!
!  Returned:
!     ANP    d       angle in range 0-2pi
!
!  This revision:  2000 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision a

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

double precision w

w = mod(a,d2pi)
if ( w < 0d0 ) w = w + d2pi
ANP = w

end function ANP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function ANPM ( a )
!>
!  Normalize angle into the range -pi <= A < +pi.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A          d       angle (radians)
!
!  Returned:
!     ANPM   d       angle in range +/-pi
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision a

!  Pi
double precision dpi
parameter ( dpi = 3.141592653589793238462643d0 )

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

double precision w

w = mod(a,d2pi)
if ( abs(w) >= dpi ) w = w - sign(d2pi,a)
ANPM = w

end function ANPM
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APCG ( date1, date2, ebpv, ehp, astrom )
!>
!  For a geocentric observer, prepare star-independent astrometry
!  parameters for transformations between ICRS and GCRS coordinates.
!  The Earth ephemeris is supplied by the caller.
!
!  The parameters produced by this routine are required in the parallax,
!  light deflection and aberration parts of the astrometric
!  transformation chain.
!
!  Status:  support routine.
!
!  Given:
!     DATE1    d       TDB as a 2-part...
!     DATE2    d       ...Julian Date (Note 1)
!     EBPV     d(3,2)  Earth barycentric position/velocity (au, au/day)
!     EHP      d(3)    Earth heliocentric position (au)
!
!  Returned:
!     ASTROM   d(30)   star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     unchanged
!               (23)     unchanged
!               (24)     unchanged
!               (25)     unchanged
!               (26)     unchanged
!               (27)     unchanged
!               (28)     unchanged
!               (29)     unchanged
!               (30)     unchanged
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.  For most
!     applications of this routine the choice will not be at all
!     critical.
!
!     TT can be used instead of TDB without any significant impact on
!     accuracy.
!
!  2) All the vectors are with respect to BCRS axes.
!
!  3) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  4) The context array ASTROM produced by this routine is used by
!     ATCIQ* and ATICQ*.
!
!  Called:
!     ZPV      zero pv-vector
!     APCS     astrometry parameters, ICRS-GCRS, space observer
!
!  This revision:   2017 March 12
!
!-----------------------------------------------------------------------

implicit none
double precision date1, date2, ebpv(3,2), ehp(3), astrom(30)

double precision pv(3,2)

!  Geocentric observer.
call ZPV ( pv )

!  Compute the star-independent astrometry parameters.
call APCS ( date1, date2, pv, ebpv, ehp, astrom )

end subroutine APCG
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APCG13 ( date1, date2, astrom )
!>
!  For a geocentric observer, prepare star-independent astrometry
!  parameters for transformations between ICRS and GCRS coordinates.
!  The caller supplies the date, and SOFA models are used to predict
!  the Earth ephemeris.
!
!  The parameters produced by this routine are required in the
!  parallax, light deflection and aberration parts of the astrometric
!  transformation chain.
!
!  Status:  support routine.
!
!  Given:
!     DATE1    d      TDB as a 2-part...
!     DATE2    d      ...Julian Date (Note 1)
!
!  Returned:
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     unchanged
!               (23)     unchanged
!               (24)     unchanged
!               (25)     unchanged
!               (26)     unchanged
!               (27)     unchanged
!               (28)     unchanged
!               (29)     unchanged
!               (30)     unchanged
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.  For most
!     applications of this routine the choice will not be at all
!     critical.
!
!     TT can be used instead of TDB without any significant impact on
!     accuracy.
!
!  2) All the vectors are with respect to BCRS axes.
!
!  3) In cases where the caller wishes to supply his own Earth
!     ephemeris, the routine APCG can be used instead of the present
!     routine.
!
!  4) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  5) The context array ASTROM produced by this routine is used by
!     ATCIQ* and ATICQ*.
!
!  Called:
!     EPV00    Earth position and velocity
!     APCG     astrometry parameters, ICRS-GCRS, geocenter
!
!  This revision:   2017 March 12
!
!-----------------------------------------------------------------------

implicit none
double precision date1, date2, astrom(30)

integer j
double precision ehpv(3,2), ebpv(3,2)

!  Earth barycentric & heliocentric position/velocity (au, au/d).
call EPV00 ( date1, date2, ehpv, ebpv, j )

!  Compute the star-independent astrometry parameters.
call APCG ( date1, date2, ebpv, ehpv, astrom )

end subroutine APCG13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APCI ( date1, date2, ebpv, ehp, x, y, s, astrom )
!>
!  For a terrestrial observer, prepare star-independent astrometry
!  parameters for transformations between ICRS and geocentric CIRS
!  coordinates.  The Earth ephemeris and CIP/CIO are supplied by the
!  caller.
!
!  The parameters produced by this routine are required in the parallax,
!  light deflection, aberration, and bias-precession-nutation parts of
!  the astrometric transformation chain.
!
!  Status:  support routine.
!
!  Given:
!     DATE1    d       TDB as a 2-part...
!     DATE2    d      ...Julian Date (Note 1)
!     EBPV     d(3,2)  Earth barycentric position/velocity (au, au/day)
!     EHP      d(3)    Earth heliocentric position (au)
!     X,Y      d       CIP X,Y (components of unit vector)
!     S        d       the CIO locator s (radians)
!
!  Returned:
!     ASTROM   d(30)   star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     unchanged
!               (23)     unchanged
!               (24)     unchanged
!               (25)     unchanged
!               (26)     unchanged
!               (27)     unchanged
!               (28)     unchanged
!               (29)     unchanged
!               (30)     unchanged
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.  For most
!     applications of this routine the choice will not be at all
!     critical.
!
!     TT can be used instead of TDB without any significant impact on
!     accuracy.
!
!  2) All the vectors are with respect to BCRS axes.
!
!  3) In cases where the caller does not wish to provide the Earth
!     ephemeris and CIP/CIO, the routine APCI13 can be used instead
!     of the present routine.  This computes the required quantities
!     using other SOFA routines.
!
!  4) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  5) The context array ASTROM produced by this routine is used by
!     ATCIQ* and ATICQ*.
!
!  Called:
!     APCG     astrometry parameters, ICRS-GCRS, geocenter
!     C2IXYS   celestial-to-intermediate matrix, given X,Y and s
!
!  This revision:   2017 March 12
!
!-----------------------------------------------------------------------

implicit none
double precision date1, date2, ebpv(3,2), ehp(3), x, y, s, &
                 astrom(30)

!  Star-independent astrometry parameters for geocenter.
call APCG ( date1, date2, ebpv, ehp, astrom )

!  CIO based BPN matrix.
call C2IXYS ( x, y, s, astrom(13) )

end subroutine APCI
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APCI13 ( date1, date2, astrom, eo )
!>
!  For a terrestrial observer, prepare star-independent astrometry
!  parameters for transformations between ICRS and geocentric CIRS
!  coordinates.  The caller supplies the date, and SOFA models are
!  used to predict the Earth ephemeris and CIP/CIO.
!
!  The parameters produced by this routine are required in the parallax,
!  light deflection, aberration, and bias-precession-nutation parts of
!  the astrometric transformation chain.
!
!  Status:  support routine.
!
!  Given:
!     DATE1    d      TDB as a 2-part...
!     DATE2    d      ...Julian Date (Note 1)
!
!  Returned:
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     unchanged
!               (23)     unchanged
!               (24)     unchanged
!               (25)     unchanged
!               (26)     unchanged
!               (27)     unchanged
!               (28)     unchanged
!               (29)     unchanged
!               (30)     unchanged
!     EO       d      equation of the origins (ERA-GST)
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.  For most
!     applications of this routine the choice will not be at all
!     critical.
!
!     TT can be used instead of TDB without any significant impact on
!     accuracy.
!
!  2) All the vectors are with respect to BCRS axes.
!
!  3) In cases where the caller wishes to supply his own Earth
!     ephemeris and CIP/CIO, the routine APCI can be used instead of
!     the present routine.
!
!  4) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  5) The context array ASTROM produced by this routine is used by
!     ATCIQ* and ATICQ*.
!
!  Called:
!     EPV00    Earth position and velocity
!     PNM06A   classical NPB matrix, IAU 2006/2000A
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     S06      the CIO locator s, given X,Y, IAU 2006
!     APCI     astrometry parameters, ICRS-CIRS
!     EORS     equation of the origins, given NPB matrix and s
!
!  This revision:   2017 March 12
!
!-----------------------------------------------------------------------

implicit none
double precision date1, date2, astrom(30), eo

integer j
double precision pvh(3,2), pvb(3,2), r(3,3), x, y, s

!     DOUBLE PRECISION S06, EORS

!  Earth barycentric & heliocentric position/velocity (au, au/d).
call EPV00 ( date1, date2, pvh, pvb, j )

!  Form the equinox based BPN matrix, IAU 2006/2000A.
call PNM06A ( date1, date2, r )

!  Extract CIP X,Y.
call BPN2XY ( r, x, y )

!  Obtain CIO locator s.
s = S06 ( date1, date2, x, y )

!  Compute the star-independent astrometry parameters.
call APCI ( date1, date2, pvb, pvh, x, y, s, astrom )

!  Equation of the origins.
eo = EORS ( r, s )

end subroutine APCI13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APCO ( date1, date2, ebpv, ehp, x, y, s, &
                      theta, elong, phi, hm, xp, yp, sp, &
                      refa, refb, astrom )
!>
!  For a terrestrial observer, prepare star-independent astrometry
!  parameters for transformations between ICRS and observed coordinates.
!  The caller supplies the Earth ephemeris, the Earth rotation
!  information and the refraction constants as well as the site
!  coordinates.
!
!  Status:  support routine.
!
!  Given:
!     DATE1    d       TDB as a 2-part...
!     DATE2    d       ...Julian Date (Note 1)
!     EBPV     d(3,2)  Earth barycentric pos/vel (au, au/day, Note 2)
!     EHP      d(3)    Earth heliocentric position (au, Note 2)
!     X,Y      d       CIP X,Y (components of unit vector)
!     S        d       the CIO locator s (radians)
!     THETA    d       Earth rotation angle (radians)
!     ELONG    d       longitude (radians, east +ve, Note 3)
!     PHI      d       latitude (geodetic, radians, Note 3)
!     HM       d       height above ellipsoid (m, geodetic, Note 3)
!     XP,YP    d       polar motion coordinates (radians, Note 4)
!     SP       d       the TIO locator s' (radians, Note 4)
!     REFA     d       refraction constant A (radians, Note 5)
!     REFB     d       refraction constant B (radians, Note 5)
!
!  Returned:
!     ASTROM   d(30)   star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.  For most
!     applications of this routine the choice will not be at all
!     critical.
!
!     TT can be used instead of TDB without any significant impact on
!     accuracy.
!
!  2) The vectors EB, EH, and all the ASTROM vectors, are with respect
!     to BCRS axes.
!
!  3) The geographical coordinates are with respect to the WGS84
!     reference ellipsoid.  TAKE CARE WITH THE LONGITUDE SIGN
!     CONVENTION:  the longitude required by the present routine is
!     right-handed, i.e. east-positive, in accordance with geographical
!     convention.
!
!  4) XP and YP are the coordinates (in radians) of the Celestial
!     Intermediate Pole with respect to the International Terrestrial
!     Reference System (see IERS Conventions), measured along the
!     meridians 0 and 90 deg west respectively.  SP is the TIO locator
!     s', in radians, which positions the Terrestrial Intermediate
!     Origin on the equator.  For many applications, XP, YP and
!     (especially) SP can be set to zero.
!
!     Internally, the polar motion is stored in a form rotated onto the
!     local meridian.
!
!  5) The refraction constants REFA and REFB are for use in a
!     dZ = A*tan(Z)+B*tan^3(Z) model, where Z is the observed
!     (i.e. refracted) zenith distance and dZ is the amount of
!     refraction.
!
!  6) It is advisable to take great care with units, as even unlikely
!     values of the input parameters are accepted and processed in
!     accordance with the models used.
!
!  7) In cases where the caller does not wish to provide the Earth
!     Ephemeris, the Earth rotation information and refraction
!     constants, the routine APCO13 can be used instead of the
!     present routine.  This starts from UTC and weather readings etc.
!     and computes suitable values using other SOFA routines.
!
!  8) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  9) The context array ASTROM produced by this routine is used by
!     ATIOQ, ATOIQ, ATCIQ*, and ATICQ*.
!
!  Called:
!     APER     astrometry parameters: update ERA
!     C2IXYS   celestial-to-intermediate matrix, given X,Y and s
!     PVTOB    position/velocity of terrestrial station
!     TRXPV    product of transpose of r-matrix and pv-vector
!     APCS     astrometry parameters, ICRS-GCRS, space observer
!     CR       copy r-matrix
!
!  This revision:   2017 March 12
!
!-----------------------------------------------------------------------

implicit none
double precision date1, date2, ebpv(3,2), ehp(3), x, y, s, &
                 theta, elong, phi, hm, xp, yp, sp, refa, refb, &
                 astrom(30)

double precision sl, cl, r(3,3), pvc(3,2), pv(3,2)

!  Longitude with adjustment for TIO locator s'.
astrom(22) = elong + sp

!  Polar motion, rotated onto the local meridian.
sl = sin(astrom(22))
cl = cos(astrom(22))
astrom(23) = xp*cl - yp*sl
astrom(24) = xp*sl + yp*cl

!  Functions of latitude.
astrom(25) = sin(phi)
astrom(26) = cos(phi)

!  Refraction constants.
astrom(29) = refa
astrom(30) = refb

!  Local Earth rotation angle.
call APER ( theta, astrom )

!  Disable the (redundant) diurnal aberration step.
astrom(27) = 0d0

!  CIO based BPN matrix.
call C2IXYS ( x, y, s, r )

!  Observer's geocentric position and velocity (m, m/s, CIRS).
call PVTOB ( elong, phi, hm, xp, yp, sp, theta, pvc )

!  Rotate into GCRS.
call TRXPV ( r, pvc, pv )

!  ICRS <-> GCRS parameters.
call APCS ( date1, date2, pv, ebpv, ehp, astrom )

!  Store the CIO based BPN matrix.
call CR ( r, astrom(13) )

end subroutine APCO
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APCO13 ( utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                        phpa, tc, rh, wl, astrom, eo, j )
!>
!  For a terrestrial observer, prepare star-independent astrometry
!  parameters for transformations between ICRS and observed coordinates.
!  The caller supplies UTC, site coordinates, ambient air conditions and
!  observing wavelength, and SOFA models are used to obtain the Earth
!  ephemeris, CIP/CIO and refraction constants.
!
!  The parameters produced by this routine are required in the parallax,
!  light deflection, aberration, and bias-precession-nutation parts of
!  the ICRS/CIRS transformations.
!
!  Status:  support routine.
!
!  Given:
!     UTC1     d      UTC as a 2-part...
!     UTC2     d      ...quasi Julian Date (Notes 1,2)
!     DUT1     d      UT1-UTC (seconds, Note 3)
!     ELONG    d      longitude (radians, east +ve, Note 4)
!     PHI      d      latitude (geodetic, radians, Note 4)
!     HM       d      height above ellipsoid (m, geodetic, Notes 4,6)
!     XP,YP    d      polar motion coordinates (radians, Note 5)
!     PHPA     d      pressure at the observer (hPa = mB, Note 6)
!     TC       d      ambient temperature at the observer (deg C)
!     RH       d      relative humidity at the observer (range 0-1)
!     WL       d      wavelength (micrometers, Note 7)
!
!  Returned:
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!     EO       d      equation of the origins (ERA-GST)
!     J        i      status: +1 = dubious year (Note 2)
!                              0 = OK
!                             -1 = unacceptable date
!
!  Notes:
!
!  1)  UTC1+UTC2 is quasi Julian Date (see Note 2), apportioned in any
!      convenient way between the two arguments, for example where UTC1
!      is the Julian Day Number and UTC2 is the fraction of a day.
!
!      However, JD cannot unambiguously represent UTC during a leap
!      second unless special measures are taken.  The convention in the
!      present routine is that the JD day represents UTC days whether
!      the length is 86399, 86400 or 86401 SI seconds.
!
!      Applications should use the routine DTF2D to convert from
!      calendar date and time of day into 2-part quasi Julian Date, as
!      it implements the leap-second-ambiguity convention just
!      described.
!
!  2)  The warning status "dubious year" flags UTCs that predate the
!      introduction of the time scale or that are too far in the
!      future to be trusted.  See DAT for further details.
!
!  3)  UT1-UTC is tabulated in IERS bulletins.  It increases by exactly
!      one second at the end of each positive UTC leap second,
!      introduced in order to keep UT1-UTC within +/- 0.9s.  n.b. This
!      practice is under review, and in the future UT1-UTC may grow
!      essentially without limit.
!
!  4)  The geographical coordinates are with respect to the WGS84
!      reference ellipsoid.  TAKE CARE WITH THE LONGITUDE SIGN:  the
!      longitude required by the present routine is east-positive
!      (i.e. right-handed), in accordance with geographical convention.
!
!  5)  The polar motion XP,YP can be obtained from IERS bulletins.  The
!      values are the coordinates (in radians) of the Celestial
!      Intermediate Pole with respect to the International Terrestrial
!      Reference System (see IERS Conventions 2003), measured along the
!      meridians 0 and 90 deg west respectively.  For many applications,
!      XP and YP can be set to zero.
!
!      Internally, the polar motion is stored in a form rotated onto
!      the local meridian.
!
!  6)  If hm, the height above the ellipsoid of the observing station
!      in meters, is not known but phpa, the pressure in hPa (=mB), is
!      available, an adequate estimate of hm can be obtained from the
!      expression
!
!            hm = -29.3 * tsl * log ( phpa / 1013.25 );
!
!      where tsl is the approximate sea-level air temperature in K
!      (See Astrophysical Quantities, C.W.Allen, 3rd edition, section
!      52).  Similarly, if the pressure phpa is not known, it can be
!      estimated from the height of the observing station, hm, as
!      follows:
!
!            phpa = 1013.25 * exp ( -hm / ( 29.3 * tsl ) );
!
!      Note, however, that the refraction is nearly proportional to
!      the pressure and that an accurate phpa value is important for
!      precise work.
!
!  7)  The argument WL specifies the observing wavelength in
!      micrometers.  The transition from optical to radio is assumed to
!      occur at 100 micrometers (about 3000 GHz).
!
!  8)  It is advisable to take great care with units, as even unlikely
!      values of the input parameters are accepted and processed in
!      accordance with the models used.
!
!  9)  In cases where the caller wishes to supply his own Earth
!      ephemeris, Earth rotation information and refraction constants,
!      the routine APCO can be used instead of the present routine.
!
!  10) This is one of several routines that inserts into the ASTROM
!      array star-independent parameters needed for the chain of
!      astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!      The various routines support different classes of observer and
!      portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!      Those with names ending in "13" use contemporary SOFA models to
!      compute the various ephemerides.  The others accept ephemerides
!      supplied by the caller.
!
!      The transformation from ICRS to GCRS covers space motion,
!      parallax, light deflection, and aberration.  From GCRS to CIRS
!      comprises frame bias and precession-nutation.  From CIRS to
!      observed takes account of Earth rotation, polar motion, diurnal
!      aberration and parallax (unless subsumed into the ICRS <-> GCRS
!      transformation), and atmospheric refraction.
!
!  11) The context array ASTROM produced by this routine is used by
!      ATIOQ, ATOIQ, ATCIQ* and ATICQ*.
!
!  Called:
!     UTCTAI   UTC to TAI
!     TAITT    TAI to TT
!     UTCUT1   UTC to UT1
!     EPV00    Earth position and velocity
!     PNM06A   classical NPB matrix, IAU 2006/2000A
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     S06      the CIO locator s, given X,Y, IAU 2006
!     ERA00    Earth rotation angle, IAU 2000
!     SP00     the TIO locator s', IERS 2000
!     REFCO    refraction constants for given ambient conditions
!     APCO     astrometry parameters, ICRS-observed
!     EORS     equation of the origins, given NPB matrix and s
!
!  This revision:   2013 December 5
!
!-----------------------------------------------------------------------

implicit none
double precision utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                 phpa, tc, rh, wl, astrom(30), eo
integer j

integer js, jw
double precision tai1, tai2, tt1, tt2, ut11, ut12, &
                 ehpv(3,2), ebpv(3,2), r(3,3), x, y, s, theta, &
                 sp, refa, refb

!     DOUBLE PRECISION S06, ERA00, SP00, EORS

!  UTC to other time scales.
call UTCTAI ( utc1, utc2, tai1, tai2, js )
if ( js<0 ) go to 9
call TAITT ( tai1, tai2, tt1, tt2, js )
call UTCUT1 ( utc1, utc2, dut1, ut11, ut12, js )
if ( js<0 ) go to 9

!  Earth barycentric & heliocentric position/velocity (au, au/d).
call EPV00 ( tt1, tt2, ehpv, ebpv, jw )

!  Form the equinox based BPN matrix, IAU 2006/2000A.
call PNM06A ( tt1, tt2, r )

!  Extract CIP X,Y.
call BPN2XY ( r, x, y )

!  Obtain CIO locator s.
s = S06 ( tt1, tt2, x, y )

!  Earth rotation angle.
theta = ERA00 ( ut11, ut12 )

!  TIO locator s'.
sp = SP00 ( tt1, tt2 )

!  Refraction constants A and B.
call REFCO ( phpa, tc, rh, wl, refa, refb )

!  Compute the star-independent astrometry parameters.
call APCO ( tt1, tt2, ebpv, ehpv, x, y, s, theta, &
                elong, phi, hm, xp, yp, sp, refa, refb, &
                astrom )

!  Equation of the origins.
eo = EORS ( r, s )

!  Return the status.
9 continue
j = js

end subroutine APCO13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APCS ( date1, date2, pv, ebpv, ehp, astrom )
!>
!  For an observer whose geocentric position and velocity are known,
!  prepare star-independent astrometry parameters for transformations
!  between ICRS and GCRS.  The Earth ephemeris is supplied by the
!  caller.
!
!  The parameters produced by this routine are required in the space
!  motion, parallax, light deflection and aberration parts of the
!  astrometric transformation chain.
!
!  Status:  support routine.
!
!  Given:
!     DATE1    d       TDB as a 2-part...
!     DATE2    d       ...Julian Date (Note 1)
!     PV       d(3,2)  observer's geocentric pos/vel (m, m/s)
!     EBPV     d(3,2)  Earth barycentric position/velocity (au, au/day)
!     EHP      d(3)    Earth heliocentric position (au)
!
!  Returned:
!     ASTROM   d(30)   star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     unchanged
!               (23)     unchanged
!               (24)     unchanged
!               (25)     unchanged
!               (26)     unchanged
!               (27)     unchanged
!               (28)     unchanged
!               (29)     unchanged
!               (30)     unchanged
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.  For most
!     applications of this routine the choice will not be at all
!     critical.
!
!     TT can be used instead of TDB without any significant impact on
!     accuracy.
!
!  2) All the vectors are with respect to BCRS axes.
!
!  3) Providing separate arguments for (i) the observer's geocentric
!     position and velocity and (ii) the Earth ephemeris is done for
!     convenience in the geocentric, terrestrial and Earth orbit cases.
!     For deep space applications it maybe more convenient to specify
!     zero geocentric position and velocity and to supply the
!     observer's position and velocity information directly instead of
!     with respect to the Earth.  However, note the different units:
!     m and m/s for the geocentric vectors, au and au/day for the
!     heliocentric and barycentric vectors.
!
!  4) In cases where the caller does not wish to provide the Earth
!     ephemeris, the routine APCS13 can be used instead of the
!     present routine.  This computes the Earth ephemeris using the
!     SOFA routine EPV00.
!
!  5) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  6) The context array ASTROM produced by this routine is used by
!     ATCIQ* and ATICQ*.
!
!  Called:
!     CP       copy p-vector
!     PM       modulus of p-vector
!     PN       decompose p-vector into modulus and direction
!     IR       initialize r-matrix to identity
!
!  This revision:   2017 March 16
!
!-----------------------------------------------------------------------

implicit none
double precision date1, date2, pv(3,2), ebpv(3,2), ehp(3), &
                 astrom(30)

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian year
double precision djy
parameter ( djy = 365.25d0 )

!  Seconds per day
double precision daysec
parameter ( daysec = 86400d0 )

!  Speed of light (m/s)
double precision cmps
parameter ( cmps = 299792458d0 )

!  Astronomical unit (m, IAU 2012)
double precision aum
parameter ( aum = 149597870.7d3 )

!  Light time for 1 au (s)
double precision ault
parameter ( ault = aum/cmps )

!  au/d to m/s
double precision audms
parameter ( audms = aum/daysec )

!  Light time for 1 au (day)
double precision cr
parameter ( cr = ault/daysec )

integer i
double precision dp, dv, pb(3), vb(3), ph(3), v2, w

!  Time since reference epoch, years (for proper motion calculation).
astrom(1) = ( ( date1 - dj00 ) + date2 ) / djy

!  Adjust Earth ephemeris to observer.
do 1 i=1,3
   dp = pv(i,1) / aum
   dv = pv(i,2) / audms
   pb(i) = ebpv(i,1) + dp
   vb(i) = ebpv(i,2) + dv
   ph(i) = ehp(i) + dp
1 continue

!  Barycentric position of observer (au).
call CP ( pb, astrom(2) )

!  Heliocentric direction and distance (unit vector and au).
call PN ( ph, astrom(8), astrom(5) )

!  Barycentric vel. in units of c, and reciprocal of Lorenz factor.
v2 = 0d0
do 3 i=1,3
   w = vb(i) * cr
   astrom(8+i) = w
   v2 = v2 + w*w
3 continue
astrom(12) = sqrt ( 1d0 - v2 )

!  Reset the NPB matrix.
call IR ( astrom(13) )

end subroutine APCS
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APCS13 ( date1, date2, pv, astrom )
!>
!  For an observer whose geocentric position and velocity are known,
!  prepare star-independent astrometry parameters for transformations
!  between ICRS and GCRS.  The Earth ephemeris is from SOFA models.
!
!  The parameters produced by this routine are required in the space
!  motion, parallax, light deflection and aberration parts of the
!  astrometric transformation chain.
!
!  Status:  support routine.
!
!  Given:
!     DATE1    d      TDB as a 2-part...
!     DATE2    d      ...Julian Date (Note 1)
!     PV       d(3,2) observer's geocentric pos/vel (Note 3)
!
!  Returned:
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     unchanged
!               (23)     unchanged
!               (24)     unchanged
!               (25)     unchanged
!               (26)     unchanged
!               (27)     unchanged
!               (28)     unchanged
!               (29)     unchanged
!               (30)     unchanged
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.  For most
!     applications of this routine the choice will not be at all
!     critical.
!
!     TT can be used instead of TDB without any significant impact on
!     accuracy.
!
!  2) All the vectors are with respect to BCRS axes.
!
!  3) The observer's position and velocity PV are geocentric but with
!     respect to BCRS axes, and in units of m and m/s.  No assumptions
!     are made about proximity to the Earth, and the routine can be
!     used for deep space applications as well as Earth orbit and
!     terrestrial.
!
!  4) In cases where the caller wishes to supply his own Earth
!     ephemeris, the routine APCS can be used instead of the present
!     routine.
!
!  5) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  6) The context array ASTROM produced by this routine is used by
!     ATCIQ* and ATICQ*.
!
!  Called:
!     EPV00    Earth position and velocity
!     APCS     astrometry parameters, ICRS-GCRS, space observer
!
!  This revision:   2017 March 12
!
!-----------------------------------------------------------------------

implicit none
double precision date1, date2, pv(3,2), astrom(30)

integer j
double precision ehpv(3,2), ebpv(3,2)

!  Earth barycentric & heliocentric position/velocity (au, au/d).
call EPV00 ( date1, date2, ehpv, ebpv, j )

!  Compute the star-independent astrometry parameters.
call APCS ( date1, date2, pv, ebpv, ehpv, astrom )

end subroutine APCS13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APER ( theta, astrom )
!>
!  In the star-independent astrometry parameters, update only the
!  Earth rotation angle, supplied by the caller explicitly.
!
!  Status:  support routine.
!
!  Given:
!     THETA    d      Earth rotation angle (radians, Note 2)
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      not used
!               (2-4)    not used
!               (5-7)    not used
!               (8)      not used
!               (9-11)   not used
!               (12)     not used
!               (13-21)  not used
!               (22)     longitude + s' (radians)
!               (23)     not used
!               (24)     not used
!               (25)     not used
!               (26)     not used
!               (27)     not used
!               (28)     not used
!               (29)     not used
!               (30)     not used
!
!  Returned:
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      unchanged
!               (2-4)    unchanged
!               (5-7)    unchanged
!               (8)      unchanged
!               (9-11)   unchanged
!               (12)     unchanged
!               (13-21)  unchanged
!               (22)     unchanged
!               (23)     unchanged
!               (24)     unchanged
!               (25)     unchanged
!               (26)     unchanged
!               (27)     unchanged
!               (28)     "local" Earth rotation angle (radians)
!               (29)     unchanged
!               (30)     unchanged
!
!  Notes:
!
!  1) This routine exists to enable sidereal-tracking applications to
!     avoid wasteful recomputation of the bulk of the astrometry
!     parameters:  only the Earth rotation is updated.
!
!  2) For targets expressed as equinox based positions, such as
!     classical geocentric apparent (RA,Dec), the supplied THETA can be
!     Greenwich apparent sidereal time rather than Earth rotation
!     angle.
!
!  3) The routine APER13 can be used instead of the present routine,
!     and starts from UT1 rather than ERA itself.
!
!  4) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  This revision:   2013 September 25
!
!-----------------------------------------------------------------------

implicit none
double precision theta, astrom(30)

astrom(28) = theta + astrom(22)

end subroutine APER
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APER13 ( ut11, ut12, astrom )
!>
!  In the star-independent astrometry parameters, update only the
!  Earth rotation angle.  The caller provides UT1 (n.b. not UTC).
!
!  Status:  support routine.
!
!  Given:
!     UT11     d      UT1 as a 2-part...
!     UT12     d      ...Julian Date (Note 1)
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      not used
!               (2-4)    not used
!               (5-7)    not used
!               (8)      not used
!               (9-11)   not used
!               (12)     not used
!               (13-21)  not used
!               (22)     longitude + s' (radians)
!               (23)     not used
!               (24)     not used
!               (25)     not used
!               (26)     not used
!               (27)     not used
!               (28)     not used
!               (29)     not used
!               (30)     not used
!
!  Returned:
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      unchanged
!               (2-4)    unchanged
!               (5-7)    unchanged
!               (8)      unchanged
!               (9-11)   unchanged
!               (12)     unchanged
!               (13-21)  unchanged
!               (22)     unchanged
!               (23)     unchanged
!               (24)     unchanged
!               (25)     unchanged
!               (26)     unchanged
!               (27)     unchanged
!               (28)     "local" Earth rotation angle (radians)
!               (29)     unchanged
!               (30)     unchanged
!
!  Notes:
!
!  1) The UT1 date (n.b. not UTC) UT11+UT12 is a Julian Date,
!     apportioned in any convenient way between the arguments UT11 and
!     UT12.  For example, JD(UT1)=2450123.7 could be expressed in any
!     of these ways, among others:
!
!            UT11           UT12
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  The date & time method is
!     best matched to the algorithm used:  maximum precision is
!     delivered when the UT11 argument is for 0hrs UT1 on the day in
!     question and the UT12 argument lies in the range 0 to 1, or vice
!     versa.
!
!  2) If the caller wishes to provide the Earth rotation angle itself,
!     the routine APER can be used instead.  One use of this
!     technique is to substitute Greenwich apparent sidereal time and
!     thereby to support equinox based transformations directly.
!
!  3) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  Called:
!     APER     astrometry parameters: update ERA
!     ERA00    Earth rotation angle, IAU 2000
!
!  This revision:   2017 March 12
!
!-----------------------------------------------------------------------

implicit none
double precision ut11, ut12, astrom(30)

!     DOUBLE PRECISION ERA00

call APER ( ERA00 ( ut11, ut12 ), astrom )

end subroutine APER13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APIO ( sp, theta, elong, phi, hm, xp, yp, &
                      refa, refb, astrom )
!>
!  For a terrestrial observer, prepare star-independent astrometry
!  parameters for transformations between CIRS and observed coordinates.
!  The caller supplies the Earth orientation information and the
!  refraction constants as well as the site coordinates.
!
!  Status:  support routine.
!
!  Given:
!     SP       d      the TIO locator s' (radians, Note 1)
!     THETA    d      Earth rotation angle (radians)
!     ELONG    d      longitude (radians, east +ve, Note 2)
!     PHI      d      geodetic latitude (radians, Note 2)
!     HM       d      height above ellipsoid (m, geodetic Note 2)
!     XP,YP    d      polar motion coordinates (radians, Note 3)
!     REFA     d      refraction constant A (radians, Note 4)
!     REFB     d      refraction constant B (radians, Note 4)
!
!  Returned:
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      unchanged
!               (2-4)    unchanged
!               (5-7)    unchanged
!               (8)      unchanged
!               (9-11)   unchanged
!               (12)     unchanged
!               (13-21)  unchanged
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!
!  Notes:
!
!  1) SP, the TIO locator s', is a tiny quantity needed only by the most
!     precise applications.  It can either be set to zero or predicted
!     using the SOFA routine SP00.
!
!  2) The geographical coordinates are with respect to the WGS84
!     reference ellipsoid.  TAKE CARE WITH THE LONGITUDE SIGN:  the
!     longitude required by the present routine is east-positive
!     (i.e. right-handed), in accordance with geographical convention.
!
!  3) The polar motion XP,YP can be obtained from IERS bulletins.  The
!     values are the coordinates (in radians) of the Celestial
!     Intermediate Pole with respect to the International Terrestrial
!     Reference System (see IERS Conventions 2003), measured along the
!     meridians 0 and 90 deg west respectively.  For many applications,
!     XP and YP can be set to zero.
!
!     Internally, the polar motion is stored in a form rotated onto the
!     local meridian.
!
!  4) The refraction constants REFA and REFB are for use in a
!     dZ = A*tan(Z)+B*tan^3(Z) model, where Z is the observed
!     (i.e. refracted) zenith distance and dZ is the amount of
!     refraction.
!
!  5) It is advisable to take great care with units, as even unlikely
!     values of the input parameters are accepted and processed in
!     accordance with the models used.
!
!  6) In cases where the caller does not wish to provide the Earth
!     rotation information and refraction constants, the routine
!     APIO13 can be used instead of the present routine.  This
!     starts from UTC and weather readings etc. and computes suitable
!     values using other SOFA routines.
!
!  7) This is one of several routines that inserts into the ASTROM
!     array star-independent parameters needed for the chain of
!     astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!     The various routines support different classes of observer and
!     portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!     Those with names ending in "13" use contemporary SOFA models to
!     compute the various ephemerides.  The others accept ephemerides
!     supplied by the caller.
!
!     The transformation from ICRS to GCRS covers space motion,
!     parallax, light deflection, and aberration.  From GCRS to CIRS
!     comprises frame bias and precession-nutation.  From CIRS to
!     observed takes account of Earth rotation, polar motion, diurnal
!     aberration and parallax (unless subsumed into the ICRS <-> GCRS
!     transformation), and atmospheric refraction.
!
!  8) The context array ASTROM produced by this routine is used by
!     ATIOQ and ATOIQ.
!
!  Called:
!     PVTOB    position/velocity of terrestrial station
!     APER     astrometry parameters: update ERA
!
!  This revision:   2013 September 25
!
!-----------------------------------------------------------------------

implicit none
double precision sp, theta, elong, phi, hm, xp, yp, refa, refb, &
                 astrom(30)

! Speed of light (m/s)
double precision cmps
parameter ( cmps = 299792458d0 )

double precision sl, cl, pv(3,2)

!  Longitude with adjustment for TIO locator s'.
astrom(22) = elong + sp

!  Polar motion, rotated onto the local meridian.
sl = sin(astrom(22))
cl = cos(astrom(22))
astrom(23) = xp*cl - yp*sl
astrom(24) = xp*sl + yp*cl

!  Functions of latitude.
astrom(25) = sin(phi)
astrom(26) = cos(phi)

!  Observer's geocentric position and velocity (m, m/s, CIRS).
call PVTOB ( elong, phi, hm, xp, yp, sp, theta, pv )

!  Magnitude of diurnal aberration vector.
astrom(27) = sqrt ( pv(1,2)*pv(1,2) + pv(2,2)*pv(2,2) ) / cmps

!  Refraction constants.
astrom(29) = refa
astrom(30) = refb

!  Local Earth rotation angle.
call APER ( theta, astrom )

end subroutine APIO
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine APIO13 ( utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                        phpa, tc, rh, wl, astrom, j )
!>
!  For a terrestrial observer, prepare star-independent astrometry
!  parameters for transformations between CIRS and observed coordinates.
!  The caller supplies UTC, site coordinates, ambient air conditions and
!  observing wavelength.
!
!  Status:  support routine.
!
!  Given:
!     UTC1     d      UTC as a 2-part...
!     UTC2     d      ...quasi Julian Date (Notes 1,2)
!     DUT1     d      UT1-UTC (seconds)
!     ELONG    d      longitude (radians, east +ve, Note 3)
!     PHI      d      geodetic latitude (radians, Note 3)
!     HM       d      height above ellipsoid (m, geodetic Notes 4,6)
!     XP,YP    d      polar motion x-coordinates (radians, Note 5)
!     PHPA     d      pressure at the observer (hPa = mB, Note 6)
!     TC       d      ambient temperature at the observer (deg C)
!     RH       d      relative humidity at the observer (range 0-1)
!     WL       d      wavelength (micrometers, Note 7)
!
!  Returned:
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      unchanged
!               (2-4)    unchanged
!               (5-7)    unchanged
!               (8)      unchanged
!               (9-11)   unchanged
!               (12)     unchanged
!               (13-21)  unchanged
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!     J        i         status: +1 = dubious year (Note 2)
!                                 0 = OK
!                                -1 = unacceptable date
!
!  Notes:
!
!  1)  UTC1+UTC2 is quasi Julian Date (see Note 2), apportioned in any
!      convenient way between the two arguments, for example where UTC1
!      is the Julian Day Number and UTC2 is the fraction of a day.
!
!      However, JD cannot unambiguously represent UTC during a leap
!      second unless special measures are taken.  The convention in the
!      present routine is that the JD day represents UTC days whether
!      the length is 86399, 86400 or 86401 SI seconds.
!
!      Applications should use the routine DTF2D to convert from
!      calendar date and time of day into 2-part quasi Julian Date, as
!      it implements the leap-second-ambiguity convention just
!      described.
!
!  2)  The warning status "dubious year" flags UTCs that predate the
!      introduction of the time scale or that are too far in the future
!      to be trusted.  See DAT for further details.
!
!  3)  UT1-UTC is tabulated in IERS bulletins.  It increases by exactly
!      one second at the end of each positive UTC leap second,
!      introduced in order to keep UT1-UTC within +/- 0.9s.  n.b. This
!      practice is under review, and in the future UT1-UTC may grow
!      essentially without limit.
!
!  4)  The geographical coordinates are with respect to the WGS84
!      reference ellipsoid.  TAKE CARE WITH THE LONGITUDE SIGN:  the
!      longitude required by the present routine is east-positive
!      (i.e. right-handed), in accordance with geographical convention.
!
!  5)  The polar motion XP,YP can be obtained from IERS bulletins.  The
!      values are the coordinates (in radians) of the Celestial
!      Intermediate Pole with respect to the International Terrestrial
!      Reference System (see IERS Conventions 2003), measured along the
!      meridians 0 and 90 deg west respectively.  For many applications,
!      XP and YP can be set to zero.
!
!      Internally, the polar motion is stored in a form rotated onto
!      the local meridian.
!
!  6)  If hm, the height above the ellipsoid of the observing station
!      in meters, is not known but phpa, the pressure in hPa (=mB), is
!      available, an adequate estimate of hm can be obtained from the
!      expression
!
!            hm = -29.3 * tsl * log ( phpa / 1013.25 );
!
!      where tsl is the approximate sea-level air temperature in K
!      (See Astrophysical Quantities, C.W.Allen, 3rd edition, section
!      52).  Similarly, if the pressure phpa is not known, it can be
!      estimated from the height of the observing station, hm, as
!      follows:
!
!            phpa = 1013.25 * exp ( -hm / ( 29.3 * tsl ) );
!
!      Note, however, that the refraction is nearly proportional to the
!      pressure and that an accurate phpa value is important for
!      precise work.
!
!  7)  The argument WL specifies the observing wavelength in
!      micrometers.  The transition from optical to radio is assumed to
!      occur at 100 micrometers (about 3000 GHz).
!
!  8)  It is advisable to take great care with units, as even unlikely
!      values of the input parameters are accepted and processed in
!      accordance with the models used.
!
!  9)  In cases where the caller wishes to supply his own Earth
!      rotation information and refraction constants, the routine
!      APC can be used instead of the present routine.
!
!  10) This is one of several routines that inserts into the ASTROM
!      array star-independent parameters needed for the chain of
!      astrometric transformations ICRS <-> GCRS <-> CIRS <-> observed.
!
!      The various routines support different classes of observer and
!      portions of the transformation chain:
!
!            routines           observer        transformation
!
!        APCG APCG13    geocentric      ICRS <-> GCRS
!        APCI APCI13    terrestrial     ICRS <-> CIRS
!        APCO APCO13    terrestrial     ICRS <-> observed
!        APCS APCS13    space           ICRS <-> GCRS
!        APER APER13    terrestrial     update Earth rotation
!        APIO APIO13    terrestrial     CIRS <-> observed
!
!      Those with names ending in "13" use contemporary SOFA models to
!      compute the various ephemerides.  The others accept ephemerides
!      supplied by the caller.
!
!      The transformation from ICRS to GCRS covers space motion,
!      parallax, light deflection, and aberration.  From GCRS to CIRS
!      comprises frame bias and precession-nutation.  From CIRS to
!      observed takes account of Earth rotation, polar motion, diurnal
!      aberration and parallax (unless subsumed into the ICRS <-> GCRS
!      transformation), and atmospheric refraction.
!
!  11) The context array ASTROM produced by this routine is used by
!      ATIOQ and ATOIQ.
!
!  Called:
!     UTCTAI   UTC to TAI
!     TAITT    TAI to TT
!     UTCUT1   UTC to UT1
!     SP00     the TIO locator s', IERS 2000
!     ERA00    Earth rotation angle, IAU 2000
!     REFCO    refraction constants for given ambient conditions
!     APIO     astrometry parameters, CIRS-observed
!
!  This revision:   2013 September 25
!
!-----------------------------------------------------------------------

implicit none
double precision utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                 phpa, tc, rh, wl, astrom(30)
integer j

integer js
double precision tai1, tai2, tt1, tt2, ut11, ut12, sp, theta, &
                 refa, refb

!     DOUBLE PRECISION SP00, ERA00

!  UTC to other time scales.
call UTCTAI ( utc1, utc2, tai1, tai2, js )
call TAITT ( tai1, tai2, tt1, tt2, js )
call UTCUT1 ( utc1, utc2, dut1, ut11, ut12, js )

!  Abort if error.
if ( js<0 ) go to 9

!  TIO locator s'.
sp = SP00 ( tt1, tt2 )

!  Earth rotation angle.
theta = ERA00 ( ut11, ut12 )

!  Refraction constants A and B.
call REFCO ( phpa, tc, rh, wl, refa, refb )

!  CIRS <-> observed astrometry parameters.
call APIO ( sp, theta, elong, phi, hm, xp, yp, refa, refb, &
                astrom )

!  Return the status.
9 continue
j = js

end subroutine APIO13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATCI13 ( rc, dc, pr, pd, px, rv, date1, date2, &
                        ri, di, eo )
!>
!  Transform ICRS star data, epoch J2000.0, to CIRS.
!
!  Status:  support routine.
!
!  Given:
!     RC       d      ICRS right ascension at J2000.0 (radians, Note 1)
!     DC       d      ICRS declination at J2000.0 (radians, Note 1)
!     PR       d      RA proper motion (radians/year; Note 2)
!     PD       d      Dec proper motion (radians/year)
!     PX       d      parallax (arcsec)
!     RV       d      radial velocity (km/s, +ve if receding)
!     DATE1    d      TDB as a 2-part...
!     DATE2    d      ...Julian Date (Note 3)
!
!  Returned:
!     RI,DI    d      CIRS geocentric RA,Dec (radians)
!     EO       d      equation of the origins (ERA-GST, Note 5)
!
!  Notes:
!
!  1) Star data for an epoch other than J2000.0 (for example from the
!     Hipparcos catalog, which has an epoch of J1991.25) will require a
!     preliminary call to PMSAFE before use.
!
!  2) The proper motion in RA is dRA/dt rather than cos(Dec)*dRA/dt.
!
!  3) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.  For most
!     applications of this routine the choice will not be at all
!     critical.
!
!     TT can be used instead of TDB without any significant impact on
!     accuracy.
!
!  4) The available accuracy is better than 1 milliarcsecond, limited
!     mainly by the precession-nutation model that is used, namely
!     IAU 2000A/2006.  Very close to solar system bodies, additional
!     errors of up to several milliarcseconds can occur because of
!     unmodeled light deflection;  however, the Sun's contribution is
!     taken into account, to first order.  The accuracy limitations of
!     the SOFA routine EPV00 (used to compute Earth position and
!     velocity) can contribute aberration errors of up to
!     5 microarcseconds.  Light deflection at the Sun's limb is
!     uncertain at the 0.4 mas level.
!
!  5) Should the transformation to (equinox based) apparent place be
!     required rather than (CIO based) intermediate place, subtract the
!     equation of the origins from the returned right ascension:
!     RA = RI - EO. (The ANP routine can then be applied, as
!     required, to keep the result in the conventional 0-2pi range.)
!
!  Called:
!     APCI13   astrometry parameters, ICRS-CIRS, 2013
!     ATCIQ    quick ICRS to CIRS
!
!  This revision:   2017 March 12
!
!-----------------------------------------------------------------------

implicit none
double precision rc, dc, pr, pd, px, rv, date1, date2, ri, di, eo

!  Star-independent astrometry parameters
double precision astrom(30)

!  The transformation parameters.
call APCI13 ( date1, date2, astrom, eo )

!  ICRS (epoch J2000.0) to CIRS.
call ATCIQ ( rc, dc, pr, pd, px, rv, astrom, ri, di )

end subroutine ATCI13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATCIQ ( rc, dc, pr, pd, px, rv, astrom, ri, di )
!>
!  Quick ICRS, epoch J2000.0, to CIRS transformation, given precomputed
!  star-independent astrometry parameters.
!
!  Use of this routine is appropriate when efficiency is important and
!  where many star positions are to be transformed for one date.  The
!  star-independent parameters can be obtained by calling one of the
!  routines APCI[13], APCG[13], APCO[13] or APCS[13].
!
!  If the parallax and proper motions are zero the ATCIQZ routine
!  can be used instead.
!
!  Status:  support routine.
!
!  Given:
!     RC,DC    d      ICRS RA,Dec at J2000.0 (radians)
!     PR       d      RA proper motion (radians/year; Note 3)
!     PD       d      Dec proper motion (radians/year)
!     PX       d      parallax (arcsec)
!     RV       d      radial velocity (km/s, +ve if receding)
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!
!  Returned:
!     RI,DI    d      CIRS RA,Dec (radians)
!
!  Notes:
!
!  1) All the vectors are with respect to BCRS axes.
!
!  2) Star data for an epoch other than J2000.0 (for example from the
!     Hipparcos catalog, which has an epoch of J1991.25) will require a
!     preliminary call to PMSAFE before use.
!
!  3) The proper motion in RA is dRA/dt rather than cos(Dec)*dRA/dt.
!
!  Called:
!     PMPX     proper motion and parallax
!     LDSUN    light deflection by the Sun
!     AB       stellar aberration
!     RXP      product of r-matrix and pv-vector
!     C2S      p-vector to spherical
!     ANP      normalize angle into range 0 to 2pi
!
!  This revision:   2013 August 25
!
!-----------------------------------------------------------------------

implicit none
double precision rc, dc, pr, pd, px, rv, astrom(30), ri, di

double precision pco(3), pnat(3), ppr(3), pi(3), w

!     DOUBLE PRECISION ANP

!  Proper motion and parallax, giving BCRS coordinate direction.
call PMPX ( rc, dc, pr, pd, px, rv, astrom(1), astrom(2), &
                pco )

!  Light deflection by the Sun, giving BCRS natural direction.
call LDSUN ( pco, astrom(5), astrom(8), pnat )

!  Aberration, giving GCRS proper direction.
call AB (pnat, astrom(9), astrom(8), astrom(12), ppr )

!  Bias-precession-nutation, giving CIRS proper direction.
call RXP ( astrom(13), ppr, pi )

!  CIRS RA,Dec.
call C2S ( pi, w, di )
ri = ANP ( w )

end subroutine ATCIQ
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATCIQN ( rc, dc, pr, pd, px, rv, astrom, n, b, &
                        ri, di )
!>
!  Quick ICRS, epoch J2000.0, to CIRS transformation, given precomputed
!  star-independent astrometry parameters plus a list of light-
!  deflecting bodies.
!
!  Use of this routine is appropriate when efficiency is important and
!  where many star positions are to be transformed for one date.  The
!  star-independent parameters can be obtained by calling one of the
!  routines APCI[13], APCG[13], APCO[13] or APCS[13].
!
!  If the only light-deflecting body to be taken into account is the
!  Sun, the ATCIQ routine can be used instead.  If in addition the
!  parallax and proper motions are zero, the ATCIQZ routine can be
!  used.
!
!  Status:  support routine.
!
!  Given:
!     RC,DC    d      ICRS RA,Dec at J2000.0 (radians, Note 1)
!     PR       d      RA proper motion (radians/year; Note 2)
!     PD       d      Dec proper motion (radians/year)
!     PX       d      parallax (arcsec)
!     RV       d      radial velocity (km/s, +ve if receding)
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!     N        i       number of bodies (Note 3)
!     B        d(8,N)  data for each of the NB bodies (Notes 3,4):
!               (1,I)    mass of the body (solar masses, Note 5)
!               (2,I)    deflection limiter (Note 6)
!               (3-5,I)  barycentric position of the body (au)
!               (6-8,I)  barycentric velocity of the body (au/day)
!
!  Returned:
!     RI,DI    d      CIRS RA,Dec (radians)
!
!  Notes:
!
!  1) Star data for an epoch other than J2000.0 (for example from the
!     Hipparcos catalog, which has an epoch of J1991.25) will require a
!     preliminary call to PMSAFE before use.
!
!  2) The proper motion in RA is dRA/dt rather than cos(Dec)*dRA/dt.
!
!  3) The array B contains N entries, one for each body to be
!     considered.  If N = 0, no gravitational light deflection will be
!     applied, not even for the Sun.
!
!  4) The array B should include an entry for the Sun as well as for any
!     planet or other body to be taken into account.  The entries should
!     be in the order in which the light passes the body.
!
!  5) In the entry in the B array for body I, the mass parameter B(1,I)
!     can, as required, be adjusted in order to allow for such effects
!     as quadrupole field.
!
!  6) The deflection limiter parameter B(2,I) is phi^2/2, where phi is
!     the angular separation (in radians) between star and body at which
!     limiting is applied.  As phi shrinks below the chosen threshold,
!     the deflection is artificially reduced, reaching zero for phi = 0.
!     Example values suitable for a terrestrial observer, together with
!     masses, are as follows:
!
!        body I     B(1,I)         B(2,I)
!
!        Sun        1D0            6D-6
!        Jupiter    0.00095435D0   3D-9
!        Saturn     0.00028574D0   3D-10
!
!  7) For efficiency, validation of the B array is omitted.  The
!     supplied masses must be greater than zero, the position and
!     velocity vectors must be right, and the deflection limiter
!     greater than zero.
!
!  Called:
!     PMPX     proper motion and parallax
!     LDN      light deflection by n bodies
!     AB       stellar aberration
!     RXP      product of r-matrix and pv-vector
!     C2S      p-vector to spherical
!     ANP      normalize angle into range 0 to 2pi
!
!  This revision:   2013 September 30
!
!-----------------------------------------------------------------------

implicit none
double precision rc, dc, pr, pd, px, rv, astrom(30)
integer n
double precision b(8,n), ri, di

double precision pco(3), pnat(3), ppr(3), pi(3), w

!     DOUBLE PRECISION ANP

!  Proper motion and parallax, giving BCRS coordinate direction.
call PMPX ( rc, dc, pr, pd, px, rv, astrom(1), astrom(2), &
                pco )

!  Light deflection, giving BCRS natural direction.
call LDN ( n, b, astrom(2), pco, pnat )

!  Aberration, giving GCRS proper direction.
call AB (pnat, astrom(9), astrom(8), astrom(12), ppr )

!  Bias-precession-nutation, giving CIRS proper direction.
call RXP ( astrom(13), ppr, pi )

!  CIRS RA,Dec.
call C2S ( pi, w, di )
ri = ANP ( w )

end subroutine ATCIQN
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATCIQZ ( rc, dc, astrom, ri, di )
!>
!  Quick ICRS to CIRS transformation, given precomputed star-independent
!  astrometry parameters, and assuming zero parallax and proper motion.
!
!  Use of this routine is appropriate when efficiency is important and
!  where many star positions are to be transformed for one date.  The
!  star-independent parameters can be obtained by calling one of the
!  routines APCI[13], APCG[13], APCO[13] or APCS[13].
!
!  The corresponding routine for the case of non-zero parallax and
!  proper motion is ATCIQ.
!
!  Status:  support routine.
!
!  Given:
!     RC,DC    d      ICRS astrometric RA,Dec (radians)
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!
!  Returned:
!     RI,DI    d      CIRS RA,Dec (radians)
!
!  Note:
!
!     All the vectors are with respect to BCRS axes.
!
!  References:
!
!     Urban, S. & Seidelmann, P. K. (eds), Explanatory Supplement to
!     the Astronomical Almanac, 3rd ed., University Science Books
!     (2013).
!
!     Klioner, Sergei A., "A practical relativistic model for micro-
!     arcsecond astrometry in space", Astr. J. 125, 1580-1597 (2003).
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     LDSUN    light deflection due to Sun
!     AB       stellar aberration
!     RXP      product of r-matrix and p-vector
!     C2S      p-vector to spherical
!     ANP      normalize angle into range +/- pi
!
!  This revision:   2013 August 31
!
!-----------------------------------------------------------------------

implicit none
double precision rc, dc, astrom(30), ri, di

double precision pco(3), pnat(3), ppr(3), pi(3), w

!     DOUBLE PRECISION ANP

!  BCRS coordinate direction (unit vector).
call S2C ( rc, dc, pco )

!  Light deflection by the Sun, giving BCRS natural direction.
call LDSUN ( pco, astrom(5), astrom(8), pnat )

!  Aberration, giving GCRS proper direction.
call AB ( pnat, astrom(9), astrom(8), astrom(12), ppr )

!  Bias-precession-nutation, giving CIRS proper direction.
call RXP ( astrom(13), ppr, pi )

!  CIRS RA,Dec.
call C2S ( pi, w, di )
ri = ANP ( w )

end subroutine ATCIQZ
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATCO13 ( rc, dc, pr, pd, px, rv, &
                        utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                        phpa, tc, rh, wl, &
                        aob, zob, hob, dob, rob, eo, j )
!>
!  ICRS RA,Dec to observed place.  The caller supplies UTC, site
!  coordinates, ambient air conditions and observing wavelength.
!
!  Status:  support routine.
!
!  Given:
!     RC,DC    d      ICRS right ascension at J2000.0 (radians, Note 1)
!     PR       d      RA proper motion (radians/year; Note 2)
!     PD       d      Dec proper motion (radians/year)
!     PX       d      parallax (arcsec)
!     RV       d      radial velocity (km/s, +ve if receding)
!     UTC1     d      UTC as a 2-part...
!     UTC2     d      ...quasi Julian Date (Notes 3-4)
!     DUT1     d      UT1-UTC (seconds, Note 5)
!     ELONG    d      longitude (radians, east +ve, Note 6)
!     PHI      d      latitude (geodetic, radians, Note 6)
!     HM       d      height above ellipsoid (m, geodetic, Notes 6,8)
!     XP,YP    d      polar motion coordinates (radians, Note 7)
!     PHPA     d      pressure at the observer (hPa = mB, Note 8)
!     TC       d      ambient temperature at the observer (deg C)
!     RH       d      relative humidity at the observer (range 0-1)
!     WL       d      wavelength (micrometers, Note 9)
!
!  Returned:
!     AOB      d      observed azimuth (radians: N=0,E=90)
!     ZOB      d      observed zenith distance (radians)
!     HOB      d      observed hour angle (radians)
!     DOB      d      observed declination (radians)
!     ROB      d      observed right ascension (CIO-based, radians)
!     EO       d      equation of the origins (ERA-GST)
!     J        i      status: +1 = dubious year (Note 4)
!                              0 = OK
!                             -1 = unacceptable date
!
!  Notes:
!
!  1)  Star data for an epoch other than J2000.0 (for example from the
!      Hipparcos catalog, which has an epoch of J1991.25) will require
!      a preliminary call to PMSAFE before use.
!
!  2)  The proper motion in RA is dRA/dt rather than cos(Dec)*dRA/dt.
!
!  3)  UTC1+UTC2 is quasi Julian Date (see Note 2), apportioned in any
!      convenient way between the two arguments, for example where UTC1
!      is the Julian Day Number and UTC2 is the fraction of a day.
!
!      However, JD cannot unambiguously represent UTC during a leap
!      second unless special measures are taken.  The convention in the
!      present routine is that the JD day represents UTC days whether
!      the length is 86399, 86400 or 86401 SI seconds.
!
!      Applications should use the routine DTF2D to convert from
!      calendar date and time of day into 2-part quasi Julian Date, as
!      it implements the leap-second-ambiguity convention just
!      described.
!
!  4)  The warning status "dubious year" flags UTCs that predate the
!      introduction of the time scale or that are too far in the
!      future to be trusted.  See DAT for further details.
!
!  5)  UT1-UTC is tabulated in IERS bulletins.  It increases by exactly
!      one second at the end of each positive UTC leap second,
!      introduced in order to keep UT1-UTC within +/- 0.9s.  n.b. This
!      practice is under review, and in the future UT1-UTC may grow
!      essentially without limit.
!
!  6)  The geographical coordinates are with respect to the WGS84
!      reference ellipsoid.  TAKE CARE WITH THE LONGITUDE SIGN:  the
!      longitude required by the present routine is east-positive
!      (i.e. right-handed), in accordance with geographical convention.
!
!  7)  The polar motion XP,YP can be obtained from IERS bulletins.  The
!      values are the coordinates (in radians) of the Celestial
!      Intermediate Pole with respect to the International Terrestrial
!      Reference System (see IERS Conventions 2003), measured along the
!      meridians 0 and 90 deg west respectively.  For many applications,
!      XP and YP can be set to zero.
!
!  8)  If hm, the height above the ellipsoid of the observing station
!      in meters, is not known but phpa, the pressure in hPa (=mB),
!      is available, an adequate estimate of hm can be obtained from
!      the expression
!
!            hm = -29.3 * tsl * log ( phpa / 1013.25 );
!
!      where tsl is the approximate sea-level air temperature in K
!      (See Astrophysical Quantities, C.W.Allen, 3rd edition, section
!      52).  Similarly, if the pressure phpa is not known, it can be
!      estimated from the height of the observing station, hm, as
!      follows:
!
!            phpa = 1013.25 * exp ( -hm / ( 29.3 * tsl ) );
!
!      Note, however, that the refraction is nearly proportional to
!      the pressure and that an accurate phpa value is important for
!      precise work.
!
!  9)  The argument WL specifies the observing wavelength in
!      micrometers.  The transition from optical to radio is assumed to
!      occur at 100 micrometers (about 3000 GHz).
!
!  10) The accuracy of the result is limited by the corrections for
!      refraction, which use a simple A*tan(z) + B*tan^3(z) model.
!      Providing the meteorological parameters are known accurately and
!      there are no gross local effects, the predicted observed
!      coordinates should be within 0.05 arcsec (optical) or 1 arcsec
!      (radio) for a zenith distance of less than 70 degrees, better
!      than 30 arcsec (optical or radio) at 85 degrees and better than
!      20 arcmin (optical) or 30 arcmin (radio) at the horizon.
!
!      Without refraction, the complementary routines ATCO13 and
!      ATOC13 are self-consistent to better than 1 microarcsecond
!      all over the celestial sphere.  With refraction included,
!      consistency falls off at high zenith distances, but is still
!      better than 0.05 arcsec at 85 degrees.
!
!  11) "Observed" Az,ZD means the position that would be seen by a
!      perfect geodetically aligned theodolite.  (Zenith distance is
!      used rather than altitude in order to reflect the fact that no
!      allowance is made for depression of the horizon.)  This is
!      related to the observed HA,Dec via the standard rotation, using
!      the geodetic latitude (corrected for polar motion), while the
!      observed HA and RA are related simply through the Earth rotation
!      angle and the site longitude.  "Observed" RA,Dec or HA,Dec thus
!      means the position that would be seen by a perfect equatorial
!      with its polar axis aligned to the Earth's axis of rotation.
!
!  12) It is advisable to take great care with units, as even unlikely
!      values of the input parameters are accepted and processed in
!      accordance with the models used.
!
!  Called:
!     APCO13   astrometry parameters, ICRS-observed, 2013
!     ATCIQ    quick ICRS to CIRS
!     ATIOQ    quick CIRS to observed
!
!  This revision:   2016 February 2
!
!-----------------------------------------------------------------------

implicit none
double precision rc, dc, pr, pd, px, rv, utc1, utc2, dut1, &
                 elong, phi, hm, xp, yp, phpa, tc, rh, wl, &
                 aob, zob, hob, dob, rob, eo
integer j

integer js
double precision astrom(30)
double precision ri, di

!  Star-independent astrometry parameters.
call APCO13 ( utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                  phpa, tc, rh, wl, astrom, eo, js )
if ( js<0 ) go to 9

!  Transform ICRS to CIRS.
call ATCIQ ( rc, dc, pr, pd, px, rv, astrom, ri, di )

!  Transform CIRS to observed.
call ATIOQ ( ri, di, astrom, aob, zob, hob, dob, rob )

!  Return OK/warning status.
9 continue
j = js

end subroutine ATCO13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATIC13 ( ri, di, date1, date2, rc, dc, eo )
!>
!  Transform star RA,Dec from geocentric CIRS to ICRS astrometric.
!
!  Status:  support routine.
!
!  Given:
!     RI,DI    d      CIRS geocentric RA,Dec (radians)
!     DATE1    d      TDB as a 2-part...
!     DATE2    d      ...Julian Date (Note 1)
!
!  Returned:
!     RC,DC    d      ICRS astrometric RA,Dec (radians)
!     EO       d      equation of the origins (ERA-GST, Note 4)
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.  For most
!     applications of this routine the choice will not be at all
!     critical.
!
!     TT can be used instead of TDB without any significant impact on
!     accuracy.
!
!  2) Iterative techniques are used for the aberration and light
!     deflection corrections so that the routines ATIC13 (or
!     ATICQ) and ATCI13 (or ATCIQ) are accurate inverses;
!     even at the edge of the Sun's disk the discrepancy is only about
!     1 nanoarcsecond.
!
!  3) The available accuracy is better than 1 milliarcsecond, limited
!     mainly by the precession-nutation model that is used, namely
!     IAU 2000A/2006.  Very close to solar system bodies, additional
!     errors of up to several milliarcseconds can occur because of
!     unmodeled light deflection;  however, the Sun's contribution is
!     taken into account, to first order.  The accuracy limitations of
!     the SOFA routine EPV00 (used to compute Earth position and
!     velocity) can contribute aberration errors of up to
!     5 microarcseconds.  Light deflection at the Sun's limb is
!     uncertain at the 0.4 mas level.
!
!  4) Should the transformation to (equinox based) J2000.0 mean place
!     be required rather than (CIO based) ICRS coordinates, subtract the
!     equation of the origins from the returned right ascension:
!     RA = RI - EO.  (The ANP routine can then be applied, as
!     required, to keep the result in the conventional 0-2pi range.)
!
!  Called:
!     APCI13   astrometry parameters, ICRS-CIRS, 2013
!     ATICQ    quick CIRS to ICRS astrometric
!
!  This revision:   2017 March 12
!
!-----------------------------------------------------------------------

implicit none
double precision ri, di, date1, date2, rc, dc, eo

!  Star-independent astrometry parameters
double precision astrom(30)

!  Star-independent astrometry parameters.
call APCI13 ( date1, date2, astrom, eo )

!  CIRS to ICRS astrometric
call ATICQ ( ri, di, astrom, rc, dc )

end subroutine ATIC13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATICQ ( ri, di, astrom, rc, dc )
!>
!  Quick CIRS RA,Dec to ICRS astrometric place, given the star-
!  independent astrometry parameters.
!
!  Use of this routine is appropriate when efficiency is important and
!  where many star positions are all to be transformed for one date.
!  The star-independent astrometry parameters can be obtained by
!  calling one of the routines APCI[13], APCG[13], APCO[13]
!  or APCS[13].
!
!  Status:  support routine.
!
!  Given:
!     RI,DI    d      CIRS RA,Dec (radians)
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!
!  Returned:
!     RC,DC    d      ICRS astrometric RA,Dec (radians)
!
!  Notes:
!
!  1) Only the Sun is taken into account in the light deflection
!     correction.
!
!  2) Iterative techniques are used for the aberration and light
!     deflection corrections so that the routines ATIC13 (or
!     ATICQ) and ATCI13 (or ATCIQ) are accurate inverses;
!     even at the edge of the Sun's disk the discrepancy is only about
!     1 nanoarcsecond.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     TRXP     product of transpose of r-matrix and p-vector
!     ZP       zero p-vector
!     AB       stellar aberration
!     LDSUN    light deflection by the Sun
!     C2S      p-vector to spherical
!     ANP      normalize angle into range +/- pi
!
!  This revision:   2013 August 3
!
!-----------------------------------------------------------------------

implicit none
double precision ri, di, astrom(30), rc, dc

integer j, i
double precision pi(3), ppr(3), pnat(3), pco(3), w, d(3), &
                 before(3), r2, r, after(3)

!     DOUBLE PRECISION ANP

!  CIRS RA,Dec to Cartesian.
call S2C ( ri, di, pi )

!  Bias-precession-nutation, giving GCRS proper direction.
call TRXP ( astrom(13), pi, ppr )

!  Aberration, giving GCRS natural direction.
call ZP ( d )
do 50 j=1,2
   r2 = 0d0
   do 10 i=1,3
      w = ppr(i) - d(i)
      before(i) = w
      r2 = r2 + w*w
10    continue
   r = sqrt ( r2 )
   do 20 i=1,3
      before(i) = before(i) / r
20    continue
   call AB ( before, astrom(9), astrom(8), astrom(12), after )
   r2 = 0d0
   do 30 i=1,3
      d(i) = after(i) - before(i)
      w = ppr(i) - d(i)
      pnat(i) = w
      r2 = r2 + w*w
30    continue
   r = sqrt ( r2 )
   do 40 i=1,3
      pnat(i) = pnat(i) / r
40    continue
50 continue

!  Light deflection by the Sun, giving BCRS coordinate direction.
call ZP ( d )
do 100 j=1,5
   r2 = 0d0
   do 60 i=1,3
      w = pnat(i) - d(i)
      before(i) = w
      r2 = r2 + w*w
60    continue
   r = sqrt ( r2 )
   do 70 i=1,3
      before(i) = before(i) / r
70    continue
   call LDSUN ( before, astrom(5), astrom(8), after )
   r2 = 0d0
   do 80 i=1,3
      d(i) = after(i) - before(i)
      w = pnat(i) - d(i)
      pco(i) = w
      r2 = r2 + w*w
80    continue
   r = sqrt ( r2 )
   do 90 i=1,3
      pco(i) = pco(i) / r
90    continue
100 continue

!  ICRS astrometric RA,Dec.
call C2S ( pco, w, dc )
rc = ANP ( w )

end subroutine ATICQ
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATICQN ( ri, di, astrom, n, b, rc, dc )
!>
!  Quick CIRS to ICRS astrometric place transformation, given the
!  star-independent astrometry parameters plus a list of light-
!  deflecting bodies.
!
!  Use of this routine is appropriate when efficiency is important and
!  where many star positions are all to be transformed for one date.
!  The star-independent astrometry parameters can be obtained by
!  calling one of the routines APCI[13], APCG[13], APCO[13]
!  or APCS[13].
!
!  If the only light-deflecting body to be taken into account is the
!  Sun, the ATICQ routine can be used instead.
!
!  Status:  support routine.
!
!  Given:
!     RI,DI    d      CIRS RA,Dec (radians)
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!     N        i       number of bodies (Note 3)
!     B        d(8,N)  data for each of the NB bodies (Notes 3,4):
!               (1,I)    mass of the body (solar masses, Note 5)
!               (2,I)    deflection limiter (Note 6)
!               (3-5,I)  barycentric position of the body (au)
!               (6-8,I)  barycentric velocity of the body (au/day)
!
!  Returned:
!     RC,DC    d      ICRS astrometric RA,Dec (radians)
!
!  Notes:
!
!  1) Iterative techniques are used for the aberration and light
!     deflection corrections so that the routines ATICQN and
!     ATCIQN are accurate inverses; even at the edge of the Sun's
!     disk the discrepancy is only about 1 nanoarcsecond.
!
!  2) If the only light-deflecting body to be taken into account is the
!     Sun, the ATICQ routine can be used instead.
!
!  3) The array B contains N entries, one for each body to be
!     considered.  If N = 0, no gravitational light deflection will be
!     applied, not even for the Sun.
!
!  4) The array B should include an entry for the Sun as well as for any
!     planet or other body to be taken into account.  The entries should
!     be in the order in which the light passes the body.
!
!  5) In the entry in the B array for body I, the mass parameter B(1,I)
!     can, as required, be adjusted in order to allow for such effects
!     as quadrupole field.
!
!  6) The deflection limiter parameter B(2,I) is phi^2/2, where phi is
!     the angular separation (in radians) between star and body at which
!     limiting is applied.  As phi shrinks below the chosen threshold,
!     the deflection is artificially reduced, reaching zero for phi = 0.
!     Example values suitable for a terrestrial observer, together with
!     masses, are as follows:
!
!        body I     B(1,I)         B(2,I)
!
!        Sun        1D0            6D-6
!        Jupiter    0.00095435D0   3D-9
!        Saturn     0.00028574D0   3D-10
!
!  7) For efficiency, validation of the contents of the B array is
!     omitted.  The supplied masses must be greater than zero, the
!     position and velocity vectors must be right, and the deflection
!     limiter greater than zero.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     TRXP     product of transpose of r-matrix and p-vector
!     ZP       zero p-vector
!     AB       stellar aberration
!     LDN      light deflection by n bodies
!     C2S      p-vector to spherical
!     ANP      normalize angle into range +/- pi
!
!  This revision:   2013 September 30
!
!-----------------------------------------------------------------------

implicit none
double precision ri, di, astrom(30)
integer n
double precision b(8,n), rc, dc

integer j, i
double precision pi(3), ppr(3), pnat(3), pco(3), w, d(3), &
                 before(3), r2, r, after(3)

!     DOUBLE PRECISION ANP

!  CIRS RA,Dec to Cartesian.
call S2C ( ri, di, pi )

!  Bias-precession-nutation, giving GCRS proper direction.
call TRXP ( astrom(13), pi, ppr )

!  Aberration, giving GCRS natural direction.
call ZP ( d )
do 50 j=1,2
   r2 = 0d0
   do 10 i=1,3
      w = ppr(i) - d(i)
      before(i) = w
      r2 = r2 + w*w
10    continue
   r = sqrt ( r2 )
   do 20 i=1,3
      before(i) = before(i) / r
20    continue
   call AB ( before, astrom(9), astrom(8), astrom(12), after )
   r2 = 0d0
   do 30 i=1,3
      d(i) = after(i) - before(i)
      w = ppr(i) - d(i)
      pnat(i) = w
      r2 = r2 + w*w
30    continue
   r = sqrt ( r2 )
   do 40 i=1,3
      pnat(i) = pnat(i) / r
40    continue
50 continue

!  Light deflection, giving BCRS coordinate direction.
call ZP ( d )
do 100 j=1,5
   r2 = 0d0
   do 60 i=1,3
      w = pnat(i) - d(i)
      before(i) = w
      r2 = r2 + w*w
60    continue
   r = sqrt ( r2 )
   do 70 i=1,3
      before(i) = before(i) / r
70    continue
   call LDN ( n, b, astrom(2), before, after )
   r2 = 0d0
   do 80 i=1,3
      d(i) = after(i) - before(i)
      w = pnat(i) - d(i)
      pco(i) = w
      r2 = r2 + w*w
80    continue
   r = sqrt ( r2 )
   do 90 i=1,3
      pco(i) = pco(i) / r
90    continue
100 continue

!  ICRS astrometric RA,Dec.
call C2S ( pco, w, dc )
rc = ANP ( w )

end subroutine ATICQN
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATIO13 ( ri, di, utc1, utc2, dut1, &
                        elong, phi, hm, xp, yp, phpa, tc, rh, wl, &
                        aob, zob, hob, dob, rob, j )
!>
!  CIRS RA,Dec to observed place.  The caller supplies UTC, site
!  coordinates, ambient air conditions and observing wavelength.
!
!  Status:  support routine.
!
!  Given:
!     RI       d      CIRS right ascension (CIO-based, radians)
!     DI       d      CIRS declination (radians)
!     UTC1     d      UTC as a 2-part...
!     UTC2     d      ...quasi Julian Date (Notes 1,2)
!     DUT1     d      UT1-UTC (seconds, Note 3)
!     ELONG    d      longitude (radians, east +ve, Note 4)
!     PHI      d      geodetic latitude (radians, Note 4)
!     HM       d      height above ellipsoid (m, geodetic Notes 4,6)
!     XP,YP    d      polar motion coordinates (radians, Note 5)
!     PHPA     d      pressure at the observer (hPa = mB, Note 6)
!     TC       d      ambient temperature at the observer (deg C)
!     RH       d      relative humidity at the observer (range 0-1)
!     WL       d      wavelength (micrometers, Note 7)
!
!  Returned:
!     AOB      d      observed azimuth (radians: N=0,E=90)
!     ZOB      d      observed zenith distance (radians)
!     HOB      d      observed hour angle (radians)
!     DOB      d      observed declination (radians)
!     ROB      d      observed right ascension (CIO-based, radians)
!     J        i      status: +1 = dubious year (Note 2)
!                              0 = OK
!                             -1 = unacceptable date
!
!  Notes:
!
!  1)  UTC1+UTC2 is quasi Julian Date (see Note 2), apportioned in any
!      convenient way between the two arguments, for example where UTC1
!      is the Julian Day Number and UTC2 is the fraction of a day.
!
!      However, JD cannot unambiguously represent UTC during a leap
!      second unless special measures are taken.  The convention in the
!      present routine is that the JD day represents UTC days whether
!      the length is 86399, 86400 or 86401 SI seconds.
!
!      Applications should use the routine DTF2D to convert from
!      calendar date and time of day into 2-part quasi Julian Date, as
!      it implements the leap-second-ambiguity convention just
!      described.
!
!  2)  The warning status "dubious year" flags UTCs that predate the
!      introduction of the time scale or that are too far in the
!      future to be trusted.  See DAT for further details.
!
!  3)  UT1-UTC is tabulated in IERS bulletins.  It increases by exactly
!      one second at the end of each positive UTC leap second,
!      introduced in order to keep UT1-UTC within +/- 0.9s.  n.b. This
!      practice is under review, and in the future UT1-UTC may grow
!      essentially without limit.
!
!  4)  The geographical coordinates are with respect to the WGS84
!      reference ellipsoid.  TAKE CARE WITH THE LONGITUDE SIGN:  the
!      longitude required by the present routine is east-positive
!      (i.e. right-handed), in accordance with geographical convention.
!
!  5)  The polar motion XP,YP can be obtained from IERS bulletins.  The
!      values are the coordinates (in radians) of the Celestial
!      Intermediate Pole with respect to the International Terrestrial
!      Reference System (see IERS Conventions 2003), measured along the
!      meridians 0 and 90 deg west respectively.  For many applications,
!      XP and YP can be set to zero.
!
!  6)  If hm, the height above the ellipsoid of the observing station
!      in meters, is not known but phpa, the pressure in hPa (=mB), is
!      available, an adequate estimate of hm can be obtained from the
!      expression
!
!            hm = -29.3 * tsl * log ( phpa / 1013.25 );
!
!      where tsl is the approximate sea-level air temperature in K
!      (See Astrophysical Quantities, C.W.Allen, 3rd edition, section
!      52).  Similarly, if the pressure phpa is not known, it can be
!      estimated from the height of the observing station, hm, as
!      follows:
!
!            phpa = 1013.25 * exp ( -hm / ( 29.3 * tsl ) );
!
!      Note, however, that the refraction is nearly proportional to
!      the pressure and that an accurate phpa value is important for
!      precise work.
!
!  7)  The argument WL specifies the observing wavelength in
!      micrometers.  The transition from optical to radio is assumed to
!      occur at 100 micrometers (about 3000 GHz).
!
!  8)  "Observed" Az,ZD means the position that would be seen by a
!      perfect geodetically aligned theodolite.  (Zenith distance is
!      used rather than altitude in order to reflect the fact that no
!      allowance is made for depression of the horizon.)  This is
!      related to the observed HA,Dec via the standard rotation, using
!      the geodetic latitude (corrected for polar motion), while the
!      observed HA and RA are related simply through the Earth rotation
!      angle and the site longitude.  "Observed" RA,Dec or HA,Dec thus
!      means the position that would be seen by a perfect equatorial
!      with its polar axis aligned to the Earth's axis of rotation.
!
!  9)  The accuracy of the result is limited by the corrections for
!      refraction, which use a simple A*tan(z) + B*tan^3(z) model.
!      Providing the meteorological parameters are known accurately and
!      there are no gross local effects, the predicted astrometric
!      coordinates should be within 0.05 arcsec (optical) or 1 arcsec
!      (radio) for a zenith distance of less than 70 degrees, better
!      than 30 arcsec (optical or radio) at 85 degrees and better
!      than 20 arcmin (optical) or 30 arcmin (radio) at the horizon.
!
!  10) The complementary routines ATIO13 and ATOI13 are self-
!      consistent to better than 1 microarcsecond all over the
!      celestial sphere.
!
!  11) It is advisable to take great care with units, as even unlikely
!      values of the input parameters are accepted and processed in
!      accordance with the models used.
!
!  Called:
!     APIO13   astrometry parameters, CIRS-observed, 2013
!     ATIOQ    quick CIRS to observed
!
!  This revision:   2016 February 2
!
!-----------------------------------------------------------------------

implicit none
double precision ri, di, utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                 phpa, tc, rh, wl, aob, zob, hob, dob, rob
integer j

integer js
double precision astrom(30)

!  Star-independent astrometry parameters for CIRS->observed.
call APIO13 ( utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                  phpa, tc, rh, wl, astrom, js )

!  Abort if bad UTC.
if ( js<0 ) go to 9

!  Transform CIRS to observed.
call ATIOQ ( ri, di, astrom, aob, zob, hob, dob, rob )

!  Return OK/warning status.
9 continue
j = js

end subroutine ATIO13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATIOQ ( ri, di, astrom, aob, zob, hob, dob, rob )
!>
!  Quick CIRS to observed place transformation.
!
!  Use of this routine is appropriate when efficiency is important and
!  where many star positions are all to be transformed for one date.
!  The star-independent astrometry parameters can be obtained by
!  calling APIO[13] or APCO[13].
!
!  Status:  support routine.
!
!  Given:
!     RI       d      CIRS right ascension
!     DI       d      CIRS declination
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!
!  Returned:
!     AOB      d      observed azimuth (radians: N=0,E=90)
!     ZOB      d      observed zenith distance (radians)
!     HOB      d      observed hour angle (radians)
!     DOB      d      observed declination (CIO-based, radians)
!     ROB      d      observed right ascension (CIO-based, radians)
!
!  Notes:
!
!  1) This routine returns zenith distance rather than altitude in
!     order to reflect the fact that no allowance is made for
!     depression of the horizon.
!
!  2) The accuracy of the result is limited by the corrections for
!     refraction, which use a simple A*tan(z) + B*tan^3(z) model.
!     Providing the meteorological parameters are known accurately and
!     there are no gross local effects, the predicted observed
!     coordinates should be within 0.05 arcsec (optical) or 1 arcsec
!     (radio) for a zenith distance of less than 70 degrees, better
!     than 30 arcsec (optical or radio) at 85 degrees and better than
!     20 arcmin (optical) or 30 arcmin (radio) at the horizon.
!
!     Without refraction, the complementary routines ATIOQ and
!     ATOIQ are self-consistent to better than 1 microarcsecond all
!     over the celestial sphere.  With refraction included, consistency
!     falls off at high zenith distances, but is still better than
!     0.05 arcsec at 85 degrees.
!
!  3) It is advisable to take great care with units, as even unlikely
!     values of the input parameters are accepted and processed in
!     accordance with the models used.
!
!  4) The CIRS RA,Dec is obtained from a star catalog mean place by
!     allowing for space motion, parallax, the Sun's gravitational lens
!     effect, annual aberration and precession-nutation.  For star
!     positions in the ICRS, these effects can be applied by means of
!     the ATCI13 (etc.) routines.  Starting from classical "mean
!     place" systems, additional transformations will be needed first.
!
!  5) "Observed" Az,El means the position that would be seen by a
!     perfect geodetically aligned theodolite.  This is obtained from
!     the CIRS RA,Dec by allowing for Earth orientation and diurnal
!     aberration, rotating from equator to horizon coordinates, and then
!     adjusting for refraction.  The HA,Dec is obtained by rotating back
!     into equatorial coordinates, and is the position that would be
!     seen by a perfect equatorial with its polar axis aligned to the
!     Earth's axis of rotation.  Finally, the RA is obtained by
!     subtracting the HA from the local ERA.
!
!  6) The star-independent CIRS-to-observed-place parameters in ASTROM
!     may be computed with APIO[13] or APCO[13].  If nothing has
!     changed significantly except the time, APER[13] may be used
!     to perform the requisite adjustment to the ASTROM array.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     C2S      p-vector to spherical
!     ANP      normalize angle into range 0 to 2pi
!
!  This revision:   2017 July 10
!
!-----------------------------------------------------------------------

implicit none
double precision ri, di, astrom(30), aob, zob, hob, dob, rob

!  Minimum sine and cosine of altitude for refraction purposes
double precision selmin, celmin
parameter ( selmin = 0.05d0, celmin = 1d-6 )

double precision v(3), x, y, z, xhd, yhd, zhd, f, &
                 xhdt, yhdt, zhdt, xaet, yaet, zaet, azobs, &
                 r, tz, w, del, cosdel, xaeo, yaeo, zaeo, &
                 zdobs, hmobs, dcobs, raobs
!     DOUBLE PRECISION ANP

!  CIRS RA,Dec to Cartesian -HA,Dec.
call S2C ( ri-astrom(28), di, v )
x = v(1)
y = v(2)
z = v(3)

!  Polar motion.
xhd = x + astrom(23)*z
yhd = y - astrom(24)*z
zhd = z - astrom(23)*x + astrom(24)*y

!  Diurnal aberration.
f = ( 1d0 - astrom(27)*yhd )
xhdt = f * xhd
yhdt = f * ( yhd + astrom(27) )
zhdt = f * zhd

!  Cartesian -HA,Dec to Cartesian Az,El (S=0,E=90).
xaet = astrom(25)*xhdt - astrom(26)*zhdt
yaet = yhdt
zaet = astrom(26)*xhdt + astrom(25)*zhdt

!  Azimuth (N=0,E=90).
if ( xaet/=0d0 .or. yaet/=0d0 ) then
   azobs = atan2 ( yaet, -xaet )
else
   azobs = 0d0
end if

!  ----------
!  Refraction
!  ----------

!  Cosine and sine of altitude, with precautions.
r = max ( sqrt ( xaet*xaet + yaet*yaet ), celmin)
z = max ( zaet, selmin )

!  A*tan(z)+B*tan^3(z) model, with Newton-Raphson correction.
tz = r/z
w = astrom(30)*tz*tz
del = ( astrom(29) + w ) * tz / &
      ( 1d0 + ( astrom(29) + 3d0*w ) / ( z*z ) )

!  Apply the change, giving observed vector.
cosdel = 1d0 - del*del/2d0
f = cosdel - del*z/r
xaeo = xaet*f
yaeo = yaet*f
zaeo = cosdel*zaet + del*r

!  Observed ZD.
zdobs = atan2 ( sqrt ( xaeo*xaeo + yaeo*yaeo ), zaeo )

!  Az/El vector to HA,Dec vector (both right-handed).
v(1) = astrom(25)*xaeo + astrom(26)*zaeo
v(2) = yaeo
v(3) = - astrom(26)*xaeo + astrom(25)*zaeo

!  To spherical -HA,Dec.
call C2S ( v, hmobs, dcobs )

!  Right ascension (with respect to CIO).
raobs = astrom(28) + hmobs

!  Return the results.
aob = ANP(azobs)
zob = zdobs
hob = -hmobs
dob = dcobs
rob = ANP(raobs)

end subroutine ATIOQ
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATOC13 ( type, ob1, ob2, utc1, utc2, dut1, &
                        elong, phi, hm, xp, yp, phpa, tc, rh, wl, &
                        rc, dc, j )
!>
!  Observed place at a groundbased site to to ICRS astrometric RA,Dec.
!  The caller supplies UTC, site coordinates, ambient air conditions
!  and observing wavelength.
!
!  Status:  support routine.
!
!  Given:
!     TYPE     c*(*)  type of coordinates - 'R', 'H' or 'A' (Notes 1,2)
!     OB1      d      observed Az, HA or RA (radians; Az is N=0,E=90)
!     OB2      d      observed ZD or Dec (radians)
!     UTC1     d      UTC as a 2-part...
!     UTC2     d      ...quasi Julian Date (Notes 3,4)
!     DUT1     d      UT1-UTC (seconds, Note 5)
!     ELONG    d      longitude (radians, east +ve, Note 6)
!     PHI      d      geodetic latitude (radians, Note 6)
!     HM       d      height above ellipsoid (m, geodetic Notes 6,8)
!     XP,YP    d      polar motion coordinates (radians, Note 7)
!     PHPA     d      pressure at the observer (hPa = mB, Note 8)
!     TC       d      ambient temperature at the observer (deg C)
!     RH       d      relative humidity at the observer (range 0-1)
!     WL       d      wavelength (micrometers, Note 9)
!
!  Returned:
!     RC,DC    d      ICRS astrometric RA,Dec (radians)
!     J        i      status: +1 = dubious year (Note 4)
!                                   0 = OK
!                                  -1 = unacceptable date
!
!  Notes:
!
!  1)  "Observed" Az,ZD means the position that would be seen by a
!      perfect geodetically aligned theodolite.  (Zenith distance is
!      used rather than altitude in order to reflect the fact that no
!      allowance is made for depression of the horizon.)  This is
!      related to the observed HA,Dec via the standard rotation, using
!      the geodetic latitude (corrected for polar motion), while the
!      observed HA and RA are related simply through the Earth rotation
!      angle and the site longitude.  "Observed" RA,Dec or HA,Dec thus
!      means the position that would be seen by a perfect equatorial
!      with its polar axis aligned to the Earth's axis of rotation.
!
!  2)  Only the first character of the TYPE argument is significant.
!      'R' or 'r' indicates that OB1 and OB2 are the observed right
!      ascension and declination;  'H' or 'h' indicates that they are
!      hour angle (west +ve) and declination;  anything else ('A' or
!      'a' is recommended) indicates that OB1 and OB2 are azimuth
!      (north zero, east 90 deg) and zenith distance.
!
!  3)  UTC1+UTC2 is quasi Julian Date (see Note 2), apportioned in any
!      convenient way between the two arguments, for example where UTC1
!      is the Julian Day Number and UTC2 is the fraction of a day.
!
!      However, JD cannot unambiguously represent UTC during a leap
!      second unless special measures are taken.  The convention in the
!      present routine is that the JD day represents UTC days whether
!      the length is 86399, 86400 or 86401 SI seconds.
!
!      Applications should use the routine DTF2D to convert from
!      calendar date and time of day into 2-part quasi Julian Date, as
!      it implements the leap-second-ambiguity convention just
!      described.
!
!  4)  The warning status "dubious year" flags UTCs that predate the
!      introduction of the time scale or that are too far in the
!      future to be trusted.  See DAT for further details.
!
!  5)  UT1-UTC is tabulated in IERS bulletins.  It increases by exactly
!      one second at the end of each positive UTC leap second,
!      introduced in order to keep UT1-UTC within +/- 0.9s.  n.b. This
!      practice is under review, and in the future UT1-UTC may grow
!      essentially without limit.
!
!  6)  The geographical coordinates are with respect to the WGS84
!      reference ellipsoid.  TAKE CARE WITH THE LONGITUDE SIGN:  the
!      longitude required by the present routine is east-positive
!      (i.e. right-handed), in accordance with geographical convention.
!
!  7)  The polar motion XP,YP can be obtained from IERS bulletins.  The
!      values are the coordinates (in radians) of the Celestial
!      Intermediate Pole with respect to the International Terrestrial
!      Reference System (see IERS Conventions 2003), measured along the
!      meridians 0 and 90 deg west respectively.  For many applications,
!      XP and YP can be set to zero.
!
!  8)  If hm, the height above the ellipsoid of the observing station
!      in meters, is not known but phpa, the pressure in hPa (=mB), is
!      available, an adequate estimate of hm can be obtained from the
!      expression
!
!            hm = -29.3 * tsl * log ( phpa / 1013.25 );
!
!      where tsl is the approximate sea-level air temperature in K
!      (See Astrophysical Quantities, C.W.Allen, 3rd edition, section
!      52).  Similarly, if the pressure phpa is not known, it can be
!      estimated from the height of the observing station, hm, as
!      follows:
!
!            phpa = 1013.25 * exp ( -hm / ( 29.3 * tsl ) );
!
!      Note, however, that the refraction is nearly proportional to
!      the pressure and that an accurate phpa value is important for
!      precise work.
!
!  9)  The argument WL specifies the observing wavelength in
!      micrometers.  The transition from optical to radio is assumed to
!      occur at 100 micrometers (about 3000 GHz).
!
!  10) The accuracy of the result is limited by the corrections for
!      refraction, which use a simple A*tan(z) + B*tan^3(z) model.
!      Providing the meteorological parameters are known accurately and
!      there are no gross local effects, the predicted astrometric
!      coordinates should be within 0.05 arcsec (optical) or 1 arcsec
!      (radio) for a zenith distance of less than 70 degrees, better
!      than 30 arcsec (optical or radio) at 85 degrees and better
!      than 20 arcmin (optical) or 30 arcmin (radio) at the horizon.
!
!      Without refraction, the complementary routines ATCO13 and
!      ATOC13 are self-consistent to better than 1 microarcsecond
!      all over the celestial sphere.  With refraction included,
!      consistency falls off at high zenith distances, but is still
!      better than 0.05 arcsec at 85 degrees.
!
!  11) It is advisable to take great care with units, as even unlikely
!      values of the input parameters are accepted and processed in
!      accordance with the models used.
!
!  Called:
!     APCO13   astrometry parameters, ICRS-observed
!     ATOIQ    quick observed to CIRS
!     ATICQ    quick CIRS to ICRS
!
!  This revision:   2013 August 3
!
!-----------------------------------------------------------------------

implicit none
character*(*) type
double precision ob1, ob2, utc1, utc2, dut1, &
                 elong, phi, hm, xp, yp, phpa, tc, rh, wl, rc, dc
integer j

integer js
double precision astrom(30), eo, ri, di

!  Star-independent astrometry parameters.
call APCO13 ( utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                  phpa, tc, rh, wl, astrom, eo, js )

!  Abort if bad UTC.
if ( js<0 ) go to 9

!  Transform observed to CIRS.
call ATOIQ ( type, ob1, ob2, astrom, ri, di )

!  Transform CIRS to ICRS.
call ATICQ ( ri, di, astrom, rc, dc )

!  Return OK/warning status.
9 continue
j = js

end subroutine ATOC13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATOI13 ( type, ob1, ob2, utc1, utc2, dut1, &
                        elong, phi, hm, xp, yp, phpa, tc, rh, wl, &
                        ri, di, j )
!>
!  Observed place to CIRS.  The caller supplies UTC, site coordinates,
!  ambient air conditions and observing wavelength.
!
!  Status:  support routine.
!
!  Given:
!     TYPE     c*(*)  type of coordinates - 'R', 'H' or 'A' (Notes 1,2)
!     OB1      d      observed Az, HA or RA (radians; Az is N=0,E=90)
!     OB2      d      observed ZD or Dec (radians)
!     UTC1     d      UTC as a 2-part...
!     UTC2     d      ...quasi Julian Date (Notes 3,4)
!     DUT1     d      UT1-UTC (seconds, Note 5)
!     ELONG    d      longitude (radians, east +ve, Note 6)
!     PHI      d      geodetic latitude (radians, Note 6)
!     HM       d      height above the ellipsoid (meters, Notes 6,8)
!     XP,YP    d      polar motion coordinates (radians, Note 7)
!     PHPA     d      pressure at the observer (hPa = mB, Note 8)
!     TC       d      ambient temperature at the observer (deg C)
!     RH       d      relative humidity at the observer (range 0-1)
!     WL       d      wavelength (micrometers, Note 9)
!
!  Returned:
!     RI       d      CIRS right ascension (CIO-based, radians)
!     DI       d      CIRS declination (radians)
!     J        i      status: +1 = dubious year (Note 2)
!                              0 = OK
!                             -1 = unacceptable date
!
!  Notes:
!
!  1)  "Observed" Az,ZD means the position that would be seen by a
!      perfect geodetically aligned theodolite.  (Zenith distance is
!      used rather than altitude in order to reflect the fact that no
!      allowance is made for depression of the horizon.)  This is
!      related to the observed HA,Dec via the standard rotation, using
!      the geodetic latitude (corrected for polar motion), while the
!      observed HA and RA are related simply through the Earth rotation
!      angle and the site longitude.  "Observed" RA,Dec or HA,Dec thus
!      means the position that would be seen by a perfect equatorial
!      with its polar axis aligned to the Earth's axis of rotation.
!
!  2)  Only the first character of the TYPE argument is significant.
!      'R' or 'r' indicates that OB1 and OB2 are the observed right
!      ascension and declination;  'H' or 'h' indicates that they are
!      hour angle (west +ve) and declination;  anything else ('A' or
!      'a' is recommended) indicates that OB1 and OB2 are azimuth
!      (north zero, east 90 deg) and zenith distance.
!
!  3)  UTC1+UTC2 is quasi Julian Date (see Note 2), apportioned in any
!      convenient way between the two arguments, for example where UTC1
!      is the Julian Day Number and UTC2 is the fraction of a day.
!
!      However, JD cannot unambiguously represent UTC during a leap
!      second unless special measures are taken.  The convention in the
!      present routine is that the JD day represents UTC days whether
!      the length is 86399, 86400 or 86401 SI seconds.
!
!      Applications should use the routine DTF2D to convert from
!      calendar date and time of day into 2-part quasi Julian Date, as
!      it implements the leap-second-ambiguity convention just
!      described.
!
!  4)  The warning status "dubious year" flags UTCs that predate the
!      introduction of the time scale or that are too far in the
!      future to be trusted.  See DAT for further details.
!
!  5)  UT1-UTC is tabulated in IERS bulletins.  It increases by exactly
!      one second at the end of each positive UTC leap second,
!      introduced in order to keep UT1-UTC within +/- 0.9s.  n.b. This
!      practice is under review, and in the future UT1-UTC may grow
!      essentially without limit.
!
!  6)  The geographical coordinates are with respect to the WGS84
!      reference ellipsoid.  TAKE CARE WITH THE LONGITUDE SIGN:  the
!      longitude required by the present routine is east-positive
!      (i.e. right-handed), in accordance with geographical convention.
!
!  7)  The polar motion XP,YP can be obtained from IERS bulletins.  The
!      values are the coordinates (in radians) of the Celestial
!      Intermediate Pole with respect to the International Terrestrial
!      Reference System (see IERS Conventions 2003), measured along the
!      meridians 0 and 90 deg west respectively.  For many applications,
!      XP and YP can be set to zero.
!
!  8)  If hm, the height above the ellipsoid of the observing station
!      in meters, is not known but phpa, the pressure in hPa (=mB), is
!      available, an adequate estimate of hm can be obtained from the
!      expression
!
!            hm = -29.3 * tsl * log ( phpa / 1013.25 );
!
!      where tsl is the approximate sea-level air temperature in K
!      (See Astrophysical Quantities, C.W.Allen, 3rd edition, section
!      52).  Similarly, if the pressure phpa is not known, it can be
!      estimated from the height of the observing station, hm, as
!      follows:
!
!            phpa = 1013.25 * exp ( -hm / ( 29.3 * tsl ) );
!
!      Note, however, that the refraction is nearly proportional to
!      the pressure and that an accurate phpa value is important for
!      precise work.
!
!  9)  The argument WL specifies the observing wavelength in
!      micrometers.  The transition from optical to radio is assumed to
!      occur at 100 micrometers (about 3000 GHz).
!
!  10) The accuracy of the result is limited by the corrections for
!      refraction, which use a simple A*tan(z) + B*tan^3(z) model.
!      Providing the meteorological parameters are known accurately and
!      there are no gross local effects, the predicted astrometric
!      coordinates should be within 0.05 arcsec (optical) or 1 arcsec
!      (radio) for a zenith distance of less than 70 degrees, better
!      than 30 arcsec (optical or radio) at 85 degrees and better
!      than 20 arcmin (optical) or 30 arcmin (radio) at the horizon.
!
!      Without refraction, the complementary routines ATIO13 and
!      ATOI13 are self-consistent to better than 1 microarcsecond
!      all over the celestial sphere.  With refraction included,
!      consistency falls off at high zenith distances, but is still
!      better than 0.05 arcsec at 85 degrees.
!
!  11) It is advisable to take great care with units, as even unlikely
!      values of the input parameters are accepted and processed in
!      accordance with the models used.
!
!  Called:
!     APIO13   astrometry parameters, CIRS-observed, 2013
!     ATOIQ    quick observed to CIRS
!
!  This revision:   2013 July 6
!
!-----------------------------------------------------------------------

implicit none
character*(*) type
double precision ob1, ob2, utc1, utc2, dut1, elong, phi, hm, &
                 xp, yp, phpa, tc, rh, wl, ri, di
integer j

integer js
double precision astrom(30)

!  Star-independent astrometry parameters for CIRS->observed.
call APIO13 ( utc1, utc2, dut1, elong, phi, hm, xp, yp, &
                  phpa, tc, rh, wl, astrom, js )

!  Abort if bad UTC.
if ( js<0 ) go to 9

!  Transform observed to CIRS.
call ATOIQ ( type, ob1, ob2, astrom, ri, di )

!  Return OK/warning status.
9 continue
j = js

end subroutine ATOI13
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ATOIQ ( type, ob1, ob2, astrom, ri, di )
!>
!  Quick observed place to CIRS, given the star-independent astrometry
!  parameters.
!
!  Use of this routine is appropriate when efficiency is important and
!  where many star positions are all to be transformed for one date.
!  The star-independent astrometry parameters can be obtained by calling
!  APIO[13] or APCO[13].
!
!  Status:  support routine.
!
!  Given:
!     TYPE     c*(*)  type of coordinates: 'R', 'H' or 'A' (Note 2)
!     OB1      d      observed Az, HA or RA (radians; Az is N=0,E=90)
!     OB2      d      observed ZD or Dec (radians)
!     ASTROM   d(30)  star-independent astrometry parameters:
!               (1)      PM time interval (SSB, Julian years)
!               (2-4)    SSB to observer (vector, au)
!               (5-7)    Sun to observer (unit vector)
!               (8)      distance from Sun to observer (au)
!               (9-11)   v: barycentric observer velocity (vector, c)
!               (12)     sqrt(1-|v|^2): reciprocal of Lorenz factor
!               (13-21)  bias-precession-nutation matrix
!               (22)     longitude + s' (radians)
!               (23)     polar motion xp wrt local meridian (radians)
!               (24)     polar motion yp wrt local meridian (radians)
!               (25)     sine of geodetic latitude
!               (26)     cosine of geodetic latitude
!               (27)     magnitude of diurnal aberration vector
!               (28)     "local" Earth rotation angle (radians)
!               (29)     refraction constant A (radians)
!               (30)     refraction constant B (radians)
!
!  Returned:
!     RI       d      CIRS right ascension (CIO-based, radians)
!     DI       d      CIRS declination (radians)
!
!  Notes:
!
!  1) "Observed" Az,El means the position that would be seen by a
!     perfect geodetically aligned theodolite.  This is related to the
!     observed HA,Dec via the standard rotation, using the geodetic
!     latitude (corrected for polar motion), while the observed HA and
!     RA are related simply through the Earth rotation angle and the
!     site longitude.  "Observed" RA,Dec or HA,Dec thus means the
!     position that would be seen by a perfect equatorial with its polar
!     axis aligned to the Earth's axis of rotation.  By removing from
!     the observed place the effects of atmospheric refraction and
!     diurnal aberration, the CIRS RA,Dec is obtained.
!
!  2) Only the first character of the type argument is significant.
!     'R' or 'r' indicates that OB1 and OB2 are the observed right
!     ascension and declination;  'H' or 'h' indicates that they are
!     hour angle (west +ve) and declination;  anything else ('A' or
!     'a' is recommended) indicates that OB1 and OB2 are azimuth (north
!     zero, east 90 deg) and zenith distance.  (Zenith distance is used
!     rather than altitude in order to reflect the fact that no
!     allowance is made for depression of the horizon.)
!
!  3) The accuracy of the result is limited by the corrections for
!     refraction, which use a simple A*tan(z) + B*tan^3(z) model.
!     Providing the meteorological parameters are known accurately and
!     there are no gross local effects, the predicted observed
!     coordinates should be within 0D05 arcsec (optical) or 1 arcsec
!     (radio) for a zenith distance of less than 70 degrees, better
!     than 30 arcsec (optical or radio) at 85 degrees and better than
!     20 arcmin (optical) or 30 arcmin (radio) at the horizon.
!
!     Without refraction, the complementary routines ATIOQ and
!     ATOIQ are self-consistent to better than 1 microarcsecond all
!     over the celestial sphere.  With refraction included, consistency
!     falls off at high zenith distances, but is still better than
!     0.05 arcsec at 85 degrees.
!
!  4) It is advisable to take great care with units, as even unlikely
!     values of the input parameters are accepted and processed in
!     accordance with the models used.
!
!  5) The star-independent astrometry parameters in ASTROM may be
!     computed with APIO13 (or APIO).  If nothing has changed
!     significantly except the time, APER13 (or APER) may be
!     used to perform the requisite adjustment to the ASTROM array.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     C2S      p-vector to spherical
!     ANP      normalize angle into range 0 to 2pi
!
!  This revision:   2013 August 3
!
!-----------------------------------------------------------------------

implicit none
character*(*) type
double precision ob1, ob2, astrom(30), ri, di

character c
double precision c1, c2, sphi, cphi, ce, xaeo, yaeo, zaeo, v(3), &
                 xmhdo, ymhdo, zmhdo, az, sz, zdo, refa, refb, &
                 tz, dref, zdt, xaet, yaet, zaet, &
                 xmhda, ymhda, zmhda, f, xhd, yhd, zhd, &
                 xpl, ypl, w, hma

!     DOUBLE PRECISION ANP

!  Coordinate type.
c = type(:1)

!  Coordinates.
c1 = ob1
c2 = ob2

!  Sin, cos of latitude.
sphi = astrom(25)
cphi = astrom(26)

!  Standardize coordinate type.
if ( c=='r' .or. c=='R' ) then
   c = 'R'
else if ( c=='h' .or. c=='H' ) then
   c = 'H'
else
   c = 'A'
end if

!  If Az,ZD, convert to Cartesian (S=0,E=90).
if ( c=='A' ) then
   ce = sin(c2)
   xaeo = - cos(c1) * ce
   yaeo = sin(c1) * ce
   zaeo = cos(c2)
else

!     If RA,Dec, convert to HA,Dec.
   if ( c=='R' ) c1 = astrom(28) - c1

!     To Cartesian -HA,DeC.
   call S2C ( -c1, c2, v )
   xmhdo = v(1)
   ymhdo = v(2)
   zmhdo = v(3)

!     To Cartesian Az,El (S=0,E=90).
   xaeo = sphi*xmhdo - cphi*zmhdo
   yaeo = ymhdo
   zaeo = cphi*xmhdo + sphi*zmhdo
end if

!  Azimuth (S=0,E=90).
if ( xaeo/=0d0 .or. yaeo/=0d0 ) then
   az = atan2(yaeo,xaeo)
else
   az = 0d0
end if

!  Sine of observed ZD, and observed ZD.
sz = sqrt ( xaeo*xaeo + yaeo*yaeo )
zdo = atan2 ( sz, zaeo )

!
! Refraction
! ----------

!  Fast algorithm using two constant model.
refa = astrom(29)
refb = astrom(30)
tz = sz / zaeo
dref = ( refa + refb*tz*tz ) * tz
zdt = zdo + dref

!  To Cartesian Az,ZD.
ce = sin(zdt)
xaet = cos(az) * ce
yaet = sin(az) * ce
zaet = cos(zdt)

!  Cartesian Az,ZD to Cartesian -HA,DeC.
xmhda = sphi*xaet + cphi*zaet
ymhda = yaet
zmhda = - cphi*xaet + sphi*zaet

!  Diurnal aberration.
f = ( 1d0 + astrom(27)*ymhda )
xhd = f * xmhda
yhd = f * ( ymhda - astrom(27) )
zhd = f * zmhda

!  Polar motion.
xpl = astrom(23)
ypl = astrom(24)
w = xpl*xhd - ypl*yhd + zhd
v(1) = xhd - xpl*w
v(2) = yhd + ypl*w
v(3) = w - ( xpl*xpl + ypl*ypl ) * zhd

!  To spherical -HA,DeC.
call C2S ( v, hma, di )

!  Right ascension.
ri = ANP ( astrom(28) + hma )

end subroutine ATOIQ
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine BI00 ( dpsibi, depsbi, dra )
!>
!  Frame bias components of IAU 2000 precession-nutation models (part of
!  MHB2000 with additions).
!
!  Status:  canonical model.
!
!  Returned:
!     DPSIBI,DEPSBI  d   longitude and obliquity corrections
!     DRA            d   the ICRS RA of the J2000.0 mean equinox
!
!  Notes:
!
!  1) The frame bias corrections in longitude and obliquity (radians)
!     are required in order to correct for the offset between the GCRS
!     pole and the J2000.0 mean pole.  They define, with respect to the
!     GCRS frame, a J2000.0 mean pole that is consistent with the rest
!     of the IAU 2000A precession-nutation model.
!
!  2) In addition to the displacement of the pole, the complete
!     description of the frame bias requires also an offset in right
!     ascension.  This is not part of the IAU 2000A model, and is from
!     Chapront et al. (2002).  It is returned in radians.
!
!  3) This is a supplemented implementation of one aspect of the IAU
!     2000A nutation model, formally adopted by the IAU General Assembly
!     in 2000, namely MHB2000 (Mathews et al. 2002).
!
!  References:
!
!     Chapront, J., Chapront-Touze, M. & Francou, G., Astron.Astrophys.,
!     387, 700, 2002.
!
!     Mathews, P.M., Herring, T.A., Buffet, B.A., "Modeling of nutation
!     and precession   New nutation series for nonrigid Earth and
!     insights into the Earth's interior", J.Geophys.Res., 107, B4,
!     2002.  The MHB2000 code itself was obtained on 9th September 2002
!     from ftp://maia.usno.navy.mil/conv2000/chapter5/IAU2000A.
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision dpsibi, depsbi, dra

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  The frame bias corrections in longitude and obliquity
double precision dpbias, debias
parameter ( dpbias = -0.041775d0 * das2r, &
            debias = -0.0068192d0 * das2r )

!  The ICRS RA of the J2000.0 equinox (Chapront et al., 2002)
double precision dra0
parameter ( dra0 = -0.0146d0 * das2r )

!  Return the results (which are fixed).
dpsibi = dpbias
depsbi = debias
dra = dra0

end subroutine BI00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine BP00 ( date1, date2, rb, rp, rbp )
!>
!  Frame bias and precession, IAU 2000.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RB           d(3,3)    frame bias matrix (Note 2)
!     RP           d(3,3)    precession matrix (Note 3)
!     RBP          d(3,3)    bias-precession matrix (Note 4)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix RB transforms vectors from GCRS to mean J2000.0 by
!     applying frame bias.
!
!  3) The matrix RP transforms vectors from J2000.0 mean equator and
!     equinox to mean equator and equinox of date by applying
!     precession.
!
!  4) The matrix RBP transforms vectors from GCRS to mean equator and
!     equinox of date by applying frame bias then precession.  It is the
!     product RP x RB.
!
!  Called:
!     BI00     frame bias components, IAU 2000
!     PR00     IAU 2000 precession adjustments
!     IR       initialize r-matrix to identity
!     RX       rotate around X-axis
!     RY       rotate around Y-axis
!     RZ       rotate around Z-axis
!     RXR      product of two r-matrices
!     CR       copy r-matrix
!
!  Reference:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!  This revision:  2013 August 21
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rb(3,3), rp(3,3), rbp(3,3)

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

!  J2000.0 obliquity (Lieske et al. 1977)
double precision eps0
parameter ( eps0 = 84381.448d0 * das2r )

double precision t, dpsibi, depsbi, dra0, psia77, oma77, chia, &
                 dpsipr, depspr, psia, oma, rbw(3,3)

!  Interval between fundamental epoch J2000.0 and current date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Frame bias.
call BI00 ( dpsibi, depsbi, dra0 )

!  Precession angles (Lieske et al. 1977)
psia77 =        ( 5038.7784d0 + &
                (   -1.07259d0 + &
                (   -0.001147d0 ) * t ) * t ) * t * das2r
oma77  = eps0 + ( &
                (    0.05127d0 + &
                (   -0.007726d0 ) * t ) * t ) * t * das2r
chia   =        (   10.5526d0 + &
                (   -2.38064d0 + &
                (   -0.001125d0 ) * t ) * t ) * t * das2r

!  Apply IAU 2000 precession corrections.
call PR00 ( date1, date2, dpsipr, depspr )
psia = psia77 + dpsipr
oma  = oma77  + depspr

!  Frame bias matrix: GCRS to J2000.0.
call IR ( rbw )
call RZ ( dra0, rbw )
call RY ( dpsibi*sin(eps0), rbw )
call RX ( -depsbi, rbw )
call CR ( rbw, rb )

!  Precession matrix: J2000.0 to mean of date.
call IR ( rp )
call RX ( eps0, rp )
call RZ ( -psia, rp )
call RX ( -oma, rp )
call RZ ( chia, rp )

!  Bias-precession matrix: GCRS to mean of date.
call RXR ( rp, rbw, rbp )

end subroutine BP00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine BP06 ( date1, date2, rb, rp, rbp )
!>
!  Frame bias and precession, IAU 2006.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RB           d(3,3)    frame bias matrix (Note 2)
!     RP           d(3,3)    precession matrix (Note 3)
!     RBP          d(3,3)    bias-precession matrix (Note 4)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix RB transforms vectors from GCRS to mean J2000.0 by
!     applying frame bias.
!
!  3) The matrix RP transforms vectors from mean J2000.0 to mean of date
!     by applying precession.
!
!  4) The matrix RBP transforms vectors from GCRS to mean of date by
!     applying frame bias then precession.  It is the product RP x RB.
!
!  Called:
!     PFW06    bias-precession F-W angles, IAU 2006
!     FW2M     F-W angles to r-matrix
!     PMAT06   PB matrix, IAU 2006
!     TR       transpose r-matrix
!     RXR      product of two r-matrices
!
!  References:
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2013 August 21
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rb(3,3), rp(3,3), rbp(3,3)

!  JD for MJD 0
double precision djm0
parameter (djm0 = 2400000.5d0 )

!  Reference epoch (J2000.0), MJD
double precision djm00
parameter ( djm00 = 51544.5d0 )

double precision gamb, phib, psib, epsa, rbpw(3,3), rbt(3,3)

!  B matrix.
call PFW06 ( djm0, djm00, gamb, phib, psib, epsa )
call FW2M ( gamb, phib, psib, epsa, rb )

!  PxB matrix (temporary).
call PMAT06 ( date1, date2, rbpw )

!  P matrix.
call TR ( rb, rbt )
call RXR ( rbpw, rbt, rp )

!  PxB matrix.
call CR ( rbpw, rbp )

end subroutine BP06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine BPN2XY ( rbpn, x, y )
!>
!  Extract from the bias-precession-nutation matrix the X,Y coordinates
!  of the Celestial Intermediate Pole.
!
!  Status:  support routine.
!
!  Given:
!     RBPN      d(3,3)    celestial-to-true matrix (Note 1)
!
!  Returned:
!     X,Y         d       Celestial Intermediate Pole (Note 2)
!
!  Notes:
!
!  1) The matrix RBPN transforms vectors from GCRS to true equator (and
!     CIO or equinox) of date, and therefore the Celestial Intermediate
!     Pole unit vector is the bottom row of the matrix.
!
!  2) X,Y are components of the Celestial Intermediate Pole unit vector
!     in the Geocentric Celestial Reference System.
!
!  Reference:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision rbpn(3,3), x, y

!  Extract the X,Y coordinates.
x = rbpn(3,1)
y = rbpn(3,2)

end subroutine BPN2XY
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2I00A ( date1, date2, rc2i )
!>
!  Form the celestial-to-intermediate matrix for a given date using the
!  IAU 2000A precession-nutation model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RC2I         d(3,3)    celestial-to-intermediate matrix (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix RC2I is the first stage in the transformation from
!     celestial to terrestrial coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), ERA is the Earth
!     Rotation Angle and RPOM is the polar motion matrix.
!
!  3) A faster, but slightly less accurate result (about 1 mas), can be
!     obtained by using instead the C2I00B routine.
!
!  Called:
!     PNM00A   classical NPB matrix, IAU 2000A
!     C2IBPN   celestial-to-intermediate matrix, given NPB matrix
!
!  References:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rc2i(3,3)

double precision rbpn(3,3)

!  Obtain the celestial-to-true matrix (IAU 2000A).
call PNM00A ( date1, date2, rbpn )

!  Form the celestial-to-intermediate matrix.
call C2IBPN ( date1, date2, rbpn, rc2i )

end subroutine C2I00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2I00B ( date1, date2, rc2i )
!>
!  Form the celestial-to-intermediate matrix for a given date using the
!  IAU 2000B precession-nutation model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RC2I         d(3,3)    celestial-to-intermediate matrix (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix RC2I is the first stage in the transformation from
!     celestial to terrestrial coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), ERA is the Earth
!     Rotation Angle and RPOM is the polar motion matrix.
!
!  3) The present routine is faster, but slightly less accurate (about
!     1 mas), than the C2I00A routine.
!
!  Called:
!     PNM00B   classical NPB matrix, IAU 2000B
!     C2IBPN   celestial-to-intermediate matrix, given NPB matrix
!
!  References:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rc2i(3,3)

double precision rbpn(3,3)

!  Obtain the celestial-to-true matrix (IAU 2000B).
call PNM00B ( date1, date2, rbpn )

!  Form the celestial-to-intermediate matrix.
call C2IBPN ( date1, date2, rbpn, rc2i )

end subroutine C2I00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2I06A ( date1, date2, rc2i )
!>
!  Form the celestial-to-intermediate matrix for a given date using the
!  IAU 2006 precession and IAU 2000A nutation models.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RC2I         d(3,3)    celestial-to-intermediate matrix (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix RC2I is the first stage in the transformation from
!     celestial to terrestrial coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), ERA is the Earth
!     Rotation Angle and RPOM is the polar motion matrix.
!
!  Called:
!     PNM06A   classical NPB matrix, IAU 2006/2000A
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     S06      the CIO locator s, given X,Y, IAU 2006
!     C2IXYS   celestial-to-intermediate matrix, given X,Y and s
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), 2004, IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2007 May 11
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rc2i(3,3)

double precision rbpn(3,3), x, y, s

!     DOUBLE PRECISION S06

!  Obtain the celestial-to-true matrix (IAU 2006/2000A).
call PNM06A ( date1, date2, rbpn )

!  Extract the X,Y coordinates.
call BPN2XY ( rbpn, x, y )

!  Obtain the CIO locator.
s = S06 ( date1, date2, x, y )

!  Form the celestial-to-intermediate matrix.
call C2IXYS ( x, y, s, rc2i )

end subroutine C2I06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2IBPN ( date1, date2, rbpn, rc2i )
!>
!  Form the celestial-to-intermediate matrix for a given date given
!  the bias-precession-nutation matrix.  IAU 2000.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!     RBPN         d(3,3)    celestial-to-true matrix (Note 2)
!
!  Returned:
!     RC2I         d(3,3)    celestial-to-intermediate matrix (Note 3)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix RBPN transforms vectors from GCRS to true equator (and
!     CIO or equinox) of date.  Only the CIP (bottom row) is used.
!
!  3) The matrix RC2I is the first stage in the transformation from
!     celestial to terrestrial coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), ERA is the Earth
!     Rotation Angle and RPOM is the polar motion matrix.
!
!  4) Although its name does not include "00", this routine is in fact
!     specific to the IAU 2000 models.
!
!  Called:
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     C2IXY    celestial-to-intermediate matrix, given X,Y
!
!  References:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rbpn(3,3), rc2i(3,3)

double precision x, y

!  Extract the X,Y coordinates.
call BPN2XY ( rbpn, x, y )

!  Form the celestial-to-intermediate matrix (n.b. IAU 2000 specific).
call C2IXY ( date1, date2, x, y, rc2i )

end subroutine C2IBPN
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2IXY ( date1, date2, x, y, rc2i )
!>
!  Form the celestial to intermediate-frame-of-date matrix for a given
!  date when the CIP X,Y coordinates are known.  IAU 2000.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!     X,Y            d      Celestial Intermediate Pole (Note 2)
!
!  Returned:
!     RC2I         d(3,3)   celestial-to-intermediate matrix (Note 3)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The Celestial Intermediate Pole coordinates are the x,y components
!     of the unit vector in the Geocentric Celestial Reference System.
!
!  3) The matrix RC2I is the first stage in the transformation from
!     celestial to terrestrial coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), ERA is the Earth
!     Rotation Angle and RPOM is the polar motion matrix.
!
!  4) Although its name does not include "00", this routine is in fact
!     specific to the IAU 2000 models.
!
!  Called:
!     C2IXYS   celestial-to-intermediate matrix, given X,Y and s
!     S00      the CIO locator s, given X,Y, IAU 2000A
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2007 June 1
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, x, y, rc2i(3,3)

!     DOUBLE PRECISION S00

!  Compute s and then the matrix.
call C2IXYS ( x, y, S00 ( date1, date2, x, y ), rc2i )

end subroutine C2IXY
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2IXYS ( x, y, s, rc2i )
!>
!  Form the celestial to intermediate-frame-of-date matrix given the CIP
!  X,Y and the CIO locator s.
!
!  Status:  support routine.
!
!  Given:
!     X,Y        d       Celestial Intermediate Pole (Note 1)
!     S          d       the CIO locator s (Note 2)
!
!  Returned:
!     RC2I     d(3,3)    celestial-to-intermediate matrix (Note 3)
!
!  Notes:
!
!  1) The Celestial Intermediate Pole coordinates are the x,y components
!     of the unit vector in the Geocentric Celestial Reference System.
!
!  2) The CIO locator s (in radians) positions the Celestial
!     Intermediate Origin on the equator of the CIP.
!
!  3) The matrix RC2I is the first stage in the transformation from
!     celestial to terrestrial coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), ERA is the Earth
!     Rotation Angle and RPOM is the polar motion matrix.
!
!  Called:
!     IR       initialize r-matrix to identity
!     RZ       rotate around Z-axis
!     RY       rotate around Y-axis
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2014 November 7
!
!-----------------------------------------------------------------------

implicit none

double precision x, y, s, rc2i(3,3)

double precision r2, e, d

!  Obtain the spherical angles E and d.
r2 = x*x+y*y
if ( r2>0d0 ) then
   e = atan2 ( y, x )
else
   e = 0d0
end if
d = atan ( sqrt ( r2 / (1d0-r2) ) )

!  Form the matrix.
call IR ( rc2i )
call RZ ( e, rc2i )
call RY ( d, rc2i )
call RZ ( -(e+s), rc2i )

end subroutine C2IXYS
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2S ( p, theta, phi )
!>
!  P-vector to spherical coordinates.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     P        d(3)      p-vector
!
!  Returned:
!     THETA    d         longitude angle (radians)
!     PHI      d         latitude angle (radians)
!
!  Notes:
!
!  1) P can have any magnitude; only its direction is used.
!
!  2) If P is null, zero THETA and PHI are returned.
!
!  3) At either pole, zero THETA is returned.
!
!  This revision:  2007 April 11
!
!-----------------------------------------------------------------------

implicit none

double precision p(3), theta, phi

double precision x, y, z, d2

x = p(1)
y = p(2)
z = p(3)
d2 = x*x + y*y

if ( d2 == 0d0 ) then
   theta = 0d0
else
   theta = atan2(y,x)
end if

if ( z == 0d0 ) then
   phi = 0d0
else
   phi = atan2(z,sqrt(d2))
end if

end subroutine C2S
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2T00A ( tta, ttb, uta, utb, xp, yp, rc2t )
!>
!  Form the celestial to terrestrial matrix given the date, the UT1 and
!  the polar motion, using the IAU 2000A nutation model.
!
!  Status:  support routine.
!
!  Given:
!     TTA,TTB    d       TT as a 2-part Julian Date (Note 1)
!     UTA,UTB    d       UT1 as a 2-part Julian Date (Note 1)
!     XP,YP      d       coordinates of the pole (radians, Note 2)
!
!  Returned:
!     RC2T     d(3,3)    celestial-to-terrestrial matrix (Note 3)
!
!  Notes:
!
!  1) The TT and UT1 dates TTA+TTB and UTA+UTB are Julian Dates,
!     apportioned in any convenient way between the arguments UTA and
!     UTB.  For example, JD(UT1)=2450123.7 could be expressed in any of
!     these ways, among others:
!
!             UTA            UTB
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  In the case of UTA,UTB, the
!     date & time method is best matched to the Earth rotation angle
!     algorithm used:  maximum accuracy (or, at least, minimum noise) is
!     delivered when the UTA argument is for 0hrs UT1 on the day in
!     question and the UTB argument lies in the range 0 to 1, or vice
!     versa.
!
!  2) XP and YP are the coordinates (in radians) of the Celestial
!     Intermediate Pole with respect to the International Terrestrial
!     Reference System (see IERS Conventions 2003), measured along the
!     meridians to 0 and 90 deg west respectively.
!
!  3) The matrix RC2T transforms from celestial to terrestrial
!     coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), RC2I is the
!     celestial-to-intermediate matrix, ERA is the Earth rotation angle
!     and RPOM is the polar motion matrix.
!
!  4) A faster, but slightly less accurate result (about 1 mas), can be
!     obtained by using instead the C2T00B routine.
!
!  Called:
!     C2I00A   celestial-to-intermediate matrix, IAU 2000A
!     ERA00    Earth rotation angle, IAU 2000
!     SP00     the TIO locator s', IERS 2000
!     POM00    polar motion matrix
!     C2TCIO   form CIO-based celestial-to-terrestrial matrix
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2009 April 1
!
!-----------------------------------------------------------------------

implicit none

double precision tta, ttb, uta, utb, xp, yp, rc2t(3,3)

double precision rc2i(3,3), era, sp, rpom(3,3)

!     DOUBLE PRECISION ERA00, SP00

!  Form the celestial-to-intermediate matrix for this TT (IAU 2000A).
call C2I00A ( tta, ttb, rc2i )

!  Predict the Earth rotation angle for this UT1.
era = ERA00 ( uta, utb )

!  Estimate s'.
sp = SP00 ( tta, ttb )

!  Form the polar motion matrix.
call POM00 ( xp, yp, sp, rpom )

!  Combine to form the celestial-to-terrestrial matrix.
call C2TCIO ( rc2i, era, rpom, rc2t )

end subroutine C2T00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2T00B ( tta, ttb, uta, utb, xp, yp, rc2t )
!>
!  Form the celestial to terrestrial matrix given the date, the UT1 and
!  the polar motion, using the IAU 2000B nutation model.
!
!  Status:  support routine.
!
!  Given:
!     TTA,TTB    d       TT as a 2-part Julian Date (Note 1)
!     UTA,UTB    d       UT1 as a 2-part Julian Date (Note 1)
!     XP,YP      d       coordinates of the pole (radians, Note 2)
!
!  Returned:
!     RC2T     d(3,3)    celestial-to-terrestrial matrix (Note 3)
!
!  Notes:
!
!  1) The TT and UT1 dates TTA+TTB and UTA+UTB are Julian Dates,
!     apportioned in any convenient way between the arguments UTA and
!     UTB.  For example, JD(UT1)=2450123.7 could be expressed in any of
!     these ways, among others:
!
!             UTA            UTB
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  In the case of UTA,UTB, the
!     date & time method is best matched to the Earth rotation angle
!     algorithm used:  maximum accuracy (or, at least, minimum noise) is
!     delivered when the UTA argument is for 0hrs UT1 on the day in
!     question and the UTB argument lies in the range 0 to 1, or vice
!     versa.
!
!  2) XP and YP are the coordinates (in radians) of the Celestial
!     Intermediate Pole with respect to the International Terrestrial
!     Reference System (see IERS Conventions 2003), measured along the
!     meridians to 0 and 90 deg west respectively.
!
!  3) The matrix RC2T transforms from celestial to terrestrial
!     coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), RC2I is the
!     celestial-to-intermediate matrix, ERA is the Earth rotation angle
!     and RPOM is the polar motion matrix.
!
!  4) The present routine is faster, but slightly less accurate (about
!     1 mas), than the C2T00A routine.
!
!  Called:
!     C2I00B   celestial-to-intermediate matrix, IAU 2000B
!     ERA00    Earth rotation angle, IAU 2000
!     POM00    polar motion matrix
!     C2TCIO   form CIO-based celestial-to-terrestrial matrix
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2009 April 1
!
!-----------------------------------------------------------------------

implicit none

double precision tta, ttb, uta, utb, xp, yp, rc2t(3,3)

double precision rc2i(3,3), era, rpom(3,3)

!     DOUBLE PRECISION ERA00

!  Form the celestial-to-intermediate matrix for this TT (IAU 2000B).
call C2I00B ( tta, ttb, rc2i )

!  Predict the Earth rotation angle for this UT1.
era = ERA00 ( uta, utb )

!  Form the polar motion matrix (neglecting s').
call POM00 ( xp, yp, 0d0, rpom )

!  Combine to form the celestial-to-terrestrial matrix.
call C2TCIO ( rc2i, era, rpom, rc2t )

end subroutine C2T00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2T06A ( tta, ttb, uta, utb, xp, yp, rc2t )
!>
!  Form the celestial to terrestrial matrix given the date, the UT1 and
!  the polar motion, using the IAU 2006 precession and IAU 2000A
!  nutation models.
!
!  Status:  support routine.
!
!  Given:
!     TTA,TTB    d       TT as a 2-part Julian Date (Note 1)
!     UTA,UTB    d       UT1 as a 2-part Julian Date (Note 1)
!     XP,YP      d       coordinates of the pole (radians, Note 2)
!
!  Returned:
!     RC2T     d(3,3)    celestial-to-terrestrial matrix (Note 3)
!
!  Notes:
!
!  1) The TT and UT1 dates TTA+TTB and UTA+UTB are Julian Dates,
!     apportioned in any convenient way between the arguments UTA and
!     UTB.  For example, JD(UT1)=2450123.7 could be expressed in any of
!     these ways, among others:
!
!             UTA            UTB
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  In the case of UTA,UTB, the
!     date & time method is best matched to the Earth rotation angle
!     algorithm used:  maximum accuracy (or, at least, minimum noise) is
!     delivered when the UTA argument is for 0hrs UT1 on the day in
!     question and the UTB argument lies in the range 0 to 1, or vice
!     versa.
!
!  2) XP and YP are the coordinates (in radians) of the Celestial
!     Intermediate Pole with respect to the International Terrestrial
!     Reference System (see IERS Conventions 2003), measured along the
!     meridians to 0 and 90 deg west respectively.
!
!  3) The matrix RC2T transforms from celestial to terrestrial
!     coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), RC2I is the
!     celestial-to-intermediate matrix, ERA is the Earth rotation angle
!     and RPOM is the polar motion matrix.
!
!  Called:
!     C2I06A   celestial-to-intermediate matrix, IAU 2006/2000A
!     ERA00    Earth rotation angle, IAU 2000
!     SP00     the TIO locator s', IERS 2000
!     POM00    polar motion matrix
!     C2TCIO   form CIO-based celestial-to-terrestrial matrix
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), 2004, IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG
!
!  This revision:  2009 April 1
!
!-----------------------------------------------------------------------

implicit none

double precision tta, ttb, uta, utb, xp, yp, rc2t(3,3)

double precision rc2i(3,3), era, sp, rpom(3,3)

!     DOUBLE PRECISION ERA00, SP00

!  Form the celestial-to-intermediate matrix for this TT.
call C2I06A ( tta, ttb, rc2i )

!  Predict the Earth rotation angle for this UT1.
era = ERA00 ( uta, utb )

!  Estimate s'.
sp = SP00 ( tta, ttb )

!  Form the polar motion matrix.
call POM00 ( xp, yp, sp, rpom )

!  Combine to form the celestial-to-terrestrial matrix.
call C2TCIO ( rc2i, era, rpom, rc2t )

end subroutine C2T06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2TCEO ( rc2i, era, rpom, rc2t )
!>
!  Assemble the celestial to terrestrial matrix from CIO-based
!  components (the celestial-to-intermediate matrix, the Earth Rotation
!  Angle and the polar motion matrix).
!
!  Status:  obsolete routine.
!
!  Given:
!     RC2I     d(3,3)    celestial-to-intermediate matrix
!     ERA        d       Earth rotation angle
!     RPOM     d(3,3)    polar-motion matrix
!
!  Returned:
!     RC2T     d(3,3)    celestial-to-terrestrial matrix
!
!  Notes:
!
!  1) The name of the present routine, C2TCEO, reflects the original
!     name of the celestial intermediate origin (CIO), which before the
!     adoption of IAU 2006 Resolution 2 was called the "celestial
!     ephemeris origin" (CEO).
!
!  2) When the name change from CEO to CIO occurred, a new SOFA routine
!     called C2TCIO was introduced as the successor to the existing
!     C2TCEO.  The present routine is merely a front end to the new
!     one.
!
!  3) The present routine is included in the SOFA collection only to
!     support existing applications.  It should not be used in new
!     applications.
!
!  Called:
!     C2TCIO   form CIO-based celestial-to-terrestrial matrix
!
!  This revision:  2007 May 9
!
!-----------------------------------------------------------------------

implicit none

double precision rc2i(3,3), era, rpom(3,3), rc2t(3,3)

!  Call the renamed routine.
call C2TCIO ( rc2i, era, rpom, rc2t )

end subroutine C2TCEO
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2TCIO ( rc2i, era, rpom, rc2t )
!>
!  Assemble the celestial to terrestrial matrix from CIO-based
!  components (the celestial-to-intermediate matrix, the Earth Rotation
!  Angle and the polar motion matrix).
!
!  Status:  support routine.
!
!  Given:
!     RC2I     d(3,3)    celestial-to-intermediate matrix
!     ERA        d       Earth rotation angle (radians)
!     RPOM     d(3,3)    polar-motion matrix
!
!  Returned:
!     RC2T     d(3,3)    celestial-to-terrestrial matrix
!
!  Notes:
!
!  1) This routine constructs the rotation matrix that transforms
!     vectors in the celestial system into vectors in the terrestrial
!     system.  It does so starting from precomputed components, namely
!     the matrix which rotates from celestial coordinates to the
!     intermediate frame, the Earth rotation angle and the polar motion
!     matrix.  One use of the present routine is when generating a
!     series of celestial-to-terrestrial matrices where only the Earth
!     Rotation Angle changes, avoiding the considerable overhead of
!     recomputing the precession-nutation more often than necessary to
!     achieve given accuracy objectives.
!
!  2) The relationship between the arguments is as follows:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003).
!
!  Called:
!     CR       copy r-matrix
!     RZ       rotate around Z-axis
!     RXR      product of two r-matrices
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), 2004, IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG
!
!  This revision:  2013 August 24
!
!-----------------------------------------------------------------------

implicit none

double precision rc2i(3,3), era, rpom(3,3), rc2t(3,3)

double precision r(3,3)

!  Construct the matrix.
call CR ( rc2i, r )
call RZ ( era, r )
call RXR ( rpom, r, rc2t )

end subroutine C2TCIO
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2TEQX ( rbpn, gst, rpom, rc2t )
!>
!  Assemble the celestial to terrestrial matrix from equinox-based
!  components (the celestial-to-true matrix, the Greenwich Apparent
!  Sidereal Time and the polar motion matrix).
!
!  Status:  support routine.
!
!  Given:
!     RBPN     d(3,3)    celestial-to-true matrix
!     GST        d       Greenwich (apparent) Sidereal Time (radians)
!     RPOM     d(3,3)    polar-motion matrix
!
!  Returned:
!     RC2T     d(3,3)    celestial-to-terrestrial matrix (Note 2)
!
!  Notes:
!
!  1) This routine constructs the rotation matrix that transforms
!     vectors in the celestial system into vectors in the terrestrial
!     system.  It does so starting from precomputed components, namely
!     the matrix which rotates from celestial coordinates to the
!     true equator and equinox of date, the Greenwich Apparent Sidereal
!     Time and the polar motion matrix.  One use of the present routine
!     is when generating a series of celestial-to-terrestrial matrices
!     where only the Sidereal Time changes, avoiding the considerable
!     overhead of recomputing the precession-nutation more often than
!     necessary to achieve given accuracy objectives.
!
!  2) The relationship between the arguments is as follows:
!
!        [TRS]  =  RPOM * R_3(GST) * RBPN * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003).
!
!  Called:
!     CR       copy r-matrix
!     RZ       rotate around Z-axis
!     RXR      product of two r-matrices
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2013 August 24
!
!-----------------------------------------------------------------------

implicit none

double precision rbpn(3,3), gst, rpom(3,3), rc2t(3,3)

double precision r(3,3)

!  Construct the matrix.
call CR ( rbpn, r )
call RZ ( gst, r )
call RXR ( rpom, r, rc2t )

end subroutine C2TEQX
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2TPE ( tta, ttb, uta, utb, dpsi, deps, xp, yp, &
                       rc2t )
!>
!  Form the celestial to terrestrial matrix given the date, the UT1, the
!  nutation and the polar motion.  IAU 2000.
!
!  Status:  support routine.
!
!  Given:
!     TTA,TTB     d       TT as a 2-part Julian Date (Note 1)
!     UTA,UTB     d       UT1 as a 2-part Julian Date (Note 1)
!     DPSI,DEPS   d       nutation (Note 2)
!     XP,YP       d       coordinates of the pole (radians, Note 3)
!
!  Returned:
!     RC2T      d(3,3)    celestial-to-terrestrial matrix (Note 4)
!
!  Notes:
!
!  1) The TT and UT1 dates TTA+TTB and UTA+UTB are Julian Dates,
!     apportioned in any convenient way between the arguments UTA and
!     UTB.  For example, JD(UT1)=2450123.7 could be expressed in any of
!     these ways, among others:
!
!             UTA            UTB
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  In the case of UTA,UTB, the
!     date & time method is best matched to the Earth rotation angle
!     algorithm used:  maximum accuracy (or, at least, minimum noise) is
!     delivered when the UTA argument is for 0hrs UT1 on the day in
!     question and the UTB argument lies in the range 0 to 1, or vice
!     versa.
!
!  2) The caller is responsible for providing the nutation components;
!     they are in longitude and obliquity, in radians and are with
!     respect to the equinox and ecliptic of date.  For high-accuracy
!     applications, free core nutation should be included as well as
!     any other relevant corrections to the position of the CIP.
!
!  3) XP and YP are the coordinates (in radians) of the Celestial
!     Intermediate Pole with respect to the International Terrestrial
!     Reference System (see IERS Conventions 2003), measured along the
!     meridians to 0 and 90 deg west respectively.
!
!  4) The matrix RC2T transforms from celestial to terrestrial
!     coordinates:
!
!        [TRS]  =  RPOM * R_3(GST) * RBPN * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), RBPN is the
!     bias-precession-nutation matrix, GST is the Greenwich (apparent)
!     Sidereal Time and RPOM is the polar motion matrix.
!
!  5) Although its name does not include "00", this routine is in fact
!     specific to the IAU 2000 models.
!
!  Called:
!     PN00     bias/precession/nutation results, IAU 2000
!     GMST00   Greenwich mean sidereal time, IAU 2000
!     SP00     the TIO locator s', IERS 2000
!     EE00     equation of the equinoxes, IAU 2000
!     POM00    polar motion matrix
!     C2TEQX   form equinox-based celestial-to-terrestrial matrix
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2009 April 1
!
!-----------------------------------------------------------------------

implicit none

double precision tta, ttb, uta, utb, dpsi, deps, xp, yp, rc2t(3,3)

double precision epsa, rb(3,3), rp(3,3), rbp(3,3), rn(3,3), &
                 rbpn(3,3), gmst, ee, sp, rpom(3,3)

!     DOUBLE PRECISION GMST00, EE00, SP00

!  Form the celestial-to-true matrix for this TT.
call PN00 ( tta, ttb, dpsi, deps, &
                epsa, rb, rp, rbp, rn, rbpn )

!  Predict the Greenwich Mean Sidereal Time for this UT1 and TT.
gmst = GMST00 ( uta, utb, tta, ttb )

!  Predict the equation of the equinoxes given TT and nutation.
ee = EE00 ( tta, ttb, epsa, dpsi)

!  Estimate s'.
sp = SP00 ( tta, ttb)

!  Form the polar motion matrix.
call POM00 ( xp, yp, sp, rpom )

!  Combine to form the celestial-to-terrestrial matrix.
call C2TEQX ( rbpn, gmst+ee, rpom, rc2t )

end subroutine C2TPE
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine C2TXY ( tta, ttb, uta, utb, x, y, xp, yp, rc2t )
!>
!  Form the celestial to terrestrial matrix given the date, the UT1, the
!  CIP coordinates and the polar motion.  IAU 2000.
!
!  Status:  support routine.
!
!  Given:
!     TTA,TTB    d       TT as a 2-part Julian Date (Note 1)
!     UTA,UTB    d       UT1 as a 2-part Julian Date (Note 1)
!     X,Y        d       Celestial Intermediate Pole (Note 2)
!     XP,YP      d       coordinates of the pole (radians, Note 3)
!
!  Returned:
!     RC2T     d(3,3)    celestial-to-terrestrial matrix (Note 4)
!
!  Notes:
!
!  1) The TT and UT1 dates TTA+TTB and UTA+UTB are Julian Dates,
!     apportioned in any convenient way between the arguments UTA and
!     UTB.  For example, JD(UT1)=2450123.7 could be expressed in any of
!     these ways, among others:
!
!             UTA            UTB
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  In the case of UTA,UTB, the
!     date & time method is best matched to the Earth rotation angle
!     algorithm used:  maximum accuracy (or, at least, minimum noise) is
!     delivered when the UTA argument is for 0hrs UT1 on the day in
!     question and the UTB argument lies in the range 0 to 1, or vice
!     versa.
!
!  2) The Celestial Intermediate Pole coordinates are the x,y components
!     of the unit vector in the Geocentric Celestial Reference System.
!
!  3) XP and YP are the coordinates (in radians) of the Celestial
!     Intermediate Pole with respect to the International Terrestrial
!     Reference System (see IERS Conventions 2003), measured along the
!     meridians to 0 and 90 deg west respectively.
!
!  4) The matrix RC2T transforms from celestial to terrestrial
!     coordinates:
!
!        [TRS]  =  RPOM * R_3(ERA) * RC2I * [CRS]
!
!               =  RC2T * [CRS]
!
!     where [CRS] is a vector in the Geocentric Celestial Reference
!     System and [TRS] is a vector in the International Terrestrial
!     Reference System (see IERS Conventions 2003), ERA is the Earth
!     Rotation Angle and RPOM is the polar motion matrix.
!
!  5) Although its name does not include "00", this routine is in fact
!     specific to the IAU 2000 models.
!
!  Called:
!     C2IXY    celestial-to-intermediate matrix, given X,Y
!     ERA00    Earth rotation angle, IAU 2000
!     SP00     the TIO locator s', IERS 2000
!     POM00    polar motion matrix
!     C2TCIO   form CIO-based celestial-to-terrestrial matrix
!
! Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2009 April 1
!
!-----------------------------------------------------------------------

implicit none

double precision tta, ttb, uta, utb, x, y, xp, yp, rc2t(3,3)

double precision rc2i(3,3), era, sp, rpom(3,3)

!     DOUBLE PRECISION ERA00, SP00

!  Form the celestial-to-intermediate matrix for this TT.
call C2IXY ( tta, ttb, x, y, rc2i )

!  Predict the Earth rotation angle for this UT1.
era = ERA00 ( uta, utb )

!  Estimate s'.
sp = SP00 ( tta, ttb )

!  Form the polar motion matrix.
call POM00 ( xp, yp, sp, rpom )

!  Combine to form the celestial-to-terrestrial matrix.
call C2TCIO ( rc2i, era, rpom, rc2t )

end subroutine C2TXY
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine CAL2JD ( iy, im, id, djm0, djm, j )
!>
!  Gregorian Calendar to Julian Date.
!
!  Status:  support routine.
!
!  Given:
!     IY,IM,ID    i     year, month, day in Gregorian calendar (Note 1)
!
!  Returned:
!     DJM0        d     MJD zero-point: always 2400000.5
!     DJM         d     Modified Julian Date for 0 hrs
!     J           i     status:
!                           0 = OK
!                          -1 = bad year   (Note 3: JD not computed)
!                          -2 = bad month  (JD not computed)
!                          -3 = bad day    (JD computed)
!
!  Notes:
!
!  1) The algorithm used is valid from -4800 March 1, but this
!     implementation rejects dates before -4799 January 1.
!
!  2) The Julian Date is returned in two pieces, in the usual SOFA
!     manner, which is designed to preserve time resolution.  The
!     Julian Date is available as a single number by adding DJM0 and
!     DJM.
!
!  3) In early eras the conversion is from the "Proleptic Gregorian
!     Calendar";  no account is taken of the date(s) of adoption of
!     the Gregorian Calendar, nor is the AD/BC numbering convention
!     observed.
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Section 12.92 (p604).
!
!  This revision:  2014 November 7
!
!-----------------------------------------------------------------------

implicit none

integer iy, im, id
double precision djm0, djm

integer j, ndays, my, iypmy

!  Earliest year allowed (4800BC)
integer iymin
parameter ( iymin = -4799 )

!  Month lengths in days
integer mtab(12)
data mtab / 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 /

!  Preset status.
j = 0

!  Validate year.
if ( iy<iymin ) then
   j = -1
else

!     Validate month.
   if ( im>=1 .and. im<=12 ) then

!        Days in current month.
      ndays = mtab(im)

!        Allow for leap year.
      if ( im == 2 ) then
         if ( mod(iy,4) == 0 ) ndays = 29
         if ( mod(iy,100)==0 .and. &
              mod(iy,400)/=0 ) ndays = 28
      end if

!        Validate day.
      if ( id<1 .or. id>ndays ) j = -3

!        Result.
      my = ( im - 14 ) / 12
      iypmy = iy + my
      djm0 = 2400000.5d0
      djm = dble( ( 1461 * ( iypmy + 4800 ) ) / 4 &
                + (  367 * ( im-2 - 12*my ) ) / 12 &
                - (    3 * ( ( iypmy + 4900 ) / 100 ) ) / 4 &
                + id - 2432076)

!        Bad month
   else
      j = -2
   end if
end if

end subroutine CAL2JD
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine CP ( p, c )
!>
!  Copy a p-vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     P        d(3)     p-vector to be copied
!
!  Returned:
!     C        d(3)     copy
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision p(3), c(3)

integer i

do 1 i=1,3
   c(i) = p(i)
1 continue

end subroutine CP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine CPV ( pv, c )
!>
!  Copy a position/velocity vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     PV       d(3,2)    position/velocity vector to be copied
!
!  Returned:
!     C        d(3,2)    copy
!
!  Called:
!     CP       copy p-vector
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision pv(3,2), c(3,2)

call CP ( pv(1,1), c(1,1) )
call CP ( pv(1,2), c(1,2) )

end subroutine CPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine CR ( r, c )
!>
!  Copy an r-matrix.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     R        d(3,3)    r-matrix to be copied
!
!  Returned:
!     C        d(3,3)    copy
!
!  Called:
!     CP       copy p-vector
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision r(3,3), c(3,3)

integer i

do 1 i=1,3
   call CP ( r(1,i), c(1,i) )
1 continue

end subroutine CR
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine D2DTF ( scale, ndp, d1, d2, iy, im, id, ihmsf, j )
!>
!  Format for output a 2-part Julian Date (or in the case of UTC a
!  quasi-JD form that includes special provision for leap seconds).
!
!  Status:  support routine.
!
!  Given:
!     SCALE      c*(*)  time scale ID (Note 1)
!     NDP        i      resolution (Note 2)
!     D1,D2      d      time as a 2-part Julian Date (Notes 3,4)
!
!  Returned:
!     IY,IM,ID   i      year, month, day in Gregorian calendar (Note 5)
!     IHMSF      i(4)   hours, minutes, seconds, fraction (Note 1)
!     J          i      status: +1 = dubious year (Note 5)
!                                0 = OK
!                               -1 = unacceptable date (Note 6)
!
!  Notes:
!
!  1) SCALE identifies the time scale.  Only the value 'UTC' (in upper
!     case) is significant, and enables handling of leap seconds (see
!     Note 4).
!
!  2) NDP is the number of decimal places in the seconds field, and can
!     have negative as well as positive values, such as:
!
!     NDP         resolution
!     -4            1 00 00
!     -3            0 10 00
!     -2            0 01 00
!     -1            0 00 10
!      0            0 00 01
!      1            0 00 00.1
!      2            0 00 00.01
!      3            0 00 00.001
!
!     The limits are platform dependent, but a safe range is -5 to +9.
!
!  3) D1+D2 is Julian Date, apportioned in any convenient way between
!     the two arguments, for example where D1 is the Julian Day Number
!     and D2 is the fraction of a day.  In the case of UTC, where the
!     use of JD is problematical, special conventions apply:  see the
!     next note.
!
!  4) JD cannot unambiguously represent UTC during a leap second unless
!     special measures are taken.  The SOFA internal convention is that
!     the quasi-JD day represents UTC days whether the length is 86399,
!     86400 or 86401 SI seconds.  In the 1960-1972 era there were
!     smaller jumps (in either direction) each time the linear UTC(TAI)
!     expression was changed, and these "mini-leaps" are also included
!     in the SOFA convention.
!
!  5) The warning status "dubious year" flags UTCs that predate the
!     introduction of the time scale or that are too far in the future
!     to be trusted.  See DAT for further details.
!
!  6) For calendar conventions and limitations, see CAL2JD.
!
!  Called:
!     JD2CAL   JD to Gregorian calendar
!     D2TF     decompose days to hms
!     DAT      delta(AT) = TAI-UTC
!
!  This revision:  2014 February 15
!
!-----------------------------------------------------------------------

implicit none
character*(*) scale
integer ndp
double precision d1, d2
integer iy, im, id, ihmsf(4), j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

logical leap
character s
integer iy1, im1, id1, js, iy2, im2, id2, ihmsf1(4), i
double precision a1, b1, fd, dat0, dat12, w, dat24, dleap

!  The two-part JD.
a1 = d1
b1 = d2

!  Provisional calendar date.
call JD2CAL ( a1, b1, iy1, im1, id1, fd, js )
if ( js/=0 ) go to 9

!  Is this a leap second day?
leap = .false.
if ( scale=='UTC' ) then

!     TAI-UTC at 0h today.
   call DAT ( iy1, im1, id1, 0d0, dat0, js )
   if ( js<0 ) go to 9

!     TAI-UTC at 12h today (to detect drift).
   call DAT ( iy1, im1, id1, 0.5d0, dat12, js )
   if ( js<0 ) go to 9

!     TAI-UTC at 0h tomorrow (to detect jumps).
   call JD2CAL ( a1+1.5d0, b1-fd, iy2, im2, id2, w, js )
   if ( js/=0 ) go to 9
   call DAT ( iy2, im2, id2, 0d0, dat24, js )
   if ( js<0 ) go to 9

!     Any sudden change in TAI-UTC (seconds).
   dleap = dat24 - ( 2d0 * dat12 - dat0 )

!     If leap second day, scale the fraction of a day into SI.
   leap = dleap/=0d0
   if ( leap ) fd = fd + fd*dleap/d2s

end if

!  Provisional time of day.
call D2TF ( ndp, fd, s, ihmsf1 )

!  Has the (rounded) time gone past 24h?
if ( ihmsf1(1)>23 ) then

!     Yes.  We probably need tomorrow's calendar date.
   call JD2CAL ( a1+1.5d0, b1-fd, iy2, im2, id2, w, js )
   if ( js<0 ) go to 9

!     Is today a leap second day?
   if ( .not. leap ) then

!        No.  Use 0h tomorrow.
      iy1 = iy2
      im1 = im2
      id1 = id2
      ihmsf1(1) = 0
      ihmsf1(2) = 0
      ihmsf1(3) = 0

   else

!        Yes.  Are we past the leap second itself?
      if ( ihmsf1(3)>0 ) then

!           Yes.  Use tomorrow but allow for the leap second.
         iy1 = iy2
         im1 = im2
         id1 = id2
         ihmsf1(1) = 0
         ihmsf1(2) = 0
         ihmsf1(3) = 0

      else

!           No.  Use 23 59 60... today.
         ihmsf1(1) = 23
         ihmsf1(2) = 59
         ihmsf1(3) = 60
      end if

!        If rounding to 10s or coarser always go up to new day.
      if ( ndp<0 .and. ihmsf1(3)==60 ) then
         iy1 = iy2
         im1 = im2
         id1 = id2
         ihmsf1(1) = 0
         ihmsf1(2) = 0
         ihmsf1(3) = 0
      end if
   end if
end if

!  Results.
iy = iy1
im = im1
id = id1
do 2 i=1,4
   ihmsf(i) = ihmsf1(i)
2 continue

!  Status.
9 continue
j = js

end subroutine D2DTF
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine D2TF ( ndp, days, sign, ihmsf )
!>
!  Decompose days to hours, minutes, seconds, fraction.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     NDP       i        resolution (Note 1)
!     DAYS      d        interval in days
!
!  Returned:
!     SIGN      c        '+' or '-'
!     IHMSF     i(4)     hours, minutes, seconds, fraction
!
!  Notes:
!
!  1) NDP is interpreted as follows:
!
!     NDP         resolution
!      :      ...0000 00 00
!     -7         1000 00 00
!     -6          100 00 00
!     -5           10 00 00
!     -4            1 00 00
!     -3            0 10 00
!     -2            0 01 00
!     -1            0 00 10
!      0            0 00 01
!      1            0 00 00.1
!      2            0 00 00.01
!      3            0 00 00.001
!      :            0 00 00.000...
!
!  2) The largest positive useful value for NDP is determined by the
!     size of DAYS, the format of DOUBLE PRECISION floating-point
!     numbers on the target platform, and the risk of overflowing
!     IHMSF(4).  On a typical platform, for DAYS up to 1D0, the
!     available floating-point precision might correspond to NDP=12.
!     However, the practical limit is typically NDP=9, set by the
!     capacity of a 32-bit IHMSF(4).
!
!  3) The absolute value of DAYS may exceed 1D0.  In cases where it
!     does not, it is up to the caller to test for and handle the
!     case where DAYS is very nearly 1D0 and rounds up to 24 hours,
!     by testing for IHMSF(1)=24 and setting IHMSF(1-4) to zero.
!
!  This revision:  2005 August 26
!
!-----------------------------------------------------------------------

implicit none

integer ndp
double precision days
character sign*(*)
integer ihmsf(4)

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

integer nrs, n
double precision rs, rm, rh, a, ah, am, as, af

!  Handle sign.
if ( days >= 0d0 ) then
   sign = '+'
else
   sign = '-'
end if

!  Interval in seconds.
a = d2s * abs(days)

!  Pre-round if resolution coarser than 1 second (then pretend NDP=1).
if ( ndp < 0 ) then
   nrs = 1
   do 1 n=1,-ndp
      if ( n==2 .or. n==4 ) then
         nrs = nrs * 6
      else
         nrs = nrs * 10
      end if
1    continue
   rs = dble(nrs)
   a = rs * anint(a/rs)
end if

!  Express the unit of each field in resolution units.
nrs = 1
do 2 n=1,ndp
   nrs = nrs * 10
2 continue
rs = dble(nrs)
rm = rs * 60d0
rh = rm * 60d0

!  Round the interval and express in resolution units.
a = anint(rs*a)

!  Break into fields.
ah = aint(a/rh)
a = a - ah*rh
am = aint(a/rm)
a = a - am*rm
as = aint(a/rs)
af = a - as*rs

!  Return results.
ihmsf(1) = nint(ah)
ihmsf(2) = nint(am)
ihmsf(3) = nint(as)
ihmsf(4) = nint(af)

end subroutine D2TF
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine DAT ( iy, im, id, fd, deltat, j )
!>
!  For a given UTC date, calculate Delta(AT) = TAI-UTC.
!
!     :------------------------------------------:
!     :                                          :
!     :                 IMPORTANT                :
!     :                                          :
!     :  A new version of this routine must be   :
!     :  produced whenever a new leap second is  :
!     :  announced.  There are five items to     :
!     :  change on each such occasion:           :
!     :                                          :
!     :  1) The parameter NDAT must be           :
!     :     increased by 1.                      :
!     :                                          :
!     :  2) The set of DATA statements that      :
!     :     initialize the arrays IDAT and       :
!     :     DATS must be extended by one line.   :
!     :                                          :
!     :  3) The parameter IYV must be set to     :
!     :     the current year.                    :
!     :                                          :
!     :  4) The "Latest leap second" comment     :
!     :     below must be set to the new leap    :
!     :     second date.                         :
!     :                                          :
!     :  5) The "This revision" comment, later,  :
!     :     must be set to the current date.     :
!     :                                          :
!     :  Change (3) must also be carried out     :
!     :  whenever the routine is re-issued,      :
!     :  even if no leap seconds have been       :
!     :  added.                                  :
!     :                                          :
!     :  Latest leap second:  2016 December 31   :
!     :                                          :
!     :__________________________________________:
!
!  Status:  user-replaceable support routine.
!
!  Given:
!     IY       i     UTC:  year (Notes 1 and 2)
!     IM       i           month (Note 2)
!     ID       i           day (Notes 2 and 3)
!     FD       d           fraction of day (Note 4)
!
!  Returned:
!     DELTAT   d     TAI minus UTC, seconds
!     J        i     status (Note 5):
!                       1 = dubious year (Note 1)
!                       0 = OK
!                      -1 = bad year
!                      -2 = bad month
!                      -3 = bad day (Note 3)
!                      -4 = bad fraction (Note 4)
!                      -5 = internal error (Note 5)
!
!  Notes:
!
!  1) UTC began at 1960 January 1.0 (JD 2436934.5) and it is improper
!     to call the routine with an earlier date.  If this is attempted,
!     zero is returned together with a warning status.
!
!     Because leap seconds cannot, in principle, be predicted in
!     advance, a reliable check for dates beyond the valid range is
!     impossible.  To guard against gross errors, a year five or more
!     after the release year of the present routine (see parameter IYV)
!     is considered dubious.  In this case a warning status is returned
!     but the result is computed in the normal way.
!
!     For both too-early and too-late years, the warning status is J=+1.
!     This is distinct from the error status J=-1, which signifies a
!     year so early that JD could not be computed.
!
!  2) If the specified date is for a day which ends with a leap second,
!     the TAI-UTC value returned is for the period leading up to the
!     leap second.  If the date is for a day which begins as a leap
!     second ends, the TAI-UTC returned is for the period following the
!     leap second.
!
!  3) The day number must be in the normal calendar range, for example
!     1 through 30 for April.  The "almanac" convention of allowing
!     such dates as January 0 and December 32 is not supported in this
!     routine, in order to avoid confusion near leap seconds.
!
!  4) The fraction of day is used only for dates before the introduction
!     of leap seconds, the first of which occurred at the end of 1971.
!     It is tested for validity (0 to 1 is the valid range) even if not
!     used;  if invalid, zero is used and status J=-4 is returned.  For
!     many applications, setting FD to zero is acceptable;  the
!     resulting error is always less than 3 ms (and occurs only
!     pre-1972).
!
!  5) The status value returned in the case where there are multiple
!     errors refers to the first error detected.  For example, if the
!     month and day are 13 and 32 respectively, J=-2 (bad month) will be
!     returned.  The "internal error" status refers to a case that is
!     impossible but causes some compilers to issue a warning.
!
!  6) In cases where a valid result is not available, zero is returned.
!
!  References:
!
!  1) For dates from 1961 January 1 onwards, the expressions from the
!     file ftp://maia.usno.navy.mil/ser7/tai-utc.dat are used.
!
!  2) The 5ms timestep at 1961 January 1 is taken from 2.58.1 (p87) of
!     the 1992 Explanatory Supplement.
!
!  Called:
!     CAL2JD   Gregorian calendar to JD
!
!  This revision:  2019 July 5
!
!-----------------------------------------------------------------------

implicit none

integer iy, im, id
double precision fd, deltat
integer j

!  Release year for this version of DAT
integer iyv
parameter ( iyv = 2019 )

!  Number of Delta(AT) changes (increase by 1 for each new leap second)
integer ndat
parameter ( ndat = 42 )

!  Number of Delta(AT) expressions before leap seconds were introduced
integer nera1
parameter ( nera1 = 14 )

!  Dates (year, month) on which new Delta(AT) came into force
integer idat(2,ndat)

!  New Delta(AT) which came into force on the given dates
double precision dats(ndat)

!  Reference dates (MJD) and drift rates (s/day), pre leap seconds
double precision drift(2,nera1)

!  Miscellaneous local variables
logical more
integer js, m, n, is
double precision da, djm0, djm

!  Dates, Delta(AT)s, reference dates, and drift rates
data ((idat(m,n),m=1,2),dats(n),(drift(m,n),m=1,2),n=1,14) &
  / 1960,  1,  1.4178180d0, 37300d0, 0.001296d0, &
    1961,  1,  1.4228180d0, 37300d0, 0.001296d0, &
    1961,  8,  1.3728180d0, 37300d0, 0.001296d0, &
    1962,  1,  1.8458580d0, 37665d0, 0.0011232d0, &
    1963, 11,  1.9458580d0, 37665d0, 0.0011232d0, &
    1964,  1,  3.2401300d0, 38761d0, 0.001296d0, &
    1964,  4,  3.3401300d0, 38761d0, 0.001296d0, &
    1964,  9,  3.4401300d0, 38761d0, 0.001296d0, &
    1965,  1,  3.5401300d0, 38761d0, 0.001296d0, &
    1965,  3,  3.6401300d0, 38761d0, 0.001296d0, &
    1965,  7,  3.7401300d0, 38761d0, 0.001296d0, &
    1965,  9,  3.8401300d0, 38761d0, 0.001296d0, &
    1966,  1,  4.3131700d0, 39126d0, 0.002592d0, &
    1968,  2,  4.2131700d0, 39126d0, 0.002592d0 /

!  Dates and Delta(AT)s
data ((idat(m,n),m=1,2),dats(n),n=15,30) &
  / 1972,  1, 10d0, &
    1972,  7, 11d0, &
    1973,  1, 12d0, &
    1974,  1, 13d0, &
    1975,  1, 14d0, &
    1976,  1, 15d0, &
    1977,  1, 16d0, &
    1978,  1, 17d0, &
    1979,  1, 18d0, &
    1980,  1, 19d0, &
    1981,  7, 20d0, &
    1982,  7, 21d0, &
    1983,  7, 22d0, &
    1985,  7, 23d0, &
    1988,  1, 24d0, &
    1990,  1, 25d0 /

data ((idat(m,n),m=1,2),dats(n),n=31,ndat) &
  / 1991,  1, 26d0, &
    1992,  7, 27d0, &
    1993,  7, 28d0, &
    1994,  7, 29d0, &
    1996,  1, 30d0, &
    1997,  7, 31d0, &
    1999,  1, 32d0, &
    2006,  1, 33d0, &
    2009,  1, 34d0, &
    2012,  7, 35d0, &
    2015,  7, 36d0, &
    2017,  1, 37d0 /

!  Initialize the result to zero and the status to OK.
da = 0d0
js = 0

!  If invalid fraction of a day, set error status and give up.
if ( fd<0d0 .or. fd>1d0 ) then
   js = -4
   go to 9000
end if

!  Convert the date into an MJD.
call CAL2JD ( iy, im, id, djm0, djm, js )

!  If invalid year, month, or day, give up.
if ( js < 0 ) go to 9000

!  If pre-UTC year, set warning status and give up.
if ( iy < idat(1,1) ) then
   js = 1
   go to 9000
end if

!  If suspiciously late year, set warning status but proceed.
if ( iy > iyv+5 ) js = 1

!  Combine year and month.
m = 12*iy+im

!  Find the most recent table entry.
is = 0
more = .true.
do 1 n=ndat,1,-1
   if ( more ) then
      is = n
      more = m < ( 12*idat(1,n) + idat(2,n) )
   end if
1 continue

!  Prevent underflow warnings.
if ( is < 1 ) then
   js = -5
   go to 9000
end if

!  Get the Delta(AT).
da = dats(is)

!  If pre-1972, adjust for drift.
if ( is <= nera1 ) da = da + &
                          ( djm + fd - drift(1,is) ) * drift(2,is)

!  Return the Delta(AT) value and the status.
9000 continue
deltat = da
j = js

end subroutine DAT
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function DTDB ( date1, date2, &
                                     ut, elong, u, v )
!>
!  An approximation to TDB-TT, the difference between barycentric
!  dynamical time and terrestrial time, for an observer on the Earth.
!
!  The different time scales - proper, coordinate and realized - are
!  related to each other:
!
!            TAI             <-  physically realized
!             :
!          offset            <-  observed (nominally +32.184s)
!             :
!            TT              <-  terrestrial time
!             :
!    rate adjustment (L_G)   <-  definition of TT
!             :
!            TCG             <-  time scale for GCRS
!             :
!      "periodic" terms      <-  DTDB is an implementation
!             :
!    rate adjustment (L_C)   <-  function of solar-system ephemeris
!             :
!            TCB             <-  time scale for BCRS
!             :
!    rate adjustment (-L_B)  <-  definition of TDB
!             :
!            TDB             <-  TCB scaled to track TT
!             :
!      "periodic" terms      <-  -DTDB is an approximation
!             :
!            TT              <-  terrestrial time
!
!  Adopted values for the various constants can be found in the IERS
!  Conventions (McCarthy & Petit 2003).
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2     d    date, TDB (Notes 1-3)
!     UT              d    universal time (UT1, fraction of one day)
!     ELONG           d    longitude (east positive, radians)
!     U               d    distance from Earth spin axis (km)
!     V               d    distance north of equatorial plane (km)
!
!  Returned:
!    DTDB         d    TDB-TT (seconds)
!
!  Notes:
!
!  1) The date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the arguments DATE1 and DATE2.  For
!     example, JD(TDB)=2450123.7 could be expressed in any of these
!     ways, among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.
!
!     Although the date is, formally, barycentric dynamical time (TDB),
!     the terrestrial dynamical time (TT) can be used with no practical
!     effect on the accuracy of the prediction.
!
!  2) TT can be regarded as a coordinate time that is realized as an
!     offset of 32.184s from International Atomic Time, TAI.  TT is a
!     specific linear transformation of geocentric coordinate time TCG,
!     which is the time scale for the Geocentric Celestial Reference
!     System, GCRS.
!
!  3) TDB is a coordinate time, and is a specific linear transformation
!     of barycentric coordinate time TCB, which is the time scale for
!     the Barycentric Celestial Reference System, BCRS.
!
!  4) The difference TCG-TCB depends on the masses and positions of the
!     bodies of the solar system and the velocity of the Earth.  It is
!     dominated by a rate difference, the residual being of a periodic
!     character.  The latter, which is modeled by the present routine,
!     comprises a main (annual) sinusoidal term of amplitude
!     approximately 0.00166 seconds, plus planetary terms up to about
!     20 microseconds, and lunar and diurnal terms up to 2 microseconds.
!     These effects come from the changing transverse Doppler effect
!     and gravitational red-shift as the observer (on the Earth's
!     surface) experiences variations in speed (with respect to the
!     BCRS) and gravitational potential.
!
!  5) TDB can be regarded as the same as TCB but with a rate adjustment
!     to keep it close to TT, which is convenient for many applications.
!     The history of successive attempts to define TDB is set out in
!     Resolution 3 adopted by the IAU General Assembly in 2006, which
!     defines a fixed TDB(TCB) transformation that is consistent with
!     contemporary solar-system ephemerides.  Future ephemerides will
!     imply slightly changed transformations between TCG and TCB, which
!     could introduce a linear drift between TDB and TT;  however, any
!     such drift is unlikely to exceed 1 nanosecond per century.
!
!  6) The geocentric TDB-TT model used in the present routine is that of
!     Fairhead & Bretagnon (1990), in its full form.  It was originally
!     supplied by Fairhead (private communications with P.T.Wallace,
!     1990) as a Fortran subroutine.  The present routine contains an
!     adaptation of the Fairhead code.  The numerical results are
!     essentially unaffected by the changes, the differences with
!     respect to the Fairhead & Bretagnon original being at the 1D-20 s
!     level.
!
!     The topocentric part of the model is from Moyer (1981) and
!     Murray (1983), with fundamental arguments adapted from
!     Simon et al. 1994.  It is an approximation to the expression
!     ( v / c ) . ( r / c ), where v is the barycentric velocity of
!     the Earth, r is the geocentric position of the observer and
!     c is the speed of light.
!
!     By supplying zeroes for U and V, the topocentric part of the
!     model can be nullified, and the routine will return the Fairhead
!     & Bretagnon result alone.
!
!  7) During the interval 1950-2050, the absolute accuracy is better
!     than +/- 3 nanoseconds relative to time ephemerides obtained by
!     direct numerical integrations based on the JPL DE405 solar system
!     ephemeris.
!
!  8) It must be stressed that the present routine is merely a model,
!     and that numerical integration of solar-system ephemerides is the
!     definitive method for predicting the relationship between TCG and
!     TCB and hence between TT and TDB.
!
!  References:
!
!     Fairhead, L., & Bretagnon, P., Astron.Astrophys., 229, 240-247
!     (1990).
!
!     IAU 2006 Resolution 3.
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Moyer, T.D., Cel.Mech., 23, 33 (1981).
!
!     Murray, C.A., Vectorial Astrometry, Adam Hilger (1983).
!
!     Seidelmann, P.K. et al., Explanatory Supplement to the
!     Astronomical Almanac, Chapter 2, University Science Books (1992).
!
!     Simon, J.L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G. & Laskar, J., Astron.Astrophys., 282, 663-683 (1994).
!
!  This revision:  2010 July 29
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, ut, elong, u, v

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Degrees to radians
double precision dd2r
parameter ( dd2r = 1.745329251994329576923691d-2 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian millennium
double precision djm
parameter ( djm = 365250d0 )

double precision t, tsol, w, elsun, emsun, d, elj, els, &
                 wt, w0, w1, w2, w3, w4, wf, wj

!
!  =====================
!  Fairhead et al. model
!  =====================
!
!  787 sets of three coefficients.
!
!  Each set is amplitude (microseconds)
!              frequency (radians per Julian millennium since J2000.0),
!              phase (radians).
!
!  Sets   1-474 are the T**0 terms,
!   "   475-679  "   "  T**1   "
!   "   680-764  "   "  T**2   "
!   "   765-784  "   "  T**3   "
!   "   785-787  "   "  T**4   "  .
!
double precision fairhd(3,787)
integer i,j
data ((fairhd(i,j),i=1,3),j=  1, 10) / &
 1656.674564d-6,    6283.075849991d0, 6.240054195d0, &
   22.417471d-6,    5753.384884897d0, 4.296977442d0, &
   13.839792d-6,   12566.151699983d0, 6.196904410d0, &
    4.770086d-6,     529.690965095d0, 0.444401603d0, &
    4.676740d-6,    6069.776754553d0, 4.021195093d0, &
    2.256707d-6,     213.299095438d0, 5.543113262d0, &
    1.694205d-6,      -3.523118349d0, 5.025132748d0, &
    1.554905d-6,   77713.771467920d0, 5.198467090d0, &
    1.276839d-6,    7860.419392439d0, 5.988822341d0, &
    1.193379d-6,    5223.693919802d0, 3.649823730d0 /
data ((fairhd(i,j),i=1,3),j= 11, 20) / &
    1.115322d-6,    3930.209696220d0, 1.422745069d0, &
    0.794185d-6,   11506.769769794d0, 2.322313077d0, &
    0.447061d-6,      26.298319800d0, 3.615796498d0, &
    0.435206d-6,    -398.149003408d0, 4.349338347d0, &
    0.600309d-6,    1577.343542448d0, 2.678271909d0, &
    0.496817d-6,    6208.294251424d0, 5.696701824d0, &
    0.486306d-6,    5884.926846583d0, 0.520007179d0, &
    0.432392d-6,      74.781598567d0, 2.435898309d0, &
    0.468597d-6,    6244.942814354d0, 5.866398759d0, &
    0.375510d-6,    5507.553238667d0, 4.103476804d0 /
data ((fairhd(i,j),i=1,3),j= 21, 30) / &
    0.243085d-6,    -775.522611324d0, 3.651837925d0, &
    0.173435d-6,   18849.227549974d0, 6.153743485d0, &
    0.230685d-6,    5856.477659115d0, 4.773852582d0, &
    0.203747d-6,   12036.460734888d0, 4.333987818d0, &
    0.143935d-6,    -796.298006816d0, 5.957517795d0, &
    0.159080d-6,   10977.078804699d0, 1.890075226d0, &
    0.119979d-6,      38.133035638d0, 4.551585768d0, &
    0.118971d-6,    5486.777843175d0, 1.914547226d0, &
    0.116120d-6,    1059.381930189d0, 0.873504123d0, &
    0.137927d-6,   11790.629088659d0, 1.135934669d0 /
data ((fairhd(i,j),i=1,3),j= 31, 40) / &
    0.098358d-6,    2544.314419883d0, 0.092793886d0, &
    0.101868d-6,   -5573.142801634d0, 5.984503847d0, &
    0.080164d-6,     206.185548437d0, 2.095377709d0, &
    0.079645d-6,    4694.002954708d0, 2.949233637d0, &
    0.062617d-6,      20.775395492d0, 2.654394814d0, &
    0.075019d-6,    2942.463423292d0, 4.980931759d0, &
    0.064397d-6,    5746.271337896d0, 1.280308748d0, &
    0.063814d-6,    5760.498431898d0, 4.167901731d0, &
    0.048042d-6,    2146.165416475d0, 1.495846011d0, &
    0.048373d-6,     155.420399434d0, 2.251573730d0 /
data ((fairhd(i,j),i=1,3),j= 41, 50) / &
    0.058844d-6,     426.598190876d0, 4.839650148d0, &
    0.046551d-6,      -0.980321068d0, 0.921573539d0, &
    0.054139d-6,   17260.154654690d0, 3.411091093d0, &
    0.042411d-6,    6275.962302991d0, 2.869567043d0, &
    0.040184d-6,      -7.113547001d0, 3.565975565d0, &
    0.036564d-6,    5088.628839767d0, 3.324679049d0, &
    0.040759d-6,   12352.852604545d0, 3.981496998d0, &
    0.036507d-6,     801.820931124d0, 6.248866009d0, &
    0.036955d-6,    3154.687084896d0, 5.071801441d0, &
    0.042732d-6,     632.783739313d0, 5.720622217d0 /
data ((fairhd(i,j),i=1,3),j= 51, 60) / &
    0.042560d-6,  161000.685737473d0, 1.270837679d0, &
    0.040480d-6,   15720.838784878d0, 2.546610123d0, &
    0.028244d-6,   -6286.598968340d0, 5.069663519d0, &
    0.033477d-6,    6062.663207553d0, 4.144987272d0, &
    0.034867d-6,     522.577418094d0, 5.210064075d0, &
    0.032438d-6,    6076.890301554d0, 0.749317412d0, &
    0.030215d-6,    7084.896781115d0, 3.389610345d0, &
    0.029247d-6,  -71430.695617928d0, 4.183178762d0, &
    0.033529d-6,    9437.762934887d0, 2.404714239d0, &
    0.032423d-6,    8827.390269875d0, 5.541473556d0 /
data ((fairhd(i,j),i=1,3),j= 61, 70) / &
    0.027567d-6,    6279.552731642d0, 5.040846034d0, &
    0.029862d-6,   12139.553509107d0, 1.770181024d0, &
    0.022509d-6,   10447.387839604d0, 1.460726241d0, &
    0.020937d-6,    8429.241266467d0, 0.652303414d0, &
    0.020322d-6,     419.484643875d0, 3.735430632d0, &
    0.024816d-6,   -1194.447010225d0, 1.087136918d0, &
    0.025196d-6,    1748.016413067d0, 2.901883301d0, &
    0.021691d-6,   14143.495242431d0, 5.952658009d0, &
    0.017673d-6,    6812.766815086d0, 3.186129845d0, &
    0.022567d-6,    6133.512652857d0, 3.307984806d0 /
data ((fairhd(i,j),i=1,3),j= 71, 80) / &
    0.016155d-6,   10213.285546211d0, 1.331103168d0, &
    0.014751d-6,    1349.867409659d0, 4.308933301d0, &
    0.015949d-6,    -220.412642439d0, 4.005298270d0, &
    0.015974d-6,   -2352.866153772d0, 6.145309371d0, &
    0.014223d-6,   17789.845619785d0, 2.104551349d0, &
    0.017806d-6,      73.297125859d0, 3.475975097d0, &
    0.013671d-6,    -536.804512095d0, 5.971672571d0, &
    0.011942d-6,    8031.092263058d0, 2.053414715d0, &
    0.014318d-6,   16730.463689596d0, 3.016058075d0, &
    0.012462d-6,     103.092774219d0, 1.737438797d0 /
data ((fairhd(i,j),i=1,3),j= 81, 90) / &
    0.010962d-6,       3.590428652d0, 2.196567739d0, &
    0.015078d-6,   19651.048481098d0, 3.969480770d0, &
    0.010396d-6,     951.718406251d0, 5.717799605d0, &
    0.011707d-6,   -4705.732307544d0, 2.654125618d0, &
    0.010453d-6,    5863.591206116d0, 1.913704550d0, &
    0.012420d-6,    4690.479836359d0, 4.734090399d0, &
    0.011847d-6,    5643.178563677d0, 5.489005403d0, &
    0.008610d-6,    3340.612426700d0, 3.661698944d0, &
    0.011622d-6,    5120.601145584d0, 4.863931876d0, &
    0.010825d-6,     553.569402842d0, 0.842715011d0 /
data ((fairhd(i,j),i=1,3),j= 91,100) / &
    0.008666d-6,    -135.065080035d0, 3.293406547d0, &
    0.009963d-6,     149.563197135d0, 4.870690598d0, &
    0.009858d-6,    6309.374169791d0, 1.061816410d0, &
    0.007959d-6,     316.391869657d0, 2.465042647d0, &
    0.010099d-6,     283.859318865d0, 1.942176992d0, &
    0.007147d-6,    -242.728603974d0, 3.661486981d0, &
    0.007505d-6,    5230.807466803d0, 4.920937029d0, &
    0.008323d-6,   11769.853693166d0, 1.229392026d0, &
    0.007490d-6,   -6256.777530192d0, 3.658444681d0, &
    0.009370d-6,  149854.400134205d0, 0.673880395d0 /
data ((fairhd(i,j),i=1,3),j=101,110) / &
    0.007117d-6,      38.027672636d0, 5.294249518d0, &
    0.007857d-6,   12168.002696575d0, 0.525733528d0, &
    0.007019d-6,    6206.809778716d0, 0.837688810d0, &
    0.006056d-6,     955.599741609d0, 4.194535082d0, &
    0.008107d-6,   13367.972631107d0, 3.793235253d0, &
    0.006731d-6,    5650.292110678d0, 5.639906583d0, &
    0.007332d-6,      36.648562930d0, 0.114858677d0, &
    0.006366d-6,    4164.311989613d0, 2.262081818d0, &
    0.006858d-6,    5216.580372801d0, 0.642063318d0, &
    0.006919d-6,    6681.224853400d0, 6.018501522d0 /
data ((fairhd(i,j),i=1,3),j=111,120) / &
    0.006826d-6,    7632.943259650d0, 3.458654112d0, &
    0.005308d-6,   -1592.596013633d0, 2.500382359d0, &
    0.005096d-6,   11371.704689758d0, 2.547107806d0, &
    0.004841d-6,    5333.900241022d0, 0.437078094d0, &
    0.005582d-6,    5966.683980335d0, 2.246174308d0, &
    0.006304d-6,   11926.254413669d0, 2.512929171d0, &
    0.006603d-6,   23581.258177318d0, 5.393136889d0, &
    0.005123d-6,      -1.484472708d0, 2.999641028d0, &
    0.004648d-6,    1589.072895284d0, 1.275847090d0, &
    0.005119d-6,    6438.496249426d0, 1.486539246d0 /
data ((fairhd(i,j),i=1,3),j=121,130) / &
    0.004521d-6,    4292.330832950d0, 6.140635794d0, &
    0.005680d-6,   23013.539539587d0, 4.557814849d0, &
    0.005488d-6,      -3.455808046d0, 0.090675389d0, &
    0.004193d-6,    7234.794256242d0, 4.869091389d0, &
    0.003742d-6,    7238.675591600d0, 4.691976180d0, &
    0.004148d-6,    -110.206321219d0, 3.016173439d0, &
    0.004553d-6,   11499.656222793d0, 5.554998314d0, &
    0.004892d-6,    5436.993015240d0, 1.475415597d0, &
    0.004044d-6,    4732.030627343d0, 1.398784824d0, &
    0.004164d-6,   12491.370101415d0, 5.650931916d0 /
data ((fairhd(i,j),i=1,3),j=131,140) / &
    0.004349d-6,   11513.883316794d0, 2.181745369d0, &
    0.003919d-6,   12528.018664345d0, 5.823319737d0, &
    0.003129d-6,    6836.645252834d0, 0.003844094d0, &
    0.004080d-6,   -7058.598461315d0, 3.690360123d0, &
    0.003270d-6,      76.266071276d0, 1.517189902d0, &
    0.002954d-6,    6283.143160294d0, 4.447203799d0, &
    0.002872d-6,      28.449187468d0, 1.158692983d0, &
    0.002881d-6,     735.876513532d0, 0.349250250d0, &
    0.003279d-6,    5849.364112115d0, 4.893384368d0, &
    0.003625d-6,    6209.778724132d0, 1.473760578d0 /
data ((fairhd(i,j),i=1,3),j=141,150) / &
    0.003074d-6,     949.175608970d0, 5.185878737d0, &
    0.002775d-6,    9917.696874510d0, 1.030026325d0, &
    0.002646d-6,   10973.555686350d0, 3.918259169d0, &
    0.002575d-6,   25132.303399966d0, 6.109659023d0, &
    0.003500d-6,     263.083923373d0, 1.892100742d0, &
    0.002740d-6,   18319.536584880d0, 4.320519510d0, &
    0.002464d-6,     202.253395174d0, 4.698203059d0, &
    0.002409d-6,       2.542797281d0, 5.325009315d0, &
    0.003354d-6,  -90955.551694697d0, 1.942656623d0, &
    0.002296d-6,    6496.374945429d0, 5.061810696d0 /
data ((fairhd(i,j),i=1,3),j=151,160) / &
    0.003002d-6,    6172.869528772d0, 2.797822767d0, &
    0.003202d-6,   27511.467873537d0, 0.531673101d0, &
    0.002954d-6,   -6283.008539689d0, 4.533471191d0, &
    0.002353d-6,     639.897286314d0, 3.734548088d0, &
    0.002401d-6,   16200.772724501d0, 2.605547070d0, &
    0.003053d-6,  233141.314403759d0, 3.029030662d0, &
    0.003024d-6,   83286.914269554d0, 2.355556099d0, &
    0.002863d-6,   17298.182327326d0, 5.240963796d0, &
    0.002103d-6,   -7079.373856808d0, 5.756641637d0, &
    0.002303d-6,   83996.847317911d0, 2.013686814d0 /
data ((fairhd(i,j),i=1,3),j=161,170) / &
    0.002303d-6,   18073.704938650d0, 1.089100410d0, &
    0.002381d-6,      63.735898303d0, 0.759188178d0, &
    0.002493d-6,    6386.168624210d0, 0.645026535d0, &
    0.002366d-6,       3.932153263d0, 6.215885448d0, &
    0.002169d-6,   11015.106477335d0, 4.845297676d0, &
    0.002397d-6,    6243.458341645d0, 3.809290043d0, &
    0.002183d-6,    1162.474704408d0, 6.179611691d0, &
    0.002353d-6,    6246.427287062d0, 4.781719760d0, &
    0.002199d-6,    -245.831646229d0, 5.956152284d0, &
    0.001729d-6,    3894.181829542d0, 1.264976635d0 /
data ((fairhd(i,j),i=1,3),j=171,180) / &
    0.001896d-6,   -3128.388765096d0, 4.914231596d0, &
    0.002085d-6,      35.164090221d0, 1.405158503d0, &
    0.002024d-6,   14712.317116458d0, 2.752035928d0, &
    0.001737d-6,    6290.189396992d0, 5.280820144d0, &
    0.002229d-6,     491.557929457d0, 1.571007057d0, &
    0.001602d-6,   14314.168113050d0, 4.203664806d0, &
    0.002186d-6,     454.909366527d0, 1.402101526d0, &
    0.001897d-6,   22483.848574493d0, 4.167932508d0, &
    0.001825d-6,   -3738.761430108d0, 0.545828785d0, &
    0.001894d-6,    1052.268383188d0, 5.817167450d0 /
data ((fairhd(i,j),i=1,3),j=181,190) / &
    0.001421d-6,      20.355319399d0, 2.419886601d0, &
    0.001408d-6,   10984.192351700d0, 2.732084787d0, &
    0.001847d-6,   10873.986030480d0, 2.903477885d0, &
    0.001391d-6,   -8635.942003763d0, 0.593891500d0, &
    0.001388d-6,      -7.046236698d0, 1.166145902d0, &
    0.001810d-6,  -88860.057071188d0, 0.487355242d0, &
    0.001288d-6,   -1990.745017041d0, 3.913022880d0, &
    0.001297d-6,   23543.230504682d0, 3.063805171d0, &
    0.001335d-6,    -266.607041722d0, 3.995764039d0, &
    0.001376d-6,   10969.965257698d0, 5.152914309d0 /
data ((fairhd(i,j),i=1,3),j=191,200) / &
    0.001745d-6,  244287.600007027d0, 3.626395673d0, &
    0.001649d-6,   31441.677569757d0, 1.952049260d0, &
    0.001416d-6,    9225.539273283d0, 4.996408389d0, &
    0.001238d-6,    4804.209275927d0, 5.503379738d0, &
    0.001472d-6,    4590.910180489d0, 4.164913291d0, &
    0.001169d-6,    6040.347246017d0, 5.841719038d0, &
    0.001039d-6,    5540.085789459d0, 2.769753519d0, &
    0.001004d-6,    -170.672870619d0, 0.755008103d0, &
    0.001284d-6,   10575.406682942d0, 5.306538209d0, &
    0.001278d-6,      71.812653151d0, 4.713486491d0 /
data ((fairhd(i,j),i=1,3),j=201,210) / &
    0.001321d-6,   18209.330263660d0, 2.624866359d0, &
    0.001297d-6,   21228.392023546d0, 0.382603541d0, &
    0.000954d-6,    6282.095528923d0, 0.882213514d0, &
    0.001145d-6,    6058.731054289d0, 1.169483931d0, &
    0.000979d-6,    5547.199336460d0, 5.448375984d0, &
    0.000987d-6,   -6262.300454499d0, 2.656486959d0, &
    0.001070d-6, -154717.609887482d0, 1.827624012d0, &
    0.000991d-6,    4701.116501708d0, 4.387001801d0, &
    0.001155d-6,     -14.227094002d0, 3.042700750d0, &
    0.001176d-6,     277.034993741d0, 3.335519004d0 /
data ((fairhd(i,j),i=1,3),j=211,220) / &
    0.000890d-6,   13916.019109642d0, 5.601498297d0, &
    0.000884d-6,   -1551.045222648d0, 1.088831705d0, &
    0.000876d-6,    5017.508371365d0, 3.969902609d0, &
    0.000806d-6,   15110.466119866d0, 5.142876744d0, &
    0.000773d-6,   -4136.910433516d0, 0.022067765d0, &
    0.001077d-6,     175.166059800d0, 1.844913056d0, &
    0.000954d-6,   -6284.056171060d0, 0.968480906d0, &
    0.000737d-6,    5326.786694021d0, 4.923831588d0, &
    0.000845d-6,    -433.711737877d0, 4.749245231d0, &
    0.000819d-6,    8662.240323563d0, 5.991247817d0 /
data ((fairhd(i,j),i=1,3),j=221,230) / &
    0.000852d-6,     199.072001436d0, 2.189604979d0, &
    0.000723d-6,   17256.631536341d0, 6.068719637d0, &
    0.000940d-6,    6037.244203762d0, 6.197428148d0, &
    0.000885d-6,   11712.955318231d0, 3.280414875d0, &
    0.000706d-6,   12559.038152982d0, 2.824848947d0, &
    0.000732d-6,    2379.164473572d0, 2.501813417d0, &
    0.000764d-6,   -6127.655450557d0, 2.236346329d0, &
    0.000908d-6,     131.541961686d0, 2.521257490d0, &
    0.000907d-6,   35371.887265976d0, 3.370195967d0, &
    0.000673d-6,    1066.495477190d0, 3.876512374d0 /
data ((fairhd(i,j),i=1,3),j=231,240) / &
    0.000814d-6,   17654.780539750d0, 4.627122566d0, &
    0.000630d-6,      36.027866677d0, 0.156368499d0, &
    0.000798d-6,     515.463871093d0, 5.151962502d0, &
    0.000798d-6,     148.078724426d0, 5.909225055d0, &
    0.000806d-6,     309.278322656d0, 6.054064447d0, &
    0.000607d-6,     -39.617508346d0, 2.839021623d0, &
    0.000601d-6,     412.371096874d0, 3.984225404d0, &
    0.000646d-6,   11403.676995575d0, 3.852959484d0, &
    0.000704d-6,   13521.751441591d0, 2.300991267d0, &
    0.000603d-6,  -65147.619767937d0, 4.140083146d0 /
data ((fairhd(i,j),i=1,3),j=241,250) / &
    0.000609d-6,   10177.257679534d0, 0.437122327d0, &
    0.000631d-6,    5767.611978898d0, 4.026532329d0, &
    0.000576d-6,   11087.285125918d0, 4.760293101d0, &
    0.000674d-6,   14945.316173554d0, 6.270510511d0, &
    0.000726d-6,    5429.879468239d0, 6.039606892d0, &
    0.000710d-6,   28766.924424484d0, 5.672617711d0, &
    0.000647d-6,   11856.218651625d0, 3.397132627d0, &
    0.000678d-6,   -5481.254918868d0, 6.249666675d0, &
    0.000618d-6,   22003.914634870d0, 2.466427018d0, &
    0.000738d-6,    6134.997125565d0, 2.242668890d0 /
data ((fairhd(i,j),i=1,3),j=251,260) / &
    0.000660d-6,     625.670192312d0, 5.864091907d0, &
    0.000694d-6,    3496.032826134d0, 2.668309141d0, &
    0.000531d-6,    6489.261398429d0, 1.681888780d0, &
    0.000611d-6, -143571.324284214d0, 2.424978312d0, &
    0.000575d-6,   12043.574281889d0, 4.216492400d0, &
    0.000553d-6,   12416.588502848d0, 4.772158039d0, &
    0.000689d-6,    4686.889407707d0, 6.224271088d0, &
    0.000495d-6,    7342.457780181d0, 3.817285811d0, &
    0.000567d-6,    3634.621024518d0, 1.649264690d0, &
    0.000515d-6,   18635.928454536d0, 3.945345892d0 /
data ((fairhd(i,j),i=1,3),j=261,270) / &
    0.000486d-6,    -323.505416657d0, 4.061673868d0, &
    0.000662d-6,   25158.601719765d0, 1.794058369d0, &
    0.000509d-6,     846.082834751d0, 3.053874588d0, &
    0.000472d-6,  -12569.674818332d0, 5.112133338d0, &
    0.000461d-6,    6179.983075773d0, 0.513669325d0, &
    0.000641d-6,   83467.156352816d0, 3.210727723d0, &
    0.000520d-6,   10344.295065386d0, 2.445597761d0, &
    0.000493d-6,   18422.629359098d0, 1.676939306d0, &
    0.000478d-6,    1265.567478626d0, 5.487314569d0, &
    0.000472d-6,     -18.159247265d0, 1.999707589d0 /
data ((fairhd(i,j),i=1,3),j=271,280) / &
    0.000559d-6,   11190.377900137d0, 5.783236356d0, &
    0.000494d-6,    9623.688276691d0, 3.022645053d0, &
    0.000463d-6,    5739.157790895d0, 1.411223013d0, &
    0.000432d-6,   16858.482532933d0, 1.179256434d0, &
    0.000574d-6,   72140.628666286d0, 1.758191830d0, &
    0.000484d-6,   17267.268201691d0, 3.290589143d0, &
    0.000550d-6,    4907.302050146d0, 0.864024298d0, &
    0.000399d-6,      14.977853527d0, 2.094441910d0, &
    0.000491d-6,     224.344795702d0, 0.878372791d0, &
    0.000432d-6,   20426.571092422d0, 6.003829241d0 /
data ((fairhd(i,j),i=1,3),j=281,290) / &
    0.000481d-6,    5749.452731634d0, 4.309591964d0, &
    0.000480d-6,    5757.317038160d0, 1.142348571d0, &
    0.000485d-6,    6702.560493867d0, 0.210580917d0, &
    0.000426d-6,    6055.549660552d0, 4.274476529d0, &
    0.000480d-6,    5959.570433334d0, 5.031351030d0, &
    0.000466d-6,   12562.628581634d0, 4.959581597d0, &
    0.000520d-6,   39302.096962196d0, 4.788002889d0, &
    0.000458d-6,   12132.439962106d0, 1.880103788d0, &
    0.000470d-6,   12029.347187887d0, 1.405611197d0, &
    0.000416d-6,   -7477.522860216d0, 1.082356330d0 /
data ((fairhd(i,j),i=1,3),j=291,300) / &
    0.000449d-6,   11609.862544012d0, 4.179989585d0, &
    0.000465d-6,   17253.041107690d0, 0.353496295d0, &
    0.000362d-6,   -4535.059436924d0, 1.583849576d0, &
    0.000383d-6,   21954.157609398d0, 3.747376371d0, &
    0.000389d-6,      17.252277143d0, 1.395753179d0, &
    0.000331d-6,   18052.929543158d0, 0.566790582d0, &
    0.000430d-6,   13517.870106233d0, 0.685827538d0, &
    0.000368d-6,   -5756.908003246d0, 0.731374317d0, &
    0.000330d-6,   10557.594160824d0, 3.710043680d0, &
    0.000332d-6,   20199.094959633d0, 1.652901407d0 /
data ((fairhd(i,j),i=1,3),j=301,310) / &
    0.000384d-6,   11933.367960670d0, 5.827781531d0, &
    0.000387d-6,   10454.501386605d0, 2.541182564d0, &
    0.000325d-6,   15671.081759407d0, 2.178850542d0, &
    0.000318d-6,     138.517496871d0, 2.253253037d0, &
    0.000305d-6,    9388.005909415d0, 0.578340206d0, &
    0.000352d-6,    5749.861766548d0, 3.000297967d0, &
    0.000311d-6,    6915.859589305d0, 1.693574249d0, &
    0.000297d-6,   24072.921469776d0, 1.997249392d0, &
    0.000363d-6,    -640.877607382d0, 5.071820966d0, &
    0.000323d-6,   12592.450019783d0, 1.072262823d0 /
data ((fairhd(i,j),i=1,3),j=311,320) / &
    0.000341d-6,   12146.667056108d0, 4.700657997d0, &
    0.000290d-6,    9779.108676125d0, 1.812320441d0, &
    0.000342d-6,    6132.028180148d0, 4.322238614d0, &
    0.000329d-6,    6268.848755990d0, 3.033827743d0, &
    0.000374d-6,   17996.031168222d0, 3.388716544d0, &
    0.000285d-6,    -533.214083444d0, 4.687313233d0, &
    0.000338d-6,    6065.844601290d0, 0.877776108d0, &
    0.000276d-6,      24.298513841d0, 0.770299429d0, &
    0.000336d-6,   -2388.894020449d0, 5.353796034d0, &
    0.000290d-6,    3097.883822726d0, 4.075291557d0 /
data ((fairhd(i,j),i=1,3),j=321,330) / &
    0.000318d-6,     709.933048357d0, 5.941207518d0, &
    0.000271d-6,   13095.842665077d0, 3.208912203d0, &
    0.000331d-6,    6073.708907816d0, 4.007881169d0, &
    0.000292d-6,     742.990060533d0, 2.714333592d0, &
    0.000362d-6,   29088.811415985d0, 3.215977013d0, &
    0.000280d-6,   12359.966151546d0, 0.710872502d0, &
    0.000267d-6,   10440.274292604d0, 4.730108488d0, &
    0.000262d-6,     838.969287750d0, 1.327720272d0, &
    0.000250d-6,   16496.361396202d0, 0.898769761d0, &
    0.000325d-6,   20597.243963041d0, 0.180044365d0 /
data ((fairhd(i,j),i=1,3),j=331,340) / &
    0.000268d-6,    6148.010769956d0, 5.152666276d0, &
    0.000284d-6,    5636.065016677d0, 5.655385808d0, &
    0.000301d-6,    6080.822454817d0, 2.135396205d0, &
    0.000294d-6,    -377.373607916d0, 3.708784168d0, &
    0.000236d-6,    2118.763860378d0, 1.733578756d0, &
    0.000234d-6,    5867.523359379d0, 5.575209112d0, &
    0.000268d-6, -226858.238553767d0, 0.069432392d0, &
    0.000265d-6,  167283.761587465d0, 4.369302826d0, &
    0.000280d-6,   28237.233459389d0, 5.304829118d0, &
    0.000292d-6,   12345.739057544d0, 4.096094132d0 /
data ((fairhd(i,j),i=1,3),j=341,350) / &
    0.000223d-6,   19800.945956225d0, 3.069327406d0, &
    0.000301d-6,   43232.306658416d0, 6.205311188d0, &
    0.000264d-6,   18875.525869774d0, 1.417263408d0, &
    0.000304d-6,   -1823.175188677d0, 3.409035232d0, &
    0.000301d-6,     109.945688789d0, 0.510922054d0, &
    0.000260d-6,     813.550283960d0, 2.389438934d0, &
    0.000299d-6,  316428.228673312d0, 5.384595078d0, &
    0.000211d-6,    5756.566278634d0, 3.789392838d0, &
    0.000209d-6,    5750.203491159d0, 1.661943545d0, &
    0.000240d-6,   12489.885628707d0, 5.684549045d0 /
data ((fairhd(i,j),i=1,3),j=351,360) / &
    0.000216d-6,    6303.851245484d0, 3.862942261d0, &
    0.000203d-6,    1581.959348283d0, 5.549853589d0, &
    0.000200d-6,    5642.198242609d0, 1.016115785d0, &
    0.000197d-6,     -70.849445304d0, 4.690702525d0, &
    0.000227d-6,    6287.008003254d0, 2.911891613d0, &
    0.000197d-6,     533.623118358d0, 1.048982898d0, &
    0.000205d-6,   -6279.485421340d0, 1.829362730d0, &
    0.000209d-6,  -10988.808157535d0, 2.636140084d0, &
    0.000208d-6,    -227.526189440d0, 4.127883842d0, &
    0.000191d-6,     415.552490612d0, 4.401165650d0 /
data ((fairhd(i,j),i=1,3),j=361,370) / &
    0.000190d-6,   29296.615389579d0, 4.175658539d0, &
    0.000264d-6,   66567.485864652d0, 4.601102551d0, &
    0.000256d-6,   -3646.350377354d0, 0.506364778d0, &
    0.000188d-6,   13119.721102825d0, 2.032195842d0, &
    0.000185d-6,    -209.366942175d0, 4.694756586d0, &
    0.000198d-6,   25934.124331089d0, 3.832703118d0, &
    0.000195d-6,    4061.219215394d0, 3.308463427d0, &
    0.000234d-6,    5113.487598583d0, 1.716090661d0, &
    0.000188d-6,    1478.866574064d0, 5.686865780d0, &
    0.000222d-6,   11823.161639450d0, 1.942386641d0 /
data ((fairhd(i,j),i=1,3),j=371,380) / &
    0.000181d-6,   10770.893256262d0, 1.999482059d0, &
    0.000171d-6,    6546.159773364d0, 1.182807992d0, &
    0.000206d-6,      70.328180442d0, 5.934076062d0, &
    0.000169d-6,   20995.392966449d0, 2.169080622d0, &
    0.000191d-6,   10660.686935042d0, 5.405515999d0, &
    0.000228d-6,   33019.021112205d0, 4.656985514d0, &
    0.000184d-6,   -4933.208440333d0, 3.327476868d0, &
    0.000220d-6,    -135.625325010d0, 1.765430262d0, &
    0.000166d-6,   23141.558382925d0, 3.454132746d0, &
    0.000191d-6,    6144.558353121d0, 5.020393445d0 /
data ((fairhd(i,j),i=1,3),j=381,390) / &
    0.000180d-6,    6084.003848555d0, 0.602182191d0, &
    0.000163d-6,   17782.732072784d0, 4.960593133d0, &
    0.000225d-6,   16460.333529525d0, 2.596451817d0, &
    0.000222d-6,    5905.702242076d0, 3.731990323d0, &
    0.000204d-6,     227.476132789d0, 5.636192701d0, &
    0.000159d-6,   16737.577236597d0, 3.600691544d0, &
    0.000200d-6,    6805.653268085d0, 0.868220961d0, &
    0.000187d-6,   11919.140866668d0, 2.629456641d0, &
    0.000161d-6,     127.471796607d0, 2.862574720d0, &
    0.000205d-6,    6286.666278643d0, 1.742882331d0 /
data ((fairhd(i,j),i=1,3),j=391,400) / &
    0.000189d-6,     153.778810485d0, 4.812372643d0, &
    0.000168d-6,   16723.350142595d0, 0.027860588d0, &
    0.000149d-6,   11720.068865232d0, 0.659721876d0, &
    0.000189d-6,    5237.921013804d0, 5.245313000d0, &
    0.000143d-6,    6709.674040867d0, 4.317625647d0, &
    0.000146d-6,    4487.817406270d0, 4.815297007d0, &
    0.000144d-6,    -664.756045130d0, 5.381366880d0, &
    0.000175d-6,    5127.714692584d0, 4.728443327d0, &
    0.000162d-6,    6254.626662524d0, 1.435132069d0, &
    0.000187d-6,   47162.516354635d0, 1.354371923d0 /
data ((fairhd(i,j),i=1,3),j=401,410) / &
    0.000146d-6,   11080.171578918d0, 3.369695406d0, &
    0.000180d-6,    -348.924420448d0, 2.490902145d0, &
    0.000148d-6,     151.047669843d0, 3.799109588d0, &
    0.000157d-6,    6197.248551160d0, 1.284375887d0, &
    0.000167d-6,     146.594251718d0, 0.759969109d0, &
    0.000133d-6,   -5331.357443741d0, 5.409701889d0, &
    0.000154d-6,      95.979227218d0, 3.366890614d0, &
    0.000148d-6,   -6418.140930027d0, 3.384104996d0, &
    0.000128d-6,   -6525.804453965d0, 3.803419985d0, &
    0.000130d-6,   11293.470674356d0, 0.939039445d0 /
data ((fairhd(i,j),i=1,3),j=411,420) / &
    0.000152d-6,   -5729.506447149d0, 0.734117523d0, &
    0.000138d-6,     210.117701700d0, 2.564216078d0, &
    0.000123d-6,    6066.595360816d0, 4.517099537d0, &
    0.000140d-6,   18451.078546566d0, 0.642049130d0, &
    0.000126d-6,   11300.584221356d0, 3.485280663d0, &
    0.000119d-6,   10027.903195729d0, 3.217431161d0, &
    0.000151d-6,    4274.518310832d0, 4.404359108d0, &
    0.000117d-6,    6072.958148291d0, 0.366324650d0, &
    0.000165d-6,   -7668.637425143d0, 4.298212528d0, &
    0.000117d-6,   -6245.048177356d0, 5.379518958d0 /
data ((fairhd(i,j),i=1,3),j=421,430) / &
    0.000130d-6,   -5888.449964932d0, 4.527681115d0, &
    0.000121d-6,    -543.918059096d0, 6.109429504d0, &
    0.000162d-6,    9683.594581116d0, 5.720092446d0, &
    0.000141d-6,    6219.339951688d0, 0.679068671d0, &
    0.000118d-6,   22743.409379516d0, 4.881123092d0, &
    0.000129d-6,    1692.165669502d0, 0.351407289d0, &
    0.000126d-6,    5657.405657679d0, 5.146592349d0, &
    0.000114d-6,     728.762966531d0, 0.520791814d0, &
    0.000120d-6,      52.596639600d0, 0.948516300d0, &
    0.000115d-6,      65.220371012d0, 3.504914846d0 /
data ((fairhd(i,j),i=1,3),j=431,440) / &
    0.000126d-6,    5881.403728234d0, 5.577502482d0, &
    0.000158d-6,  163096.180360983d0, 2.957128968d0, &
    0.000134d-6,   12341.806904281d0, 2.598576764d0, &
    0.000151d-6,   16627.370915377d0, 3.985702050d0, &
    0.000109d-6,    1368.660252845d0, 0.014730471d0, &
    0.000131d-6,    6211.263196841d0, 0.085077024d0, &
    0.000146d-6,    5792.741760812d0, 0.708426604d0, &
    0.000146d-6,     -77.750543984d0, 3.121576600d0, &
    0.000107d-6,    5341.013788022d0, 0.288231904d0, &
    0.000138d-6,    6281.591377283d0, 2.797450317d0 /
data ((fairhd(i,j),i=1,3),j=441,450) / &
    0.000113d-6,   -6277.552925684d0, 2.788904128d0, &
    0.000115d-6,    -525.758811831d0, 5.895222200d0, &
    0.000138d-6,    6016.468808270d0, 6.096188999d0, &
    0.000139d-6,   23539.707386333d0, 2.028195445d0, &
    0.000146d-6,   -4176.041342449d0, 4.660008502d0, &
    0.000107d-6,   16062.184526117d0, 4.066520001d0, &
    0.000142d-6,   83783.548222473d0, 2.936315115d0, &
    0.000128d-6,    9380.959672717d0, 3.223844306d0, &
    0.000135d-6,    6205.325306007d0, 1.638054048d0, &
    0.000101d-6,    2699.734819318d0, 5.481603249d0 /
data ((fairhd(i,j),i=1,3),j=451,460) / &
    0.000104d-6,    -568.821874027d0, 2.205734493d0, &
    0.000103d-6,    6321.103522627d0, 2.440421099d0, &
    0.000119d-6,    6321.208885629d0, 2.547496264d0, &
    0.000138d-6,    1975.492545856d0, 2.314608466d0, &
    0.000121d-6,     137.033024162d0, 4.539108237d0, &
    0.000123d-6,   19402.796952817d0, 4.538074405d0, &
    0.000119d-6,   22805.735565994d0, 2.869040566d0, &
    0.000133d-6,   64471.991241142d0, 6.056405489d0, &
    0.000129d-6,     -85.827298831d0, 2.540635083d0, &
    0.000131d-6,   13613.804277336d0, 4.005732868d0 /
data ((fairhd(i,j),i=1,3),j=461,470) / &
    0.000104d-6,    9814.604100291d0, 1.959967212d0, &
    0.000112d-6,   16097.679950283d0, 3.589026260d0, &
    0.000123d-6,    2107.034507542d0, 1.728627253d0, &
    0.000121d-6,   36949.230808424d0, 6.072332087d0, &
    0.000108d-6,  -12539.853380183d0, 3.716133846d0, &
    0.000113d-6,   -7875.671863624d0, 2.725771122d0, &
    0.000109d-6,    4171.425536614d0, 4.033338079d0, &
    0.000101d-6,    6247.911759770d0, 3.441347021d0, &
    0.000113d-6,    7330.728427345d0, 0.656372122d0, &
    0.000113d-6,   51092.726050855d0, 2.791483066d0 /
data ((fairhd(i,j),i=1,3),j=471,480) / &
    0.000106d-6,    5621.842923210d0, 1.815323326d0, &
    0.000101d-6,     111.430161497d0, 5.711033677d0, &
    0.000103d-6,     909.818733055d0, 2.812745443d0, &
    0.000101d-6,    1790.642637886d0, 1.965746028d0, &

!  T
  102.156724d-6,    6283.075849991d0, 4.249032005d0, &
    1.706807d-6,   12566.151699983d0, 4.205904248d0, &
    0.269668d-6,     213.299095438d0, 3.400290479d0, &
    0.265919d-6,     529.690965095d0, 5.836047367d0, &
    0.210568d-6,      -3.523118349d0, 6.262738348d0, &
    0.077996d-6,    5223.693919802d0, 4.670344204d0 /
data ((fairhd(i,j),i=1,3),j=481,490) / &
    0.054764d-6,    1577.343542448d0, 4.534800170d0, &
    0.059146d-6,      26.298319800d0, 1.083044735d0, &
    0.034420d-6,    -398.149003408d0, 5.980077351d0, &
    0.032088d-6,   18849.227549974d0, 4.162913471d0, &
    0.033595d-6,    5507.553238667d0, 5.980162321d0, &
    0.029198d-6,    5856.477659115d0, 0.623811863d0, &
    0.027764d-6,     155.420399434d0, 3.745318113d0, &
    0.025190d-6,    5746.271337896d0, 2.980330535d0, &
    0.022997d-6,    -796.298006816d0, 1.174411803d0, &
    0.024976d-6,    5760.498431898d0, 2.467913690d0 /
data ((fairhd(i,j),i=1,3),j=491,500) / &
    0.021774d-6,     206.185548437d0, 3.854787540d0, &
    0.017925d-6,    -775.522611324d0, 1.092065955d0, &
    0.013794d-6,     426.598190876d0, 2.699831988d0, &
    0.013276d-6,    6062.663207553d0, 5.845801920d0, &
    0.011774d-6,   12036.460734888d0, 2.292832062d0, &
    0.012869d-6,    6076.890301554d0, 5.333425680d0, &
    0.012152d-6,    1059.381930189d0, 6.222874454d0, &
    0.011081d-6,      -7.113547001d0, 5.154724984d0, &
    0.010143d-6,    4694.002954708d0, 4.044013795d0, &
    0.009357d-6,    5486.777843175d0, 3.416081409d0 /
data ((fairhd(i,j),i=1,3),j=501,510) / &
    0.010084d-6,     522.577418094d0, 0.749320262d0, &
    0.008587d-6,   10977.078804699d0, 2.777152598d0, &
    0.008628d-6,    6275.962302991d0, 4.562060226d0, &
    0.008158d-6,    -220.412642439d0, 5.806891533d0, &
    0.007746d-6,    2544.314419883d0, 1.603197066d0, &
    0.007670d-6,    2146.165416475d0, 3.000200440d0, &
    0.007098d-6,      74.781598567d0, 0.443725817d0, &
    0.006180d-6,    -536.804512095d0, 1.302642751d0, &
    0.005818d-6,    5088.628839767d0, 4.827723531d0, &
    0.004945d-6,   -6286.598968340d0, 0.268305170d0 /
data ((fairhd(i,j),i=1,3),j=511,520) / &
    0.004774d-6,    1349.867409659d0, 5.808636673d0, &
    0.004687d-6,    -242.728603974d0, 5.154890570d0, &
    0.006089d-6,    1748.016413067d0, 4.403765209d0, &
    0.005975d-6,   -1194.447010225d0, 2.583472591d0, &
    0.004229d-6,     951.718406251d0, 0.931172179d0, &
    0.005264d-6,     553.569402842d0, 2.336107252d0, &
    0.003049d-6,    5643.178563677d0, 1.362634430d0, &
    0.002974d-6,    6812.766815086d0, 1.583012668d0, &
    0.003403d-6,   -2352.866153772d0, 2.552189886d0, &
    0.003030d-6,     419.484643875d0, 5.286473844d0 /
data ((fairhd(i,j),i=1,3),j=521,530) / &
    0.003210d-6,      -7.046236698d0, 1.863796539d0, &
    0.003058d-6,    9437.762934887d0, 4.226420633d0, &
    0.002589d-6,   12352.852604545d0, 1.991935820d0, &
    0.002927d-6,    5216.580372801d0, 2.319951253d0, &
    0.002425d-6,    5230.807466803d0, 3.084752833d0, &
    0.002656d-6,    3154.687084896d0, 2.487447866d0, &
    0.002445d-6,   10447.387839604d0, 2.347139160d0, &
    0.002990d-6,    4690.479836359d0, 6.235872050d0, &
    0.002890d-6,    5863.591206116d0, 0.095197563d0, &
    0.002498d-6,    6438.496249426d0, 2.994779800d0 /
data ((fairhd(i,j),i=1,3),j=531,540) / &
    0.001889d-6,    8031.092263058d0, 3.569003717d0, &
    0.002567d-6,     801.820931124d0, 3.425611498d0, &
    0.001803d-6,  -71430.695617928d0, 2.192295512d0, &
    0.001782d-6,       3.932153263d0, 5.180433689d0, &
    0.001694d-6,   -4705.732307544d0, 4.641779174d0, &
    0.001704d-6,   -1592.596013633d0, 3.997097652d0, &
    0.001735d-6,    5849.364112115d0, 0.417558428d0, &
    0.001643d-6,    8429.241266467d0, 2.180619584d0, &
    0.001680d-6,      38.133035638d0, 4.164529426d0, &
    0.002045d-6,    7084.896781115d0, 0.526323854d0 /
data ((fairhd(i,j),i=1,3),j=541,550) / &
    0.001458d-6,    4292.330832950d0, 1.356098141d0, &
    0.001437d-6,      20.355319399d0, 3.895439360d0, &
    0.001738d-6,    6279.552731642d0, 0.087484036d0, &
    0.001367d-6,   14143.495242431d0, 3.987576591d0, &
    0.001344d-6,    7234.794256242d0, 0.090454338d0, &
    0.001438d-6,   11499.656222793d0, 0.974387904d0, &
    0.001257d-6,    6836.645252834d0, 1.509069366d0, &
    0.001358d-6,   11513.883316794d0, 0.495572260d0, &
    0.001628d-6,    7632.943259650d0, 4.968445721d0, &
    0.001169d-6,     103.092774219d0, 2.838496795d0 /
data ((fairhd(i,j),i=1,3),j=551,560) / &
    0.001162d-6,    4164.311989613d0, 3.408387778d0, &
    0.001092d-6,    6069.776754553d0, 3.617942651d0, &
    0.001008d-6,   17789.845619785d0, 0.286350174d0, &
    0.001008d-6,     639.897286314d0, 1.610762073d0, &
    0.000918d-6,   10213.285546211d0, 5.532798067d0, &
    0.001011d-6,   -6256.777530192d0, 0.661826484d0, &
    0.000753d-6,   16730.463689596d0, 3.905030235d0, &
    0.000737d-6,   11926.254413669d0, 4.641956361d0, &
    0.000694d-6,    3340.612426700d0, 2.111120332d0, &
    0.000701d-6,    3894.181829542d0, 2.760823491d0 /
data ((fairhd(i,j),i=1,3),j=561,570) / &
    0.000689d-6,    -135.065080035d0, 4.768800780d0, &
    0.000700d-6,   13367.972631107d0, 5.760439898d0, &
    0.000664d-6,    6040.347246017d0, 1.051215840d0, &
    0.000654d-6,    5650.292110678d0, 4.911332503d0, &
    0.000788d-6,    6681.224853400d0, 4.699648011d0, &
    0.000628d-6,    5333.900241022d0, 5.024608847d0, &
    0.000755d-6,    -110.206321219d0, 4.370971253d0, &
    0.000628d-6,    6290.189396992d0, 3.660478857d0, &
    0.000635d-6,   25132.303399966d0, 4.121051532d0, &
    0.000534d-6,    5966.683980335d0, 1.173284524d0 /
data ((fairhd(i,j),i=1,3),j=571,580) / &
    0.000543d-6,    -433.711737877d0, 0.345585464d0, &
    0.000517d-6,   -1990.745017041d0, 5.414571768d0, &
    0.000504d-6,    5767.611978898d0, 2.328281115d0, &
    0.000485d-6,    5753.384884897d0, 1.685874771d0, &
    0.000463d-6,    7860.419392439d0, 5.297703006d0, &
    0.000604d-6,     515.463871093d0, 0.591998446d0, &
    0.000443d-6,   12168.002696575d0, 4.830881244d0, &
    0.000570d-6,     199.072001436d0, 3.899190272d0, &
    0.000465d-6,   10969.965257698d0, 0.476681802d0, &
    0.000424d-6,   -7079.373856808d0, 1.112242763d0 /
data ((fairhd(i,j),i=1,3),j=581,590) / &
    0.000427d-6,     735.876513532d0, 1.994214480d0, &
    0.000478d-6,   -6127.655450557d0, 3.778025483d0, &
    0.000414d-6,   10973.555686350d0, 5.441088327d0, &
    0.000512d-6,    1589.072895284d0, 0.107123853d0, &
    0.000378d-6,   10984.192351700d0, 0.915087231d0, &
    0.000402d-6,   11371.704689758d0, 4.107281715d0, &
    0.000453d-6,    9917.696874510d0, 1.917490952d0, &
    0.000395d-6,     149.563197135d0, 2.763124165d0, &
    0.000371d-6,    5739.157790895d0, 3.112111866d0, &
    0.000350d-6,   11790.629088659d0, 0.440639857d0 /
data ((fairhd(i,j),i=1,3),j=591,600) / &
    0.000356d-6,    6133.512652857d0, 5.444568842d0, &
    0.000344d-6,     412.371096874d0, 5.676832684d0, &
    0.000383d-6,     955.599741609d0, 5.559734846d0, &
    0.000333d-6,    6496.374945429d0, 0.261537984d0, &
    0.000340d-6,    6055.549660552d0, 5.975534987d0, &
    0.000334d-6,    1066.495477190d0, 2.335063907d0, &
    0.000399d-6,   11506.769769794d0, 5.321230910d0, &
    0.000314d-6,   18319.536584880d0, 2.313312404d0, &
    0.000424d-6,    1052.268383188d0, 1.211961766d0, &
    0.000307d-6,      63.735898303d0, 3.169551388d0 /
data ((fairhd(i,j),i=1,3),j=601,610) / &
    0.000329d-6,      29.821438149d0, 6.106912080d0, &
    0.000357d-6,    6309.374169791d0, 4.223760346d0, &
    0.000312d-6,   -3738.761430108d0, 2.180556645d0, &
    0.000301d-6,     309.278322656d0, 1.499984572d0, &
    0.000268d-6,   12043.574281889d0, 2.447520648d0, &
    0.000257d-6,   12491.370101415d0, 3.662331761d0, &
    0.000290d-6,     625.670192312d0, 1.272834584d0, &
    0.000256d-6,    5429.879468239d0, 1.913426912d0, &
    0.000339d-6,    3496.032826134d0, 4.165930011d0, &
    0.000283d-6,    3930.209696220d0, 4.325565754d0 /
data ((fairhd(i,j),i=1,3),j=611,620) / &
    0.000241d-6,   12528.018664345d0, 3.832324536d0, &
    0.000304d-6,    4686.889407707d0, 1.612348468d0, &
    0.000259d-6,   16200.772724501d0, 3.470173146d0, &
    0.000238d-6,   12139.553509107d0, 1.147977842d0, &
    0.000236d-6,    6172.869528772d0, 3.776271728d0, &
    0.000296d-6,   -7058.598461315d0, 0.460368852d0, &
    0.000306d-6,   10575.406682942d0, 0.554749016d0, &
    0.000251d-6,   17298.182327326d0, 0.834332510d0, &
    0.000290d-6,    4732.030627343d0, 4.759564091d0, &
    0.000261d-6,    5884.926846583d0, 0.298259862d0 /
data ((fairhd(i,j),i=1,3),j=621,630) / &
    0.000249d-6,    5547.199336460d0, 3.749366406d0, &
    0.000213d-6,   11712.955318231d0, 5.415666119d0, &
    0.000223d-6,    4701.116501708d0, 2.703203558d0, &
    0.000268d-6,    -640.877607382d0, 0.283670793d0, &
    0.000209d-6,    5636.065016677d0, 1.238477199d0, &
    0.000193d-6,   10177.257679534d0, 1.943251340d0, &
    0.000182d-6,    6283.143160294d0, 2.456157599d0, &
    0.000184d-6,    -227.526189440d0, 5.888038582d0, &
    0.000182d-6,   -6283.008539689d0, 0.241332086d0, &
    0.000228d-6,   -6284.056171060d0, 2.657323816d0 /
data ((fairhd(i,j),i=1,3),j=631,640) / &
    0.000166d-6,    7238.675591600d0, 5.930629110d0, &
    0.000167d-6,    3097.883822726d0, 5.570955333d0, &
    0.000159d-6,    -323.505416657d0, 5.786670700d0, &
    0.000154d-6,   -4136.910433516d0, 1.517805532d0, &
    0.000176d-6,   12029.347187887d0, 3.139266834d0, &
    0.000167d-6,   12132.439962106d0, 3.556352289d0, &
    0.000153d-6,     202.253395174d0, 1.463313961d0, &
    0.000157d-6,   17267.268201691d0, 1.586837396d0, &
    0.000142d-6,   83996.847317911d0, 0.022670115d0, &
    0.000152d-6,   17260.154654690d0, 0.708528947d0 /
data ((fairhd(i,j),i=1,3),j=641,650) / &
    0.000144d-6,    6084.003848555d0, 5.187075177d0, &
    0.000135d-6,    5756.566278634d0, 1.993229262d0, &
    0.000134d-6,    5750.203491159d0, 3.457197134d0, &
    0.000144d-6,    5326.786694021d0, 6.066193291d0, &
    0.000160d-6,   11015.106477335d0, 1.710431974d0, &
    0.000133d-6,    3634.621024518d0, 2.836451652d0, &
    0.000134d-6,   18073.704938650d0, 5.453106665d0, &
    0.000134d-6,    1162.474704408d0, 5.326898811d0, &
    0.000128d-6,    5642.198242609d0, 2.511652591d0, &
    0.000160d-6,     632.783739313d0, 5.628785365d0 /
data ((fairhd(i,j),i=1,3),j=651,660) / &
    0.000132d-6,   13916.019109642d0, 0.819294053d0, &
    0.000122d-6,   14314.168113050d0, 5.677408071d0, &
    0.000125d-6,   12359.966151546d0, 5.251984735d0, &
    0.000121d-6,    5749.452731634d0, 2.210924603d0, &
    0.000136d-6,    -245.831646229d0, 1.646502367d0, &
    0.000120d-6,    5757.317038160d0, 3.240883049d0, &
    0.000134d-6,   12146.667056108d0, 3.059480037d0, &
    0.000137d-6,    6206.809778716d0, 1.867105418d0, &
    0.000141d-6,   17253.041107690d0, 2.069217456d0, &
    0.000129d-6,   -7477.522860216d0, 2.781469314d0 /
data ((fairhd(i,j),i=1,3),j=661,670) / &
    0.000116d-6,    5540.085789459d0, 4.281176991d0, &
    0.000116d-6,    9779.108676125d0, 3.320925381d0, &
    0.000129d-6,    5237.921013804d0, 3.497704076d0, &
    0.000113d-6,    5959.570433334d0, 0.983210840d0, &
    0.000122d-6,    6282.095528923d0, 2.674938860d0, &
    0.000140d-6,     -11.045700264d0, 4.957936982d0, &
    0.000108d-6,   23543.230504682d0, 1.390113589d0, &
    0.000106d-6,  -12569.674818332d0, 0.429631317d0, &
    0.000110d-6,    -266.607041722d0, 5.501340197d0, &
    0.000115d-6,   12559.038152982d0, 4.691456618d0 /
data ((fairhd(i,j),i=1,3),j=671,680) / &
    0.000134d-6,   -2388.894020449d0, 0.577313584d0, &
    0.000109d-6,   10440.274292604d0, 6.218148717d0, &
    0.000102d-6,    -543.918059096d0, 1.477842615d0, &
    0.000108d-6,   21228.392023546d0, 2.237753948d0, &
    0.000101d-6,   -4535.059436924d0, 3.100492232d0, &
    0.000103d-6,      76.266071276d0, 5.594294322d0, &
    0.000104d-6,     949.175608970d0, 5.674287810d0, &
    0.000101d-6,   13517.870106233d0, 2.196632348d0, &
    0.000100d-6,   11933.367960670d0, 4.056084160d0, &

!  T^2
    4.322990d-6,    6283.075849991d0, 2.642893748d0 /
data ((fairhd(i,j),i=1,3),j=681,690) / &
    0.406495d-6,       0.000000000d0, 4.712388980d0, &
    0.122605d-6,   12566.151699983d0, 2.438140634d0, &
    0.019476d-6,     213.299095438d0, 1.642186981d0, &
    0.016916d-6,     529.690965095d0, 4.510959344d0, &
    0.013374d-6,      -3.523118349d0, 1.502210314d0, &
    0.008042d-6,      26.298319800d0, 0.478549024d0, &
    0.007824d-6,     155.420399434d0, 5.254710405d0, &
    0.004894d-6,    5746.271337896d0, 4.683210850d0, &
    0.004875d-6,    5760.498431898d0, 0.759507698d0, &
    0.004416d-6,    5223.693919802d0, 6.028853166d0 /
data ((fairhd(i,j),i=1,3),j=691,700) / &
    0.004088d-6,      -7.113547001d0, 0.060926389d0, &
    0.004433d-6,   77713.771467920d0, 3.627734103d0, &
    0.003277d-6,   18849.227549974d0, 2.327912542d0, &
    0.002703d-6,    6062.663207553d0, 1.271941729d0, &
    0.003435d-6,    -775.522611324d0, 0.747446224d0, &
    0.002618d-6,    6076.890301554d0, 3.633715689d0, &
    0.003146d-6,     206.185548437d0, 5.647874613d0, &
    0.002544d-6,    1577.343542448d0, 6.232904270d0, &
    0.002218d-6,    -220.412642439d0, 1.309509946d0, &
    0.002197d-6,    5856.477659115d0, 2.407212349d0 /
data ((fairhd(i,j),i=1,3),j=701,710) / &
    0.002897d-6,    5753.384884897d0, 5.863842246d0, &
    0.001766d-6,     426.598190876d0, 0.754113147d0, &
    0.001738d-6,    -796.298006816d0, 2.714942671d0, &
    0.001695d-6,     522.577418094d0, 2.629369842d0, &
    0.001584d-6,    5507.553238667d0, 1.341138229d0, &
    0.001503d-6,    -242.728603974d0, 0.377699736d0, &
    0.001552d-6,    -536.804512095d0, 2.904684667d0, &
    0.001370d-6,    -398.149003408d0, 1.265599125d0, &
    0.001889d-6,   -5573.142801634d0, 4.413514859d0, &
    0.001722d-6,    6069.776754553d0, 2.445966339d0 /
data ((fairhd(i,j),i=1,3),j=711,720) / &
    0.001124d-6,    1059.381930189d0, 5.041799657d0, &
    0.001258d-6,     553.569402842d0, 3.849557278d0, &
    0.000831d-6,     951.718406251d0, 2.471094709d0, &
    0.000767d-6,    4694.002954708d0, 5.363125422d0, &
    0.000756d-6,    1349.867409659d0, 1.046195744d0, &
    0.000775d-6,     -11.045700264d0, 0.245548001d0, &
    0.000597d-6,    2146.165416475d0, 4.543268798d0, &
    0.000568d-6,    5216.580372801d0, 4.178853144d0, &
    0.000711d-6,    1748.016413067d0, 5.934271972d0, &
    0.000499d-6,   12036.460734888d0, 0.624434410d0 /
data ((fairhd(i,j),i=1,3),j=721,730) / &
    0.000671d-6,   -1194.447010225d0, 4.136047594d0, &
    0.000488d-6,    5849.364112115d0, 2.209679987d0, &
    0.000621d-6,    6438.496249426d0, 4.518860804d0, &
    0.000495d-6,   -6286.598968340d0, 1.868201275d0, &
    0.000456d-6,    5230.807466803d0, 1.271231591d0, &
    0.000451d-6,    5088.628839767d0, 0.084060889d0, &
    0.000435d-6,    5643.178563677d0, 3.324456609d0, &
    0.000387d-6,   10977.078804699d0, 4.052488477d0, &
    0.000547d-6,  161000.685737473d0, 2.841633844d0, &
    0.000522d-6,    3154.687084896d0, 2.171979966d0 /
data ((fairhd(i,j),i=1,3),j=731,740) / &
    0.000375d-6,    5486.777843175d0, 4.983027306d0, &
    0.000421d-6,    5863.591206116d0, 4.546432249d0, &
    0.000439d-6,    7084.896781115d0, 0.522967921d0, &
    0.000309d-6,    2544.314419883d0, 3.172606705d0, &
    0.000347d-6,    4690.479836359d0, 1.479586566d0, &
    0.000317d-6,     801.820931124d0, 3.553088096d0, &
    0.000262d-6,     419.484643875d0, 0.606635550d0, &
    0.000248d-6,    6836.645252834d0, 3.014082064d0, &
    0.000245d-6,   -1592.596013633d0, 5.519526220d0, &
    0.000225d-6,    4292.330832950d0, 2.877956536d0 /
data ((fairhd(i,j),i=1,3),j=741,750) / &
    0.000214d-6,    7234.794256242d0, 1.605227587d0, &
    0.000205d-6,    5767.611978898d0, 0.625804796d0, &
    0.000180d-6,   10447.387839604d0, 3.499954526d0, &
    0.000229d-6,     199.072001436d0, 5.632304604d0, &
    0.000214d-6,     639.897286314d0, 5.960227667d0, &
    0.000175d-6,    -433.711737877d0, 2.162417992d0, &
    0.000209d-6,     515.463871093d0, 2.322150893d0, &
    0.000173d-6,    6040.347246017d0, 2.556183691d0, &
    0.000184d-6,    6309.374169791d0, 4.732296790d0, &
    0.000227d-6,  149854.400134205d0, 5.385812217d0 /
data ((fairhd(i,j),i=1,3),j=751,760) / &
    0.000154d-6,    8031.092263058d0, 5.120720920d0, &
    0.000151d-6,    5739.157790895d0, 4.815000443d0, &
    0.000197d-6,    7632.943259650d0, 0.222827271d0, &
    0.000197d-6,      74.781598567d0, 3.910456770d0, &
    0.000138d-6,    6055.549660552d0, 1.397484253d0, &
    0.000149d-6,   -6127.655450557d0, 5.333727496d0, &
    0.000137d-6,    3894.181829542d0, 4.281749907d0, &
    0.000135d-6,    9437.762934887d0, 5.979971885d0, &
    0.000139d-6,   -2352.866153772d0, 4.715630782d0, &
    0.000142d-6,    6812.766815086d0, 0.513330157d0 /
data ((fairhd(i,j),i=1,3),j=761,770) / &
    0.000120d-6,   -4705.732307544d0, 0.194160689d0, &
    0.000131d-6,  -71430.695617928d0, 0.000379226d0, &
    0.000124d-6,    6279.552731642d0, 2.122264908d0, &
    0.000108d-6,   -6256.777530192d0, 0.883445696d0, &

!  T^3
    0.143388d-6,    6283.075849991d0, 1.131453581d0, &
    0.006671d-6,   12566.151699983d0, 0.775148887d0, &
    0.001480d-6,     155.420399434d0, 0.480016880d0, &
    0.000934d-6,     213.299095438d0, 6.144453084d0, &
    0.000795d-6,     529.690965095d0, 2.941595619d0, &
    0.000673d-6,    5746.271337896d0, 0.120415406d0 /
data ((fairhd(i,j),i=1,3),j=771,780) / &
    0.000672d-6,    5760.498431898d0, 5.317009738d0, &
    0.000389d-6,    -220.412642439d0, 3.090323467d0, &
    0.000373d-6,    6062.663207553d0, 3.003551964d0, &
    0.000360d-6,    6076.890301554d0, 1.918913041d0, &
    0.000316d-6,     -21.340641002d0, 5.545798121d0, &
    0.000315d-6,    -242.728603974d0, 1.884932563d0, &
    0.000278d-6,     206.185548437d0, 1.266254859d0, &
    0.000238d-6,    -536.804512095d0, 4.532664830d0, &
    0.000185d-6,     522.577418094d0, 4.578313856d0, &
    0.000245d-6,   18849.227549974d0, 0.587467082d0 /
data ((fairhd(i,j),i=1,3),j=781,787) / &
    0.000180d-6,     426.598190876d0, 5.151178553d0, &
    0.000200d-6,     553.569402842d0, 5.355983739d0, &
    0.000141d-6,    5223.693919802d0, 1.336556009d0, &
    0.000104d-6,    5856.477659115d0, 4.239842759d0, &

!  T^4
    0.003826d-6,    6283.075849991d0, 5.705257275d0, &
    0.000303d-6,   12566.151699983d0, 5.407132842d0, &
    0.000209d-6,     155.420399434d0, 1.989815753d0 /

!  Time since J2000.0 in Julian millennia.
t = ( ( date1-dj00 ) + date2 ) / djm

!  =================
!  Topocentric terms
!  =================

!  Convert UT to local solar time in radians.
tsol = mod(ut,1d0) * d2pi + elong

!  FUNDAMENTAL ARGUMENTS:  Simon et al. 1994.

!  Combine time argument (millennia) with deg/arcsec factor.
w = t / 3600d0

!  Sun Mean Longitude.
elsun = mod(280.46645683d0 + 1296027711.03429d0 * w, 360d0) * dd2r

!  Sun Mean Anomaly.
emsun = mod(357.52910918d0 + 1295965810.481d0 * w, 360d0) * dd2r

!  Mean Elongation of Moon from Sun.
d = mod(297.85019547d0 + 16029616012.090d0 * w, 360d0) * dd2r

!  Mean Longitude of Jupiter.
elj = mod(34.35151874d0 + 109306899.89453d0 * w, 360d0) * dd2r

!  Mean Longitude of Saturn.
els = mod(50.07744430d0 + 44046398.47038d0 * w, 360d0) * dd2r

!  TOPOCENTRIC TERMS:  Moyer 1981 and Murray 1983.
wt =  + 0.00029d-10 * u * sin(tsol + elsun - els) &
      + 0.00100d-10 * u * sin(tsol - 2d0*emsun) &
      + 0.00133d-10 * u * sin(tsol - d) &
      + 0.00133d-10 * u * sin(tsol + elsun - elj) &
      - 0.00229d-10 * u * sin(tsol + 2d0*elsun + emsun) &
      - 0.0220d-10 * v * cos(elsun + emsun) &
      + 0.05312d-10 * u * sin(tsol - emsun) &
      - 0.13677d-10 * u * sin(tsol + 2d0*elsun) &
      - 1.3184d-10 * v * cos(elsun) &
      + 3.17679d-10 * u * sin(tsol)

!  =====================
!  Fairhead et al. model
!  =====================

!  T**0
w0 = 0d0
do 10 j=474,1,-1
   w0 = w0 + fairhd(1,j) * sin(fairhd(2,j)*t + fairhd(3,j))
10 continue

!  T**1
w1 = 0d0
do 11 j=679,475,-1
   w1 = w1 + fairhd(1,j) * sin(fairhd(2,j)*t + fairhd(3,j))
11 continue

!  T**2
w2 = 0d0
do 12 j=764,680,-1
   w2 = w2 + fairhd(1,j) * sin(fairhd(2,j)*t + fairhd(3,j))
12 continue

!  T**3
w3 = 0d0
do 13 j=784,765,-1
   w3 = w3 + fairhd(1,j) * sin(fairhd(2,j)*t + fairhd(3,j))
13 continue

!  T**4
w4 = 0d0
do 14 j=787,785,-1
   w4 = w4 + fairhd(1,j) * sin(fairhd(2,j)*t + fairhd(3,j))
14 continue

!  Multiply by powers of T and combine.
wf = t * ( t * ( t * ( t * w4 + w3 ) + w2 ) + w1 ) + w0

!  Adjustments to use JPL planetary masses instead of IAU.
wj =   0.00065d-6 * sin(6069.776754d0*t + 4.021194d0) + &
       0.00033d-6 * sin( 213.299095d0*t + 5.543132d0) + &
    ( -0.00196d-6 * sin(6208.294251d0*t + 5.696701d0) ) + &
    ( -0.00173d-6 * sin(  74.781599d0*t + 2.435900d0) ) + &
       0.03638d-6 * t * t

!  ============
!  Final result
!  ============

!  TDB-TT in seconds.
DTDB = wt + wf + wj

end function DTDB
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine DTF2D ( scale, iy, im, id, ihr, imn, sec, &
                       d1, d2, j )
!>
!  Encode date and time fields into 2-part Julian Date (or in the case
!  of UTC a quasi-JD form that includes special provision for leap
!  seconds).
!
!  Status:  support routine.
!
!  Given:
!     SCALE      c*(*)  time scale ID (Note 1)
!     IY,IM,ID   i      year, month, day in Gregorian calendar (Note 2)
!     IHR,IMN    i      hour, minute
!     SEC        d      seconds
!
!  Returned:
!     D1,D2      d      2-part Julian Date (Notes 3,4)
!     J          i      status: +3 = both of next two
!                               +2 = time is after end of day (Note 5)
!                               +1 = dubious year (Note 6)
!                                0 = OK
!                               -1 = bad year
!                               -2 = bad month
!                               -3 = bad day
!                               -4 = bad hour
!                               -5 = bad minute
!                               -6 = bad second (<0)
!
!  Notes:
!
!  1) SCALE identifies the time scale.  Only the value 'UTC' (in upper
!     case) is significant, and enables handling of leap seconds (see
!     Note 4).
!
!  2) For calendar conventions and limitations, see CAL2JD.
!
!  3) The sum of the results, D1+D2, is Julian Date, where normally D1
!     is the Julian Day Number and D2 is the fraction of a day.  In the
!     case of UTC, where the use of JD is problematical, special
!     conventions apply:  see the next note.
!
!  4) JD cannot unambiguously represent UTC during a leap second unless
!     special measures are taken.  The SOFA internal convention is that
!     the quasi-JD day represents UTC days whether the length is 86399,
!     86400 or 86401 SI seconds.  In the 1960-1972 era there were
!     smaller jumps (in either direction) each time the linear UTC(TAI)
!     expression was changed, and these "mini-leaps" are also included
!     in the SOFA convention.
!
!  5) The warning status "time is after end of day" usually means that
!     the SEC argument is greater than 60D0.  However, in a day ending
!     in a leap second the limit changes to 61D0 (or 59D0 in the case of
!     a negative leap second).
!
!  6) The warning status "dubious year" flags UTCs that predate the
!     introduction of the time scale or that are too far in the future
!     to be trusted.  See DAT for further details.
!
!  7) Only in the case of continuous and regular time scales (TAI, TT,
!     TCG, TCB and TDB) is the result D1+D2 a Julian Date, strictly
!     speaking.  In the other cases (UT1 and UTC) the result must be
!     used with circumspection;  in particular the difference between
!     two such results cannot be interpreted as a precise time
!     interval.
!
!  Called:
!     CAL2JD   Gregorian calendar to JD
!     DAT      delta(AT) = TAI-UTC
!     JD2CAL   JD to Gregorian calendar
!
!  This revision:  2013 July 26
!
!-----------------------------------------------------------------------

implicit none
character*(*) scale
integer iy, im, id, ihr, imn
double precision sec, d1, d2
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

integer js, iy2, im2, id2
double precision dj, w, day, seclim, dat0, dat12, dat24, &
                 dleap, time

!  Today's Julian Day Number.
call CAL2JD ( iy, im, id, dj, w, js )
if ( js/=0 ) go to 9
dj = dj + w

!  Day length and final minute length in seconds (provisional).
day = d2s
seclim = 60d0

!  Deal with the UTC leap second case.
if ( scale=='UTC' ) then

!     TAI-UTC at 0h today.
   call DAT ( iy, im, id, 0d0, dat0, js )
   if ( js<0 ) go to 9

!     TAI-UTC at 12h today (to detect drift).
   call DAT ( iy, im, id, 0.5d0, dat12, js )
   if ( js<0 ) go to 9

!     TAI-UTC at 0h tomorrow (to detect jumps).
   call JD2CAL ( dj, 1.5d0, iy2, im2, id2, w, js )
   if ( js/=0 ) go to 9
   call DAT ( iy2, im2, id2, 0d0, dat24, js )
   if ( js<0 ) go to 9

!     Any sudden change in TAI-UTC between today and tomorrow.
   dleap = dat24 - ( 2d0 * dat12 - dat0 )

!     If leap second day, correct the day and final minute lengths.
   day = day + dleap
   if ( ihr==23 .and. imn==59 ) seclim = seclim + dleap

!     End of UTC-specific actions.
end if

!  Validate the time.
if ( ihr>=0 .and. ihr<=23 ) then
   if ( imn>=0 .and. imn<=59 ) then
      if ( sec>=0d0 ) then
         if ( sec>=seclim ) then
            js = js + 2
         end if
      else
         js = -6
      end if
   else
      js = -5
   end if
else
   js = -4
end if
if ( js<0 ) go to 9

!  The time in days.
time = (60d0*dble(60*ihr+imn)+sec) / day

!  Return the date and time.
d1 = dj
d2 = time

!  Return the status.
9 continue
j = js

end subroutine DTF2D
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ECEQ06 ( date1, date2, dl, db, dr, dd )
!>
!  Transformation from ecliptic coordinates (mean equinox and ecliptic
!  of date) to ICRS RA,Dec, using the IAU 2006 precession model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2  d      TT as a 2-part Julian Date (Note 1)
!     DL,DB        d      ecliptic longitude and latitude (radians)
!
!  Returned:
!     DR,DD        d      ICRS right ascension and declination (radians)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) No assumptions are made about whether the coordinates represent
!     starlight and embody astrometric effects such as parallax or
!     aberration.
!
!  3) The transformation is approximately that from ecliptic longitude
!     and latitude (mean equinox and ecliptic of date) to mean J2000.0
!     right ascension and declination, with only frame bias (always less
!     than 25 mas) to disturb this classical picture.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     ECM06    J2000.0 to ecliptic rotation matrix, IAU 2006
!     TRXP     product of transpose of r-matrix and p-vector
!     C2S      unit vector to spherical coordinates
!     ANP      normalize angle into range 0 to 2pi
!     ANPM     normalize angle into range +/- pi
!
!  This revision:  2016 February 9
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dl, db, dr, dd

double precision rm(3,3), v1(3), v2(3), a, b

!     DOUBLE PRECISION ANP, ANPM

!  Spherical to Cartesian.
call S2C ( dl, db, v1 )

!  Rotation matrix, ICRS equatorial to ecliptic.
call ECM06 ( date1, date2, rm )

!  The transformation from ecliptic to ICRS.
call TRXP ( rm, v1, v2 )

!  Cartesian to spherical.
call C2S ( v2, a, b )

!  Express in conventional ranges.
dr = ANP ( a )
dd = ANPM ( b )

end subroutine ECEQ06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ECM06 ( date1, date2, rm )
!>
!  ICRS equatorial to ecliptic rotation matrix, IAU 2006.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2  d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RM           d(3,3) ICRS to ecliptic rotation matrix
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix is in the sense
!
!        E_ep = RM x P_ICRS,
!
!     where P_ICRS is a vector with respect to ICRS right ascension
!     and declination axes and E_ep is the same vector with respect to
!     the (inertial) ecliptic and equinox of date.
!
!  3) P_ICRS is a free vector, merely a direction, typically of unit
!     magnitude, and not bound to any particular spatial origin, such as
!     the Earth, Sun or SSB.  No assumptions are made about whether it
!     represents starlight and embodies astrometric effects such as
!     parallax or aberration.  The transformation is approximately that
!     between mean J2000.0 right ascension and declination and ecliptic
!     longitude and latitude, with only frame bias (always less than
!     25 mas) to disturb this classical picture.
!
!  Called:
!     OBL06    mean obliquity, IAU 2006
!     PMAT06   PB matrix, IAU 2006
!     IR       initialize r-matrix to identity
!     RX       rotate around X-axis
!     RXR      product of two r-matrices
!
!  This revision:  2015 December 11
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rm(3,3)

double precision ob, bp(3,3), e(3,3)
!     DOUBLE PRECISION OBL06

!  Obliquity, IAU 2006.
ob = OBL06 ( date1, date2 )

!  Precession-bias matrix, IAU 2006.
call PMAT06 ( date1, date2, bp )

!  Equatorial of date to ecliptic matrix.
call IR ( e )
call RX ( ob, e )

!  ICRS to ecliptic coordinates rotation matrix, IAU 2006.
call RXR ( e, bp, rm )

end subroutine ECM06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EE00 ( date1, date2, epsa, dpsi )
!>
!  The equation of the equinoxes, compatible with IAU 2000 resolutions,
!  given the nutation in longitude and the mean obliquity.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!     EPSA           d      mean obliquity (Note 2)
!     DPSI           d      nutation in longitude (Note 3)
!
!  Returned:
!     EE00       d      equation of the equinoxes (Note 4)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The obliquity, in radians, is mean of date.
!
!  3) The result, which is in radians, operates in the following sense:
!
!        Greenwich apparent ST = GMST + equation of the equinoxes
!
!  4) The result is compatible with the IAU 2000 resolutions.  For
!     further details, see IERS Conventions 2003 and Capitaine et al.
!     (2002).
!
!  Called:
!     EECT00   equation of the equinoxes complementary terms
!
!  References:
!
!     Capitaine, N., Wallace, P.T. and McCarthy, D.D., "Expressions to
!     implement the IAU 2000 definition of UT1", Astronomy &
!     Astrophysics, 406, 1135-1149 (2003)
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, epsa, dpsi

!     DOUBLE PRECISION EECT00

!  Equation of the equinoxes.
EE00 = dpsi * cos(epsa) + EECT00 ( date1, date2 )

end function EE00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EE00A ( date1, date2 )
!>
!  Equation of the equinoxes, compatible with IAU 2000 resolutions.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     EE00A      d      equation of the equinoxes (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The result, which is in radians, operates in the following sense:
!
!        Greenwich apparent ST = GMST + equation of the equinoxes
!
!  3) The result is compatible with the IAU 2000 resolutions.  For
!     further details, see IERS Conventions 2003 and Capitaine et al.
!     (2002).
!
!  Called:
!     PR00     IAU 2000 precession adjustments
!     OBL80    mean obliquity, IAU 1980
!     NUT00A   nutation, IAU 2000A
!     EE00     equation of the equinoxes, IAU 2000
!
!  References:
!
!     Capitaine, N., Wallace, P.T. and McCarthy, D.D., "Expressions to
!     implement the IAU 2000 definition of UT1", Astronomy &
!     Astrophysics, 406, 1135-1149 (2003)
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

double precision dpsipr, depspr, epsa, dpsi, deps

!     DOUBLE PRECISION OBL80, EE00

!  IAU 2000 precession-rate adjustments.
call PR00 ( date1, date2, dpsipr, depspr )

!  Mean obliquity, consistent with IAU 2000 precession-nutation.
epsa = OBL80 ( date1, date2 ) + depspr

!  Nutation in longitude.
call NUT00A ( date1, date2, dpsi, deps )

!  Equation of the equinoxes.
EE00A = EE00 ( date1, date2, epsa, dpsi )

end function EE00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EE00B ( date1, date2 )
!>
!  Equation of the equinoxes, compatible with IAU 2000 resolutions but
!  using the truncated nutation model IAU 2000B.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d     TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     EE00B     d     equation of the equinoxes (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The result, which is in radians, operates in the following sense:
!
!        Greenwich apparent ST = GMST + equation of the equinoxes
!
!  3) The result is compatible with the IAU 2000 resolutions except that
!     accuracy has been compromised for the sake of speed.  For further
!     details, see McCarthy & Luzum (2001), IERS Conventions 2003 and
!     Capitaine et al. (2003).
!
!  Called:
!     PR00     IAU 2000 precession adjustments
!     OBL80    mean obliquity, IAU 1980
!     NUT00B   nutation, IAU 2000B
!     EE00     equation of the equinoxes, IAU 2000
!
!  References:
!
!     Capitaine, N., Wallace, P.T. and McCarthy, D.D., "Expressions to
!     implement the IAU 2000 definition of UT1", Astronomy &
!     Astrophysics, 406, 1135-1149 (2003)
!
!     McCarthy, D.D. & Luzum, B.J., "An abridged model of the
!     precession-nutation of the celestial pole", Celestial Mechanics &
!     Dynamical Astronomy, 85, 37-49 (2003)
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

double precision dpsipr, depspr, epsa, dpsi, deps

!     DOUBLE PRECISION OBL80, EE00

!  IAU 2000 precession-rate adjustments.
call PR00 ( date1, date2, dpsipr, depspr )

!  Mean obliquity, consistent with IAU 2000 precession-nutation.
epsa = OBL80 ( date1, date2 ) + depspr

!  Nutation in longitude.
call NUT00B ( date1, date2, dpsi, deps )

!  Equation of the equinoxes.
EE00B = EE00 ( date1, date2, epsa, dpsi )

end function EE00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EE06A ( date1, date2 )
!>
!  Equation of the equinoxes, compatible with IAU 2000 resolutions and
!  IAU 2006/2000A precession-nutation.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     EE06A      d      equation of the equinoxes (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The result, which is in radians, operates in the following sense:
!
!        Greenwich apparent ST = GMST + equation of the equinoxes
!
!  Called:
!     ANPM     normalize angle into range +/- pi
!     GST06A   Greenwich apparent sidereal time, IAU 2006/2000A
!     GMST06   Greenwich mean sidereal time, IAU 2006
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), 2004, IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG
!
!  This revision:  2006 October 31
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

!     DOUBLE PRECISION ANPM, GST06A, GMST06

!  Equation of the equinoxes.
EE06A = ANPM ( GST06A ( 0d0, 0d0, date1, date2 ) - &
                       GMST06 ( 0d0, 0d0, date1, date2 ) )

end function EE06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EECT00 ( date1, date2 )
!>
!  Equation of the equinoxes complementary terms, consistent with
!  IAU 2000 resolutions.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2   d    TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     EECT00    d    complementary terms (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The "complementary terms" are part of the equation of the
!     equinoxes (EE), classically the difference between apparent and
!     mean Sidereal Time:
!
!        GAST = GMST + EE
!
!     with:
!
!        EE = dpsi * cos(eps)
!
!     where dpsi is the nutation in longitude and eps is the obliquity
!     of date.  However, if the rotation of the Earth were constant in
!     an inertial frame the classical formulation would lead to apparent
!     irregularities in the UT1 timescale traceable to side-effects of
!     precession-nutation.  In order to eliminate these effects from
!     UT1, "complementary terms" were introduced in 1994 (IAU, 1994) and
!     took effect from 1997 (Capitaine and Gontier, 1993):
!
!        GAST = GMST + CT + EE
!
!     By convention, the complementary terms are included as part of the
!     equation of the equinoxes rather than as part of the mean Sidereal
!     Time.  This slightly compromises the "geometrical" interpretation
!     of mean sidereal time but is otherwise inconsequential.
!
!     The present routine computes CT in the above expression,
!     compatible with IAU 2000 resolutions (Capitaine et al., 2002, and
!     IERS Conventions 2003).
!
!  Called:
!     FAL03    mean anomaly of the Moon
!     FALP03   mean anomaly of the Sun
!     FAF03    mean argument of the latitude of the Moon
!     FAD03    mean elongation of the Moon from the Sun
!     FAOM03   mean longitude of the Moon's ascending node
!     FAVE03   mean longitude of Venus
!     FAE03    mean longitude of Earth
!     FAPA03   general accumulated precession in longitude
!
!  References:
!
!     Capitaine, N. & Gontier, A.-M., Astron.Astrophys., 275,
!     645-650 (1993)
!
!     Capitaine, N., Wallace, P.T. and McCarthy, D.D., "Expressions to
!     implement the IAU 2000 definition of UT1", Astron.Astrophys.,
!     406, 1135-1149 (2003)
!
!     IAU Resolution C7, Recommendation 3 (1994)
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2017 October 23
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

!  Time since J2000.0, in Julian centuries
double precision t

!  Miscellaneous
integer i, j
double precision a, s0, s1
!     DOUBLE PRECISION FAL03, FALP03, FAF03,
!    :                 FAD03, FAOM03, FAVE03, FAE03,
!    :                 FAPA03

!  Fundamental arguments
double precision fa(14)

!  -----------------------------------------
!  The series for the EE complementary terms
!  -----------------------------------------

!  Number of terms in the series
integer ne0, ne1
parameter ( ne0=33, ne1=1 )

!  Coefficients of l,l',F,D,Om,LVe,LE,pA
integer ke0 ( 8, ne0 ), &
        ke1 ( 8, ne1 )

!  Sine and cosine coefficients
double precision se0 ( 2, ne0 ), &
                 se1 ( 2, ne1 )

!  Argument coefficients for t^0
data ( ( ke0(i,j), i=1,8), j=1,10 ) / &
  0,  0,  0,  0,  1,  0,  0,  0, &
  0,  0,  0,  0,  2,  0,  0,  0, &
  0,  0,  2, -2,  3,  0,  0,  0, &
  0,  0,  2, -2,  1,  0,  0,  0, &
  0,  0,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  3,  0,  0,  0, &
  0,  0,  2,  0,  1,  0,  0,  0, &
  0,  0,  0,  0,  3,  0,  0,  0, &
  0,  1,  0,  0,  1,  0,  0,  0, &
  0,  1,  0,  0, -1,  0,  0,  0 /
data ( ( ke0(i,j), i=1,8), j=11,20 ) / &
  1,  0,  0,  0, -1,  0,  0,  0, &
  1,  0,  0,  0,  1,  0,  0,  0, &
  0,  1,  2, -2,  3,  0,  0,  0, &
  0,  1,  2, -2,  1,  0,  0,  0, &
  0,  0,  4, -4,  4,  0,  0,  0, &
  0,  0,  1, -1,  1, -8, 12,  0, &
  0,  0,  2,  0,  0,  0,  0,  0, &
  0,  0,  2,  0,  2,  0,  0,  0, &
  1,  0,  2,  0,  3,  0,  0,  0, &
  1,  0,  2,  0,  1,  0,  0,  0 /
data ( ( ke0(i,j), i=1,8), j=21,30 ) / &
  0,  0,  2, -2,  0,  0,  0,  0, &
  0,  1, -2,  2, -3,  0,  0,  0, &
  0,  1, -2,  2, -1,  0,  0,  0, &
  0,  0,  0,  0,  0,  8,-13, -1, &
  0,  0,  0,  2,  0,  0,  0,  0, &
  2,  0, -2,  0, -1,  0,  0,  0, &
  1,  0,  0, -2,  1,  0,  0,  0, &
  0,  1,  2, -2,  2,  0,  0,  0, &
  1,  0,  0, -2, -1,  0,  0,  0, &
  0,  0,  4, -2,  4,  0,  0,  0 /
data ( ( ke0(i,j), i=1,8), j=31,ne0 ) / &
  0,  0,  2, -2,  4,  0,  0,  0, &
  1,  0, -2,  0, -3,  0,  0,  0, &
  1,  0, -2,  0, -1,  0,  0,  0 /

!  Argument coefficients for t^1
data ( ( ke1(i,j), i=1,8), j=1,ne1 ) / &
  0,  0,  0,  0,  1,  0,  0,  0 /

!  Sine and cosine coefficients for t^0
data ( ( se0(i,j), i=1,2), j =    1,   10 ) / &
            +2640.96d-6,          -0.39d-6, &
              +63.52d-6,          -0.02d-6, &
              +11.75d-6,          +0.01d-6, &
              +11.21d-6,          +0.01d-6, &
               -4.55d-6,          +0.00d-6, &
               +2.02d-6,          +0.00d-6, &
               +1.98d-6,          +0.00d-6, &
               -1.72d-6,          +0.00d-6, &
               -1.41d-6,          -0.01d-6, &
               -1.26d-6,          -0.01d-6 /
data ( ( se0(i,j), i=1,2), j =   11,   20 ) / &
               -0.63d-6,          +0.00d-6, &
               -0.63d-6,          +0.00d-6, &
               +0.46d-6,          +0.00d-6, &
               +0.45d-6,          +0.00d-6, &
               +0.36d-6,          +0.00d-6, &
               -0.24d-6,          -0.12d-6, &
               +0.32d-6,          +0.00d-6, &
               +0.28d-6,          +0.00d-6, &
               +0.27d-6,          +0.00d-6, &
               +0.26d-6,          +0.00d-6 /
data ( ( se0(i,j), i=1,2), j =   21,   30 ) / &
               -0.21d-6,          +0.00d-6, &
               +0.19d-6,          +0.00d-6, &
               +0.18d-6,          +0.00d-6, &
               -0.10d-6,          +0.05d-6, &
               +0.15d-6,          +0.00d-6, &
               -0.14d-6,          +0.00d-6, &
               +0.14d-6,          +0.00d-6, &
               -0.14d-6,          +0.00d-6, &
               +0.14d-6,          +0.00d-6, &
               +0.13d-6,          +0.00d-6 /
data ( ( se0(i,j), i=1,2), j =   31,  ne0 ) / &
               -0.11d-6,          +0.00d-6, &
               +0.11d-6,          +0.00d-6, &
               +0.11d-6,          +0.00d-6 /

!  Sine and cosine coefficients for t^1
data ( ( se1(i,j), i=1,2), j =    1,  ne1 ) / &
               -0.87d-6,          +0.00d-6 /

!  Interval between fundamental epoch J2000.0 and current date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Fundamental Arguments (from IERS Conventions 2003)

!  Mean anomaly of the Moon.
fa(1) = FAL03 ( t )

!  Mean anomaly of the Sun.
fa(2) = FALP03 ( t )

!  Mean longitude of the Moon minus that of the ascending node.
fa(3) = FAF03 ( t )

!  Mean elongation of the Moon from the Sun.
fa(4) = FAD03 ( t )

!  Mean longitude of the ascending node of the Moon.
fa(5) = FAOM03 ( t )

!  Mean longitude of Venus.
fa(6) = FAVE03 ( t )

!  Mean longitude of Earth.
fa(7) = FAE03 ( t )

!  General precession in longitude.
fa(8) = FAPA03 ( t )

!  Evaluate the EE complementary terms.
s0 = 0d0
s1 = 0d0

do 2 i = ne0,1,-1
   a = 0d0
   do 1 j=1,8
      a = a + dble(ke0(j,i))*fa(j)
1    continue
   s0 = s0 + ( se0(1,i)*sin(a) + se0(2,i)*cos(a) )
2 continue
do 4 i = ne1,1,-1
   a = 0d0
   do 3 j=1,8
      a = a + dble(ke1(j,i))*fa(j)
3    continue
   s1 = s1 + ( se1(1,i)*sin(a) + se1(2,i)*cos(a) )
4 continue
EECT00 = ( s0 + s1 * t ) * das2r

end function EECT00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine EFORM ( n, a, f, j )
!>
!  Earth reference ellipsoids.
!
!  Status:  canonical.
!
!  Given:
!     N         i     ellipsoid identifier (Note 1)
!
!  Returned:
!     A         d     equatorial radius (meters, Note 2)
!     F         d     flattening (Note 2)
!     J         i     status:  0 = OK
!                             -1 = illegal identifier (Note 3)
!
!  Notes:
!
!  1) The identifier N is a number that specifies the choice of
!     reference ellipsoid.  The following are supported:
!
!        N   ellipsoid
!
!        1    WGS84
!        2    GRS80
!        3    WGS72
!
!     The number N has no significance outside the SOFA software.
!
!  2) The ellipsoid parameters are returned in the form of equatorial
!     radius in meters (A) and flattening (F).  The latter is a number
!     around 0.00335, i.e. around 1/298.
!
!  3) For the case where an unsupported N value is supplied, zero A and
!     F are returned, as well as error status.
!
!  References:
!
!     Department of Defense World Geodetic System 1984, National Imagery
!     and Mapping Agency Technical Report 8350.2, Third Edition, p3-2.
!
!     Moritz, H., Bull. Geodesique 66-2, 187 (1992).
!
!     The Department of Defense World Geodetic System 1972, World
!     Geodetic System Committee, May 1974.
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     p220.
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

integer n
double precision a, f
integer j

!  Preset the status to OK
j = 0

!  Look up A and F for the specified reference ellipsoid.

if ( n==1 ) then

!     WGS84.
   a = 6378137d0
   f = 1d0 / 298.257223563d0

else if ( n==2 ) then

!     GRS80.
   a = 6378137d0
   f = 1d0 / 298.257222101d0

else if ( n==3 ) then

!     WGS72.
   a = 6378135d0
   f = 1d0 / 298.26d0

else

!     Invalid identifier.
   a = 0d0
   f = 0d0
   j = -1

end if

end subroutine EFORM
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EO06A ( date1, date2 )
!>
!  Equation of the origins, IAU 2006 precession and IAU 2000A nutation.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     EO06A      d      equation of the origins in radians
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The equation of the origins is the distance between the true
!     equinox and the celestial intermediate origin and, equivalently,
!     the difference between Earth rotation angle and Greenwich
!     apparent sidereal time (ERA-GST).  It comprises the precession
!     (since J2000.0) in right ascension plus the equation of the
!     equinoxes (including the small correction terms).
!
!  Called:
!     PNM06A   classical NPB matrix, IAU 2006/2000A
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     S06      the CIO locator s, given X,Y, IAU 2006
!     EORS     equation of the origins, given NPB matrix and s
!
!  References:
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2007 February 13
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

double precision r(3,3), x, y, s
!     DOUBLE PRECISION S06, EORS

!  Classical nutation x precession x bias matrix.
call PNM06A ( date1, date2, r )

!  Extract CIP coordinates.
call BPN2XY ( r, x, y )

!  The CIO locator, s.
s = S06 ( date1, date2, x, y )

!  Solve for the EO.
EO06A = EORS ( r, s )

end function EO06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EORS ( rnpb, s )
!>
!  Equation of the origins, given the classical NPB matrix and the
!  quantity s.
!
!  Status:  support routine.
!
!  Given:
!     RNPB    d(3,3)    classical nutation x precession x bias matrix
!     S         d       the quantity s (the CIO locator)
!
!  Returned:
!     EORS  d       the equation of the origins in radians.
!
!  Notes:
!
!  1)  The equation of the origins is the distance between the true
!      equinox and the celestial intermediate origin and, equivalently,
!      the difference between Earth rotation angle and Greenwich
!      apparent sidereal time (ERA-GST).  It comprises the precession
!      (since J2000.0) in right ascension plus the equation of the
!      equinoxes (including the small correction terms).
!
!  2)  The algorithm is from Wallace & Capitaine (2006).
!
!  References:
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!     Wallace, P. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2008 February 24
!
!-----------------------------------------------------------------------

implicit none

double precision rnpb(3,3), s

double precision x, ax, xs, ys, zs, p, q

!  Evaluate Wallace & Capitaine (2006) expression (16).
x = rnpb(3,1)
ax = x / ( 1d0 + rnpb(3,3) )
xs = 1d0 - ax*x
ys = -ax*rnpb(3,2)
zs = -x
p = rnpb(1,1)*xs + rnpb(1,2)*ys + rnpb(1,3)*zs
q = rnpb(2,1)*xs + rnpb(2,2)*ys + rnpb(2,3)*zs
if ( p/=0d0 .or. q/=0d0 ) then
   EORS = s - atan2 ( q, p )
else
   EORS = s
end if

end function EORS
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EPB ( dj1, dj2 )
!>
!  Julian Date to Besselian Epoch.
!
!  Status:  support routine.
!
!  Given:
!     DJ1,DJ2   d         Julian Date (see note)
!
!  The result is the Besselian Epoch.
!
!  Note:
!
!     The Julian Date is supplied in two pieces, in the usual SOFA
!     manner, which is designed to preserve time resolution.  The
!     Julian Date is available as a single number by adding DJ1 and
!     DJ2.  The maximum resolution is achieved if DJ1 is 2451545D0
!     (J2000.0).
!
!  Reference:
!
!     Lieske, J.H., 1979, Astron.Astrophys. 73, 282.
!
!  This revision:  2013 August 7
!
!-----------------------------------------------------------------------

implicit none

double precision dj1, dj2

!  J2000.0 as a Julian Date
double precision dj00
parameter ( dj00 = 2451545d0 )

!  J2000.0 minus B1900.0 (2415019.81352) in days
double precision d1900
parameter ( d1900 = 36524.68648d0 )

!  Length of tropical year B1900 (days)
double precision ty
parameter ( ty = 365.242198781d0 )

EPB = 1900d0 + ( ( dj1-dj00 ) + ( dj2+d1900 ) ) / ty

end function EPB
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine EPB2JD ( epb, djm0, djm )
!>
!  Besselian Epoch to Julian Date.
!
!  Status:  support routine.
!
!  Given:
!     EPB         d     Besselian Epoch (e.g. 1957.3D0)
!
!  Returned:
!     DJM0        d     MJD zero-point: always 2400000.5
!     DJM         d     Modified Julian Date
!
!  Note:
!
!     The Julian Date is returned in two pieces, in the usual SOFA
!     manner, which is designed to preserve time resolution.  The
!     Julian Date is available as a single number by adding DJM0 and
!     DJM.
!
!  Reference:
!
!     Lieske, J.H., 1979, Astron.Astrophys. 73, 282.
!
!  This revision:  2008 May 11
!
!-----------------------------------------------------------------------

implicit none

double precision epb, djm0, djm

!  Length of tropical year B1900 (days)
double precision ty
parameter ( ty = 365.242198781d0 )

djm0 = 2400000.5d0
djm  =   15019.81352d0 + ( epb-1900d0 ) * ty

end subroutine EPB2JD
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EPJ ( dj1, dj2 )
!>
!  Julian Date to Julian Epoch.
!
!  Status:  support routine.
!
!  Given:
!     DJ1,DJ2   d         Julian Date (see note)
!
!  The result is the Julian Epoch.
!
!  Note:
!
!     The Julian Date is supplied in two pieces, in the usual SOFA
!     manner, which is designed to preserve time resolution.  The
!     Julian Date is available as a single number by adding DJ1 and
!     DJ2.  The maximum resolution is achieved if DJ1 is 2451545D0
!     (J2000.0).
!
!  Reference:
!
!     Lieske, J.H., 1979, Astron.Astrophys. 73, 282.
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision dj1, dj2

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian year
double precision djy
parameter ( djy = 365.25d0 )

EPJ = 2000d0 + ( ( dj1-dj00 ) + dj2 ) / djy

end function EPJ
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine EPJ2JD ( epj, djm0, djm )
!>
!  Julian Epoch to Julian Date.
!
!  Status:  support routine.
!
!  Given:
!     EPJ         d     Julian Epoch (e.g. 1996.8D0)
!
!  Returned:
!     DJM0        d     MJD zero-point: always 2400000.5
!     DJM         d     Modified Julian Date
!
!  Note:
!
!     The Julian Date is returned in two pieces, in the usual SOFA
!     manner, which is designed to preserve time resolution.  The
!     Julian Date is available as a single number by adding DJM0 and
!     DJM.
!
!  Reference:
!
!     Lieske, J.H., 1979, Astron.Astrophys. 73, 282.
!
!  This revision:  2008 May 11
!
!-----------------------------------------------------------------------

implicit none

double precision epj, djm0, djm

djm0 = 2400000.5d0
djm  =   51544.5d0 + ( epj-2000d0 ) * 365.25d0

end subroutine EPJ2JD
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine EPV00 ( date1, date2, pvh, pvb, jstat )
!>
!  Earth position and velocity, heliocentric and barycentric, with
!  respect to the Barycentric Celestial Reference System.
!
!  Status:  support routine.
!
!  Given:
!     DATE1    d        TDB date part A (Note 1)
!     DATE2    d        TDB date part B (Note 1)
!
!  Returned:
!     PVH      d(3,2)   heliocentric Earth position/velocity (au,au/day)
!     PVB      d(3,2)   barycentric Earth position/velocity (au,au/day)
!     JSTAT    i        status: 0 = OK
!                              +1 = warning: date outside 1900-2100 AD
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!     However, the accuracy of the result is more likely to be
!     limited by the algorithm itself than the way the epoch has been
!     expressed.
!
!  2) On return, the arrays PVH and PVB contain the following:
!
!        PVH(1,1)  x       }
!        PVH(2,1)  y       } heliocentric position, au
!        PVH(3,1)  z       }
!
!        PVH(1,2)  xdot    }
!        PVH(2,2)  ydot    } heliocentric velocity, au/d
!        PVH(3,2)  zdot    }
!
!        PVB(1,1)  x       }
!        PVB(2,1)  y       } barycentric position, au
!        PVB(3,1)  z       }
!
!        PVB(1,2)  xdot    }
!        PVB(2,2)  ydot    } barycentric velocity, au/d
!        PVB(3,2)  zdot    }
!
!     The vectors are with respect to the Barycentric Celestial
!     Reference System.  The time unit is one day in TDB.
!
!  3) The routine is a SIMPLIFIED SOLUTION from the planetary theory
!     VSOP2000 (X. Moisson, P. Bretagnon, 2001, Celes. Mechanics &
!     Dyn. Astron., 80, 3/4, 205-213) and is an adaptation of original
!     Fortran code supplied by P. Bretagnon (private comm., 2000).
!
!  4) Comparisons over the time span 1900-2100 with this simplified
!     solution and the JPL DE405 ephemeris give the following results:
!
!                                RMS    max
!           Heliocentric:
!              position error    3.7   11.2   km
!              velocity error    1.4    5.0   mm/s
!
!           Barycentric:
!              position error    4.6   13.4   km
!              velocity error    1.4    4.9   mm/s
!
!     Comparisons with the JPL DE406 ephemeris show that by 1800 and
!     2200 the position errors are approximately double their 1900-2100
!     size.  By 1500 and 2500 the deterioration is a factor of 10 and by
!     1000 and 3000 a factor of 60.  The velocity accuracy falls off at
!     about half that rate.
!
!  This revision:  2017 March 16
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, pvh(3,2), pvb(3,2)
integer jstat

double precision t, t2, xyz, xyzd, a, b, c, ct, p, cp, &
                 ph(3), vh(3), pb(3), vb(3), x, y, z

integer i, j, k

!  Days per Julian year
double precision djy
parameter ( djy = 365.25d0 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )
!
!  Matrix elements for orienting the analytical model to DE405/ICRF.
!
!  The corresponding Euler angles are:
!
!                        d  '  "
!    1st rotation    -  23 26 21.4091 about the x-axis  (obliquity)
!    2nd rotation    +         0.0475 about the z-axis  (RA offset)
!
!  These were obtained empirically, by comparisons with DE405 over
!  1900-2100.
!
double precision am12, am13, am21, am22, am23, am32, am33
parameter ( am12 = +0.000000211284d0, &
            am13 = -0.000000091603d0, &
            am21 = -0.000000230286d0, &
            am22 = +0.917482137087d0, &
            am23 = -0.397776982902d0, &
            am32 = +0.397776982902d0, &
            am33 = +0.917482137087d0 )

!  ----------------------
!  Ephemeris Coefficients
!  ----------------------
!
!  The coefficients are stored in arrays of dimension (3,n,3).  There
!  are separate sets of arrays for (i) the Sun to Earth vector and
!  (ii) the Solar-System barycenter to Sun vector.  Each of these two
!  sets contains separate arrays for the terms (n in number) in each
!  power of time (in Julian years since J2000.0): T^0, T^1 and T^2.
!  Within each array, all the Cartesian x-components, elements (i,j,1),
!  appear first, followed by all the y-components, elements (i,j,2) and
!  finally all the z-components, elements (i,j,3).  At the lowest level
!  are groups of three coefficients.  The first coefficient in each
!  group, element (1,j,k), is the amplitude of the term, the second,
!  element (2,j,k), is the phase and the third, element (3,j,k), is the
!  frequency.
!
!  The naming scheme is such that a block
!
!     DOUBLE PRECISION bn(3,Mbn,3)
!
!  applies to body b and time exponent n:
!
!    . b can be either E (Earth with respect to Sun) or S (Sun with
!      respect to Solar-System Barycenter)
!
!    . n can be 0, 1 or 2, for T^0, T^1 or T^2
!
!  For example, array E2(3,ME2,3) contains the coefficients for
!  the T^2 terms for the Sun-to-Earth vector.
!
!  There is no requirement for the X, Y and Z models for a particular
!  block to use the same number of coefficients.  The number actually
!  used is parameterized, the number of terms being used called NbnX,
!  NbnY, and NbnZ respectively.  The parameter Mbn is the biggest of
!  the three, and defines the array size.  Unused elements are not
!  initialized and are never accessed.
!

integer ne0(3), ne0x, ne0y, ne0z, me0, &
        ne1(3), ne1x, ne1y, ne1z, me1, &
        ne2(3), ne2x, ne2y, ne2z, me2, &
        ns0(3), ns0x, ns0y, ns0z, ms0, &
        ns1(3), ns1x, ns1y, ns1z, ms1, &
        ns2(3), ns2x, ns2y, ns2z, ms2

parameter ( ne0x = 501, ne0y = 501, ne0z = 137, me0 = ne0x, &
            ne1x =  79, ne1y =  80, ne1z =  12, me1 = ne1y, &
            ne2x =   5, ne2y =   5, ne2z =   3, me2 = ne2x, &
            ns0x = 212, ns0y = 213, ns0z =  69, ms0 = ns0y, &
            ns1x =  50, ns1y =  50, ns1z =  14, ms1 = ns1x, &
            ns2x =   9, ns2y =   9, ns2z =   2, ms2 = ns2x )

double precision e0(3,me0,3), e1(3,me1,3), e2(3,me2,3), &
                 s0(3,ms0,3), s1(3,ms1,3), s2(3,ms2,3)

data ne0 / ne0x, ne0y, ne0z /
data ne1 / ne1x, ne1y, ne1z /
data ne2 / ne2x, ne2y, ne2z /
data ns0 / ns0x, ns0y, ns0z /
data ns1 / ns1x, ns1y, ns1z /
data ns2 / ns2x, ns2y, ns2z /

!  Sun-to-Earth, T^0, X
data ((e0(i,j,1),i=1,3),j=  1, 10) / &
  0.9998292878132d+00, 0.1753485171504d+01, 0.6283075850446d+01, &
  0.8352579567414d-02, 0.1710344404582d+01, 0.1256615170089d+02, &
  0.5611445335148d-02, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.1046664295572d-03, 0.1667225416770d+01, 0.1884922755134d+02, &
  0.3110842534677d-04, 0.6687513390251d+00, 0.8399684731857d+02, &
  0.2552413503550d-04, 0.5830637358413d+00, 0.5296909721118d+00, &
  0.2137207845781d-04, 0.1092330954011d+01, 0.1577343543434d+01, &
  0.1680240182951d-04, 0.4955366134987d+00, 0.6279552690824d+01, &
  0.1679012370795d-04, 0.6153014091901d+01, 0.6286599010068d+01, &
  0.1445526946777d-04, 0.3472744100492d+01, 0.2352866153506d+01 /
data ((e0(i,j,1),i=1,3),j= 11, 20) / &
  0.1091038246184d-04, 0.3689845786119d+01, 0.5223693906222d+01, &
  0.9344399733932d-05, 0.6073934645672d+01, 0.1203646072878d+02, &
  0.8993182910652d-05, 0.3175705249069d+01, 0.1021328554739d+02, &
  0.5665546034116d-05, 0.2152484672246d+01, 0.1059381944224d+01, &
  0.6844146703035d-05, 0.1306964099750d+01, 0.5753384878334d+01, &
  0.7346610905565d-05, 0.4354980070466d+01, 0.3981490189893d+00, &
  0.6815396474414d-05, 0.2218229211267d+01, 0.4705732307012d+01, &
  0.6112787253053d-05, 0.5384788425458d+01, 0.6812766822558d+01, &
  0.4518120711239d-05, 0.6087604012291d+01, 0.5884926831456d+01, &
  0.4521963430706d-05, 0.1279424524906d+01, 0.6256777527156d+01 /
data ((e0(i,j,1),i=1,3),j= 21, 30) / &
  0.4497426764085d-05, 0.5369129144266d+01, 0.6309374173736d+01, &
  0.4062190566959d-05, 0.5436473303367d+00, 0.6681224869435d+01, &
  0.5412193480192d-05, 0.7867838528395d+00, 0.7755226100720d+00, &
  0.5469839049386d-05, 0.1461440311134d+01, 0.1414349524433d+02, &
  0.5205264083477d-05, 0.4432944696116d+01, 0.7860419393880d+01, &
  0.2149759935455d-05, 0.4502237496846d+01, 0.1150676975667d+02, &
  0.2279109618501d-05, 0.1239441308815d+01, 0.7058598460518d+01, &
  0.2259282939683d-05, 0.3272430985331d+01, 0.4694002934110d+01, &
  0.2558950271319d-05, 0.2265471086404d+01, 0.1216800268190d+02, &
  0.2561581447555d-05, 0.1454740653245d+01, 0.7099330490126d+00 /
data ((e0(i,j,1),i=1,3),j= 31, 40) / &
  0.1781441115440d-05, 0.2962068630206d+01, 0.7962980379786d+00, &
  0.1612005874644d-05, 0.1473255041006d+01, 0.5486777812467d+01, &
  0.1818630667105d-05, 0.3743903293447d+00, 0.6283008715021d+01, &
  0.1818601377529d-05, 0.6274174354554d+01, 0.6283142985870d+01, &
  0.1554475925257d-05, 0.1624110906816d+01, 0.2513230340178d+02, &
  0.2090948029241d-05, 0.5852052276256d+01, 0.1179062909082d+02, &
  0.2000176345460d-05, 0.4072093298513d+01, 0.1778984560711d+02, &
  0.1289535917759d-05, 0.5217019331069d+01, 0.7079373888424d+01, &
  0.1281135307881d-05, 0.4802054538934d+01, 0.3738761453707d+01, &
  0.1518229005692d-05, 0.8691914742502d+00, 0.2132990797783d+00 /
data ((e0(i,j,1),i=1,3),j= 41, 50) / &
  0.9450128579027d-06, 0.4601859529950d+01, 0.1097707878456d+02, &
  0.7781119494996d-06, 0.1844352816694d+01, 0.8827390247185d+01, &
  0.7733407759912d-06, 0.3582790154750d+01, 0.5507553240374d+01, &
  0.7350644318120d-06, 0.2695277788230d+01, 0.1589072916335d+01, &
  0.6535928827023d-06, 0.3651327986142d+01, 0.1176985366291d+02, &
  0.6324624183656d-06, 0.2241302375862d+01, 0.6262300422539d+01, &
  0.6298565300557d-06, 0.4407122406081d+01, 0.6303851278352d+01, &
  0.8587037089179d-06, 0.3024307223119d+01, 0.1672837615881d+03, &
  0.8299954491035d-06, 0.6192539428237d+01, 0.3340612434717d+01, &
  0.6311263503401d-06, 0.2014758795416d+01, 0.7113454667900d-02 /
data ((e0(i,j,1),i=1,3),j= 51, 60) / &
  0.6005646745452d-06, 0.3399500503397d+01, 0.4136910472696d+01, &
  0.7917715109929d-06, 0.2493386877837d+01, 0.6069776770667d+01, &
  0.7556958099685d-06, 0.4159491740143d+01, 0.6496374930224d+01, &
  0.6773228244949d-06, 0.4034162934230d+01, 0.9437762937313d+01, &
  0.5370708577847d-06, 0.1562219163734d+01, 0.1194447056968d+01, &
  0.5710804266203d-06, 0.2662730803386d+01, 0.6282095334605d+01, &
  0.5709824583726d-06, 0.3985828430833d+01, 0.6284056366286d+01, &
  0.5143950896447d-06, 0.1308144688689d+01, 0.6290189305114d+01, &
  0.5088010604546d-06, 0.5352817214804d+01, 0.6275962395778d+01, &
  0.4960369085172d-06, 0.2644267922349d+01, 0.6127655567643d+01 /
data ((e0(i,j,1),i=1,3),j= 61, 70) / &
  0.4803137891183d-06, 0.4008844192080d+01, 0.6438496133249d+01, &
  0.5731747768225d-06, 0.3794550174597d+01, 0.3154687086868d+01, &
  0.4735947960579d-06, 0.6107118308982d+01, 0.3128388763578d+01, &
  0.4808348796625d-06, 0.4771458618163d+01, 0.8018209333619d+00, &
  0.4115073743137d-06, 0.3327111335159d+01, 0.8429241228195d+01, &
  0.5230575889287d-06, 0.5305708551694d+01, 0.1336797263425d+02, &
  0.5133977889215d-06, 0.5784230738814d+01, 0.1235285262111d+02, &
  0.5065815825327d-06, 0.2052064793679d+01, 0.1185621865188d+02, &
  0.4339831593868d-06, 0.3644994195830d+01, 0.1726015463500d+02, &
  0.3952928638953d-06, 0.4930376436758d+01, 0.5481254917084d+01 /
data ((e0(i,j,1),i=1,3),j= 71, 80) / &
  0.4898498111942d-06, 0.4542084219731d+00, 0.9225539266174d+01, &
  0.4757490209328d-06, 0.3161126388878d+01, 0.5856477690889d+01, &
  0.4727701669749d-06, 0.6214993845446d+00, 0.2544314396739d+01, &
  0.3800966681863d-06, 0.3040132339297d+01, 0.4265981595566d+00, &
  0.3257301077939d-06, 0.8064977360087d+00, 0.3930209696940d+01, &
  0.3255810528674d-06, 0.1974147981034d+01, 0.2146165377750d+01, &
  0.3252029748187d-06, 0.2845924913135d+01, 0.4164311961999d+01, &
  0.3255505635308d-06, 0.3017900824120d+01, 0.5088628793478d+01, &
  0.2801345211990d-06, 0.6109717793179d+01, 0.1256967486051d+02, &
  0.3688987740970d-06, 0.2911550235289d+01, 0.1807370494127d+02 /
data ((e0(i,j,1),i=1,3),j= 81, 90) / &
  0.2475153429458d-06, 0.2179146025856d+01, 0.2629832328990d-01, &
  0.3033457749150d-06, 0.1994161050744d+01, 0.4535059491685d+01, &
  0.2186743763110d-06, 0.5125687237936d+01, 0.1137170464392d+02, &
  0.2764777032774d-06, 0.4822646860252d+00, 0.1256262854127d+02, &
  0.2199028768592d-06, 0.4637633293831d+01, 0.1255903824622d+02, &
  0.2046482824760d-06, 0.1467038733093d+01, 0.7084896783808d+01, &
  0.2611209147507d-06, 0.3044718783485d+00, 0.7143069561767d+02, &
  0.2286079656818d-06, 0.4764220356805d+01, 0.8031092209206d+01, &
  0.1855071202587d-06, 0.3383637774428d+01, 0.1748016358760d+01, &
  0.2324669506784d-06, 0.6189088449251d+01, 0.1831953657923d+02 /
data ((e0(i,j,1),i=1,3),j= 91,100) / &
  0.1709528015688d-06, 0.5874966729774d+00, 0.4933208510675d+01, &
  0.2168156875828d-06, 0.4302994009132d+01, 0.1044738781244d+02, &
  0.2106675556535d-06, 0.3800475419891d+01, 0.7477522907414d+01, &
  0.1430213830465d-06, 0.1294660846502d+01, 0.2942463415728d+01, &
  0.1388396901944d-06, 0.4594797202114d+01, 0.8635942003952d+01, &
  0.1922258844190d-06, 0.4943044543591d+00, 0.1729818233119d+02, &
  0.1888460058292d-06, 0.2426943912028d+01, 0.1561374759853d+03, &
  0.1789449386107d-06, 0.1582973303499d+00, 0.1592596075957d+01, &
  0.1360803685374d-06, 0.5197240440504d+01, 0.1309584267300d+02, &
  0.1504038014709d-06, 0.3120360916217d+01, 0.1649636139783d+02 /
data ((e0(i,j,1),i=1,3),j=101,110) / &
  0.1382769533389d-06, 0.6164702888205d+01, 0.7632943190217d+01, &
  0.1438059769079d-06, 0.1437423770979d+01, 0.2042657109477d+02, &
  0.1326303260037d-06, 0.3609688799679d+01, 0.1213955354133d+02, &
  0.1159244950540d-06, 0.5463018167225d+01, 0.5331357529664d+01, &
  0.1433118149136d-06, 0.6028909912097d+01, 0.7342457794669d+01, &
  0.1234623148594d-06, 0.3109645574997d+01, 0.6279485555400d+01, &
  0.1233949875344d-06, 0.3539359332866d+01, 0.6286666145492d+01, &
  0.9927196061299d-07, 0.1259321569772d+01, 0.7234794171227d+01, &
  0.1242302191316d-06, 0.1065949392609d+01, 0.1511046609763d+02, &
  0.1098402195201d-06, 0.2192508743837d+01, 0.1098880815746d+02 /
data ((e0(i,j,1),i=1,3),j=111,120) / &
  0.1158191395315d-06, 0.4054411278650d+01, 0.5729506548653d+01, &
  0.9048475596241d-07, 0.5429764748518d+01, 0.9623688285163d+01, &
  0.8889853269023d-07, 0.5046586206575d+01, 0.6148010737701d+01, &
  0.1048694242164d-06, 0.2628858030806d+01, 0.6836645152238d+01, &
  0.1112308378646d-06, 0.4177292719907d+01, 0.1572083878776d+02, &
  0.8631729709901d-07, 0.1601345232557d+01, 0.6418140963190d+01, &
  0.8527816951664d-07, 0.2463888997513d+01, 0.1471231707864d+02, &
  0.7892139456991d-07, 0.3154022088718d+01, 0.2118763888447d+01, &
  0.1051782905236d-06, 0.4795035816088d+01, 0.1349867339771d+01, &
  0.1048219943164d-06, 0.2952983395230d+01, 0.5999216516294d+01 /
data ((e0(i,j,1),i=1,3),j=121,130) / &
  0.7435760775143d-07, 0.5420547991464d+01, 0.6040347114260d+01, &
  0.9869574106949d-07, 0.3695646753667d+01, 0.6566935184597d+01, &
  0.9156886364226d-07, 0.3922675306609d+01, 0.5643178611111d+01, &
  0.7006834356188d-07, 0.1233968624861d+01, 0.6525804586632d+01, &
  0.9806170182601d-07, 0.1919542280684d+01, 0.2122839202813d+02, &
  0.9052289673607d-07, 0.4615902724369d+01, 0.4690479774488d+01, &
  0.7554200867893d-07, 0.1236863719072d+01, 0.1253985337760d+02, &
  0.8215741286498d-07, 0.3286800101559d+00, 0.1097355562493d+02, &
  0.7185178575397d-07, 0.5880942158367d+01, 0.6245048154254d+01, &
  0.7130726476180d-07, 0.7674871987661d+00, 0.6321103546637d+01 /
data ((e0(i,j,1),i=1,3),j=131,140) / &
  0.6650894461162d-07, 0.6987129150116d+00, 0.5327476111629d+01, &
  0.7396888823688d-07, 0.3576824794443d+01, 0.5368044267797d+00, &
  0.7420588884775d-07, 0.5033615245369d+01, 0.2354323048545d+02, &
  0.6141181642908d-07, 0.9449927045673d+00, 0.1296430071988d+02, &
  0.6373557924058d-07, 0.6206342280341d+01, 0.9517183207817d+00, &
  0.6359474329261d-07, 0.5036079095757d+01, 0.1990745094947d+01, &
  0.5740173582646d-07, 0.6105106371350d+01, 0.9555997388169d+00, &
  0.7019864084602d-07, 0.7237747359018d+00, 0.5225775174439d+00, &
  0.6398054487042d-07, 0.3976367969666d+01, 0.2407292145756d+02, &
  0.7797092650498d-07, 0.4305423910623d+01, 0.2200391463820d+02 /
data ((e0(i,j,1),i=1,3),j=141,150) / &
  0.6466760000900d-07, 0.3500136825200d+01, 0.5230807360890d+01, &
  0.7529417043890d-07, 0.3514779246100d+01, 0.1842262939178d+02, &
  0.6924571140892d-07, 0.2743457928679d+01, 0.1554202828031d+00, &
  0.6220798650222d-07, 0.2242598118209d+01, 0.1845107853235d+02, &
  0.5870209391853d-07, 0.2332832707527d+01, 0.6398972393349d+00, &
  0.6263953473888d-07, 0.2191105358956d+01, 0.6277552955062d+01, &
  0.6257781390012d-07, 0.4457559396698d+01, 0.6288598745829d+01, &
  0.5697304945123d-07, 0.3499234761404d+01, 0.1551045220144d+01, &
  0.6335438746791d-07, 0.6441691079251d+00, 0.5216580451554d+01, &
  0.6377258441152d-07, 0.2252599151092d+01, 0.5650292065779d+01 /
data ((e0(i,j,1),i=1,3),j=151,160) / &
  0.6484841818165d-07, 0.1992812417646d+01, 0.1030928125552d+00, &
  0.4735551485250d-07, 0.3744672082942d+01, 0.1431416805965d+02, &
  0.4628595996170d-07, 0.1334226211745d+01, 0.5535693017924d+00, &
  0.6258152336933d-07, 0.4395836159154d+01, 0.2608790314060d+02, &
  0.6196171366594d-07, 0.2587043007997d+01, 0.8467247584405d+02, &
  0.6159556952126d-07, 0.4782499769128d+01, 0.2394243902548d+03, &
  0.4987741172394d-07, 0.7312257619924d+00, 0.7771377146812d+02, &
  0.5459280703142d-07, 0.3001376372532d+01, 0.6179983037890d+01, &
  0.4863461189999d-07, 0.3767222128541d+01, 0.9027992316901d+02, &
  0.5349912093158d-07, 0.3663594450273d+01, 0.6386168663001d+01 /
data ((e0(i,j,1),i=1,3),j=161,170) / &
  0.5673725607806d-07, 0.4331187919049d+01, 0.6915859635113d+01, &
  0.4745485060512d-07, 0.5816195745518d+01, 0.6282970628506d+01, &
  0.4745379005326d-07, 0.8323672435672d+00, 0.6283181072386d+01, &
  0.4049002796321d-07, 0.3785023976293d+01, 0.6254626709878d+01, &
  0.4247084014515d-07, 0.2378220728783d+01, 0.7875671926403d+01, &
  0.4026912363055d-07, 0.2864103423269d+01, 0.6311524991013d+01, &
  0.4062935011774d-07, 0.2415408595975d+01, 0.3634620989887d+01, &
  0.5347771048509d-07, 0.3343479309801d+01, 0.2515860172507d+02, &
  0.4829494136505d-07, 0.2821742398262d+01, 0.5760498333002d+01, &
  0.4342554404599d-07, 0.5624662458712d+01, 0.7238675589263d+01 /
data ((e0(i,j,1),i=1,3),j=171,180) / &
  0.4021599184361d-07, 0.5557250275009d+00, 0.1101510648075d+02, &
  0.4104900474558d-07, 0.3296691780005d+01, 0.6709674010002d+01, &
  0.4376532905131d-07, 0.3814443999443d+01, 0.6805653367890d+01, &
  0.3314590480650d-07, 0.3560229189250d+01, 0.1259245002418d+02, &
  0.3232421839643d-07, 0.5185389180568d+01, 0.1066495398892d+01, &
  0.3541176318876d-07, 0.3921381909679d+01, 0.9917696840332d+01, &
  0.3689831242681d-07, 0.4190658955386d+01, 0.1192625446156d+02, &
  0.3890605376774d-07, 0.5546023371097d+01, 0.7478166569050d-01, &
  0.3038559339780d-07, 0.6231032794494d+01, 0.1256621883632d+02, &
  0.3137083969782d-07, 0.6207063419190d+01, 0.4292330755499d+01 /
data ((e0(i,j,1),i=1,3),j=181,190) / &
  0.4024004081854d-07, 0.1195257375713d+01, 0.1334167431096d+02, &
  0.3300234879283d-07, 0.1804694240998d+01, 0.1057540660594d+02, &
  0.3635399155575d-07, 0.5597811343500d+01, 0.6208294184755d+01, &
  0.3032668691356d-07, 0.3191059366530d+01, 0.1805292951336d+02, &
  0.2809652069058d-07, 0.4094348032570d+01, 0.3523159621801d-02, &
  0.3696955383823d-07, 0.5219282738794d+01, 0.5966683958112d+01, &
  0.3562894142503d-07, 0.1037247544554d+01, 0.6357857516136d+01, &
  0.3510598524148d-07, 0.1430020816116d+01, 0.6599467742779d+01, &
  0.3617736142953d-07, 0.3002911403677d+01, 0.6019991944201d+01, &
  0.2624524910730d-07, 0.2437046757292d+01, 0.6702560555334d+01 /
data ((e0(i,j,1),i=1,3),j=191,200) / &
  0.2535824204490d-07, 0.1581594689647d+01, 0.3141537925223d+02, &
  0.3519787226257d-07, 0.5379863121521d+01, 0.2505706758577d+03, &
  0.2578406709982d-07, 0.4904222639329d+01, 0.1673046366289d+02, &
  0.3423887981473d-07, 0.3646448997315d+01, 0.6546159756691d+01, &
  0.2776083886467d-07, 0.3307829300144d+01, 0.1272157198369d+02, &
  0.3379592818379d-07, 0.1747541251125d+01, 0.1494531617769d+02, &
  0.3050255426284d-07, 0.1784689432607d-01, 0.4732030630302d+01, &
  0.2652378350236d-07, 0.4420055276260d+01, 0.5863591145557d+01, &
  0.2374498173768d-07, 0.3629773929208d+01, 0.2388894113936d+01, &
  0.2716451255140d-07, 0.3079623706780d+01, 0.1202934727411d+02 /
data ((e0(i,j,1),i=1,3),j=201,210) / &
  0.3038583699229d-07, 0.3312487903507d+00, 0.1256608456547d+02, &
  0.2220681228760d-07, 0.5265520401774d+01, 0.1336244973887d+02, &
  0.3044156540912d-07, 0.4766664081250d+01, 0.2908881142201d+02, &
  0.2731859923561d-07, 0.5069146530691d+01, 0.1391601904066d+02, &
  0.2285603018171d-07, 0.5954935112271d+01, 0.6076890225335d+01, &
  0.2025006454555d-07, 0.4061789589267d+01, 0.4701116388778d+01, &
  0.2012597519804d-07, 0.2485047705241d+01, 0.6262720680387d+01, &
  0.2003406962258d-07, 0.4163779209320d+01, 0.6303431020504d+01, &
  0.2207863441371d-07, 0.6923839133828d+00, 0.6489261475556d+01, &
  0.2481374305624d-07, 0.5944173595676d+01, 0.1204357418345d+02 /
data ((e0(i,j,1),i=1,3),j=211,220) / &
  0.2130923288870d-07, 0.4641013671967d+01, 0.5746271423666d+01, &
  0.2446370543391d-07, 0.6125796518757d+01, 0.1495633313810d+00, &
  0.1932492759052d-07, 0.2234572324504d+00, 0.1352175143971d+02, &
  0.2600122568049d-07, 0.4281012405440d+01, 0.4590910121555d+01, &
  0.2431754047488d-07, 0.1429943874870d+00, 0.1162474756779d+01, &
  0.1875902869209d-07, 0.9781803816948d+00, 0.6279194432410d+01, &
  0.1874381139426d-07, 0.5670368130173d+01, 0.6286957268481d+01, &
  0.2156696047173d-07, 0.2008985006833d+01, 0.1813929450232d+02, &
  0.1965076182484d-07, 0.2566186202453d+00, 0.4686889479442d+01, &
  0.2334816372359d-07, 0.4408121891493d+01, 0.1002183730415d+02 /
data ((e0(i,j,1),i=1,3),j=221,230) / &
  0.1869937408802d-07, 0.5272745038656d+01, 0.2427287361862d+00, &
  0.2436236460883d-07, 0.4407720479029d+01, 0.9514313292143d+02, &
  0.1761365216611d-07, 0.1943892315074d+00, 0.1351787002167d+02, &
  0.2156289480503d-07, 0.1418570924545d+01, 0.6037244212485d+01, &
  0.2164748979255d-07, 0.4724603439430d+01, 0.2301353951334d+02, &
  0.2222286670853d-07, 0.2400266874598d+01, 0.1266924451345d+02, &
  0.2070901414929d-07, 0.5230348028732d+01, 0.6528907488406d+01, &
  0.1792745177020d-07, 0.2099190328945d+01, 0.6819880277225d+01, &
  0.1841802068445d-07, 0.3467527844848d+00, 0.6514761976723d+02, &
  0.1578401631718d-07, 0.7098642356340d+00, 0.2077542790660d-01 /
data ((e0(i,j,1),i=1,3),j=231,240) / &
  0.1561690152531d-07, 0.5943349620372d+01, 0.6272439236156d+01, &
  0.1558591045463d-07, 0.7040653478980d+00, 0.6293712464735d+01, &
  0.1737356469576d-07, 0.4487064760345d+01, 0.1765478049437d+02, &
  0.1434755619991d-07, 0.2993391570995d+01, 0.1102062672231d+00, &
  0.1482187806654d-07, 0.2278049198251d+01, 0.1052268489556d+01, &
  0.1424812827089d-07, 0.1682114725827d+01, 0.1311972100268d+02, &
  0.1380282448623d-07, 0.3262668602579d+01, 0.1017725758696d+02, &
  0.1811481244566d-07, 0.3187771221777d+01, 0.1887552587463d+02, &
  0.1504446185696d-07, 0.5650162308647d+01, 0.7626583626240d-01, &
  0.1740776154137d-07, 0.5487068607507d+01, 0.1965104848470d+02 /
data ((e0(i,j,1),i=1,3),j=241,250) / &
  0.1374339536251d-07, 0.5745688172201d+01, 0.6016468784579d+01, &
  0.1761377477704d-07, 0.5748060203659d+01, 0.2593412433514d+02, &
  0.1535138225795d-07, 0.6226848505790d+01, 0.9411464614024d+01, &
  0.1788140543676d-07, 0.6189318878563d+01, 0.3301902111895d+02, &
  0.1375002807996d-07, 0.5371812884394d+01, 0.6327837846670d+00, &
  0.1242115758632d-07, 0.1471687569712d+01, 0.3894181736510d+01, &
  0.1450977333938d-07, 0.4143836662127d+01, 0.1277945078067d+02, &
  0.1297579575023d-07, 0.9003477661957d+00, 0.6549682916313d+01, &
  0.1462667934821d-07, 0.5760505536428d+01, 0.1863592847156d+02, &
  0.1381774374799d-07, 0.1085471729463d+01, 0.2379164476796d+01 /
data ((e0(i,j,1),i=1,3),j=251,260) / &
  0.1682333169307d-07, 0.5409870870133d+01, 0.1620077269078d+02, &
  0.1190812918837d-07, 0.1397205174601d+01, 0.1149965630200d+02, &
  0.1221434762106d-07, 0.9001804809095d+00, 0.1257326515556d+02, &
  0.1549934644860d-07, 0.4262528275544d+01, 0.1820933031200d+02, &
  0.1252138953050d-07, 0.1411642012027d+01, 0.6993008899458d+01, &
  0.1237078905387d-07, 0.2844472403615d+01, 0.2435678079171d+02, &
  0.1446953389615d-07, 0.5295835522223d+01, 0.3813291813120d-01, &
  0.1388446457170d-07, 0.4969428135497d+01, 0.2458316379602d+00, &
  0.1019339179228d-07, 0.2491369561806d+01, 0.6112403035119d+01, &
  0.1258880815343d-07, 0.4679426248976d+01, 0.5429879531333d+01 /
data ((e0(i,j,1),i=1,3),j=261,270) / &
  0.1297768238261d-07, 0.1074509953328d+01, 0.1249137003520d+02, &
  0.9913505718094d-08, 0.4735097918224d+01, 0.6247047890016d+01, &
  0.9830453155969d-08, 0.4158649187338d+01, 0.6453748665772d+01, &
  0.1192615865309d-07, 0.3438208613699d+01, 0.6290122169689d+01, &
  0.9835874798277d-08, 0.1913300781229d+01, 0.6319103810876d+01, &
  0.9639087569277d-08, 0.9487683644125d+00, 0.8273820945392d+01, &
  0.1175716107001d-07, 0.3228141664287d+01, 0.6276029531202d+01, &
  0.1018926508678d-07, 0.2216607854300d+01, 0.1254537627298d+02, &
  0.9500087869225d-08, 0.2625116459733d+01, 0.1256517118505d+02, &
  0.9664192916575d-08, 0.5860562449214d+01, 0.6259197520765d+01 /
data ((e0(i,j,1),i=1,3),j=271,280) / &
  0.9612858712203d-08, 0.7885682917381d+00, 0.6306954180126d+01, &
  0.1117645675413d-07, 0.3932148831189d+01, 0.1779695906178d+02, &
  0.1158864052160d-07, 0.9995605521691d+00, 0.1778273215245d+02, &
  0.9021043467028d-08, 0.5263769742673d+01, 0.6172869583223d+01, &
  0.8836134773563d-08, 0.1496843220365d+01, 0.1692165728891d+01, &
  0.1045872200691d-07, 0.7009039517214d+00, 0.2204125344462d+00, &
  0.1211463487798d-07, 0.4041544938511d+01, 0.8257698122054d+02, &
  0.8541990804094d-08, 0.1447586692316d+01, 0.6393282117669d+01, &
  0.1038720703636d-07, 0.4594249718112d+00, 0.1550861511662d+02, &
  0.1126722351445d-07, 0.3925550579036d+01, 0.2061856251104d+00 /
data ((e0(i,j,1),i=1,3),j=281,290) / &
  0.8697373859631d-08, 0.4411341856037d+01, 0.9491756770005d+00, &
  0.8869380028441d-08, 0.2402659724813d+01, 0.3903911373650d+01, &
  0.9247014693258d-08, 0.1401579743423d+01, 0.6267823317922d+01, &
  0.9205062930950d-08, 0.5245978000814d+01, 0.6298328382969d+01, &
  0.8000745038049d-08, 0.3590803356945d+01, 0.2648454860559d+01, &
  0.9168973650819d-08, 0.2470150501679d+01, 0.1498544001348d+03, &
  0.1075444949238d-07, 0.1328606161230d+01, 0.3694923081589d+02, &
  0.7817298525817d-08, 0.6162256225998d+01, 0.4804209201333d+01, &
  0.9541469226356d-08, 0.3942568967039d+01, 0.1256713221673d+02, &
  0.9821910122027d-08, 0.2360246287233d+00, 0.1140367694411d+02 /
data ((e0(i,j,1),i=1,3),j=291,300) / &
  0.9897822023777d-08, 0.4619805634280d+01, 0.2280573557157d+02, &
  0.7737289283765d-08, 0.3784727847451d+01, 0.7834121070590d+01, &
  0.9260204034710d-08, 0.2223352487601d+01, 0.2787043132925d+01, &
  0.7320252888486d-08, 0.1288694636874d+01, 0.6282655592598d+01, &
  0.7319785780946d-08, 0.5359869567774d+01, 0.6283496108294d+01, &
  0.7147219933778d-08, 0.5516616675856d+01, 0.1725663147538d+02, &
  0.7946502829878d-08, 0.2630459984567d+01, 0.1241073141809d+02, &
  0.9001711808932d-08, 0.2849815827227d+01, 0.6281591679874d+01, &
  0.8994041507257d-08, 0.3795244450750d+01, 0.6284560021018d+01, &
  0.8298582787358d-08, 0.5236413127363d+00, 0.1241658836951d+02 /
data ((e0(i,j,1),i=1,3),j=301,310) / &
  0.8526596520710d-08, 0.4794605424426d+01, 0.1098419223922d+02, &
  0.8209822103197d-08, 0.1578752370328d+01, 0.1096996532989d+02, &
  0.6357049861094d-08, 0.5708926113761d+01, 0.1596186371003d+01, &
  0.7370473179049d-08, 0.3842402530241d+01, 0.4061219149443d+01, &
  0.7232154664726d-08, 0.3067548981535d+01, 0.1610006857377d+03, &
  0.6328765494903d-08, 0.1313930030069d+01, 0.1193336791622d+02, &
  0.8030064908595d-08, 0.3488500408886d+01, 0.8460828644453d+00, &
  0.6275464259232d-08, 0.1532061626198d+01, 0.8531963191132d+00, &
  0.7051897446325d-08, 0.3285859929993d+01, 0.5849364236221d+01, &
  0.6161593705428d-08, 0.1477341999464d+01, 0.5573142801433d+01 /
data ((e0(i,j,1),i=1,3),j=311,320) / &
  0.7754683957278d-08, 0.1586118663096d+01, 0.8662240327241d+01, &
  0.5889928990701d-08, 0.1304887868803d+01, 0.1232342296471d+02, &
  0.5705756047075d-08, 0.4555333589350d+01, 0.1258692712880d+02, &
  0.5964178808332d-08, 0.3001762842062d+01, 0.5333900173445d+01, &
  0.6712446027467d-08, 0.4886780007595d+01, 0.1171295538178d+02, &
  0.5941809275464d-08, 0.4701509603824d+01, 0.9779108567966d+01, &
  0.5466993627395d-08, 0.4588357817278d+01, 0.1884211409667d+02, &
  0.6340512090980d-08, 0.1164543038893d+01, 0.5217580628120d+02, &
  0.6325505710045d-08, 0.3919171259645d+01, 0.1041998632314d+02, &
  0.6164789509685d-08, 0.2143828253542d+01, 0.6151533897323d+01 /
data ((e0(i,j,1),i=1,3),j=321,330) / &
  0.5263330812430d-08, 0.6066564434241d+01, 0.1885275071096d+02, &
  0.5597087780221d-08, 0.2926316429472d+01, 0.4337116142245d+00, &
  0.5396556236817d-08, 0.3244303591505d+01, 0.6286362197481d+01, &
  0.5396615148223d-08, 0.3404304703662d+01, 0.6279789503410d+01, &
  0.7091832443341d-08, 0.8532377803192d+00, 0.4907302013889d+01, &
  0.6572352589782d-08, 0.4901966774419d+01, 0.1176433076753d+02, &
  0.5960236060795d-08, 0.1874672315797d+01, 0.1422690933580d-01, &
  0.5125480043511d-08, 0.3735726064334d+01, 0.1245594543367d+02, &
  0.5928241866410d-08, 0.4502033899935d+01, 0.6414617803568d+01, &
  0.5249600357424d-08, 0.4372334799878d+01, 0.1151388321134d+02 /
data ((e0(i,j,1),i=1,3),j=331,340) / &
  0.6059171276087d-08, 0.2581617302908d+01, 0.6062663316000d+01, &
  0.5295235081662d-08, 0.2974811513158d+01, 0.3496032717521d+01, &
  0.5820561875933d-08, 0.1796073748244d+00, 0.2838593341516d+00, &
  0.4754696606440d-08, 0.1981998136973d+01, 0.3104930017775d+01, &
  0.6385053548955d-08, 0.2559174171605d+00, 0.6133512519065d+01, &
  0.6589828273941d-08, 0.2750967106776d+01, 0.4087944051283d+02, &
  0.5383376567189d-08, 0.6325947523578d+00, 0.2248384854122d+02, &
  0.5928941683538d-08, 0.1672304519067d+01, 0.1581959461667d+01, &
  0.4816060709794d-08, 0.3512566172575d+01, 0.9388005868221d+01, &
  0.6003381586512d-08, 0.5610932219189d+01, 0.5326786718777d+01 /
data ((e0(i,j,1),i=1,3),j=341,350) / &
  0.5504225393105d-08, 0.4037501131256d+01, 0.6503488384892d+01, &
  0.5353772620129d-08, 0.6122774968240d+01, 0.1735668374386d+03, &
  0.5786253768544d-08, 0.5527984999515d+01, 0.1350651127443d+00, &
  0.5065706702002d-08, 0.9980765573624d+00, 0.1248988586463d+02, &
  0.5972838885276d-08, 0.6044489493203d+01, 0.2673594526851d+02, &
  0.5323585877961d-08, 0.3924265998147d+01, 0.4171425416666d+01, &
  0.5210772682858d-08, 0.6220111376901d+01, 0.2460261242967d+02, &
  0.4726549040535d-08, 0.3716043206862d+01, 0.7232251527446d+01, &
  0.6029425105059d-08, 0.8548704071116d+00, 0.3227113045244d+03, &
  0.4481542826513d-08, 0.1426925072829d+01, 0.5547199253223d+01 /
data ((e0(i,j,1),i=1,3),j=351,360) / &
  0.5836024505068d-08, 0.7135651752625d-01, 0.7285056171570d+02, &
  0.4137046613272d-08, 0.5330767643283d+01, 0.1087398597200d+02, &
  0.5171977473924d-08, 0.4494262335353d+00, 0.1884570439172d+02, &
  0.5694429833732d-08, 0.2952369582215d+01, 0.9723862754494d+02, &
  0.4009158925298d-08, 0.3500003416535d+01, 0.6244942932314d+01, &
  0.4784939596873d-08, 0.6196709413181d+01, 0.2929661536378d+02, &
  0.3983725022610d-08, 0.5103690031897d+01, 0.4274518229222d+01, &
  0.3870535232462d-08, 0.3187569587401d+01, 0.6321208768577d+01, &
  0.5140501213951d-08, 0.1668924357457d+01, 0.1232032006293d+02, &
  0.3849034819355d-08, 0.4445722510309d+01, 0.1726726808967d+02 /
data ((e0(i,j,1),i=1,3),j=361,370) / &
  0.4002383075060d-08, 0.5226224152423d+01, 0.7018952447668d+01, &
  0.3890719543549d-08, 0.4371166550274d+01, 0.1491901785440d+02, &
  0.4887084607881d-08, 0.5973556689693d+01, 0.1478866649112d+01, &
  0.3739939287592d-08, 0.2089084714600d+01, 0.6922973089781d+01, &
  0.5031925918209d-08, 0.4658371936827d+01, 0.1715706182245d+02, &
  0.4387748764954d-08, 0.4825580552819d+01, 0.2331413144044d+03, &
  0.4147398098865d-08, 0.3739003524998d+01, 0.1376059875786d+02, &
  0.3719089993586d-08, 0.1148941386536d+01, 0.6297302759782d+01, &
  0.3934238461056d-08, 0.1559893008343d+01, 0.7872148766781d+01, &
  0.3672471375622d-08, 0.5516145383612d+01, 0.6268848941110d+01 /
data ((e0(i,j,1),i=1,3),j=371,380) / &
  0.3768911277583d-08, 0.6116053700563d+01, 0.4157198507331d+01, &
  0.4033388417295d-08, 0.5076821746017d+01, 0.1567108171867d+02, &
  0.3764194617832d-08, 0.8164676232075d+00, 0.3185192151914d+01, &
  0.4840628226284d-08, 0.1360479453671d+01, 0.1252801878276d+02, &
  0.4949443923785d-08, 0.2725622229926d+01, 0.1617106187867d+03, &
  0.4117393089971d-08, 0.6054459628492d+00, 0.5642198095270d+01, &
  0.3925754020428d-08, 0.8570462135210d+00, 0.2139354194808d+02, &
  0.3630551757923d-08, 0.3552067338279d+01, 0.6294805223347d+01, &
  0.3627274802357d-08, 0.3096565085313d+01, 0.6271346477544d+01, &
  0.3806143885093d-08, 0.6367751709777d+00, 0.1725304118033d+02 /
data ((e0(i,j,1),i=1,3),j=381,390) / &
  0.4433254641565d-08, 0.4848461503937d+01, 0.7445550607224d+01, &
  0.3712319846576d-08, 0.1331950643655d+01, 0.4194847048887d+00, &
  0.3849847534783d-08, 0.4958368297746d+00, 0.9562891316684d+00, &
  0.3483955430165d-08, 0.2237215515707d+01, 0.1161697602389d+02, &
  0.3961912730982d-08, 0.3332402188575d+01, 0.2277943724828d+02, &
  0.3419978244481d-08, 0.5785600576016d+01, 0.1362553364512d+02, &
  0.3329417758177d-08, 0.9812676559709d-01, 0.1685848245639d+02, &
  0.4207206893193d-08, 0.9494780468236d+00, 0.2986433403208d+02, &
  0.3268548976410d-08, 0.1739332095686d+00, 0.5749861718712d+01, &
  0.3321880082685d-08, 0.1423354800666d+01, 0.6279143387820d+01 /
data ((e0(i,j,1),i=1,3),j=391,400) / &
  0.4503173010852d-08, 0.2314972675293d+00, 0.1385561574497d+01, &
  0.4316599090954d-08, 0.1012646782616d+00, 0.4176041334900d+01, &
  0.3283493323850d-08, 0.5233306881265d+01, 0.6287008313071d+01, &
  0.3164033542343d-08, 0.4005597257511d+01, 0.2099539292909d+02, &
  0.4159720956725d-08, 0.5365676242020d+01, 0.5905702259363d+01, &
  0.3565176892217d-08, 0.4284440620612d+01, 0.3932462625300d-02, &
  0.3514440950221d-08, 0.4270562636575d+01, 0.7335344340001d+01, &
  0.3540596871909d-08, 0.5953553201060d+01, 0.1234573916645d+02, &
  0.2960769905118d-08, 0.1115180417718d+01, 0.2670964694522d+02, &
  0.2962213739684d-08, 0.3863811918186d+01, 0.6408777551755d+00 /
data ((e0(i,j,1),i=1,3),j=401,410) / &
  0.3883556700251d-08, 0.1268617928302d+01, 0.6660449441528d+01, &
  0.2919225516346d-08, 0.4908605223265d+01, 0.1375773836557d+01, &
  0.3115158863370d-08, 0.3744519976885d+01, 0.3802769619140d-01, &
  0.4099438144212d-08, 0.4173244670532d+01, 0.4480965020977d+02, &
  0.2899531858964d-08, 0.5910601428850d+01, 0.2059724391010d+02, &
  0.3289733429855d-08, 0.2488050078239d+01, 0.1081813534213d+02, &
  0.3933075612875d-08, 0.1122363652883d+01, 0.3773735910827d+00, &
  0.3021403764467d-08, 0.4951973724904d+01, 0.2982630633589d+02, &
  0.2798598949757d-08, 0.5117057845513d+01, 0.1937891852345d+02, &
  0.3397421302707d-08, 0.6104159180476d+01, 0.6923953605621d+01 /
data ((e0(i,j,1),i=1,3),j=411,420) / &
  0.3720398002179d-08, 0.1184933429829d+01, 0.3066615496545d+02, &
  0.3598484186267d-08, 0.3505282086105d+01, 0.6147450479709d+01, &
  0.3694594027310d-08, 0.2286651088141d+01, 0.2636725487657d+01, &
  0.2680444152969d-08, 0.1871816775482d+00, 0.6816289982179d+01, &
  0.3497574865641d-08, 0.3143251755431d+01, 0.6418701221183d+01, &
  0.3130274129494d-08, 0.2462167316018d+01, 0.1235996607578d+02, &
  0.3241119069551d-08, 0.4256374004686d+01, 0.1652265972112d+02, &
  0.2601960842061d-08, 0.4970362941425d+01, 0.1045450126711d+02, &
  0.2690601527504d-08, 0.2372657824898d+01, 0.3163918923335d+00, &
  0.2908688152664d-08, 0.4232652627721d+01, 0.2828699048865d+02 /
data ((e0(i,j,1),i=1,3),j=421,430) / &
  0.3120456131875d-08, 0.3925747001137d+00, 0.2195415756911d+02, &
  0.3148855423384d-08, 0.3093478330445d+01, 0.1172006883645d+02, &
  0.3051044261017d-08, 0.5560948248212d+01, 0.6055599646783d+01, &
  0.2826006876660d-08, 0.5072790310072d+01, 0.5120601093667d+01, &
  0.3100034191711d-08, 0.4998530231096d+01, 0.1799603123222d+02, &
  0.2398771640101d-08, 0.2561739802176d+01, 0.6255674361143d+01, &
  0.2384002842728d-08, 0.4087420284111d+01, 0.6310477339748d+01, &
  0.2842146517568d-08, 0.2515048217955d+01, 0.5469525544182d+01, &
  0.2847674371340d-08, 0.5235326497443d+01, 0.1034429499989d+02, &
  0.2903722140764d-08, 0.1088200795797d+01, 0.6510552054109d+01 /
data ((e0(i,j,1),i=1,3),j=431,440) / &
  0.3187610710605d-08, 0.4710624424816d+01, 0.1693792562116d+03, &
  0.3048869992813d-08, 0.2857975896445d+00, 0.8390110365991d+01, &
  0.2860216950984d-08, 0.2241619020815d+01, 0.2243449970715d+00, &
  0.2701117683113d-08, 0.6651573305272d-01, 0.6129297044991d+01, &
  0.2509891590152d-08, 0.1285135324585d+01, 0.1044027435778d+02, &
  0.2623200252223d-08, 0.2981229834530d+00, 0.6436854655901d+01, &
  0.2622541669202d-08, 0.6122470726189d+01, 0.9380959548977d+01, &
  0.2818435667099d-08, 0.4251087148947d+01, 0.5934151399930d+01, &
  0.2365196797465d-08, 0.3465070460790d+01, 0.2470570524223d+02, &
  0.2358704646143d-08, 0.5791603815350d+01, 0.8671969964381d+01 /
data ((e0(i,j,1),i=1,3),j=441,450) / &
  0.2388299481390d-08, 0.4142483772941d+01, 0.7096626156709d+01, &
  0.1996041217224d-08, 0.2101901889496d+01, 0.1727188400790d+02, &
  0.2687593060336d-08, 0.1526689456959d+01, 0.7075506709219d+02, &
  0.2618913670810d-08, 0.2397684236095d+01, 0.6632000300961d+01, &
  0.2571523050364d-08, 0.5751929456787d+00, 0.6206810014183d+01, &
  0.2582135006946d-08, 0.5595464352926d+01, 0.4873985990671d+02, &
  0.2372530190361d-08, 0.5092689490655d+01, 0.1590676413561d+02, &
  0.2357178484712d-08, 0.4444363527851d+01, 0.3097883698531d+01, &
  0.2451590394723d-08, 0.3108251687661d+01, 0.6612329252343d+00, &
  0.2370045949608d-08, 0.2608133861079d+01, 0.3459636466239d+02 /
data ((e0(i,j,1),i=1,3),j=451,460) / &
  0.2268997267358d-08, 0.3639717753384d+01, 0.2844914056730d-01, &
  0.1731432137906d-08, 0.1741898445707d+00, 0.2019909489111d+02, &
  0.1629869741622d-08, 0.3902225646724d+01, 0.3035599730800d+02, &
  0.2206215801974d-08, 0.4971131250731d+01, 0.6281667977667d+01, &
  0.2205469554680d-08, 0.1677462357110d+01, 0.6284483723224d+01, &
  0.2148792362509d-08, 0.4236259604006d+01, 0.1980482729015d+02, &
  0.1873733657847d-08, 0.5926814998687d+01, 0.2876692439167d+02, &
  0.2026573758959d-08, 0.4349643351962d+01, 0.2449240616245d+02, &
  0.1807770325110d-08, 0.5700940482701d+01, 0.2045286941806d+02, &
  0.1881174408581d-08, 0.6601286363430d+00, 0.2358125818164d+02 /
data ((e0(i,j,1),i=1,3),j=461,470) / &
  0.1368023671690d-08, 0.2211098592752d+01, 0.2473415438279d+02, &
  0.1720017916280d-08, 0.4942488551129d+01, 0.1679593901136d+03, &
  0.1702427665131d-08, 0.1452233856386d+01, 0.3338575901272d+03, &
  0.1414032510054d-08, 0.5525357721439d+01, 0.1624205518357d+03, &
  0.1652626045364d-08, 0.4108794283624d+01, 0.8956999012000d+02, &
  0.1642957769686d-08, 0.7344335209984d+00, 0.5267006960365d+02, &
  0.1614952403624d-08, 0.3541213951363d+01, 0.3332657872986d+02, &
  0.1535988291188d-08, 0.4031094072151d+01, 0.3852657435933d+02, &
  0.1593193738177d-08, 0.4185136203609d+01, 0.2282781046519d+03, &
  0.1074569126382d-08, 0.1720485636868d+01, 0.8397383534231d+02 /
data ((e0(i,j,1),i=1,3),j=471,480) / &
  0.1074408214509d-08, 0.2758613420318d+01, 0.8401985929482d+02, &
  0.9700199670465d-09, 0.4216686842097d+01, 0.7826370942180d+02, &
  0.1258433517061d-08, 0.2575068876639d+00, 0.3115650189215d+03, &
  0.1240303229539d-08, 0.4800844956756d+00, 0.1784300471910d+03, &
  0.9018345948127d-09, 0.3896756361552d+00, 0.5886454391678d+02, &
  0.1135301432805d-08, 0.3700805023550d+00, 0.7842370451713d+02, &
  0.9215887951370d-09, 0.4364579276638d+01, 0.1014262087719d+03, &
  0.1055401054147d-08, 0.2156564222111d+01, 0.5660027930059d+02, &
  0.1008725979831d-08, 0.5454015785234d+01, 0.4245678405627d+02, &
  0.7217398104321d-09, 0.1597772562175d+01, 0.2457074661053d+03 /
data ((e0(i,j,1),i=1,3),j=481,490) / &
  0.6912033134447d-09, 0.5824090621461d+01, 0.1679936946371d+03, &
  0.6833881523549d-09, 0.3578778482835d+01, 0.6053048899753d+02, &
  0.4887304205142d-09, 0.3724362812423d+01, 0.9656299901946d+02, &
  0.5173709754788d-09, 0.5422427507933d+01, 0.2442876000072d+03, &
  0.4671353097145d-09, 0.2396106924439d+01, 0.1435713242844d+03, &
  0.5652608439480d-09, 0.2804028838685d+01, 0.8365903305582d+02, &
  0.5604061331253d-09, 0.1638816006247d+01, 0.8433466158131d+02, &
  0.4712723365400d-09, 0.8979003224474d+00, 0.3164282286739d+03, &
  0.4909967465112d-09, 0.3210426725516d+01, 0.4059982187939d+03, &
  0.4771358267658d-09, 0.5308027211629d+01, 0.1805255418145d+03 /
data ((e0(i,j,1),i=1,3),j=491,500) / &
  0.3943451445989d-09, 0.2195145341074d+01, 0.2568537517081d+03, &
  0.3952109120244d-09, 0.5081189491586d+01, 0.2449975330562d+03, &
  0.3788134594789d-09, 0.4345171264441d+01, 0.1568131045107d+03, &
  0.3738330190479d-09, 0.2613062847997d+01, 0.3948519331910d+03, &
  0.3099866678136d-09, 0.2846760817689d+01, 0.1547176098872d+03, &
  0.2002962716768d-09, 0.4921360989412d+01, 0.2268582385539d+03, &
  0.2198291338754d-09, 0.1130360117454d+00, 0.1658638954901d+03, &
  0.1491958330784d-09, 0.4228195232278d+01, 0.2219950288015d+03, &
  0.1475384076173d-09, 0.3005721811604d+00, 0.3052819430710d+03, &
  0.1661626624624d-09, 0.7830125621203d+00, 0.2526661704812d+03 /
data ((e0(i,j,1),i=1,3),j=501,ne0x) / &
  0.9015823460025d-10, 0.3807792942715d+01, 0.4171445043968d+03 /

!  Sun-to-Earth, T^1, X
data ((e1(i,j,1),i=1,3),j=  1, 10) / &
  0.1234046326004d-05, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.5150068824701d-06, 0.6002664557501d+01, 0.1256615170089d+02, &
  0.1290743923245d-07, 0.5959437664199d+01, 0.1884922755134d+02, &
  0.1068615564952d-07, 0.2015529654209d+01, 0.6283075850446d+01, &
  0.2079619142538d-08, 0.1732960531432d+01, 0.6279552690824d+01, &
  0.2078009243969d-08, 0.4915604476996d+01, 0.6286599010068d+01, &
  0.6206330058856d-09, 0.3616457953824d+00, 0.4705732307012d+01, &
  0.5989335313746d-09, 0.3802607304474d+01, 0.6256777527156d+01, &
  0.5958495663840d-09, 0.2845866560031d+01, 0.6309374173736d+01, &
  0.4866923261539d-09, 0.5213203771824d+01, 0.7755226100720d+00 /
data ((e1(i,j,1),i=1,3),j= 11, 20) / &
  0.4267785823142d-09, 0.4368189727818d+00, 0.1059381944224d+01, &
  0.4610675141648d-09, 0.1837249181372d-01, 0.7860419393880d+01, &
  0.3626989993973d-09, 0.2161590545326d+01, 0.5753384878334d+01, &
  0.3563071194389d-09, 0.1452631954746d+01, 0.5884926831456d+01, &
  0.3557015642807d-09, 0.4470593393054d+01, 0.6812766822558d+01, &
  0.3210412089122d-09, 0.5195926078314d+01, 0.6681224869435d+01, &
  0.2875473577986d-09, 0.5916256610193d+01, 0.2513230340178d+02, &
  0.2842913681629d-09, 0.1149902426047d+01, 0.6127655567643d+01, &
  0.2751248215916d-09, 0.5502088574662d+01, 0.6438496133249d+01, &
  0.2481432881127d-09, 0.2921989846637d+01, 0.5486777812467d+01 /
data ((e1(i,j,1),i=1,3),j= 21, 30) / &
  0.2059885976560d-09, 0.3718070376585d+01, 0.7079373888424d+01, &
  0.2015522342591d-09, 0.5979395259740d+01, 0.6290189305114d+01, &
  0.1995364084253d-09, 0.6772087985494d+00, 0.6275962395778d+01, &
  0.1957436436943d-09, 0.2899210654665d+01, 0.5507553240374d+01, &
  0.1651609818948d-09, 0.6228206482192d+01, 0.1150676975667d+02, &
  0.1822980550699d-09, 0.1469348746179d+01, 0.1179062909082d+02, &
  0.1675223159760d-09, 0.3813910555688d+01, 0.7058598460518d+01, &
  0.1706491764745d-09, 0.3004380506684d+00, 0.7113454667900d-02, &
  0.1392952362615d-09, 0.1440393973406d+01, 0.7962980379786d+00, &
  0.1209868266342d-09, 0.4150425791727d+01, 0.4694002934110d+01 /
data ((e1(i,j,1),i=1,3),j= 31, 40) / &
  0.1009827202611d-09, 0.3290040429843d+01, 0.3738761453707d+01, &
  0.1047261388602d-09, 0.4229590090227d+01, 0.6282095334605d+01, &
  0.1047006652004d-09, 0.2418967680575d+01, 0.6284056366286d+01, &
  0.9609993143095d-10, 0.4627943659201d+01, 0.6069776770667d+01, &
  0.9590900593873d-10, 0.1894393939924d+01, 0.4136910472696d+01, &
  0.9146249188071d-10, 0.2010647519562d+01, 0.6496374930224d+01, &
  0.8545274480290d-10, 0.5529846956226d-01, 0.1194447056968d+01, &
  0.8224377881194d-10, 0.1254304102174d+01, 0.1589072916335d+01, &
  0.6183529510410d-10, 0.3360862168815d+01, 0.8827390247185d+01, &
  0.6259255147141d-10, 0.4755628243179d+01, 0.8429241228195d+01 /
data ((e1(i,j,1),i=1,3),j= 41, 50) / &
  0.5539291694151d-10, 0.5371746955142d+01, 0.4933208510675d+01, &
  0.7328259466314d-10, 0.4927699613906d+00, 0.4535059491685d+01, &
  0.6017835843560d-10, 0.5776682001734d-01, 0.1255903824622d+02, &
  0.7079827775243d-10, 0.4395059432251d+01, 0.5088628793478d+01, &
  0.5170358878213d-10, 0.5154062619954d+01, 0.1176985366291d+02, &
  0.4872301838682d-10, 0.6289611648973d+00, 0.6040347114260d+01, &
  0.5249869411058d-10, 0.5617272046949d+01, 0.3154687086868d+01, &
  0.4716172354411d-10, 0.3965901800877d+01, 0.5331357529664d+01, &
  0.4871214940964d-10, 0.4627507050093d+01, 0.1256967486051d+02, &
  0.4598076850751d-10, 0.6023631226459d+01, 0.6525804586632d+01 /
data ((e1(i,j,1),i=1,3),j= 51, 60) / &
  0.4562196089485d-10, 0.4138562084068d+01, 0.3930209696940d+01, &
  0.4325493872224d-10, 0.1330845906564d+01, 0.7632943190217d+01, &
  0.5673781176748d-10, 0.2558752615657d+01, 0.5729506548653d+01, &
  0.3961436642503d-10, 0.2728071734630d+01, 0.7234794171227d+01, &
  0.5101868209058d-10, 0.4113444965144d+01, 0.6836645152238d+01, &
  0.5257043167676d-10, 0.6195089830590d+01, 0.8031092209206d+01, &
  0.5076613989393d-10, 0.2305124132918d+01, 0.7477522907414d+01, &
  0.3342169352778d-10, 0.5415998155071d+01, 0.1097707878456d+02, &
  0.3545881983591d-10, 0.3727160564574d+01, 0.4164311961999d+01, &
  0.3364063738599d-10, 0.2901121049204d+00, 0.1137170464392d+02 /
data ((e1(i,j,1),i=1,3),j= 61, 70) / &
  0.3357039670776d-10, 0.1652229354331d+01, 0.5223693906222d+01, &
  0.4307412268687d-10, 0.4938909587445d+01, 0.1592596075957d+01, &
  0.3405769115435d-10, 0.2408890766511d+01, 0.3128388763578d+01, &
  0.3001926198480d-10, 0.4862239006386d+01, 0.1748016358760d+01, &
  0.2778264787325d-10, 0.5241168661353d+01, 0.7342457794669d+01, &
  0.2676159480666d-10, 0.3423593942199d+01, 0.2146165377750d+01, &
  0.2954273399939d-10, 0.1881721265406d+01, 0.5368044267797d+00, &
  0.3309362888795d-10, 0.1931525677349d+01, 0.8018209333619d+00, &
  0.2810283608438d-10, 0.2414659495050d+01, 0.5225775174439d+00, &
  0.3378045637764d-10, 0.4238019163430d+01, 0.1554202828031d+00 /
data ((e1(i,j,1),i=1,3),j= 71,ne1x) / &
  0.2558134979840d-10, 0.1828225235805d+01, 0.5230807360890d+01, &
  0.2273755578447d-10, 0.5858184283998d+01, 0.7084896783808d+01, &
  0.2294176037690d-10, 0.4514589779057d+01, 0.1726015463500d+02, &
  0.2533506099435d-10, 0.2355717851551d+01, 0.5216580451554d+01, &
  0.2716685375812d-10, 0.2221003625100d+01, 0.8635942003952d+01, &
  0.2419043435198d-10, 0.5955704951635d+01, 0.4690479774488d+01, &
  0.2521232544812d-10, 0.1395676848521d+01, 0.5481254917084d+01, &
  0.2630195021491d-10, 0.5727468918743d+01, 0.2629832328990d-01, &
  0.2548395840944d-10, 0.2628351859400d-03, 0.1349867339771d+01 /

!  Sun-to-Earth, T^2, X
data ((e2(i,j,1),i=1,3),j=  1,ne2x) / &
 -0.4143818297913d-10, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.2171497694435d-10, 0.4398225628264d+01, 0.1256615170089d+02, &
  0.9845398442516d-11, 0.2079720838384d+00, 0.6283075850446d+01, &
  0.9256833552682d-12, 0.4191264694361d+01, 0.1884922755134d+02, &
  0.1022049384115d-12, 0.5381133195658d+01, 0.8399684731857d+02 /

!  Sun-to-Earth, T^0, Y
data ((e0(i,j,2),i=1,3),j=  1, 10) / &
  0.9998921098898d+00, 0.1826583913846d+00, 0.6283075850446d+01, &
 -0.2442700893735d-01, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.8352929742915d-02, 0.1395277998680d+00, 0.1256615170089d+02, &
  0.1046697300177d-03, 0.9641423109763d-01, 0.1884922755134d+02, &
  0.3110841876663d-04, 0.5381140401712d+01, 0.8399684731857d+02, &
  0.2570269094593d-04, 0.5301016407128d+01, 0.5296909721118d+00, &
  0.2147389623610d-04, 0.2662510869850d+01, 0.1577343543434d+01, &
  0.1680344384050d-04, 0.5207904119704d+01, 0.6279552690824d+01, &
  0.1679117312193d-04, 0.4582187486968d+01, 0.6286599010068d+01, &
  0.1440512068440d-04, 0.1900688517726d+01, 0.2352866153506d+01 /
data ((e0(i,j,2),i=1,3),j= 11, 20) / &
  0.1135139664999d-04, 0.5273108538556d+01, 0.5223693906222d+01, &
  0.9345482571018d-05, 0.4503047687738d+01, 0.1203646072878d+02, &
  0.9007418719568d-05, 0.1605621059637d+01, 0.1021328554739d+02, &
  0.5671536712314d-05, 0.5812849070861d+00, 0.1059381944224d+01, &
  0.7451401861666d-05, 0.2807346794836d+01, 0.3981490189893d+00, &
  0.6393470057114d-05, 0.6029224133855d+01, 0.5753384878334d+01, &
  0.6814275881697d-05, 0.6472990145974d+00, 0.4705732307012d+01, &
  0.6113705628887d-05, 0.3813843419700d+01, 0.6812766822558d+01, &
  0.4503851367273d-05, 0.4527804370996d+01, 0.5884926831456d+01, &
  0.4522249141926d-05, 0.5991783029224d+01, 0.6256777527156d+01 /
data ((e0(i,j,2),i=1,3),j= 21, 30) / &
  0.4501794307018d-05, 0.3798703844397d+01, 0.6309374173736d+01, &
  0.5514927480180d-05, 0.3961257833388d+01, 0.5507553240374d+01, &
  0.4062862799995d-05, 0.5256247296369d+01, 0.6681224869435d+01, &
  0.5414900429712d-05, 0.5499032014097d+01, 0.7755226100720d+00, &
  0.5463153987424d-05, 0.6173092454097d+01, 0.1414349524433d+02, &
  0.5071611859329d-05, 0.2870244247651d+01, 0.7860419393880d+01, &
  0.2195112094455d-05, 0.2952338617201d+01, 0.1150676975667d+02, &
  0.2279139233919d-05, 0.5951775132933d+01, 0.7058598460518d+01, &
  0.2278386100876d-05, 0.4845456398785d+01, 0.4694002934110d+01, &
  0.2559088003308d-05, 0.6945321117311d+00, 0.1216800268190d+02 /
data ((e0(i,j,2),i=1,3),j= 31, 40) / &
  0.2561079286856d-05, 0.6167224608301d+01, 0.7099330490126d+00, &
  0.1792755796387d-05, 0.1400122509632d+01, 0.7962980379786d+00, &
  0.1818715656502d-05, 0.4703347611830d+01, 0.6283142985870d+01, &
  0.1818744924791d-05, 0.5086748900237d+01, 0.6283008715021d+01, &
  0.1554518791390d-05, 0.5331008042713d-01, 0.2513230340178d+02, &
  0.2063265737239d-05, 0.4283680484178d+01, 0.1179062909082d+02, &
  0.1497613520041d-05, 0.6074207826073d+01, 0.5486777812467d+01, &
  0.2000617940427d-05, 0.2501426281450d+01, 0.1778984560711d+02, &
  0.1289731195580d-05, 0.3646340599536d+01, 0.7079373888424d+01, &
  0.1282657998934d-05, 0.3232864804902d+01, 0.3738761453707d+01 /
data ((e0(i,j,2),i=1,3),j= 41, 50) / &
  0.1528915968658d-05, 0.5581433416669d+01, 0.2132990797783d+00, &
  0.1187304098432d-05, 0.5453576453694d+01, 0.9437762937313d+01, &
  0.7842782928118d-06, 0.2823953922273d+00, 0.8827390247185d+01, &
  0.7352892280868d-06, 0.1124369580175d+01, 0.1589072916335d+01, &
  0.6570189360797d-06, 0.2089154042840d+01, 0.1176985366291d+02, &
  0.6324967590410d-06, 0.6704855581230d+00, 0.6262300422539d+01, &
  0.6298289872283d-06, 0.2836414855840d+01, 0.6303851278352d+01, &
  0.6476686465855d-06, 0.4852433866467d+00, 0.7113454667900d-02, &
  0.8587034651234d-06, 0.1453511005668d+01, 0.1672837615881d+03, &
  0.8068948788113d-06, 0.9224087798609d+00, 0.6069776770667d+01 /
data ((e0(i,j,2),i=1,3),j= 51, 60) / &
  0.8353786011661d-06, 0.4631707184895d+01, 0.3340612434717d+01, &
  0.6009324532132d-06, 0.1829498827726d+01, 0.4136910472696d+01, &
  0.7558158559566d-06, 0.2588596800317d+01, 0.6496374930224d+01, &
  0.5809279504503d-06, 0.5516818853476d+00, 0.1097707878456d+02, &
  0.5374131950254d-06, 0.6275674734960d+01, 0.1194447056968d+01, &
  0.5711160507326d-06, 0.1091905956872d+01, 0.6282095334605d+01, &
  0.5710183170746d-06, 0.2415001635090d+01, 0.6284056366286d+01, &
  0.5144373590610d-06, 0.6020336443438d+01, 0.6290189305114d+01, &
  0.5103108927267d-06, 0.3775634564605d+01, 0.6275962395778d+01, &
  0.4960654697891d-06, 0.1073450946756d+01, 0.6127655567643d+01 /
data ((e0(i,j,2),i=1,3),j= 61, 70) / &
  0.4786385689280d-06, 0.2431178012310d+01, 0.6438496133249d+01, &
  0.6109911263665d-06, 0.5343356157914d+01, 0.3154687086868d+01, &
  0.4839898944024d-06, 0.5830833594047d-01, 0.8018209333619d+00, &
  0.4734822623919d-06, 0.4536080134821d+01, 0.3128388763578d+01, &
  0.4834741473290d-06, 0.2585090489754d+00, 0.7084896783808d+01, &
  0.5134858581156d-06, 0.4213317172603d+01, 0.1235285262111d+02, &
  0.5064004264978d-06, 0.4814418806478d+00, 0.1185621865188d+02, &
  0.3753476772761d-06, 0.1599953399788d+01, 0.8429241228195d+01, &
  0.4935264014283d-06, 0.2157417556873d+01, 0.2544314396739d+01, &
  0.3950929600897d-06, 0.3359394184254d+01, 0.5481254917084d+01 /
data ((e0(i,j,2),i=1,3),j= 71, 80) / &
  0.4895849789777d-06, 0.5165704376558d+01, 0.9225539266174d+01, &
  0.4215241688886d-06, 0.2065368800993d+01, 0.1726015463500d+02, &
  0.3796773731132d-06, 0.1468606346612d+01, 0.4265981595566d+00, &
  0.3114178142515d-06, 0.3615638079474d+01, 0.2146165377750d+01, &
  0.3260664220838d-06, 0.4417134922435d+01, 0.4164311961999d+01, &
  0.3976996123008d-06, 0.4700866883004d+01, 0.5856477690889d+01, &
  0.2801459672924d-06, 0.4538902060922d+01, 0.1256967486051d+02, &
  0.3638931868861d-06, 0.1334197991475d+01, 0.1807370494127d+02, &
  0.2487013269476d-06, 0.3749275558275d+01, 0.2629832328990d-01, &
  0.3034165481994d-06, 0.4236622030873d+00, 0.4535059491685d+01 /
data ((e0(i,j,2),i=1,3),j= 81, 90) / &
  0.2676278825586d-06, 0.5970848007811d+01, 0.3930209696940d+01, &
  0.2764903818918d-06, 0.5194636754501d+01, 0.1256262854127d+02, &
  0.2485149930507d-06, 0.1002434207846d+01, 0.5088628793478d+01, &
  0.2199305540941d-06, 0.3066773098403d+01, 0.1255903824622d+02, &
  0.2571106500435d-06, 0.7588312459063d+00, 0.1336797263425d+02, &
  0.2049751817158d-06, 0.3444977434856d+01, 0.1137170464392d+02, &
  0.2599707296297d-06, 0.1873128542205d+01, 0.7143069561767d+02, &
  0.1785018072217d-06, 0.5015891306615d+01, 0.1748016358760d+01, &
  0.2324833891115d-06, 0.4618271239730d+01, 0.1831953657923d+02, &
  0.1709711119545d-06, 0.5300003455669d+01, 0.4933208510675d+01 /
data ((e0(i,j,2),i=1,3),j= 91,100) / &
  0.2107159351716d-06, 0.2229819815115d+01, 0.7477522907414d+01, &
  0.1750333080295d-06, 0.6161485880008d+01, 0.1044738781244d+02, &
  0.2000598210339d-06, 0.2967357299999d+01, 0.8031092209206d+01, &
  0.1380920248681d-06, 0.3027007923917d+01, 0.8635942003952d+01, &
  0.1412460470299d-06, 0.6037597163798d+01, 0.2942463415728d+01, &
  0.1888459803001d-06, 0.8561476243374d+00, 0.1561374759853d+03, &
  0.1788370542585d-06, 0.4869736290209d+01, 0.1592596075957d+01, &
  0.1360893296167d-06, 0.3626411886436d+01, 0.1309584267300d+02, &
  0.1506846530160d-06, 0.1550975377427d+01, 0.1649636139783d+02, &
  0.1800913376176d-06, 0.2075826033190d+01, 0.1729818233119d+02 /
data ((e0(i,j,2),i=1,3),j=101,110) / &
  0.1436261390649d-06, 0.6148876420255d+01, 0.2042657109477d+02, &
  0.1220227114151d-06, 0.4382583879906d+01, 0.7632943190217d+01, &
  0.1337883603592d-06, 0.2036644327361d+01, 0.1213955354133d+02, &
  0.1159326650738d-06, 0.3892276994687d+01, 0.5331357529664d+01, &
  0.1352853128569d-06, 0.1447950649744d+01, 0.1673046366289d+02, &
  0.1433408296083d-06, 0.4457854692961d+01, 0.7342457794669d+01, &
  0.1234701666518d-06, 0.1538818147151d+01, 0.6279485555400d+01, &
  0.1234027192007d-06, 0.1968523220760d+01, 0.6286666145492d+01, &
  0.1244024091797d-06, 0.5779803499985d+01, 0.1511046609763d+02, &
  0.1097934945516d-06, 0.6210975221388d+00, 0.1098880815746d+02 /
data ((e0(i,j,2),i=1,3),j=111,120) / &
  0.1254611329856d-06, 0.2591963807998d+01, 0.1572083878776d+02, &
  0.1158247286784d-06, 0.2483612812670d+01, 0.5729506548653d+01, &
  0.9039078252960d-07, 0.3857554579796d+01, 0.9623688285163d+01, &
  0.9108024978836d-07, 0.5826368512984d+01, 0.7234794171227d+01, &
  0.8887068108436d-07, 0.3475694573987d+01, 0.6148010737701d+01, &
  0.8632374035438d-07, 0.3059070488983d-01, 0.6418140963190d+01, &
  0.7893186992967d-07, 0.1583194837728d+01, 0.2118763888447d+01, &
  0.8297650201172d-07, 0.8519770534637d+00, 0.1471231707864d+02, &
  0.1019759578988d-06, 0.1319598738732d+00, 0.1349867339771d+01, &
  0.1010037696236d-06, 0.9937860115618d+00, 0.6836645152238d+01 /
data ((e0(i,j,2),i=1,3),j=121,130) / &
  0.1047727548266d-06, 0.1382138405399d+01, 0.5999216516294d+01, &
  0.7351993881086d-07, 0.3833397851735d+01, 0.6040347114260d+01, &
  0.9868771092341d-07, 0.2124913814390d+01, 0.6566935184597d+01, &
  0.7007321959390d-07, 0.5946305343763d+01, 0.6525804586632d+01, &
  0.6861411679709d-07, 0.4574654977089d+01, 0.7238675589263d+01, &
  0.7554519809614d-07, 0.5949232686844d+01, 0.1253985337760d+02, &
  0.9541880448335d-07, 0.3495242990564d+01, 0.2122839202813d+02, &
  0.7185606722155d-07, 0.4310113471661d+01, 0.6245048154254d+01, &
  0.7131360871710d-07, 0.5480309323650d+01, 0.6321103546637d+01, &
  0.6651142021039d-07, 0.5411097713654d+01, 0.5327476111629d+01 /
data ((e0(i,j,2),i=1,3),j=131,140) / &
  0.8538618213667d-07, 0.1827849973951d+01, 0.1101510648075d+02, &
  0.8634954288044d-07, 0.5443584943349d+01, 0.5643178611111d+01, &
  0.7449415051484d-07, 0.2011535459060d+01, 0.5368044267797d+00, &
  0.7421047599169d-07, 0.3464562529249d+01, 0.2354323048545d+02, &
  0.6140694354424d-07, 0.5657556228815d+01, 0.1296430071988d+02, &
  0.6353525143033d-07, 0.3463816593821d+01, 0.1990745094947d+01, &
  0.6221964013447d-07, 0.1532259498697d+01, 0.9517183207817d+00, &
  0.5852480257244d-07, 0.1375396598875d+01, 0.9555997388169d+00, &
  0.6398637498911d-07, 0.2405645801972d+01, 0.2407292145756d+02, &
  0.7039744069878d-07, 0.5397541799027d+01, 0.5225775174439d+00 /
data ((e0(i,j,2),i=1,3),j=141,150) / &
  0.6977997694382d-07, 0.4762347105419d+01, 0.1097355562493d+02, &
  0.7460629558396d-07, 0.2711944692164d+01, 0.2200391463820d+02, &
  0.5376577536101d-07, 0.2352980430239d+01, 0.1431416805965d+02, &
  0.7530607893556d-07, 0.1943940180699d+01, 0.1842262939178d+02, &
  0.6822928971605d-07, 0.4337651846959d+01, 0.1554202828031d+00, &
  0.6220772380094d-07, 0.6716871369278d+00, 0.1845107853235d+02, &
  0.6586950799043d-07, 0.2229714460505d+01, 0.5216580451554d+01, &
  0.5873800565771d-07, 0.7627013920580d+00, 0.6398972393349d+00, &
  0.6264346929745d-07, 0.6202785478961d+00, 0.6277552955062d+01, &
  0.6257929115669d-07, 0.2886775596668d+01, 0.6288598745829d+01 /
data ((e0(i,j,2),i=1,3),j=151,160) / &
  0.5343536033409d-07, 0.1977241012051d+01, 0.4690479774488d+01, &
  0.5587849781714d-07, 0.1922923484825d+01, 0.1551045220144d+01, &
  0.6905100845603d-07, 0.3570757164631d+01, 0.1030928125552d+00, &
  0.6178957066649d-07, 0.5197558947765d+01, 0.5230807360890d+01, &
  0.6187270224331d-07, 0.8193497368922d+00, 0.5650292065779d+01, &
  0.5385664291426d-07, 0.5406336665586d+01, 0.7771377146812d+02, &
  0.6329363917926d-07, 0.2837760654536d+01, 0.2608790314060d+02, &
  0.4546018761604d-07, 0.2933580297050d+01, 0.5535693017924d+00, &
  0.6196091049375d-07, 0.4157871494377d+01, 0.8467247584405d+02, &
  0.6159555108218d-07, 0.3211703561703d+01, 0.2394243902548d+03 /
data ((e0(i,j,2),i=1,3),j=161,170) / &
  0.4995340539317d-07, 0.1459098102922d+01, 0.4732030630302d+01, &
  0.5457031243572d-07, 0.1430457676136d+01, 0.6179983037890d+01, &
  0.4863461418397d-07, 0.2196425916730d+01, 0.9027992316901d+02, &
  0.5342947626870d-07, 0.2086612890268d+01, 0.6386168663001d+01, &
  0.5674296648439d-07, 0.2760204966535d+01, 0.6915859635113d+01, &
  0.4745783120161d-07, 0.4245368971862d+01, 0.6282970628506d+01, &
  0.4745676961198d-07, 0.5544725787016d+01, 0.6283181072386d+01, &
  0.4049796869973d-07, 0.2213984363586d+01, 0.6254626709878d+01, &
  0.4248333596940d-07, 0.8075781952896d+00, 0.7875671926403d+01, &
  0.4027178070205d-07, 0.1293268540378d+01, 0.6311524991013d+01 /
data ((e0(i,j,2),i=1,3),j=171,180) / &
  0.4066543943476d-07, 0.3986141175804d+01, 0.3634620989887d+01, &
  0.4858863787880d-07, 0.1276112738231d+01, 0.5760498333002d+01, &
  0.5277398263530d-07, 0.4916111741527d+01, 0.2515860172507d+02, &
  0.4105635656559d-07, 0.1725805864426d+01, 0.6709674010002d+01, &
  0.4376781925772d-07, 0.2243642442106d+01, 0.6805653367890d+01, &
  0.3235827894693d-07, 0.3614135118271d+01, 0.1066495398892d+01, &
  0.3073244740308d-07, 0.2460873393460d+01, 0.5863591145557d+01, &
  0.3088609271373d-07, 0.5678431771790d+01, 0.9917696840332d+01, &
  0.3393022279836d-07, 0.3814017477291d+01, 0.1391601904066d+02, &
  0.3038686508802d-07, 0.4660216229171d+01, 0.1256621883632d+02 /
data ((e0(i,j,2),i=1,3),j=181,190) / &
  0.4019677752497d-07, 0.5906906243735d+01, 0.1334167431096d+02, &
  0.3288834998232d-07, 0.9536146445882d+00, 0.1620077269078d+02, &
  0.3889973794631d-07, 0.3942205097644d+01, 0.7478166569050d-01, &
  0.3050438987141d-07, 0.1624810271286d+01, 0.1805292951336d+02, &
  0.3601142564638d-07, 0.4030467142575d+01, 0.6208294184755d+01, &
  0.3689015557141d-07, 0.3648878818694d+01, 0.5966683958112d+01, &
  0.3563471893565d-07, 0.5749584017096d+01, 0.6357857516136d+01, &
  0.2776183170667d-07, 0.2630124187070d+01, 0.3523159621801d-02, &
  0.2922350530341d-07, 0.1790346403629d+01, 0.1272157198369d+02, &
  0.3511076917302d-07, 0.6142198301611d+01, 0.6599467742779d+01 /
data ((e0(i,j,2),i=1,3),j=191,200) / &
  0.3619351007632d-07, 0.1432421386492d+01, 0.6019991944201d+01, &
  0.2561254711098d-07, 0.2302822475792d+01, 0.1259245002418d+02, &
  0.2626903942920d-07, 0.8660470994571d+00, 0.6702560555334d+01, &
  0.2550187397083d-07, 0.6069721995383d+01, 0.1057540660594d+02, &
  0.2535873526138d-07, 0.1079020331795d-01, 0.3141537925223d+02, &
  0.3519786153847d-07, 0.3809066902283d+01, 0.2505706758577d+03, &
  0.3424651492873d-07, 0.2075435114417d+01, 0.6546159756691d+01, &
  0.2372676630861d-07, 0.2057803120154d+01, 0.2388894113936d+01, &
  0.2710980779541d-07, 0.1510068488010d+01, 0.1202934727411d+02, &
  0.3038710889704d-07, 0.5043617528901d+01, 0.1256608456547d+02 /
data ((e0(i,j,2),i=1,3),j=201,210) / &
  0.2220364130585d-07, 0.3694793218205d+01, 0.1336244973887d+02, &
  0.3025880825460d-07, 0.5450618999049d-01, 0.2908881142201d+02, &
  0.2784493486864d-07, 0.3381164084502d+01, 0.1494531617769d+02, &
  0.2294414142438d-07, 0.4382309025210d+01, 0.6076890225335d+01, &
  0.2012723294724d-07, 0.9142212256518d+00, 0.6262720680387d+01, &
  0.2036357831958d-07, 0.5676172293154d+01, 0.4701116388778d+01, &
  0.2003474823288d-07, 0.2592767977625d+01, 0.6303431020504d+01, &
  0.2207144900109d-07, 0.5404976271180d+01, 0.6489261475556d+01, &
  0.2481664905135d-07, 0.4373284587027d+01, 0.1204357418345d+02, &
  0.2674949182295d-07, 0.5859182188482d+01, 0.4590910121555d+01 /
data ((e0(i,j,2),i=1,3),j=211,220) / &
  0.2450554720322d-07, 0.4555381557451d+01, 0.1495633313810d+00, &
  0.2601975986457d-07, 0.3933165584959d+01, 0.1965104848470d+02, &
  0.2199860022848d-07, 0.5227977189087d+01, 0.1351787002167d+02, &
  0.2448121172316d-07, 0.4858060353949d+01, 0.1162474756779d+01, &
  0.1876014864049d-07, 0.5690546553605d+01, 0.6279194432410d+01, &
  0.1874513219396d-07, 0.4099539297446d+01, 0.6286957268481d+01, &
  0.2156380842559d-07, 0.4382594769913d+00, 0.1813929450232d+02, &
  0.1981691240061d-07, 0.1829784152444d+01, 0.4686889479442d+01, &
  0.2329992648539d-07, 0.2836254278973d+01, 0.1002183730415d+02, &
  0.1765184135302d-07, 0.2803494925833d+01, 0.4292330755499d+01 /
data ((e0(i,j,2),i=1,3),j=221,230) / &
  0.2436368366085d-07, 0.2836897959677d+01, 0.9514313292143d+02, &
  0.2164089203889d-07, 0.6127522446024d+01, 0.6037244212485d+01, &
  0.1847755034221d-07, 0.3683163635008d+01, 0.2427287361862d+00, &
  0.1674798769966d-07, 0.3316993867246d+00, 0.1311972100268d+02, &
  0.2222542124356d-07, 0.8294097805480d+00, 0.1266924451345d+02, &
  0.2071074505925d-07, 0.3659492220261d+01, 0.6528907488406d+01, &
  0.1608224471835d-07, 0.4774492067182d+01, 0.1352175143971d+02, &
  0.1857583439071d-07, 0.2873120597682d+01, 0.8662240327241d+01, &
  0.1793018836159d-07, 0.5282441177929d+00, 0.6819880277225d+01, &
  0.1575391221692d-07, 0.1320789654258d+01, 0.1102062672231d+00 /
data ((e0(i,j,2),i=1,3),j=231,240) / &
  0.1840132009557d-07, 0.1917110916256d+01, 0.6514761976723d+02, &
  0.1760917288281d-07, 0.2972635937132d+01, 0.5746271423666d+01, &
  0.1561779518516d-07, 0.4372569261981d+01, 0.6272439236156d+01, &
  0.1558687885205d-07, 0.5416424926425d+01, 0.6293712464735d+01, &
  0.1951359382579d-07, 0.3094448898752d+01, 0.2301353951334d+02, &
  0.1569144275614d-07, 0.2802103689808d+01, 0.1765478049437d+02, &
  0.1479130389462d-07, 0.2136435020467d+01, 0.2077542790660d-01, &
  0.1467828510764d-07, 0.7072627435674d+00, 0.1052268489556d+01, &
  0.1627627337440d-07, 0.3947607143237d+01, 0.6327837846670d+00, &
  0.1503498479758d-07, 0.4079248909190d+01, 0.7626583626240d-01 /
data ((e0(i,j,2),i=1,3),j=241,250) / &
  0.1297967708237d-07, 0.6269637122840d+01, 0.1149965630200d+02, &
  0.1374416896634d-07, 0.4175657970702d+01, 0.6016468784579d+01, &
  0.1783812325219d-07, 0.1476540547560d+01, 0.3301902111895d+02, &
  0.1525884228756d-07, 0.4653477715241d+01, 0.9411464614024d+01, &
  0.1451067396763d-07, 0.2573001128225d+01, 0.1277945078067d+02, &
  0.1297713111950d-07, 0.5612799618771d+01, 0.6549682916313d+01, &
  0.1462784012820d-07, 0.4189661623870d+01, 0.1863592847156d+02, &
  0.1384185980007d-07, 0.2656915472196d+01, 0.2379164476796d+01, &
  0.1221497599801d-07, 0.5612515760138d+01, 0.1257326515556d+02, &
  0.1560574525896d-07, 0.4783414317919d+01, 0.1887552587463d+02 /
data ((e0(i,j,2),i=1,3),j=251,260) / &
  0.1544598372036d-07, 0.2694431138063d+01, 0.1820933031200d+02, &
  0.1531678928696d-07, 0.4105103489666d+01, 0.2593412433514d+02, &
  0.1349321503795d-07, 0.3082437194015d+00, 0.5120601093667d+01, &
  0.1252030290917d-07, 0.6124072334087d+01, 0.6993008899458d+01, &
  0.1459243816687d-07, 0.3733103981697d+01, 0.3813291813120d-01, &
  0.1226103625262d-07, 0.1267127706817d+01, 0.2435678079171d+02, &
  0.1019449641504d-07, 0.4367790112269d+01, 0.1725663147538d+02, &
  0.1380789433607d-07, 0.3387201768700d+01, 0.2458316379602d+00, &
  0.1019453421658d-07, 0.9204143073737d+00, 0.6112403035119d+01, &
  0.1297929434405d-07, 0.5786874896426d+01, 0.1249137003520d+02 /
data ((e0(i,j,2),i=1,3),j=261,270) / &
  0.9912677786097d-08, 0.3164232870746d+01, 0.6247047890016d+01, &
  0.9829386098599d-08, 0.2586762413351d+01, 0.6453748665772d+01, &
  0.1226807746104d-07, 0.6239068436607d+01, 0.5429879531333d+01, &
  0.1192691755997d-07, 0.1867380051424d+01, 0.6290122169689d+01, &
  0.9836499227081d-08, 0.3424716293727d+00, 0.6319103810876d+01, &
  0.9642862564285d-08, 0.5661372990657d+01, 0.8273820945392d+01, &
  0.1165184404862d-07, 0.5768367239093d+01, 0.1778273215245d+02, &
  0.1175794418818d-07, 0.1657351222943d+01, 0.6276029531202d+01, &
  0.1018948635601d-07, 0.6458292350865d+00, 0.1254537627298d+02, &
  0.9500383606676d-08, 0.1054306140741d+01, 0.1256517118505d+02 /
data ((e0(i,j,2),i=1,3),j=271,280) / &
  0.1227512202906d-07, 0.2505278379114d+01, 0.2248384854122d+02, &
  0.9664792009993d-08, 0.4289737277000d+01, 0.6259197520765d+01, &
  0.9613285666331d-08, 0.5500597673141d+01, 0.6306954180126d+01, &
  0.1117906736211d-07, 0.2361405953468d+01, 0.1779695906178d+02, &
  0.9611378640782d-08, 0.2851310576269d+01, 0.2061856251104d+00, &
  0.8845354852370d-08, 0.6208777705343d+01, 0.1692165728891d+01, &
  0.1054046966600d-07, 0.5413091423934d+01, 0.2204125344462d+00, &
  0.1215539124483d-07, 0.5613969479755d+01, 0.8257698122054d+02, &
  0.9932460955209d-08, 0.1106124877015d+01, 0.1017725758696d+02, &
  0.8785804715043d-08, 0.2869224476477d+01, 0.9491756770005d+00 /
data ((e0(i,j,2),i=1,3),j=281,290) / &
  0.8538084097562d-08, 0.6159640899344d+01, 0.6393282117669d+01, &
  0.8648994369529d-08, 0.1374901198784d+01, 0.4804209201333d+01, &
  0.1039063219067d-07, 0.5171080641327d+01, 0.1550861511662d+02, &
  0.8867983926439d-08, 0.8317320304902d+00, 0.3903911373650d+01, &
  0.8327495955244d-08, 0.3605591969180d+01, 0.6172869583223d+01, &
  0.9243088356133d-08, 0.6114299196843d+01, 0.6267823317922d+01, &
  0.9205657357835d-08, 0.3675153683737d+01, 0.6298328382969d+01, &
  0.1033269714606d-07, 0.3313328813024d+01, 0.5573142801433d+01, &
  0.8001706275552d-08, 0.2019980960053d+01, 0.2648454860559d+01, &
  0.9171858254191d-08, 0.8992015524177d+00, 0.1498544001348d+03 /
data ((e0(i,j,2),i=1,3),j=291,300) / &
  0.1075327150242d-07, 0.2898669963648d+01, 0.3694923081589d+02, &
  0.9884866689828d-08, 0.4946715904478d+01, 0.1140367694411d+02, &
  0.9541835576677d-08, 0.2371787888469d+01, 0.1256713221673d+02, &
  0.7739903376237d-08, 0.2213775190612d+01, 0.7834121070590d+01, &
  0.7311962684106d-08, 0.3429378787739d+01, 0.1192625446156d+02, &
  0.9724904869624d-08, 0.6195878564404d+01, 0.2280573557157d+02, &
  0.9251628983612d-08, 0.6511509527390d+00, 0.2787043132925d+01, &
  0.7320763787842d-08, 0.6001083639421d+01, 0.6282655592598d+01, &
  0.7320296650962d-08, 0.3789073265087d+01, 0.6283496108294d+01, &
  0.7947032271039d-08, 0.1059659582204d+01, 0.1241073141809d+02 /
data ((e0(i,j,2),i=1,3),j=301,310) / &
  0.9005277053115d-08, 0.1280315624361d+01, 0.6281591679874d+01, &
  0.8995601652048d-08, 0.2224439106766d+01, 0.6284560021018d+01, &
  0.8288040568796d-08, 0.5234914433867d+01, 0.1241658836951d+02, &
  0.6359381347255d-08, 0.4137989441490d+01, 0.1596186371003d+01, &
  0.8699572228626d-08, 0.1758411009497d+01, 0.6133512519065d+01, &
  0.6456797542736d-08, 0.5919285089994d+01, 0.1685848245639d+02, &
  0.7424573475452d-08, 0.5414616938827d+01, 0.4061219149443d+01, &
  0.7235671196168d-08, 0.1496516557134d+01, 0.1610006857377d+03, &
  0.8104015182733d-08, 0.1919918242764d+01, 0.8460828644453d+00, &
  0.8098576535937d-08, 0.3819615855458d+01, 0.3894181736510d+01 /
data ((e0(i,j,2),i=1,3),j=311,320) / &
  0.6275292346625d-08, 0.6244264115141d+01, 0.8531963191132d+00, &
  0.6052432989112d-08, 0.5037731872610d+00, 0.1567108171867d+02, &
  0.5705651535817d-08, 0.2984557271995d+01, 0.1258692712880d+02, &
  0.5789650115138d-08, 0.6087038140697d+01, 0.1193336791622d+02, &
  0.5512132153377d-08, 0.5855668994076d+01, 0.1232342296471d+02, &
  0.7388890819102d-08, 0.2443128574740d+01, 0.4907302013889d+01, &
  0.5467593991798d-08, 0.3017561234194d+01, 0.1884211409667d+02, &
  0.6388519802999d-08, 0.5887386712935d+01, 0.5217580628120d+02, &
  0.6106777149944d-08, 0.3483461059895d+00, 0.1422690933580d-01, &
  0.7383420275489d-08, 0.5417387056707d+01, 0.2358125818164d+02 /
data ((e0(i,j,2),i=1,3),j=321,330) / &
  0.5505208141738d-08, 0.2848193644783d+01, 0.1151388321134d+02, &
  0.6310757462877d-08, 0.2349882520828d+01, 0.1041998632314d+02, &
  0.6166904929691d-08, 0.5728575944077d+00, 0.6151533897323d+01, &
  0.5263442042754d-08, 0.4495796125937d+01, 0.1885275071096d+02, &
  0.5591828082629d-08, 0.1355441967677d+01, 0.4337116142245d+00, &
  0.5397051680497d-08, 0.1673422864307d+01, 0.6286362197481d+01, &
  0.5396992745159d-08, 0.1833502206373d+01, 0.6279789503410d+01, &
  0.6572913000726d-08, 0.3331122065824d+01, 0.1176433076753d+02, &
  0.5123421866413d-08, 0.2165327142679d+01, 0.1245594543367d+02, &
  0.5930495725999d-08, 0.2931146089284d+01, 0.6414617803568d+01 /
data ((e0(i,j,2),i=1,3),j=331,340) / &
  0.6431797403933d-08, 0.4134407994088d+01, 0.1350651127443d+00, &
  0.5003182207604d-08, 0.3805420303749d+01, 0.1096996532989d+02, &
  0.5587731032504d-08, 0.1082469260599d+01, 0.6062663316000d+01, &
  0.5935263407816d-08, 0.8384333678401d+00, 0.5326786718777d+01, &
  0.4756019827760d-08, 0.3552588749309d+01, 0.3104930017775d+01, &
  0.6599951172637d-08, 0.4320826409528d+01, 0.4087944051283d+02, &
  0.5902606868464d-08, 0.4811879454445d+01, 0.5849364236221d+01, &
  0.5921147809031d-08, 0.9942628922396d-01, 0.1581959461667d+01, &
  0.5505382581266d-08, 0.2466557607764d+01, 0.6503488384892d+01, &
  0.5353771071862d-08, 0.4551978748683d+01, 0.1735668374386d+03 /
data ((e0(i,j,2),i=1,3),j=341,350) / &
  0.5063282210946d-08, 0.5710812312425d+01, 0.1248988586463d+02, &
  0.5926120403383d-08, 0.1333998428358d+01, 0.2673594526851d+02, &
  0.5211016176149d-08, 0.4649315360760d+01, 0.2460261242967d+02, &
  0.5347075084894d-08, 0.5512754081205d+01, 0.4171425416666d+01, &
  0.4872609773574d-08, 0.1308025299938d+01, 0.5333900173445d+01, &
  0.4727711321420d-08, 0.2144908368062d+01, 0.7232251527446d+01, &
  0.6029426018652d-08, 0.5567259412084d+01, 0.3227113045244d+03, &
  0.4321485284369d-08, 0.5230667156451d+01, 0.9388005868221d+01, &
  0.4476406760553d-08, 0.6134081115303d+01, 0.5547199253223d+01, &
  0.5835268277420d-08, 0.4783808492071d+01, 0.7285056171570d+02 /
data ((e0(i,j,2),i=1,3),j=351,360) / &
  0.5172183602748d-08, 0.5161817911099d+01, 0.1884570439172d+02, &
  0.5693571465184d-08, 0.1381646203111d+01, 0.9723862754494d+02, &
  0.4060634965349d-08, 0.3876705259495d+00, 0.4274518229222d+01, &
  0.3967398770473d-08, 0.5029491776223d+01, 0.3496032717521d+01, &
  0.3943754005255d-08, 0.1923162955490d+01, 0.6244942932314d+01, &
  0.4781323427824d-08, 0.4633332586423d+01, 0.2929661536378d+02, &
  0.3871483781204d-08, 0.1616650009743d+01, 0.6321208768577d+01, &
  0.5141741733997d-08, 0.9817316704659d-01, 0.1232032006293d+02, &
  0.4002385978497d-08, 0.3656161212139d+01, 0.7018952447668d+01, &
  0.4901092604097d-08, 0.4404098713092d+01, 0.1478866649112d+01 /
data ((e0(i,j,2),i=1,3),j=361,370) / &
  0.3740932630345d-08, 0.5181188732639d+00, 0.6922973089781d+01, &
  0.4387283718538d-08, 0.3254859566869d+01, 0.2331413144044d+03, &
  0.5019197802033d-08, 0.3086773224677d+01, 0.1715706182245d+02, &
  0.3834931695175d-08, 0.2797882673542d+01, 0.1491901785440d+02, &
  0.3760413942497d-08, 0.2892676280217d+01, 0.1726726808967d+02, &
  0.3719717204628d-08, 0.5861046025739d+01, 0.6297302759782d+01, &
  0.4145623530149d-08, 0.2168239627033d+01, 0.1376059875786d+02, &
  0.3932788425380d-08, 0.6271811124181d+01, 0.7872148766781d+01, &
  0.3686377476857d-08, 0.3936853151404d+01, 0.6268848941110d+01, &
  0.3779077950339d-08, 0.1404148734043d+01, 0.4157198507331d+01 /
data ((e0(i,j,2),i=1,3),j=371,380) / &
  0.4091334550598d-08, 0.2452436180854d+01, 0.9779108567966d+01, &
  0.3926694536146d-08, 0.6102292739040d+01, 0.1098419223922d+02, &
  0.4841000253289d-08, 0.6072760457276d+01, 0.1252801878276d+02, &
  0.4949340130240d-08, 0.1154832815171d+01, 0.1617106187867d+03, &
  0.3761557737360d-08, 0.5527545321897d+01, 0.3185192151914d+01, &
  0.3647396268188d-08, 0.1525035688629d+01, 0.6271346477544d+01, &
  0.3932405074189d-08, 0.5570681040569d+01, 0.2139354194808d+02, &
  0.3631322501141d-08, 0.1981240601160d+01, 0.6294805223347d+01, &
  0.4130007425139d-08, 0.2050060880201d+01, 0.2195415756911d+02, &
  0.4433905965176d-08, 0.3277477970321d+01, 0.7445550607224d+01 /
data ((e0(i,j,2),i=1,3),j=381,390) / &
  0.3851814176947d-08, 0.5210690074886d+01, 0.9562891316684d+00, &
  0.3485807052785d-08, 0.6653274904611d+00, 0.1161697602389d+02, &
  0.3979772816991d-08, 0.1767941436148d+01, 0.2277943724828d+02, &
  0.3402607460500d-08, 0.3421746306465d+01, 0.1087398597200d+02, &
  0.4049993000926d-08, 0.1127144787547d+01, 0.3163918923335d+00, &
  0.3420511182382d-08, 0.4214794779161d+01, 0.1362553364512d+02, &
  0.3640772365012d-08, 0.5324905497687d+01, 0.1725304118033d+02, &
  0.3323037987501d-08, 0.6135761838271d+01, 0.6279143387820d+01, &
  0.4503141663637d-08, 0.1802305450666d+01, 0.1385561574497d+01, &
  0.4314560055588d-08, 0.4812299731574d+01, 0.4176041334900d+01 /
data ((e0(i,j,2),i=1,3),j=391,400) / &
  0.3294226949110d-08, 0.3657547059723d+01, 0.6287008313071d+01, &
  0.3215657197281d-08, 0.4866676894425d+01, 0.5749861718712d+01, &
  0.4129362656266d-08, 0.3809342558906d+01, 0.5905702259363d+01, &
  0.3137762976388d-08, 0.2494635174443d+01, 0.2099539292909d+02, &
  0.3514010952384d-08, 0.2699961831678d+01, 0.7335344340001d+01, &
  0.3327607571530d-08, 0.3318457714816d+01, 0.5436992986000d+01, &
  0.3541066946675d-08, 0.4382703582466d+01, 0.1234573916645d+02, &
  0.3216179847052d-08, 0.5271066317054d+01, 0.3802769619140d-01, &
  0.2959045059570d-08, 0.5819591585302d+01, 0.2670964694522d+02, &
  0.3884040326665d-08, 0.5980934960428d+01, 0.6660449441528d+01 /
data ((e0(i,j,2),i=1,3),j=401,410) / &
  0.2922027539886d-08, 0.3337290282483d+01, 0.1375773836557d+01, &
  0.4110846382042d-08, 0.5742978187327d+01, 0.4480965020977d+02, &
  0.2934508411032d-08, 0.2278075804200d+01, 0.6408777551755d+00, &
  0.3966896193000d-08, 0.5835747858477d+01, 0.3773735910827d+00, &
  0.3286695827610d-08, 0.5838898193902d+01, 0.3932462625300d-02, &
  0.3720643094196d-08, 0.1122212337858d+01, 0.1646033343740d+02, &
  0.3285508906174d-08, 0.9182250996416d+00, 0.1081813534213d+02, &
  0.3753880575973d-08, 0.5174761973266d+01, 0.5642198095270d+01, &
  0.3022129385587d-08, 0.3381611020639d+01, 0.2982630633589d+02, &
  0.2798569205621d-08, 0.3546193723922d+01, 0.1937891852345d+02 /
data ((e0(i,j,2),i=1,3),j=411,420) / &
  0.3397872070505d-08, 0.4533203197934d+01, 0.6923953605621d+01, &
  0.3708099772977d-08, 0.2756168198616d+01, 0.3066615496545d+02, &
  0.3599283541510d-08, 0.1934395469918d+01, 0.6147450479709d+01, &
  0.3688702753059d-08, 0.7149920971109d+00, 0.2636725487657d+01, &
  0.2681084724003d-08, 0.4899819493154d+01, 0.6816289982179d+01, &
  0.3495993460759d-08, 0.1572418915115d+01, 0.6418701221183d+01, &
  0.3130770324995d-08, 0.8912190180489d+00, 0.1235996607578d+02, &
  0.2744353821941d-08, 0.3800821940055d+01, 0.2059724391010d+02, &
  0.2842732906341d-08, 0.2644717440029d+01, 0.2828699048865d+02, &
  0.3046882682154d-08, 0.3987793020179d+01, 0.6055599646783d+01 /
data ((e0(i,j,2),i=1,3),j=421,430) / &
  0.2399072455143d-08, 0.9908826440764d+00, 0.6255674361143d+01, &
  0.2384306274204d-08, 0.2516149752220d+01, 0.6310477339748d+01, &
  0.2977324500559d-08, 0.5849195642118d+01, 0.1652265972112d+02, &
  0.3062835258972d-08, 0.1681660100162d+01, 0.1172006883645d+02, &
  0.3109682589231d-08, 0.5804143987737d+00, 0.2751146787858d+02, &
  0.2903920355299d-08, 0.5800768280123d+01, 0.6510552054109d+01, &
  0.2823221989212d-08, 0.9241118370216d+00, 0.5469525544182d+01, &
  0.3187949696649d-08, 0.3139776445735d+01, 0.1693792562116d+03, &
  0.2922559771655d-08, 0.3549440782984d+01, 0.2630839062450d+00, &
  0.2436302066603d-08, 0.4735540696319d+01, 0.3946258593675d+00 /
data ((e0(i,j,2),i=1,3),j=431,440) / &
  0.3049473043606d-08, 0.4998289124561d+01, 0.8390110365991d+01, &
  0.2863682575784d-08, 0.6709515671102d+00, 0.2243449970715d+00, &
  0.2641750517966d-08, 0.5410978257284d+01, 0.2986433403208d+02, &
  0.2704093466243d-08, 0.4778317207821d+01, 0.6129297044991d+01, &
  0.2445522177011d-08, 0.6009020662222d+01, 0.1171295538178d+02, &
  0.2623608810230d-08, 0.5010449777147d+01, 0.6436854655901d+01, &
  0.2079259704053d-08, 0.5980943768809d+01, 0.2019909489111d+02, &
  0.2820225596771d-08, 0.2679965110468d+01, 0.5934151399930d+01, &
  0.2365221950927d-08, 0.1894231148810d+01, 0.2470570524223d+02, &
  0.2359682077149d-08, 0.4220752950780d+01, 0.8671969964381d+01 /
data ((e0(i,j,2),i=1,3),j=441,450) / &
  0.2387577137206d-08, 0.2571783940617d+01, 0.7096626156709d+01, &
  0.1982102089816d-08, 0.5169765997119d+00, 0.1727188400790d+02, &
  0.2687502389925d-08, 0.6239078264579d+01, 0.7075506709219d+02, &
  0.2207751669135d-08, 0.2031184412677d+01, 0.4377611041777d+01, &
  0.2618370214274d-08, 0.8266079985979d+00, 0.6632000300961d+01, &
  0.2591951887361d-08, 0.8819350522008d+00, 0.4873985990671d+02, &
  0.2375055656248d-08, 0.3520944177789d+01, 0.1590676413561d+02, &
  0.2472019978911d-08, 0.1551431908671d+01, 0.6612329252343d+00, &
  0.2368157127199d-08, 0.4178610147412d+01, 0.3459636466239d+02, &
  0.1764846605693d-08, 0.1506764000157d+01, 0.1980094587212d+02 /
data ((e0(i,j,2),i=1,3),j=451,460) / &
  0.2291769608798d-08, 0.2118250611782d+01, 0.2844914056730d-01, &
  0.2209997316943d-08, 0.3363255261678d+01, 0.2666070658668d+00, &
  0.2292699097923d-08, 0.4200423956460d+00, 0.1484170571900d-02, &
  0.1629683015329d-08, 0.2331362582487d+01, 0.3035599730800d+02, &
  0.2206492862426d-08, 0.3400274026992d+01, 0.6281667977667d+01, &
  0.2205746568257d-08, 0.1066051230724d+00, 0.6284483723224d+01, &
  0.2026310767991d-08, 0.2779066487979d+01, 0.2449240616245d+02, &
  0.1762977622163d-08, 0.9951450691840d+00, 0.2045286941806d+02, &
  0.1368535049606d-08, 0.6402447365817d+00, 0.2473415438279d+02, &
  0.1720598775450d-08, 0.2303524214705d+00, 0.1679593901136d+03 /
data ((e0(i,j,2),i=1,3),j=461,470) / &
  0.1702429015449d-08, 0.6164622655048d+01, 0.3338575901272d+03, &
  0.1414033197685d-08, 0.3954561185580d+01, 0.1624205518357d+03, &
  0.1573768958043d-08, 0.2028286308984d+01, 0.3144167757552d+02, &
  0.1650705184447d-08, 0.2304040666128d+01, 0.5267006960365d+02, &
  0.1651087618855d-08, 0.2538461057280d+01, 0.8956999012000d+02, &
  0.1616409518983d-08, 0.5111054348152d+01, 0.3332657872986d+02, &
  0.1537175173581d-08, 0.5601130666603d+01, 0.3852657435933d+02, &
  0.1593191980553d-08, 0.2614340453411d+01, 0.2282781046519d+03, &
  0.1499480170643d-08, 0.3624721577264d+01, 0.2823723341956d+02, &
  0.1493807843235d-08, 0.4214569879008d+01, 0.2876692439167d+02 /
data ((e0(i,j,2),i=1,3),j=471,480) / &
  0.1074571199328d-08, 0.1496911744704d+00, 0.8397383534231d+02, &
  0.1074406983417d-08, 0.1187817671922d+01, 0.8401985929482d+02, &
  0.9757576855851d-09, 0.2655703035858d+01, 0.7826370942180d+02, &
  0.1258432887565d-08, 0.4969896184844d+01, 0.3115650189215d+03, &
  0.1240336343282d-08, 0.5192460776926d+01, 0.1784300471910d+03, &
  0.9016107005164d-09, 0.1960356923057d+01, 0.5886454391678d+02, &
  0.1135392360918d-08, 0.5082427809068d+01, 0.7842370451713d+02, &
  0.9216046089565d-09, 0.2793775037273d+01, 0.1014262087719d+03, &
  0.1061276615030d-08, 0.3726144311409d+01, 0.5660027930059d+02, &
  0.1010110596263d-08, 0.7404080708937d+00, 0.4245678405627d+02 /
data ((e0(i,j,2),i=1,3),j=481,490) / &
  0.7217424756199d-09, 0.2697449980577d-01, 0.2457074661053d+03, &
  0.6912003846756d-09, 0.4253296276335d+01, 0.1679936946371d+03, &
  0.6871814664847d-09, 0.5148072412354d+01, 0.6053048899753d+02, &
  0.4887158016343d-09, 0.2153581148294d+01, 0.9656299901946d+02, &
  0.5161802866314d-09, 0.3852750634351d+01, 0.2442876000072d+03, &
  0.5652599559057d-09, 0.1233233356270d+01, 0.8365903305582d+02, &
  0.4710812608586d-09, 0.5610486976767d+01, 0.3164282286739d+03, &
  0.4909977500324d-09, 0.1639629524123d+01, 0.4059982187939d+03, &
  0.4772641839378d-09, 0.3737100368583d+01, 0.1805255418145d+03, &
  0.4487562567153d-09, 0.1158417054478d+00, 0.8433466158131d+02 /
data ((e0(i,j,2),i=1,3),j=491,500) / &
  0.3943441230497d-09, 0.6243502862796d+00, 0.2568537517081d+03, &
  0.3952236913598d-09, 0.3510377382385d+01, 0.2449975330562d+03, &
  0.3788898363417d-09, 0.5916128302299d+01, 0.1568131045107d+03, &
  0.3738329328831d-09, 0.1042266763456d+01, 0.3948519331910d+03, &
  0.2451199165151d-09, 0.1166788435700d+01, 0.1435713242844d+03, &
  0.2436734402904d-09, 0.3254726114901d+01, 0.2268582385539d+03, &
  0.2213605274325d-09, 0.1687210598530d+01, 0.1658638954901d+03, &
  0.1491521204829d-09, 0.2657541786794d+01, 0.2219950288015d+03, &
  0.1474995329744d-09, 0.5013089805819d+01, 0.3052819430710d+03, &
  0.1661939475656d-09, 0.5495315428418d+01, 0.2526661704812d+03 /
data ((e0(i,j,2),i=1,3),j=501,ne0y) / &
  0.9015946748003d-10, 0.2236989966505d+01, 0.4171445043968d+03 /

!  Sun-to-Earth, T^1, Y
data ((e1(i,j,2),i=1,3),j=  1, 10) / &
  0.9304690546528d-06, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.5150715570663d-06, 0.4431807116294d+01, 0.1256615170089d+02, &
  0.1290825411056d-07, 0.4388610039678d+01, 0.1884922755134d+02, &
  0.4645466665386d-08, 0.5827263376034d+01, 0.6283075850446d+01, &
  0.2079625310718d-08, 0.1621698662282d+00, 0.6279552690824d+01, &
  0.2078189850907d-08, 0.3344713435140d+01, 0.6286599010068d+01, &
  0.6207190138027d-09, 0.5074049319576d+01, 0.4705732307012d+01, &
  0.5989826532569d-09, 0.2231842216620d+01, 0.6256777527156d+01, &
  0.5961360812618d-09, 0.1274975769045d+01, 0.6309374173736d+01, &
  0.4874165471016d-09, 0.3642277426779d+01, 0.7755226100720d+00 /
data ((e1(i,j,2),i=1,3),j= 11, 20) / &
  0.4283834034360d-09, 0.5148765510106d+01, 0.1059381944224d+01, &
  0.4652389287529d-09, 0.4715794792175d+01, 0.7860419393880d+01, &
  0.3751707476401d-09, 0.6617207370325d+00, 0.5753384878334d+01, &
  0.3559998806198d-09, 0.6155548875404d+01, 0.5884926831456d+01, &
  0.3558447558857d-09, 0.2898827297664d+01, 0.6812766822558d+01, &
  0.3211116927106d-09, 0.3625813502509d+01, 0.6681224869435d+01, &
  0.2875609914672d-09, 0.4345435813134d+01, 0.2513230340178d+02, &
  0.2843109704069d-09, 0.5862263940038d+01, 0.6127655567643d+01, &
  0.2744676468427d-09, 0.3926419475089d+01, 0.6438496133249d+01, &
  0.2481285237789d-09, 0.1351976572828d+01, 0.5486777812467d+01 /
data ((e1(i,j,2),i=1,3),j= 21, 30) / &
  0.2060338481033d-09, 0.2147556998591d+01, 0.7079373888424d+01, &
  0.2015822358331d-09, 0.4408358972216d+01, 0.6290189305114d+01, &
  0.2001195944195d-09, 0.5385829822531d+01, 0.6275962395778d+01, &
  0.1953667642377d-09, 0.1304933746120d+01, 0.5507553240374d+01, &
  0.1839744078713d-09, 0.6173567228835d+01, 0.1179062909082d+02, &
  0.1643334294845d-09, 0.4635942997523d+01, 0.1150676975667d+02, &
  0.1768051018652d-09, 0.5086283558874d+01, 0.7113454667900d-02, &
  0.1674874205489d-09, 0.2243332137241d+01, 0.7058598460518d+01, &
  0.1421445397609d-09, 0.6186899771515d+01, 0.7962980379786d+00, &
  0.1255163958267d-09, 0.5730238465658d+01, 0.4694002934110d+01 /
data ((e1(i,j,2),i=1,3),j= 31, 40) / &
  0.1013945281961d-09, 0.1726055228402d+01, 0.3738761453707d+01, &
  0.1047294335852d-09, 0.2658801228129d+01, 0.6282095334605d+01, &
  0.1047103879392d-09, 0.8481047835035d+00, 0.6284056366286d+01, &
  0.9530343962826d-10, 0.3079267149859d+01, 0.6069776770667d+01, &
  0.9604637611690d-10, 0.3258679792918d+00, 0.4136910472696d+01, &
  0.9153518537177d-10, 0.4398599886584d+00, 0.6496374930224d+01, &
  0.8562458214922d-10, 0.4772686794145d+01, 0.1194447056968d+01, &
  0.8232525360654d-10, 0.5966220721679d+01, 0.1589072916335d+01, &
  0.6150223411438d-10, 0.1780985591923d+01, 0.8827390247185d+01, &
  0.6272087858000d-10, 0.3184305429012d+01, 0.8429241228195d+01 /
data ((e1(i,j,2),i=1,3),j= 41, 50) / &
  0.5540476311040d-10, 0.3801260595433d+01, 0.4933208510675d+01, &
  0.7331901699361d-10, 0.5205948591865d+01, 0.4535059491685d+01, &
  0.6018528702791d-10, 0.4770139083623d+01, 0.1255903824622d+02, &
  0.5150530724804d-10, 0.3574796899585d+01, 0.1176985366291d+02, &
  0.6471933741811d-10, 0.2679787266521d+01, 0.5088628793478d+01, &
  0.5317460644174d-10, 0.9528763345494d+00, 0.3154687086868d+01, &
  0.4832187748783d-10, 0.5329322498232d+01, 0.6040347114260d+01, &
  0.4716763555110d-10, 0.2395235316466d+01, 0.5331357529664d+01, &
  0.4871509139861d-10, 0.3056663648823d+01, 0.1256967486051d+02, &
  0.4598417696768d-10, 0.4452762609019d+01, 0.6525804586632d+01 /
data ((e1(i,j,2),i=1,3),j= 51, 60) / &
  0.5674189533175d-10, 0.9879680872193d+00, 0.5729506548653d+01, &
  0.4073560328195d-10, 0.5939127696986d+01, 0.7632943190217d+01, &
  0.5040994945359d-10, 0.4549875824510d+01, 0.8031092209206d+01, &
  0.5078185134679d-10, 0.7346659893982d+00, 0.7477522907414d+01, &
  0.3769343537061d-10, 0.1071317188367d+01, 0.7234794171227d+01, &
  0.4980331365299d-10, 0.2500345341784d+01, 0.6836645152238d+01, &
  0.3458236594757d-10, 0.3825159450711d+01, 0.1097707878456d+02, &
  0.3578859493602d-10, 0.5299664791549d+01, 0.4164311961999d+01, &
  0.3370504646419d-10, 0.5002316301593d+01, 0.1137170464392d+02, &
  0.3299873338428d-10, 0.2526123275282d+01, 0.3930209696940d+01 /
data ((e1(i,j,2),i=1,3),j= 61, 70) / &
  0.4304917318409d-10, 0.3368078557132d+01, 0.1592596075957d+01, &
  0.3402418753455d-10, 0.8385495425800d+00, 0.3128388763578d+01, &
  0.2778460572146d-10, 0.3669905203240d+01, 0.7342457794669d+01, &
  0.2782710128902d-10, 0.2691664812170d+00, 0.1748016358760d+01, &
  0.2711725179646d-10, 0.4707487217718d+01, 0.5296909721118d+00, &
  0.2981760946340d-10, 0.3190260867816d+00, 0.5368044267797d+00, &
  0.2811672977772d-10, 0.3196532315372d+01, 0.7084896783808d+01, &
  0.2863454474467d-10, 0.2263240324780d+00, 0.5223693906222d+01, &
  0.3333464634051d-10, 0.3498451685065d+01, 0.8018209333619d+00, &
  0.3312991747609d-10, 0.5839154477412d+01, 0.1554202828031d+00 /
data ((e1(i,j,2),i=1,3),j= 71,ne1y) / &
  0.2813255564006d-10, 0.8268044346621d+00, 0.5225775174439d+00, &
  0.2665098083966d-10, 0.3934021725360d+01, 0.5216580451554d+01, &
  0.2349795705216d-10, 0.5197620913779d+01, 0.2146165377750d+01, &
  0.2330352293961d-10, 0.2984999231807d+01, 0.1726015463500d+02, &
  0.2728001683419d-10, 0.6521679638544d+00, 0.8635942003952d+01, &
  0.2484061007669d-10, 0.3468955561097d+01, 0.5230807360890d+01, &
  0.2646328768427d-10, 0.1013724533516d+01, 0.2629832328990d-01, &
  0.2518630264831d-10, 0.6108081057122d+01, 0.5481254917084d+01, &
  0.2421901455384d-10, 0.1651097776260d+01, 0.1349867339771d+01, &
  0.6348533267831d-11, 0.3220226560321d+01, 0.8433466158131d+02 /

!  Sun-to-Earth, T^2, Y
data ((e2(i,j,2),i=1,3),j=  1,ne2y) / &
  0.5063375872532d-10, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.2173815785980d-10, 0.2827805833053d+01, 0.1256615170089d+02, &
  0.1010231999920d-10, 0.4634612377133d+01, 0.6283075850446d+01, &
  0.9259745317636d-12, 0.2620612076189d+01, 0.1884922755134d+02, &
  0.1022202095812d-12, 0.3809562326066d+01, 0.8399684731857d+02 /

!  Sun-to-Earth, T^0, Z
data ((e0(i,j,3),i=1,3),j=  1, 10) / &
  0.2796207639075d-05, 0.3198701560209d+01, 0.8433466158131d+02, &
  0.1016042198142d-05, 0.5422360395913d+01, 0.5507553240374d+01, &
  0.8044305033647d-06, 0.3880222866652d+01, 0.5223693906222d+01, &
  0.4385347909274d-06, 0.3704369937468d+01, 0.2352866153506d+01, &
  0.3186156414906d-06, 0.3999639363235d+01, 0.1577343543434d+01, &
  0.2272412285792d-06, 0.3984738315952d+01, 0.1047747311755d+01, &
  0.1645620103007d-06, 0.3565412516841d+01, 0.5856477690889d+01, &
  0.1815836921166d-06, 0.4984507059020d+01, 0.6283075850446d+01, &
  0.1447461676364d-06, 0.3702753570108d+01, 0.9437762937313d+01, &
  0.1430760876382d-06, 0.3409658712357d+01, 0.1021328554739d+02 /
data ((e0(i,j,3),i=1,3),j= 11, 20) / &
  0.1120445753226d-06, 0.4829561570246d+01, 0.1414349524433d+02, &
  0.1090232840797d-06, 0.2080729178066d+01, 0.6812766822558d+01, &
  0.9715727346551d-07, 0.3476295881948d+01, 0.4694002934110d+01, &
  0.1036267136217d-06, 0.4056639536648d+01, 0.7109288135493d+02, &
  0.8752665271340d-07, 0.4448159519911d+01, 0.5753384878334d+01, &
  0.8331864956004d-07, 0.4991704044208d+01, 0.7084896783808d+01, &
  0.6901658670245d-07, 0.4325358994219d+01, 0.6275962395778d+01, &
  0.9144536848998d-07, 0.1141826375363d+01, 0.6620890113188d+01, &
  0.7205085037435d-07, 0.3624344170143d+01, 0.5296909721118d+00, &
  0.7697874654176d-07, 0.5554257458998d+01, 0.1676215758509d+03 /
data ((e0(i,j,3),i=1,3),j= 21, 30) / &
  0.5197545738384d-07, 0.6251760961735d+01, 0.1807370494127d+02, &
  0.5031345378608d-07, 0.2497341091913d+01, 0.4705732307012d+01, &
  0.4527110205840d-07, 0.2335079920992d+01, 0.6309374173736d+01, &
  0.4753355798089d-07, 0.7094148987474d+00, 0.5884926831456d+01, &
  0.4296951977516d-07, 0.1101916352091d+01, 0.6681224869435d+01, &
  0.3855341568387d-07, 0.1825495405486d+01, 0.5486777812467d+01, &
  0.5253930970990d-07, 0.4424740687208d+01, 0.7860419393880d+01, &
  0.4024630496471d-07, 0.5120498157053d+01, 0.1336797263425d+02, &
  0.4061069791453d-07, 0.6029771435451d+01, 0.3930209696940d+01, &
  0.3797883804205d-07, 0.4435193600836d+00, 0.3154687086868d+01 /
data ((e0(i,j,3),i=1,3),j= 31, 40) / &
  0.2933033225587d-07, 0.5124157356507d+01, 0.1059381944224d+01, &
  0.3503000930426d-07, 0.5421830162065d+01, 0.6069776770667d+01, &
  0.3670096214050d-07, 0.4582101667297d+01, 0.1219403291462d+02, &
  0.2905609437008d-07, 0.1926566420072d+01, 0.1097707878456d+02, &
  0.2466827821713d-07, 0.6090174539834d+00, 0.6496374930224d+01, &
  0.2691647295332d-07, 0.1393432595077d+01, 0.2200391463820d+02, &
  0.2150554667946d-07, 0.4308671715951d+01, 0.5643178611111d+01, &
  0.2237481922680d-07, 0.8133968269414d+00, 0.8635942003952d+01, &
  0.1817741038157d-07, 0.3755205127454d+01, 0.3340612434717d+01, &
  0.2227820762132d-07, 0.2759558596664d+01, 0.1203646072878d+02 /
data ((e0(i,j,3),i=1,3),j= 41, 50) / &
  0.1944713772307d-07, 0.5699645869121d+01, 0.1179062909082d+02, &
  0.1527340520662d-07, 0.1986749091746d+01, 0.3981490189893d+00, &
  0.1577282574914d-07, 0.3205017217983d+01, 0.5088628793478d+01, &
  0.1424738825424d-07, 0.6256747903666d+01, 0.2544314396739d+01, &
  0.1616563121701d-07, 0.2601671259394d+00, 0.1729818233119d+02, &
  0.1401210391692d-07, 0.4686939173506d+01, 0.7058598460518d+01, &
  0.1488726974214d-07, 0.2815862451372d+01, 0.2593412433514d+02, &
  0.1692626442388d-07, 0.4956894109797d+01, 0.1564752902480d+03, &
  0.1123571582910d-07, 0.2381192697696d+01, 0.3738761453707d+01, &
  0.9903308606317d-08, 0.4294851657684d+01, 0.9225539266174d+01 /
data ((e0(i,j,3),i=1,3),j= 51, 60) / &
  0.9174533187191d-08, 0.3075171510642d+01, 0.4164311961999d+01, &
  0.8645985631457d-08, 0.5477534821633d+00, 0.8429241228195d+01, &
 -0.1085876492688d-07, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.9264309077815d-08, 0.5968571670097d+01, 0.7079373888424d+01, &
  0.8243116984954d-08, 0.1489098777643d+01, 0.1044738781244d+02, &
  0.8268102113708d-08, 0.3512977691983d+01, 0.1150676975667d+02, &
  0.9043613988227d-08, 0.1290704408221d+00, 0.1101510648075d+02, &
  0.7432912038789d-08, 0.1991086893337d+01, 0.2608790314060d+02, &
  0.8586233727285d-08, 0.4238357924414d+01, 0.2986433403208d+02, &
  0.7612230060131d-08, 0.2911090150166d+01, 0.4732030630302d+01 /
data ((e0(i,j,3),i=1,3),j= 61, 70) / &
  0.7097787751408d-08, 0.1908938392390d+01, 0.8031092209206d+01, &
  0.7640237040175d-08, 0.6129219000168d+00, 0.7962980379786d+00, &
  0.7070445688081d-08, 0.1380417036651d+01, 0.2146165377750d+01, &
  0.7690770957702d-08, 0.1680504249084d+01, 0.2122839202813d+02, &
  0.8051292542594d-08, 0.5127423484511d+01, 0.2942463415728d+01, &
  0.5902709104515d-08, 0.2020274190917d+01, 0.7755226100720d+00, &
  0.5134567496462d-08, 0.2606778676418d+01, 0.1256615170089d+02, &
  0.5525802046102d-08, 0.1613011769663d+01, 0.8018209333619d+00, &
  0.5880724784221d-08, 0.4604483417236d+01, 0.4690479774488d+01, &
  0.5211699081370d-08, 0.5718964114193d+01, 0.8827390247185d+01 /
data ((e0(i,j,3),i=1,3),j= 71, 80) / &
  0.4891849573562d-08, 0.3689658932196d+01, 0.2132990797783d+00, &
  0.5150246069997d-08, 0.4099769855122d+01, 0.6480980550449d+02, &
  0.5102434319633d-08, 0.5660834602509d+01, 0.3379454372902d+02, &
  0.5083405254252d-08, 0.9842221218974d+00, 0.4136910472696d+01, &
  0.4206562585682d-08, 0.1341363634163d+00, 0.3128388763578d+01, &
  0.4663249683579d-08, 0.8130132735866d+00, 0.5216580451554d+01, &
  0.4099474416530d-08, 0.5791497770644d+01, 0.4265981595566d+00, &
  0.4628251220767d-08, 0.1249802769331d+01, 0.1572083878776d+02, &
  0.5024068728142d-08, 0.4795684802743d+01, 0.6290189305114d+01, &
  0.5120234327758d-08, 0.3810420387208d+01, 0.5230807360890d+01 /
data ((e0(i,j,3),i=1,3),j= 81, 90) / &
  0.5524029815280d-08, 0.1029264714351d+01, 0.2397622045175d+03, &
  0.4757415718860d-08, 0.3528044781779d+01, 0.1649636139783d+02, &
  0.3915786131127d-08, 0.5593889282646d+01, 0.1589072916335d+01, &
  0.4869053149991d-08, 0.3299636454433d+01, 0.7632943190217d+01, &
  0.3649365703729d-08, 0.1286049002584d+01, 0.6206810014183d+01, &
  0.3992493949002d-08, 0.3100307589464d+01, 0.2515860172507d+02, &
  0.3320247477418d-08, 0.6212683940807d+01, 0.1216800268190d+02, &
  0.3287123739696d-08, 0.4699118445928d+01, 0.7234794171227d+01, &
  0.3472776811103d-08, 0.2630507142004d+01, 0.7342457794669d+01, &
  0.3423253294767d-08, 0.2946432844305d+01, 0.9623688285163d+01 /
data ((e0(i,j,3),i=1,3),j= 91,100) / &
  0.3896173898244d-08, 0.1224834179264d+01, 0.6438496133249d+01, &
  0.3388455337924d-08, 0.1543807616351d+01, 0.1494531617769d+02, &
  0.3062704716523d-08, 0.1191777572310d+01, 0.8662240327241d+01, &
  0.3270075600400d-08, 0.5483498767737d+01, 0.1194447056968d+01, &
  0.3101209215259d-08, 0.8000833804348d+00, 0.3772475342596d+02, &
  0.2780883347311d-08, 0.4077980721888d+00, 0.5863591145557d+01, &
  0.2903605931824d-08, 0.2617490302147d+01, 0.1965104848470d+02, &
  0.2682014743119d-08, 0.2634703158290d+01, 0.7238675589263d+01, &
  0.2534360108492d-08, 0.6102446114873d+01, 0.6836645152238d+01, &
  0.2392564882509d-08, 0.3681820208691d+01, 0.5849364236221d+01 /
data ((e0(i,j,3),i=1,3),j=101,110) / &
  0.2656667254856d-08, 0.6216045388886d+01, 0.6133512519065d+01, &
  0.2331242096773d-08, 0.5864949777744d+01, 0.4535059491685d+01, &
  0.2287898363668d-08, 0.4566628532802d+01, 0.7477522907414d+01, &
  0.2336944521306d-08, 0.2442722126930d+01, 0.1137170464392d+02, &
  0.3156632236269d-08, 0.1626628050682d+01, 0.2509084901204d+03, &
  0.2982612402766d-08, 0.2803604512609d+01, 0.1748016358760d+01, &
  0.2774031674807d-08, 0.4654002897158d+01, 0.8223916695780d+02, &
  0.2295236548638d-08, 0.4326518333253d+01, 0.3378142627421d+00, &
  0.2190714699873d-08, 0.4519614578328d+01, 0.2908881142201d+02, &
  0.2191495845045d-08, 0.3012626912549d+01, 0.1673046366289d+02 /
data ((e0(i,j,3),i=1,3),j=111,120) / &
  0.2492901628386d-08, 0.1290101424052d+00, 0.1543797956245d+03, &
  0.1993778064319d-08, 0.3864046799414d+01, 0.1778984560711d+02, &
  0.1898146479022d-08, 0.5053777235891d+01, 0.2042657109477d+02, &
  0.1918280127634d-08, 0.2222470192548d+01, 0.4165496312290d+02, &
  0.1916351061607d-08, 0.8719067257774d+00, 0.7737595720538d+02, &
  0.1834720181466d-08, 0.4031491098040d+01, 0.2358125818164d+02, &
  0.1249201523806d-08, 0.5938379466835d+01, 0.3301902111895d+02, &
  0.1477304050539d-08, 0.6544722606797d+00, 0.9548094718417d+02, &
  0.1264316431249d-08, 0.2059072853236d+01, 0.8399684731857d+02, &
  0.1203526495039d-08, 0.3644813532605d+01, 0.4558517281984d+02 /
data ((e0(i,j,3),i=1,3),j=121,130) / &
  0.9221681059831d-09, 0.3241815055602d+01, 0.7805158573086d+02, &
  0.7849278367646d-09, 0.5043812342457d+01, 0.5217580628120d+02, &
  0.7983392077387d-09, 0.5000024502753d+01, 0.1501922143975d+03, &
  0.7925395431654d-09, 0.1398734871821d-01, 0.9061773743175d+02, &
  0.7640473285886d-09, 0.5067111723130d+01, 0.4951538251678d+02, &
  0.5398937754482d-09, 0.5597382200075d+01, 0.1613385000004d+03, &
  0.5626247550193d-09, 0.2601338209422d+01, 0.7318837597844d+02, &
  0.5525197197855d-09, 0.5814832109256d+01, 0.1432335100216d+03, &
  0.5407629837898d-09, 0.3384820609076d+01, 0.3230491187871d+03, &
  0.3856739119801d-09, 0.1072391840473d+01, 0.2334791286671d+03 /
data ((e0(i,j,3),i=1,3),j=131,ne0z) / &
  0.3856425239987d-09, 0.2369540393327d+01, 0.1739046517013d+03, &
  0.4350867755983d-09, 0.5255575751082d+01, 0.1620484330494d+03, &
  0.3844113924996d-09, 0.5482356246182d+01, 0.9757644180768d+02, &
  0.2854869155431d-09, 0.9573634763143d+00, 0.1697170704744d+03, &
  0.1719227671416d-09, 0.1887203025202d+01, 0.2265204242912d+03, &
  0.1527846879755d-09, 0.3982183931157d+01, 0.3341954043900d+03, &
  0.1128229264847d-09, 0.2787457156298d+01, 0.3119028331842d+03 /

!  Sun-to-Earth, T^1, Z
data ((e1(i,j,3),i=1,3),j=  1, 10) / &
  0.2278290449966d-05, 0.3413716033863d+01, 0.6283075850446d+01, &
  0.5429458209830d-07, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.1903240492525d-07, 0.3370592358297d+01, 0.1256615170089d+02, &
  0.2385409276743d-09, 0.3327914718416d+01, 0.1884922755134d+02, &
  0.8676928342573d-10, 0.1824006811264d+01, 0.5223693906222d+01, &
  0.7765442593544d-10, 0.3888564279247d+01, 0.5507553240374d+01, &
  0.7066158332715d-10, 0.5194267231944d+01, 0.2352866153506d+01, &
  0.7092175288657d-10, 0.2333246960021d+01, 0.8399684731857d+02, &
  0.5357582213535d-10, 0.2224031176619d+01, 0.5296909721118d+00, &
  0.3828035865021d-10, 0.2156710933584d+01, 0.6279552690824d+01 /
data ((e1(i,j,3),i=1,3),j= 11,ne1z) / &
  0.3824857220427d-10, 0.1529755219915d+01, 0.6286599010068d+01, &
  0.3286995181628d-10, 0.4879512900483d+01, 0.1021328554739d+02 /

!  Sun-to-Earth, T^2, Z
data ((e2(i,j,3),i=1,3),j=  1,ne2z) / &
  0.9722666114891d-10, 0.5152219582658d+01, 0.6283075850446d+01, &
 -0.3494819171909d-11, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.6713034376076d-12, 0.6440188750495d+00, 0.1256615170089d+02 /

!  SSB-to-Sun, T^0, X
data ((s0(i,j,1),i=1,3),j=  1, 10) / &
  0.4956757536410d-02, 0.3741073751789d+01, 0.5296909721118d+00, &
  0.2718490072522d-02, 0.4016011511425d+01, 0.2132990797783d+00, &
  0.1546493974344d-02, 0.2170528330642d+01, 0.3813291813120d-01, &
  0.8366855276341d-03, 0.2339614075294d+01, 0.7478166569050d-01, &
  0.2936777942117d-03, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.1201317439469d-03, 0.4090736353305d+01, 0.1059381944224d+01, &
  0.7578550887230d-04, 0.3241518088140d+01, 0.4265981595566d+00, &
  0.1941787367773d-04, 0.1012202064330d+01, 0.2061856251104d+00, &
  0.1889227765991d-04, 0.3892520416440d+01, 0.2204125344462d+00, &
  0.1937896968613d-04, 0.4797779441161d+01, 0.1495633313810d+00 /
data ((s0(i,j,1),i=1,3),j= 11, 20) / &
  0.1434506110873d-04, 0.3868960697933d+01, 0.5225775174439d+00, &
  0.1406659911580d-04, 0.4759766557397d+00, 0.5368044267797d+00, &
  0.1179022300202d-04, 0.7774961520598d+00, 0.7626583626240d-01, &
  0.8085864460959d-05, 0.3254654471465d+01, 0.3664874755930d-01, &
  0.7622752967615d-05, 0.4227633103489d+01, 0.3961708870310d-01, &
  0.6209171139066d-05, 0.2791828325711d+00, 0.7329749511860d-01, &
  0.4366435633970d-05, 0.4440454875925d+01, 0.1589072916335d+01, &
  0.3792124889348d-05, 0.5156393842356d+01, 0.7113454667900d-02, &
  0.3154548963402d-05, 0.6157005730093d+01, 0.4194847048887d+00, &
  0.3088359882942d-05, 0.2494567553163d+01, 0.6398972393349d+00 /
data ((s0(i,j,1),i=1,3),j= 21, 30) / &
  0.2788440902136d-05, 0.4934318747989d+01, 0.1102062672231d+00, &
  0.3039928456376d-05, 0.4895077702640d+01, 0.6283075850446d+01, &
  0.2272258457679d-05, 0.5278394064764d+01, 0.1030928125552d+00, &
  0.2162007057957d-05, 0.5802978019099d+01, 0.3163918923335d+00, &
  0.1767632855737d-05, 0.3415346595193d-01, 0.1021328554739d+02, &
  0.1349413459362d-05, 0.2001643230755d+01, 0.1484170571900d-02, &
  0.1170141900476d-05, 0.2424750491620d+01, 0.6327837846670d+00, &
  0.1054355266820d-05, 0.3123311487576d+01, 0.4337116142245d+00, &
  0.9800822461610d-06, 0.3026258088130d+01, 0.1052268489556d+01, &
  0.1091203749931d-05, 0.3157811670347d+01, 0.1162474756779d+01 /
data ((s0(i,j,1),i=1,3),j= 31, 40) / &
  0.6960236715913d-06, 0.8219570542313d+00, 0.1066495398892d+01, &
  0.5689257296909d-06, 0.1323052375236d+01, 0.9491756770005d+00, &
  0.6613172135802d-06, 0.2765348881598d+00, 0.8460828644453d+00, &
  0.6277702517571d-06, 0.5794064466382d+01, 0.1480791608091d+00, &
  0.6304884066699d-06, 0.7323555380787d+00, 0.2243449970715d+00, &
  0.4897850467382d-06, 0.3062464235399d+01, 0.3340612434717d+01, &
  0.3759148598786d-06, 0.4588290469664d+01, 0.3516457698740d-01, &
  0.3110520548195d-06, 0.1374299536572d+01, 0.6373574839730d-01, &
  0.3064708359780d-06, 0.4222267485047d+01, 0.1104591729320d-01, &
  0.2856347168241d-06, 0.3714202944973d+01, 0.1510475019529d+00 /
data ((s0(i,j,1),i=1,3),j= 41, 50) / &
  0.2840945514288d-06, 0.2847972875882d+01, 0.4110125927500d-01, &
  0.2378951599405d-06, 0.3762072563388d+01, 0.2275259891141d+00, &
  0.2714229481417d-06, 0.1036049980031d+01, 0.2535050500000d-01, &
  0.2323551717307d-06, 0.4682388599076d+00, 0.8582758298370d-01, &
  0.1881790512219d-06, 0.4790565425418d+01, 0.2118763888447d+01, &
  0.2261353968371d-06, 0.1669144912212d+01, 0.7181332454670d-01, &
  0.2214546389848d-06, 0.3937717281614d+01, 0.2968341143800d-02, &
  0.2184915594933d-06, 0.1129169845099d+00, 0.7775000683430d-01, &
  0.2000164937936d-06, 0.4030009638488d+01, 0.2093666171530d+00, &
  0.1966105136719d-06, 0.8745955786834d+00, 0.2172315424036d+00 /
data ((s0(i,j,1),i=1,3),j= 51, 60) / &
  0.1904742332624d-06, 0.5919743598964d+01, 0.2022531624851d+00, &
  0.1657399705031d-06, 0.2549141484884d+01, 0.7358765972222d+00, &
  0.1574070533987d-06, 0.5277533020230d+01, 0.7429900518901d+00, &
  0.1832261651039d-06, 0.3064688127777d+01, 0.3235053470014d+00, &
  0.1733615346569d-06, 0.3011432799094d+01, 0.1385174140878d+00, &
  0.1549124014496d-06, 0.4005569132359d+01, 0.5154640627760d+00, &
  0.1637044713838d-06, 0.1831375966632d+01, 0.8531963191132d+00, &
  0.1123420082383d-06, 0.1180270407578d+01, 0.1990721704425d+00, &
  0.1083754165740d-06, 0.3414101320863d+00, 0.5439178814476d+00, &
  0.1156638012655d-06, 0.6130479452594d+00, 0.5257585094865d+00 /
data ((s0(i,j,1),i=1,3),j= 61, 70) / &
  0.1142548785134d-06, 0.3724761948846d+01, 0.5336234347371d+00, &
  0.7921463895965d-07, 0.2435425589361d+01, 0.1478866649112d+01, &
  0.7428600285231d-07, 0.3542144398753d+01, 0.2164800718209d+00, &
  0.8323211246747d-07, 0.3525058072354d+01, 0.1692165728891d+01, &
  0.7257595116312d-07, 0.1364299431982d+01, 0.2101180877357d+00, &
  0.7111185833236d-07, 0.2460478875808d+01, 0.4155522422634d+00, &
  0.6868090383716d-07, 0.4397327670704d+01, 0.1173197218910d+00, &
  0.7226419974175d-07, 0.4042647308905d+01, 0.1265567569334d+01, &
  0.6955642383177d-07, 0.2865047906085d+01, 0.9562891316684d+00, &
  0.7492139296331d-07, 0.5014278994215d+01, 0.1422690933580d-01 /
data ((s0(i,j,1),i=1,3),j= 71, 80) / &
  0.6598363128857d-07, 0.2376730020492d+01, 0.6470106940028d+00, &
  0.7381147293385d-07, 0.3272990384244d+01, 0.1581959461667d+01, &
  0.6402909624032d-07, 0.5302290955138d+01, 0.9597935788730d-01, &
  0.6237454263857d-07, 0.5444144425332d+01, 0.7084920306520d-01, &
  0.5241198544016d-07, 0.4215359579205d+01, 0.5265099800692d+00, &
  0.5144463853918d-07, 0.1218916689916d+00, 0.5328719641544d+00, &
  0.5868164772299d-07, 0.2369402002213d+01, 0.7871412831580d-01, &
  0.6233195669151d-07, 0.1254922242403d+01, 0.2608790314060d+02, &
  0.6068463791422d-07, 0.5679713760431d+01, 0.1114304132498d+00, &
  0.4359361135065d-07, 0.6097219641646d+00, 0.1375773836557d+01 /
data ((s0(i,j,1),i=1,3),j= 81, 90) / &
  0.4686510366826d-07, 0.4786231041431d+01, 0.1143987543936d+00, &
  0.3758977287225d-07, 0.1167368068139d+01, 0.1596186371003d+01, &
  0.4282051974778d-07, 0.1519471064319d+01, 0.2770348281756d+00, &
  0.5153765386113d-07, 0.1860532322984d+01, 0.2228608264996d+00, &
  0.4575129387188d-07, 0.7632857887158d+00, 0.1465949902372d+00, &
  0.3326844933286d-07, 0.1298219485285d+01, 0.5070101000000d-01, &
  0.3748617450984d-07, 0.1046510321062d+01, 0.4903339079539d+00, &
  0.2816756661499d-07, 0.3434522346190d+01, 0.2991266627620d+00, &
  0.3412750405039d-07, 0.2523766270318d+01, 0.3518164938661d+00, &
  0.2655796761776d-07, 0.2904422260194d+01, 0.6256703299991d+00 /
data ((s0(i,j,1),i=1,3),j= 91,100) / &
  0.2963597929458d-07, 0.5923900431149d+00, 0.1099462426779d+00, &
  0.2539523734781d-07, 0.4851947722567d+01, 0.1256615170089d+02, &
  0.2283087914139d-07, 0.3400498595496d+01, 0.6681224869435d+01, &
  0.2321309799331d-07, 0.5789099148673d+01, 0.3368040641550d-01, &
  0.2549657649750d-07, 0.3991856479792d-01, 0.1169588211447d+01, &
  0.2290462303977d-07, 0.2788567577052d+01, 0.1045155034888d+01, &
  0.1945398522914d-07, 0.3290896998176d+01, 0.1155361302111d+01, &
  0.1849171512638d-07, 0.2698060129367d+01, 0.4452511715700d-02, &
  0.1647199834254d-07, 0.3016735644085d+01, 0.4408250688924d+00, &
  0.1529530765273d-07, 0.5573043116178d+01, 0.6521991896920d-01 /
data ((s0(i,j,1),i=1,3),j=101,110) / &
  0.1433199339978d-07, 0.1481192356147d+01, 0.9420622223326d+00, &
  0.1729134193602d-07, 0.1422817538933d+01, 0.2108507877249d+00, &
  0.1716463931346d-07, 0.3469468901855d+01, 0.2157473718317d+00, &
  0.1391206061378d-07, 0.6122436220547d+01, 0.4123712502208d+00, &
  0.1404746661924d-07, 0.1647765641936d+01, 0.4258542984690d-01, &
  0.1410452399455d-07, 0.5989729161964d+01, 0.2258291676434d+00, &
  0.1089828772168d-07, 0.2833705509371d+01, 0.4226656969313d+00, &
  0.1047374564948d-07, 0.5090690007331d+00, 0.3092784376656d+00, &
  0.1358279126532d-07, 0.5128990262836d+01, 0.7923417740620d-01, &
  0.1020456476148d-07, 0.9632772880808d+00, 0.1456308687557d+00 /
data ((s0(i,j,1),i=1,3),j=111,120) / &
  0.1033428735328d-07, 0.3223779318418d+01, 0.1795258541446d+01, &
  0.1412435841540d-07, 0.2410271572721d+01, 0.1525316725248d+00, &
  0.9722759371574d-08, 0.2333531395690d+01, 0.8434341241180d-01, &
  0.9657334084704d-08, 0.6199270974168d+01, 0.1272681024002d+01, &
  0.1083641148690d-07, 0.2864222292929d+01, 0.7032915397480d-01, &
  0.1067318403838d-07, 0.5833458866568d+00, 0.2123349582968d+00, &
  0.1062366201976d-07, 0.4307753989494d+01, 0.2142632012598d+00, &
  0.1236364149266d-07, 0.2873917870593d+01, 0.1847279083684d+00, &
  0.1092759489593d-07, 0.2959887266733d+01, 0.1370332435159d+00, &
  0.8912069362899d-08, 0.5141213702562d+01, 0.2648454860559d+01 /
data ((s0(i,j,1),i=1,3),j=121,130) / &
  0.9656467707970d-08, 0.4532182462323d+01, 0.4376440768498d+00, &
  0.8098386150135d-08, 0.2268906338379d+01, 0.2880807454688d+00, &
  0.7857714675000d-08, 0.4055544260745d+01, 0.2037373330570d+00, &
  0.7288455940646d-08, 0.5357901655142d+01, 0.1129145838217d+00, &
  0.9450595950552d-08, 0.4264926963939d+01, 0.5272426800584d+00, &
  0.9381718247537d-08, 0.7489366976576d-01, 0.5321392641652d+00, &
  0.7079052646038d-08, 0.1923311052874d+01, 0.6288513220417d+00, &
  0.9259004415344d-08, 0.2970256853438d+01, 0.1606092486742d+00, &
  0.8259801499742d-08, 0.3327056314697d+01, 0.8389694097774d+00, &
  0.6476334355779d-08, 0.2954925505727d+01, 0.2008557621224d+01 /
data ((s0(i,j,1),i=1,3),j=131,140) / &
  0.5984021492007d-08, 0.9138753105829d+00, 0.2042657109477d+02, &
  0.5989546863181d-08, 0.3244464082031d+01, 0.2111650433779d+01, &
  0.6233108606023d-08, 0.4995232638403d+00, 0.4305306221819d+00, &
  0.6877299149965d-08, 0.2834987233449d+01, 0.9561746721300d-02, &
  0.8311234227190d-08, 0.2202951835758d+01, 0.3801276407308d+00, &
  0.6599472832414d-08, 0.4478581462618d+01, 0.1063314406849d+01, &
  0.6160491096549d-08, 0.5145858696411d+01, 0.1368660381889d+01, &
  0.6164772043891d-08, 0.3762976697911d+00, 0.4234171675140d+00, &
  0.6363248684450d-08, 0.3162246718685d+01, 0.1253008786510d-01, &
  0.6448587520999d-08, 0.3442693302119d+01, 0.5287268506303d+00 /
data ((s0(i,j,1),i=1,3),j=141,150) / &
  0.6431662283977d-08, 0.8977549136606d+00, 0.5306550935933d+00, &
  0.6351223158474d-08, 0.4306447410369d+01, 0.5217580628120d+02, &
  0.5476721393451d-08, 0.3888529177855d+01, 0.2221856701002d+01, &
  0.5341772572619d-08, 0.2655560662512d+01, 0.7466759693650d-01, &
  0.5337055758302d-08, 0.5164990735946d+01, 0.7489573444450d-01, &
  0.5373120816787d-08, 0.6041214553456d+01, 0.1274714967946d+00, &
  0.5392351705426d-08, 0.9177763485932d+00, 0.1055449481598d+01, &
  0.6688495850205d-08, 0.3089608126937d+01, 0.2213766559277d+00, &
  0.5072003660362d-08, 0.4311316541553d+01, 0.2132517061319d+00, &
  0.5070726650455d-08, 0.5790675464444d+00, 0.2133464534247d+00 /
data ((s0(i,j,1),i=1,3),j=151,160) / &
  0.5658012950032d-08, 0.2703945510675d+01, 0.7287631425543d+00, &
  0.4835509924854d-08, 0.2975422976065d+01, 0.7160067364790d-01, &
  0.6479821978012d-08, 0.1324168733114d+01, 0.2209183458640d-01, &
  0.6230636494980d-08, 0.2860103632836d+01, 0.3306188016693d+00, &
  0.4649239516213d-08, 0.4832259763403d+01, 0.7796265773310d-01, &
  0.6487325792700d-08, 0.2726165825042d+01, 0.3884652414254d+00, &
  0.4682823682770d-08, 0.6966602455408d+00, 0.1073608853559d+01, &
  0.5704230804976d-08, 0.5669634104606d+01, 0.8731175355560d-01, &
  0.6125413585489d-08, 0.1513386538915d+01, 0.7605151500000d-01, &
  0.6035825038187d-08, 0.1983509168227d+01, 0.9846002785331d+00 /
data ((s0(i,j,1),i=1,3),j=161,170) / &
  0.4331123462303d-08, 0.2782892992807d+01, 0.4297791515992d+00, &
  0.4681107685143d-08, 0.5337232886836d+01, 0.2127790306879d+00, &
  0.4669105829655d-08, 0.5837133792160d+01, 0.2138191288687d+00, &
  0.5138823602365d-08, 0.3080560200507d+01, 0.7233337363710d-01, &
  0.4615856664534d-08, 0.1661747897471d+01, 0.8603097737811d+00, &
  0.4496916702197d-08, 0.2112508027068d+01, 0.7381754420900d-01, &
  0.4278479042945d-08, 0.5716528462627d+01, 0.7574578717200d-01, &
  0.3840525503932d-08, 0.6424172726492d+00, 0.3407705765729d+00, &
  0.4866636509685d-08, 0.4919244697715d+01, 0.7722995774390d-01, &
  0.3526100639296d-08, 0.2550821052734d+01, 0.6225157782540d-01 /
data ((s0(i,j,1),i=1,3),j=171,180) / &
  0.3939558488075d-08, 0.3939331491710d+01, 0.5268983110410d-01, &
  0.4041268772576d-08, 0.2275337571218d+01, 0.3503323232942d+00, &
  0.3948761842853d-08, 0.1999324200790d+01, 0.1451108196653d+00, &
  0.3258394550029d-08, 0.9121001378200d+00, 0.5296435984654d+00, &
  0.3257897048761d-08, 0.3428428660869d+01, 0.5297383457582d+00, &
  0.3842559031298d-08, 0.6132927720035d+01, 0.9098186128426d+00, &
  0.3109920095448d-08, 0.7693650193003d+00, 0.3932462625300d-02, &
  0.3132237775119d-08, 0.3621293854908d+01, 0.2346394437820d+00, &
  0.3942189421510d-08, 0.4841863659733d+01, 0.3180992042600d-02, &
  0.3796972285340d-08, 0.1814174994268d+01, 0.1862120789403d+00 /
data ((s0(i,j,1),i=1,3),j=181,190) / &
  0.3995640233688d-08, 0.1386990406091d+01, 0.4549093064213d+00, &
  0.2875013727414d-08, 0.9178318587177d+00, 0.1905464808669d+01, &
  0.3073719932844d-08, 0.2688923811835d+01, 0.3628624111593d+00, &
  0.2731016580075d-08, 0.1188259127584d+01, 0.2131850110243d+00, &
  0.2729549896546d-08, 0.3702160634273d+01, 0.2134131485323d+00, &
  0.3339372892449d-08, 0.7199163960331d+00, 0.2007689919132d+00, &
  0.2898833764204d-08, 0.1916709364999d+01, 0.5291709230214d+00, &
  0.2894536549362d-08, 0.2424043195547d+01, 0.5302110212022d+00, &
  0.3096872473843d-08, 0.4445894977497d+01, 0.2976424921901d+00, &
  0.2635672326810d-08, 0.3814366984117d+01, 0.1485980103780d+01 /
data ((s0(i,j,1),i=1,3),j=191,200) / &
  0.3649302697001d-08, 0.2924200596084d+01, 0.6044726378023d+00, &
  0.3127954585895d-08, 0.1842251648327d+01, 0.1084620721060d+00, &
  0.2616040173947d-08, 0.4155841921984d+01, 0.1258454114666d+01, &
  0.2597395859860d-08, 0.1158045978874d+00, 0.2103781122809d+00, &
  0.2593286172210d-08, 0.4771850408691d+01, 0.2162200472757d+00, &
  0.2481823585747d-08, 0.4608842558889d+00, 0.1062562936266d+01, &
  0.2742219550725d-08, 0.1538781127028d+01, 0.5651155736444d+00, &
  0.3199558469610d-08, 0.3226647822878d+00, 0.7036329877322d+00, &
  0.2666088542957d-08, 0.1967991731219d+00, 0.1400015846597d+00, &
  0.2397067430580d-08, 0.3707036669873d+01, 0.2125476091956d+00 /
data ((s0(i,j,1),i=1,3),j=201,210) / &
  0.2376570772738d-08, 0.1182086628042d+01, 0.2140505503610d+00, &
  0.2547228007887d-08, 0.4906256820629d+01, 0.1534957940063d+00, &
  0.2265575594114d-08, 0.3414949866857d+01, 0.2235935264888d+00, &
  0.2464381430585d-08, 0.4599122275378d+01, 0.2091065926078d+00, &
  0.2433408527044d-08, 0.2830751145445d+00, 0.2174915669488d+00, &
  0.2443605509076d-08, 0.4212046432538d+01, 0.1739420156204d+00, &
  0.2319779262465d-08, 0.9881978408630d+00, 0.7530171478090d-01, &
  0.2284622835465d-08, 0.5565347331588d+00, 0.7426161660010d-01, &
  0.2467268750783d-08, 0.5655708150766d+00, 0.2526561439362d+00, &
  0.2808513492782d-08, 0.1418405053408d+01, 0.5636314030725d+00 /
data ((s0(i,j,1),i=1,3),j=211,ns0x) / &
  0.2329528932532d-08, 0.4069557545675d+01, 0.1056200952181d+01, &
  0.9698639532817d-09, 0.1074134313634d+01, 0.7826370942180d+02 /

!  SSB-to-Sun, T^1, X
data ((s1(i,j,1),i=1,3),j=  1, 10) / &
 -0.1296310361520d-07, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.8975769009438d-08, 0.1128891609250d+01, 0.4265981595566d+00, &
  0.7771113441307d-08, 0.2706039877077d+01, 0.2061856251104d+00, &
  0.7538303866642d-08, 0.2191281289498d+01, 0.2204125344462d+00, &
  0.6061384579336d-08, 0.3248167319958d+01, 0.1059381944224d+01, &
  0.5726994235594d-08, 0.5569981398610d+01, 0.5225775174439d+00, &
  0.5616492836424d-08, 0.5057386614909d+01, 0.5368044267797d+00, &
  0.1010881584769d-08, 0.3473577116095d+01, 0.7113454667900d-02, &
  0.7259606157626d-09, 0.3651858593665d+00, 0.6398972393349d+00, &
  0.8755095026935d-09, 0.1662835408338d+01, 0.4194847048887d+00 /
data ((s1(i,j,1),i=1,3),j= 11, 20) / &
  0.5370491182812d-09, 0.1327673878077d+01, 0.4337116142245d+00, &
  0.5743773887665d-09, 0.4250200846687d+01, 0.2132990797783d+00, &
  0.4408103140300d-09, 0.3598752574277d+01, 0.1589072916335d+01, &
  0.3101892374445d-09, 0.4887822983319d+01, 0.1052268489556d+01, &
  0.3209453713578d-09, 0.9702272295114d+00, 0.5296909721118d+00, &
  0.3017228286064d-09, 0.5484462275949d+01, 0.1066495398892d+01, &
  0.3200700038601d-09, 0.2846613338643d+01, 0.1495633313810d+00, &
  0.2137637279911d-09, 0.5692163292729d+00, 0.3163918923335d+00, &
  0.1899686386727d-09, 0.2061077157189d+01, 0.2275259891141d+00, &
  0.1401994545308d-09, 0.4177771136967d+01, 0.1102062672231d+00 /
data ((s1(i,j,1),i=1,3),j= 21, 30) / &
  0.1578057810499d-09, 0.5782460597335d+01, 0.7626583626240d-01, &
  0.1237713253351d-09, 0.5705900866881d+01, 0.5154640627760d+00, &
  0.1313076837395d-09, 0.5163438179576d+01, 0.3664874755930d-01, &
  0.1184963304860d-09, 0.3054804427242d+01, 0.6327837846670d+00, &
  0.1238130878565d-09, 0.2317292575962d+01, 0.3961708870310d-01, &
  0.1015959527736d-09, 0.2194643645526d+01, 0.7329749511860d-01, &
  0.9017954423714d-10, 0.2868603545435d+01, 0.1990721704425d+00, &
  0.8668024955603d-10, 0.4923849675082d+01, 0.5439178814476d+00, &
  0.7756083930103d-10, 0.3014334135200d+01, 0.9491756770005d+00, &
  0.7536503401741d-10, 0.2704886279769d+01, 0.1030928125552d+00 /
data ((s1(i,j,1),i=1,3),j= 31, 40) / &
  0.5483308679332d-10, 0.6010983673799d+01, 0.8531963191132d+00, &
  0.5184339620428d-10, 0.1952704573291d+01, 0.2093666171530d+00, &
  0.5108658712030d-10, 0.2958575786649d+01, 0.2172315424036d+00, &
  0.5019424524650d-10, 0.1736317621318d+01, 0.2164800718209d+00, &
  0.4909312625978d-10, 0.3167216416257d+01, 0.2101180877357d+00, &
  0.4456638901107d-10, 0.7697579923471d+00, 0.3235053470014d+00, &
  0.4227030350925d-10, 0.3490910137928d+01, 0.6373574839730d-01, &
  0.4095456040093d-10, 0.5178888984491d+00, 0.6470106940028d+00, &
  0.4990537041422d-10, 0.3323887668974d+01, 0.1422690933580d-01, &
  0.4321170010845d-10, 0.4288484987118d+01, 0.7358765972222d+00 /
data ((s1(i,j,1),i=1,3),j= 41,ns1x) / &
  0.3544072091802d-10, 0.6021051579251d+01, 0.5265099800692d+00, &
  0.3480198638687d-10, 0.4600027054714d+01, 0.5328719641544d+00, &
  0.3440287244435d-10, 0.4349525970742d+01, 0.8582758298370d-01, &
  0.3330628322713d-10, 0.2347391505082d+01, 0.1104591729320d-01, &
  0.2973060707184d-10, 0.4789409286400d+01, 0.5257585094865d+00, &
  0.2932606766089d-10, 0.5831693799927d+01, 0.5336234347371d+00, &
  0.2876972310953d-10, 0.2692638514771d+01, 0.1173197218910d+00, &
  0.2827488278556d-10, 0.2056052487960d+01, 0.2022531624851d+00, &
  0.2515028239756d-10, 0.7411863262449d+00, 0.9597935788730d-01, &
  0.2853033744415d-10, 0.3948481024894d+01, 0.2118763888447d+01 /

!  SSB-to-Sun, T^2, X
data ((s2(i,j,1),i=1,3),j=  1,ns2x) / &
  0.1603551636587d-11, 0.4404109410481d+01, 0.2061856251104d+00, &
  0.1556935889384d-11, 0.4818040873603d+00, 0.2204125344462d+00, &
  0.1182594414915d-11, 0.9935762734472d+00, 0.5225775174439d+00, &
  0.1158794583180d-11, 0.3353180966450d+01, 0.5368044267797d+00, &
  0.9597358943932d-12, 0.5567045358298d+01, 0.2132990797783d+00, &
  0.6511516579605d-12, 0.5630872420788d+01, 0.4265981595566d+00, &
  0.7419792747688d-12, 0.2156188581957d+01, 0.5296909721118d+00, &
  0.3951972655848d-12, 0.1981022541805d+01, 0.1059381944224d+01, &
  0.4478223877045d-12, 0.0000000000000d+00, 0.0000000000000d+00 /

!  SSB-to-Sun, T^0, Y
data ((s0(i,j,2),i=1,3),j=  1, 10) / &
  0.4955392320126d-02, 0.2170467313679d+01, 0.5296909721118d+00, &
  0.2722325167392d-02, 0.2444433682196d+01, 0.2132990797783d+00, &
  0.1546579925346d-02, 0.5992779281546d+00, 0.3813291813120d-01, &
  0.8363140252966d-03, 0.7687356310801d+00, 0.7478166569050d-01, &
  0.3385792683603d-03, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.1201192221613d-03, 0.2520035601514d+01, 0.1059381944224d+01, &
  0.7587125720554d-04, 0.1669954006449d+01, 0.4265981595566d+00, &
  0.1964155361250d-04, 0.5707743963343d+01, 0.2061856251104d+00, &
  0.1891900364909d-04, 0.2320960679937d+01, 0.2204125344462d+00, &
  0.1937373433356d-04, 0.3226940689555d+01, 0.1495633313810d+00 /
data ((s0(i,j,2),i=1,3),j= 11, 20) / &
  0.1437139941351d-04, 0.2301626908096d+01, 0.5225775174439d+00, &
  0.1406267683099d-04, 0.5188579265542d+01, 0.5368044267797d+00, &
  0.1178703080346d-04, 0.5489483248476d+01, 0.7626583626240d-01, &
  0.8079835186041d-05, 0.1683751835264d+01, 0.3664874755930d-01, &
  0.7623253594652d-05, 0.2656400462961d+01, 0.3961708870310d-01, &
  0.6248667483971d-05, 0.4992775362055d+01, 0.7329749511860d-01, &
  0.4366353695038d-05, 0.2869706279678d+01, 0.1589072916335d+01, &
  0.3829101568895d-05, 0.3572131359950d+01, 0.7113454667900d-02, &
  0.3175733773908d-05, 0.4535372530045d+01, 0.4194847048887d+00, &
  0.3092437902159d-05, 0.9230153317909d+00, 0.6398972393349d+00 /
data ((s0(i,j,2),i=1,3),j= 21, 30) / &
  0.2874168812154d-05, 0.3363143761101d+01, 0.1102062672231d+00, &
  0.3040119321826d-05, 0.3324250895675d+01, 0.6283075850446d+01, &
  0.2699723308006d-05, 0.2917882441928d+00, 0.1030928125552d+00, &
  0.2134832683534d-05, 0.4220997202487d+01, 0.3163918923335d+00, &
  0.1770412139433d-05, 0.4747318496462d+01, 0.1021328554739d+02, &
  0.1377264209373d-05, 0.4305058462401d+00, 0.1484170571900d-02, &
  0.1127814538960d-05, 0.8538177240740d+00, 0.6327837846670d+00, &
  0.1055608090130d-05, 0.1551800742580d+01, 0.4337116142245d+00, &
  0.9802673861420d-06, 0.1459646735377d+01, 0.1052268489556d+01, &
  0.1090329461951d-05, 0.1587351228711d+01, 0.1162474756779d+01 /
data ((s0(i,j,2),i=1,3),j= 31, 40) / &
  0.6959590025090d-06, 0.5534442628766d+01, 0.1066495398892d+01, &
  0.5664914529542d-06, 0.6030673003297d+01, 0.9491756770005d+00, &
  0.6607787763599d-06, 0.4989507233927d+01, 0.8460828644453d+00, &
  0.6269725742838d-06, 0.4222951804572d+01, 0.1480791608091d+00, &
  0.6301889697863d-06, 0.5444316669126d+01, 0.2243449970715d+00, &
  0.4891042662861d-06, 0.1490552839784d+01, 0.3340612434717d+01, &
  0.3457083123290d-06, 0.3030475486049d+01, 0.3516457698740d-01, &
  0.3032559967314d-06, 0.2652038793632d+01, 0.1104591729320d-01, &
  0.2841133988903d-06, 0.1276744786829d+01, 0.4110125927500d-01, &
  0.2855564444432d-06, 0.2143368674733d+01, 0.1510475019529d+00 /
data ((s0(i,j,2),i=1,3),j= 41, 50) / &
  0.2765157135038d-06, 0.5444186109077d+01, 0.6373574839730d-01, &
  0.2382312465034d-06, 0.2190521137593d+01, 0.2275259891141d+00, &
  0.2808060365077d-06, 0.5735195064841d+01, 0.2535050500000d-01, &
  0.2332175234405d-06, 0.9481985524859d-01, 0.7181332454670d-01, &
  0.2322488199659d-06, 0.5180499361533d+01, 0.8582758298370d-01, &
  0.1881850258423d-06, 0.3219788273885d+01, 0.2118763888447d+01, &
  0.2196111392808d-06, 0.2366941159761d+01, 0.2968341143800d-02, &
  0.2183810335519d-06, 0.4825445110915d+01, 0.7775000683430d-01, &
  0.2002733093326d-06, 0.2457148995307d+01, 0.2093666171530d+00, &
  0.1967111767229d-06, 0.5586291545459d+01, 0.2172315424036d+00 /
data ((s0(i,j,2),i=1,3),j= 51, 60) / &
  0.1568473250543d-06, 0.3708003123320d+01, 0.7429900518901d+00, &
  0.1852528314300d-06, 0.4310638151560d+01, 0.2022531624851d+00, &
  0.1832111226447d-06, 0.1494665322656d+01, 0.3235053470014d+00, &
  0.1746805502310d-06, 0.1451378500784d+01, 0.1385174140878d+00, &
  0.1555730966650d-06, 0.1068040418198d+01, 0.7358765972222d+00, &
  0.1554883462559d-06, 0.2442579035461d+01, 0.5154640627760d+00, &
  0.1638380568746d-06, 0.2597913420625d+00, 0.8531963191132d+00, &
  0.1159938593640d-06, 0.5834512021280d+01, 0.1990721704425d+00, &
  0.1083427965695d-06, 0.5054033177950d+01, 0.5439178814476d+00, &
  0.1156480369431d-06, 0.5325677432457d+01, 0.5257585094865d+00 /
data ((s0(i,j,2),i=1,3),j= 61, 70) / &
  0.1141308860095d-06, 0.2153403923857d+01, 0.5336234347371d+00, &
  0.7913146470946d-07, 0.8642846847027d+00, 0.1478866649112d+01, &
  0.7439752463733d-07, 0.1970628496213d+01, 0.2164800718209d+00, &
  0.7280277104079d-07, 0.6073307250609d+01, 0.2101180877357d+00, &
  0.8319567719136d-07, 0.1954371928334d+01, 0.1692165728891d+01, &
  0.7137705549290d-07, 0.8904989440909d+00, 0.4155522422634d+00, &
  0.6900825396225d-07, 0.2825717714977d+01, 0.1173197218910d+00, &
  0.7245757216635d-07, 0.2481677513331d+01, 0.1265567569334d+01, &
  0.6961165696255d-07, 0.1292955312978d+01, 0.9562891316684d+00, &
  0.7571804456890d-07, 0.3427517575069d+01, 0.1422690933580d-01 /
data ((s0(i,j,2),i=1,3),j= 71, 80) / &
  0.6605425721904d-07, 0.8052192701492d+00, 0.6470106940028d+00, &
  0.7375477357248d-07, 0.1705076390088d+01, 0.1581959461667d+01, &
  0.7041664951470d-07, 0.4848356967891d+00, 0.9597935788730d-01, &
  0.6322199535763d-07, 0.3878069473909d+01, 0.7084920306520d-01, &
  0.5244380279191d-07, 0.2645560544125d+01, 0.5265099800692d+00, &
  0.5143125704988d-07, 0.4834486101370d+01, 0.5328719641544d+00, &
  0.5871866319373d-07, 0.7981472548900d+00, 0.7871412831580d-01, &
  0.6300822573871d-07, 0.5979398788281d+01, 0.2608790314060d+02, &
  0.6062154271548d-07, 0.4108655402756d+01, 0.1114304132498d+00, &
  0.4361912339976d-07, 0.5322624319280d+01, 0.1375773836557d+01 /
data ((s0(i,j,2),i=1,3),j= 81, 90) / &
  0.4417005920067d-07, 0.6240817359284d+01, 0.2770348281756d+00, &
  0.4686806749936d-07, 0.3214977301156d+01, 0.1143987543936d+00, &
  0.3758892132305d-07, 0.5879809634765d+01, 0.1596186371003d+01, &
  0.5151351332319d-07, 0.2893377688007d+00, 0.2228608264996d+00, &
  0.4554683578572d-07, 0.5475427144122d+01, 0.1465949902372d+00, &
  0.3442381385338d-07, 0.5992034796640d+01, 0.5070101000000d-01, &
  0.2831093954933d-07, 0.5367350273914d+01, 0.3092784376656d+00, &
  0.3756267090084d-07, 0.5758171285420d+01, 0.4903339079539d+00, &
  0.2816374679892d-07, 0.1863718700923d+01, 0.2991266627620d+00, &
  0.3419307025569d-07, 0.9524347534130d+00, 0.3518164938661d+00 /
data ((s0(i,j,2),i=1,3),j= 91,100) / &
  0.2904250494239d-07, 0.5304471615602d+01, 0.1099462426779d+00, &
  0.2471734511206d-07, 0.1297069793530d+01, 0.6256703299991d+00, &
  0.2539620831872d-07, 0.3281126083375d+01, 0.1256615170089d+02, &
  0.2281017868007d-07, 0.1829122133165d+01, 0.6681224869435d+01, &
  0.2275319473335d-07, 0.5797198160181d+01, 0.3932462625300d-02, &
  0.2547755368442d-07, 0.4752697708330d+01, 0.1169588211447d+01, &
  0.2285979669317d-07, 0.1223205292886d+01, 0.1045155034888d+01, &
  0.1913386560994d-07, 0.1757532993389d+01, 0.1155361302111d+01, &
  0.1809020525147d-07, 0.4246116108791d+01, 0.3368040641550d-01, &
  0.1649213300201d-07, 0.1445162890627d+01, 0.4408250688924d+00 /
data ((s0(i,j,2),i=1,3),j=101,110) / &
  0.1834972793932d-07, 0.1126917567225d+01, 0.4452511715700d-02, &
  0.1439550648138d-07, 0.6160756834764d+01, 0.9420622223326d+00, &
  0.1487645457041d-07, 0.4358761931792d+01, 0.4123712502208d+00, &
  0.1731729516660d-07, 0.6134456753344d+01, 0.2108507877249d+00, &
  0.1717747163567d-07, 0.1898186084455d+01, 0.2157473718317d+00, &
  0.1418190430374d-07, 0.4180286741266d+01, 0.6521991896920d-01, &
  0.1404844134873d-07, 0.7654053565412d-01, 0.4258542984690d-01, &
  0.1409842846538d-07, 0.4418612420312d+01, 0.2258291676434d+00, &
  0.1090948346291d-07, 0.1260615686131d+01, 0.4226656969313d+00, &
  0.1357577323612d-07, 0.3558248818690d+01, 0.7923417740620d-01 /
data ((s0(i,j,2),i=1,3),j=111,120) / &
  0.1018154061960d-07, 0.5676087241256d+01, 0.1456308687557d+00, &
  0.1412073972109d-07, 0.8394392632422d+00, 0.1525316725248d+00, &
  0.1030938326496d-07, 0.1653593274064d+01, 0.1795258541446d+01, &
  0.1180081567104d-07, 0.1285802592036d+01, 0.7032915397480d-01, &
  0.9708510575650d-08, 0.7631889488106d+00, 0.8434341241180d-01, &
  0.9637689663447d-08, 0.4630642649176d+01, 0.1272681024002d+01, &
  0.1068910429389d-07, 0.5294934032165d+01, 0.2123349582968d+00, &
  0.1063716179336d-07, 0.2736266800832d+01, 0.2142632012598d+00, &
  0.1234858713814d-07, 0.1302891146570d+01, 0.1847279083684d+00, &
  0.8912631189738d-08, 0.3570415993621d+01, 0.2648454860559d+01 /
data ((s0(i,j,2),i=1,3),j=121,130) / &
  0.1036378285534d-07, 0.4236693440949d+01, 0.1370332435159d+00, &
  0.9667798501561d-08, 0.2960768892398d+01, 0.4376440768498d+00, &
  0.8108314201902d-08, 0.6987781646841d+00, 0.2880807454688d+00, &
  0.7648364324628d-08, 0.2499017863863d+01, 0.2037373330570d+00, &
  0.7286136828406d-08, 0.3787426951665d+01, 0.1129145838217d+00, &
  0.9448237743913d-08, 0.2694354332983d+01, 0.5272426800584d+00, &
  0.9374276106428d-08, 0.4787121277064d+01, 0.5321392641652d+00, &
  0.7100226287462d-08, 0.3530238792101d+00, 0.6288513220417d+00, &
  0.9253056659571d-08, 0.1399478925664d+01, 0.1606092486742d+00, &
  0.6636432145504d-08, 0.3479575438447d+01, 0.1368660381889d+01 /
data ((s0(i,j,2),i=1,3),j=131,140) / &
  0.6469975312932d-08, 0.1383669964800d+01, 0.2008557621224d+01, &
  0.7335849729765d-08, 0.1243698166898d+01, 0.9561746721300d-02, &
  0.8743421205855d-08, 0.3776164289301d+01, 0.3801276407308d+00, &
  0.5993635744494d-08, 0.5627122113596d+01, 0.2042657109477d+02, &
  0.5981008479693d-08, 0.1674336636752d+01, 0.2111650433779d+01, &
  0.6188535145838d-08, 0.5214925208672d+01, 0.4305306221819d+00, &
  0.6596074017566d-08, 0.2907653268124d+01, 0.1063314406849d+01, &
  0.6630815126226d-08, 0.2127643669658d+01, 0.8389694097774d+00, &
  0.6156772830040d-08, 0.5082160803295d+01, 0.4234171675140d+00, &
  0.6446960563014d-08, 0.1872100916905d+01, 0.5287268506303d+00 /
data ((s0(i,j,2),i=1,3),j=141,150) / &
  0.6429324424668d-08, 0.5610276103577d+01, 0.5306550935933d+00, &
  0.6302232396465d-08, 0.1592152049607d+01, 0.1253008786510d-01, &
  0.6399244436159d-08, 0.2746214421532d+01, 0.5217580628120d+02, &
  0.5474965172558d-08, 0.2317666374383d+01, 0.2221856701002d+01, &
  0.5339293190692d-08, 0.1084724961156d+01, 0.7466759693650d-01, &
  0.5334733683389d-08, 0.3594106067745d+01, 0.7489573444450d-01, &
  0.5392665782110d-08, 0.5630254365606d+01, 0.1055449481598d+01, &
  0.6682075673789d-08, 0.1518480041732d+01, 0.2213766559277d+00, &
  0.5079130495960d-08, 0.2739765115711d+01, 0.2132517061319d+00, &
  0.5077759793261d-08, 0.5290711290094d+01, 0.2133464534247d+00 /
data ((s0(i,j,2),i=1,3),j=151,160) / &
  0.4832037368310d-08, 0.1404473217200d+01, 0.7160067364790d-01, &
  0.6463279674802d-08, 0.6038381695210d+01, 0.2209183458640d-01, &
  0.6240592771560d-08, 0.1290170653666d+01, 0.3306188016693d+00, &
  0.4672013521493d-08, 0.3261895939677d+01, 0.7796265773310d-01, &
  0.6500650750348d-08, 0.1154522312095d+01, 0.3884652414254d+00, &
  0.6344161389053d-08, 0.6206111545062d+01, 0.7605151500000d-01, &
  0.4682518370646d-08, 0.5409118796685d+01, 0.1073608853559d+01, &
  0.5329460015591d-08, 0.1202985784864d+01, 0.7287631425543d+00, &
  0.5701588675898d-08, 0.4098715257064d+01, 0.8731175355560d-01, &
  0.6030690867211d-08, 0.4132033218460d+00, 0.9846002785331d+00 /
data ((s0(i,j,2),i=1,3),j=161,170) / &
  0.4336256312655d-08, 0.1211415991827d+01, 0.4297791515992d+00, &
  0.4688498808975d-08, 0.3765479072409d+01, 0.2127790306879d+00, &
  0.4675578609335d-08, 0.4265540037226d+01, 0.2138191288687d+00, &
  0.4225578112158d-08, 0.5237566010676d+01, 0.3407705765729d+00, &
  0.5139422230028d-08, 0.1507173079513d+01, 0.7233337363710d-01, &
  0.4619995093571d-08, 0.9023957449848d-01, 0.8603097737811d+00, &
  0.4494776255461d-08, 0.5414930552139d+00, 0.7381754420900d-01, &
  0.4274026276788d-08, 0.4145735303659d+01, 0.7574578717200d-01, &
  0.5018141789353d-08, 0.3344408829055d+01, 0.3180992042600d-02, &
  0.4866163952181d-08, 0.3348534657607d+01, 0.7722995774390d-01 /
data ((s0(i,j,2),i=1,3),j=171,180) / &
  0.4111986020501d-08, 0.4198823597220d+00, 0.1451108196653d+00, &
  0.3356142784950d-08, 0.5609144747180d+01, 0.1274714967946d+00, &
  0.4070575554551d-08, 0.7028411059224d+00, 0.3503323232942d+00, &
  0.3257451857278d-08, 0.5624697983086d+01, 0.5296435984654d+00, &
  0.3256973703026d-08, 0.1857842076707d+01, 0.5297383457582d+00, &
  0.3830771508640d-08, 0.4562887279931d+01, 0.9098186128426d+00, &
  0.3725024005962d-08, 0.2358058692652d+00, 0.1084620721060d+00, &
  0.3136763921756d-08, 0.2049731526845d+01, 0.2346394437820d+00, &
  0.3795147256194d-08, 0.2432356296933d+00, 0.1862120789403d+00, &
  0.2877342229911d-08, 0.5631101279387d+01, 0.1905464808669d+01 /
data ((s0(i,j,2),i=1,3),j=181,190) / &
  0.3076931798805d-08, 0.1117615737392d+01, 0.3628624111593d+00, &
  0.2734765945273d-08, 0.5899826516955d+01, 0.2131850110243d+00, &
  0.2733405296885d-08, 0.2130562964070d+01, 0.2134131485323d+00, &
  0.2898552353410d-08, 0.3462387048225d+00, 0.5291709230214d+00, &
  0.2893736103681d-08, 0.8534352781543d+00, 0.5302110212022d+00, &
  0.3095717734137d-08, 0.2875061429041d+01, 0.2976424921901d+00, &
  0.2636190425832d-08, 0.2242512846659d+01, 0.1485980103780d+01, &
  0.3645512095537d-08, 0.1354016903958d+01, 0.6044726378023d+00, &
  0.2808173547723d-08, 0.6705114365631d-01, 0.6225157782540d-01, &
  0.2625012866888d-08, 0.4775705748482d+01, 0.5268983110410d-01 /
data ((s0(i,j,2),i=1,3),j=191,200) / &
  0.2572233995651d-08, 0.2638924216139d+01, 0.1258454114666d+01, &
  0.2604238824792d-08, 0.4826358927373d+01, 0.2103781122809d+00, &
  0.2596886385239d-08, 0.3200388483118d+01, 0.2162200472757d+00, &
  0.3228057304264d-08, 0.5384848409563d+01, 0.2007689919132d+00, &
  0.2481601798252d-08, 0.5173373487744d+01, 0.1062562936266d+01, &
  0.2745977498864d-08, 0.6250966149853d+01, 0.5651155736444d+00, &
  0.2669878833811d-08, 0.4906001352499d+01, 0.1400015846597d+00, &
  0.3203986611711d-08, 0.5034333010005d+01, 0.7036329877322d+00, &
  0.3354961227212d-08, 0.6108262423137d+01, 0.4549093064213d+00, &
  0.2400407324558d-08, 0.2135399294955d+01, 0.2125476091956d+00 /
data ((s0(i,j,2),i=1,3),j=201,210) / &
  0.2379905859802d-08, 0.5893721933961d+01, 0.2140505503610d+00, &
  0.2550844302187d-08, 0.3331940762063d+01, 0.1534957940063d+00, &
  0.2268824211001d-08, 0.1843418461035d+01, 0.2235935264888d+00, &
  0.2464700891204d-08, 0.3029548547230d+01, 0.2091065926078d+00, &
  0.2436814726024d-08, 0.4994717970364d+01, 0.2174915669488d+00, &
  0.2443623894745d-08, 0.2645102591375d+01, 0.1739420156204d+00, &
  0.2318701783838d-08, 0.5700547397897d+01, 0.7530171478090d-01, &
  0.2284448700256d-08, 0.5268898905872d+01, 0.7426161660010d-01, &
  0.2468848123510d-08, 0.5276280575078d+01, 0.2526561439362d+00, &
  0.2814052350303d-08, 0.6130168623475d+01, 0.5636314030725d+00 /
data ((s0(i,j,2),i=1,3),j=211,ns0y) / &
  0.2243662755220d-08, 0.6631692457995d+00, 0.8886590321940d-01, &
  0.2330795855941d-08, 0.2499435487702d+01, 0.1056200952181d+01, &
  0.9757679038404d-09, 0.5796846023126d+01, 0.7826370942180d+02 /

!  SSB-to-Sun, T^1, Y
data ((s1(i,j,2),i=1,3),j=  1, 10) / &
  0.8989047573576d-08, 0.5840593672122d+01, 0.4265981595566d+00, &
  0.7815938401048d-08, 0.1129664707133d+01, 0.2061856251104d+00, &
  0.7550926713280d-08, 0.6196589104845d+00, 0.2204125344462d+00, &
  0.6056556925895d-08, 0.1677494667846d+01, 0.1059381944224d+01, &
  0.5734142698204d-08, 0.4000920852962d+01, 0.5225775174439d+00, &
  0.5614341822459d-08, 0.3486722577328d+01, 0.5368044267797d+00, &
  0.1028678147656d-08, 0.1877141024787d+01, 0.7113454667900d-02, &
  0.7270792075266d-09, 0.5077167301739d+01, 0.6398972393349d+00, &
  0.8734141726040d-09, 0.9069550282609d-01, 0.4194847048887d+00, &
  0.5377371402113d-09, 0.6039381844671d+01, 0.4337116142245d+00 /
data ((s1(i,j,2),i=1,3),j= 11, 20) / &
  0.4729719431571d-09, 0.2153086311760d+01, 0.2132990797783d+00, &
  0.4458052820973d-09, 0.5059830025565d+01, 0.5296909721118d+00, &
  0.4406855467908d-09, 0.2027971692630d+01, 0.1589072916335d+01, &
  0.3101659310977d-09, 0.3317677981860d+01, 0.1052268489556d+01, &
  0.3016749232545d-09, 0.3913703482532d+01, 0.1066495398892d+01, &
  0.3198541352656d-09, 0.1275513098525d+01, 0.1495633313810d+00, &
  0.2142065389871d-09, 0.5301351614597d+01, 0.3163918923335d+00, &
  0.1902615247592d-09, 0.4894943352736d+00, 0.2275259891141d+00, &
  0.1613410990871d-09, 0.2449891130437d+01, 0.1102062672231d+00, &
  0.1576992165097d-09, 0.4211421447633d+01, 0.7626583626240d-01 /
data ((s1(i,j,2),i=1,3),j= 21, 30) / &
  0.1241637259894d-09, 0.4140803368133d+01, 0.5154640627760d+00, &
  0.1313974830355d-09, 0.3591920305503d+01, 0.3664874755930d-01, &
  0.1181697118258d-09, 0.1506314382788d+01, 0.6327837846670d+00, &
  0.1238239742779d-09, 0.7461405378404d+00, 0.3961708870310d-01, &
  0.1010107068241d-09, 0.6271010795475d+00, 0.7329749511860d-01, &
  0.9226316616509d-10, 0.1259158839583d+01, 0.1990721704425d+00, &
  0.8664946419555d-10, 0.3353244696934d+01, 0.5439178814476d+00, &
  0.7757230468978d-10, 0.1447677295196d+01, 0.9491756770005d+00, &
  0.7693168628139d-10, 0.1120509896721d+01, 0.1030928125552d+00, &
  0.5487897454612d-10, 0.4439380426795d+01, 0.8531963191132d+00 /
data ((s1(i,j,2),i=1,3),j= 31, 40) / &
  0.5196118677218d-10, 0.3788856619137d+00, 0.2093666171530d+00, &
  0.5110853339935d-10, 0.1386879372016d+01, 0.2172315424036d+00, &
  0.5027804534813d-10, 0.1647881805466d+00, 0.2164800718209d+00, &
  0.4922485922674d-10, 0.1594315079862d+01, 0.2101180877357d+00, &
  0.6155599524400d-10, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.4447147832161d-10, 0.5480720918976d+01, 0.3235053470014d+00, &
  0.4144691276422d-10, 0.1931371033660d+01, 0.6373574839730d-01, &
  0.4099950625452d-10, 0.5229611294335d+01, 0.6470106940028d+00, &
  0.5060541682953d-10, 0.1731112486298d+01, 0.1422690933580d-01, &
  0.4293615946300d-10, 0.2714571038925d+01, 0.7358765972222d+00 /
data ((s1(i,j,2),i=1,3),j= 41,ns1y) / &
  0.3545659845763d-10, 0.4451041444634d+01, 0.5265099800692d+00, &
  0.3479112041196d-10, 0.3029385448081d+01, 0.5328719641544d+00, &
  0.3438516493570d-10, 0.2778507143731d+01, 0.8582758298370d-01, &
  0.3297341285033d-10, 0.7898709807584d+00, 0.1104591729320d-01, &
  0.2972585818015d-10, 0.3218785316973d+01, 0.5257585094865d+00, &
  0.2931707295017d-10, 0.4260731012098d+01, 0.5336234347371d+00, &
  0.2897198149403d-10, 0.1120753978101d+01, 0.1173197218910d+00, &
  0.2832293240878d-10, 0.4597682717827d+00, 0.2022531624851d+00, &
  0.2864348326612d-10, 0.2169939928448d+01, 0.9597935788730d-01, &
  0.2852714675471d-10, 0.2377659870578d+01, 0.2118763888447d+01 /

!  SSB-to-Sun, T^2, Y
data ((s2(i,j,2),i=1,3),j=  1,ns2y) / &
  0.1609114495091d-11, 0.2831096993481d+01, 0.2061856251104d+00, &
  0.1560330784946d-11, 0.5193058213906d+01, 0.2204125344462d+00, &
  0.1183535479202d-11, 0.5707003443890d+01, 0.5225775174439d+00, &
  0.1158183066182d-11, 0.1782400404928d+01, 0.5368044267797d+00, &
  0.1032868027407d-11, 0.4036925452011d+01, 0.2132990797783d+00, &
  0.6540142847741d-12, 0.4058241056717d+01, 0.4265981595566d+00, &
  0.7305236491596d-12, 0.6175401942957d+00, 0.5296909721118d+00, &
 -0.5580725052968d-12, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.3946122651015d-12, 0.4108265279171d+00, 0.1059381944224d+01 /

!  SSB-to-Sun, T^0, Z
data ((s0(i,j,3),i=1,3),j=  1, 10) / &
  0.1181255122986d-03, 0.4607918989164d+00, 0.2132990797783d+00, &
  0.1127777651095d-03, 0.4169146331296d+00, 0.5296909721118d+00, &
  0.4777754401806d-04, 0.4582657007130d+01, 0.3813291813120d-01, &
  0.1129354285772d-04, 0.5758735142480d+01, 0.7478166569050d-01, &
 -0.1149543637123d-04, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.3298730512306d-05, 0.5978801994625d+01, 0.4265981595566d+00, &
  0.2733376706079d-05, 0.7665413691040d+00, 0.1059381944224d+01, &
  0.9426389657270d-06, 0.3710201265838d+01, 0.2061856251104d+00, &
  0.8187517749552d-06, 0.3390675605802d+00, 0.2204125344462d+00, &
  0.4080447871819d-06, 0.4552296640088d+00, 0.5225775174439d+00 /
data ((s0(i,j,3),i=1,3),j= 11, 20) / &
  0.3169973017028d-06, 0.3445455899321d+01, 0.5368044267797d+00, &
  0.2438098615549d-06, 0.5664675150648d+01, 0.3664874755930d-01, &
  0.2601897517235d-06, 0.1931894095697d+01, 0.1495633313810d+00, &
  0.2314558080079d-06, 0.3666319115574d+00, 0.3961708870310d-01, &
  0.1962549548002d-06, 0.3167411699020d+01, 0.7626583626240d-01, &
  0.2180518287925d-06, 0.1544420746580d+01, 0.7113454667900d-02, &
  0.1451382442868d-06, 0.1583756740070d+01, 0.1102062672231d+00, &
  0.1358439007389d-06, 0.5239941758280d+01, 0.6398972393349d+00, &
  0.1050585898028d-06, 0.2266958352859d+01, 0.3163918923335d+00, &
  0.1050029870186d-06, 0.2711495250354d+01, 0.4194847048887d+00 /
data ((s0(i,j,3),i=1,3),j= 21, 30) / &
  0.9934920679800d-07, 0.1116208151396d+01, 0.1589072916335d+01, &
  0.1048395331560d-06, 0.3408619600206d+01, 0.1021328554739d+02, &
  0.8370147196668d-07, 0.3810459401087d+01, 0.2535050500000d-01, &
  0.7989856510998d-07, 0.3769910473647d+01, 0.7329749511860d-01, &
  0.5441221655233d-07, 0.2416994903374d+01, 0.1030928125552d+00, &
  0.4610812906784d-07, 0.5858503336994d+01, 0.4337116142245d+00, &
  0.3923022803444d-07, 0.3354170010125d+00, 0.1484170571900d-02, &
  0.2610725582128d-07, 0.5410600646324d+01, 0.6327837846670d+00, &
  0.2455279767721d-07, 0.6120216681403d+01, 0.1162474756779d+01, &
  0.2375530706525d-07, 0.6055443426143d+01, 0.1052268489556d+01 /
data ((s0(i,j,3),i=1,3),j= 31, 40) / &
  0.1782967577553d-07, 0.3146108708004d+01, 0.8460828644453d+00, &
  0.1581687095238d-07, 0.6255496089819d+00, 0.3340612434717d+01, &
  0.1594657672461d-07, 0.3782604300261d+01, 0.1066495398892d+01, &
  0.1563448615040d-07, 0.1997775733196d+01, 0.2022531624851d+00, &
  0.1463624258525d-07, 0.1736316792088d+00, 0.3516457698740d-01, &
  0.1331585056673d-07, 0.4331941830747d+01, 0.9491756770005d+00, &
  0.1130634557637d-07, 0.6152017751825d+01, 0.2968341143800d-02, &
  0.1028949607145d-07, 0.2101792614637d+00, 0.2275259891141d+00, &
  0.1024074971618d-07, 0.4071833211074d+01, 0.5070101000000d-01, &
  0.8826956060303d-08, 0.4861633688145d+00, 0.2093666171530d+00 /
data ((s0(i,j,3),i=1,3),j= 41, 50) / &
  0.8572230171541d-08, 0.5268190724302d+01, 0.4110125927500d-01, &
  0.7649332643544d-08, 0.5134543417106d+01, 0.2608790314060d+02, &
  0.8581673291033d-08, 0.2920218146681d+01, 0.1480791608091d+00, &
  0.8430589300938d-08, 0.3604576619108d+01, 0.2172315424036d+00, &
  0.7776165501012d-08, 0.3772942249792d+01, 0.6373574839730d-01, &
  0.8311070234408d-08, 0.6200412329888d+01, 0.3235053470014d+00, &
  0.6927365212582d-08, 0.4543353113437d+01, 0.8531963191132d+00, &
  0.6791574208598d-08, 0.2882188406238d+01, 0.7181332454670d-01, &
  0.5593100811839d-08, 0.1776646892780d+01, 0.7429900518901d+00, &
  0.4553381853021d-08, 0.3949617611240d+01, 0.7775000683430d-01 /
data ((s0(i,j,3),i=1,3),j= 51, 60) / &
  0.5758000450068d-08, 0.3859251775075d+01, 0.1990721704425d+00, &
  0.4281283457133d-08, 0.1466294631206d+01, 0.2118763888447d+01, &
  0.4206935661097d-08, 0.5421776011706d+01, 0.1104591729320d-01, &
  0.4213751641837d-08, 0.3412048993322d+01, 0.2243449970715d+00, &
  0.5310506239878d-08, 0.5421641370995d+00, 0.5154640627760d+00, &
  0.3827450341320d-08, 0.8887314524995d+00, 0.1510475019529d+00, &
  0.4292435241187d-08, 0.1405043757194d+01, 0.1422690933580d-01, &
  0.3189780702289d-08, 0.1060049293445d+01, 0.1173197218910d+00, &
  0.3226611928069d-08, 0.6270858897442d+01, 0.2164800718209d+00, &
  0.2893897608830d-08, 0.5117563223301d+01, 0.6470106940028d+00 /
data ((s0(i,j,3),i=1,3),j= 61,ns0z) / &
  0.3239852024578d-08, 0.4079092237983d+01, 0.2101180877357d+00, &
  0.2956892222200d-08, 0.1594917021704d+01, 0.3092784376656d+00, &
  0.2980177912437d-08, 0.5258787667564d+01, 0.4155522422634d+00, &
  0.3163725690776d-08, 0.3854589225479d+01, 0.8582758298370d-01, &
  0.2662262399118d-08, 0.3561326430187d+01, 0.5257585094865d+00, &
  0.2766689135729d-08, 0.3180732086830d+00, 0.1385174140878d+00, &
  0.2411600278464d-08, 0.3324798335058d+01, 0.5439178814476d+00, &
  0.2483527695131d-08, 0.4169069291947d+00, 0.5336234347371d+00, &
  0.7788777276590d-09, 0.1900569908215d+01, 0.5217580628120d+02 /

!  SSB-to-Sun, T^1, Z
data ((s1(i,j,3),i=1,3),j=  1, 10) / &
  0.5444220475678d-08, 0.1803825509310d+01, 0.2132990797783d+00, &
  0.3883412695596d-08, 0.4668616389392d+01, 0.5296909721118d+00, &
  0.1334341434551d-08, 0.0000000000000d+00, 0.0000000000000d+00, &
  0.3730001266883d-09, 0.5401405918943d+01, 0.2061856251104d+00, &
  0.2894929197956d-09, 0.4932415609852d+01, 0.2204125344462d+00, &
  0.2857950357701d-09, 0.3154625362131d+01, 0.7478166569050d-01, &
  0.2499226432292d-09, 0.3657486128988d+01, 0.4265981595566d+00, &
  0.1937705443593d-09, 0.5740434679002d+01, 0.1059381944224d+01, &
  0.1374894396320d-09, 0.1712857366891d+01, 0.5368044267797d+00, &
  0.1217248678408d-09, 0.2312090870932d+01, 0.5225775174439d+00 /
data ((s1(i,j,3),i=1,3),j= 11,ns1z) / &
  0.7961052740870d-10, 0.5283368554163d+01, 0.3813291813120d-01, &
  0.4979225949689d-10, 0.4298290471860d+01, 0.4194847048887d+00, &
  0.4388552286597d-10, 0.6145515047406d+01, 0.7113454667900d-02, &
  0.2586835212560d-10, 0.3019448001809d+01, 0.6398972393349d+00 /

!  SSB-to-Sun, T^2, Z
data ((s2(i,j,3),i=1,3),j=  1,ns2z) / &
  0.3749920358054d-12, 0.3230285558668d+01, 0.2132990797783d+00, &
  0.2735037220939d-12, 0.6154322683046d+01, 0.5296909721118d+00 /

!  Time since reference epoch, years.
t = ( ( date1-dj00 ) + date2 ) / djy
t2 = t*t

!  Set status.
if ( abs(t) <= 100d0 ) then
   jstat = 0
else
   jstat = 1
end if

!  X then Y then Z.
do 7 k=1,3

!     Initialize position and velocity component.
   xyz = 0d0
   xyzd = 0d0

!     ------------------------------------------------
!     Obtain component of Sun to Earth ecliptic vector
!     ------------------------------------------------

!     Sun to Earth, T^0 terms.
   do 1 j=1,ne0(k)
      a = e0(1,j,k)
      b = e0(2,j,k)
      c = e0(3,j,k)
      p = b + c*t
      xyz  = xyz  + a*cos(p)
      xyzd = xyzd - a*c*sin(p)
1    continue

!     Sun to Earth, T^1 terms.
   do 2 j=1,ne1(k)
      a = e1(1,j,k)
      b = e1(2,j,k)
      c = e1(3,j,k)
      ct = c*t
      p = b + ct
      cp = cos(p)
      xyz  = xyz  + a*t*cp
      xyzd = xyzd + a*(cp-ct*sin(p))
2    continue

!     Sun to Earth, T^2 terms.
   do 3 j=1,ne2(k)
      a = e2(1,j,k)
      b = e2(2,j,k)
      c = e2(3,j,k)
      ct = c*t
      p = b + ct
      cp = cos(p)
      xyz  = xyz  + a*t2*cp
      xyzd = xyzd + a*t*(2d0*cp-ct*sin(p))
3    continue

!     Heliocentric Earth position and velocity component.
   ph(k) = xyz
   vh(k) = xyzd / djy

!     ------------------------------------------------
!     Obtain component of SSB to Earth ecliptic vector
!     ------------------------------------------------

!     SSB to Sun, T^0 terms.
   do 4 j=1,ns0(k)
      a = s0(1,j,k)
      b = s0(2,j,k)
      c = s0(3,j,k)
      p = b + c*t
      xyz  = xyz  + a*cos(p)
      xyzd = xyzd - a*c*sin(p)
4    continue

!     SSB to Sun, T^1 terms.
   do 5 j=1,ns1(k)
      a = s1(1,j,k)
      b = s1(2,j,k)
      c = s1(3,j,k)
      ct = c*t
      p = b + ct
      cp = cos(p)
      xyz  = xyz  + a*t*cp
      xyzd = xyzd + a*(cp-ct*sin(p))
5    continue

!     SSB to Sun, T^2 terms.
   do 6 j=1,ns2(k)
      a = s2(1,j,k)
      b = s2(2,j,k)
      c = s2(3,j,k)
      ct = c*t
      p = b + ct
      cp = cos(p)
      xyz  = xyz  + a*t2*cp
      xyzd = xyzd + a*t*(2d0*cp-ct*sin(p))
6    continue

!     Barycentric Earth position and velocity component.
   pb(k) = xyz
   vb(k) = xyzd / djy

!     Next Cartesian component.
7 continue

!  Rotate from ecliptic to ICRF coordinates and return the results.
x = ph(1)
y = ph(2)
z = ph(3)
pvh(1,1) =      x + am12*y + am13*z
pvh(2,1) = am21*x + am22*y + am23*z
pvh(3,1) =          am32*y + am33*z
x = vh(1)
y = vh(2)
z = vh(3)
pvh(1,2) =      x + am12*y + am13*z
pvh(2,2) = am21*x + am22*y + am23*z
pvh(3,2) =          am32*y + am33*z
x = pb(1)
y = pb(2)
z = pb(3)
pvb(1,1) =      x + am12*y + am13*z
pvb(2,1) = am21*x + am22*y + am23*z
pvb(3,1) =          am32*y + am33*z
x = vb(1)
y = vb(2)
z = vb(3)
pvb(1,2) =      x + am12*y + am13*z
pvb(2,2) = am21*x + am22*y + am23*z
pvb(3,2) =          am32*y + am33*z

end subroutine EPV00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine EQEC06 ( date1, date2, dr, dd, dl, db )
!>
!  Transformation from ICRS equatorial coordinates to ecliptic
!  coordinates (mean equinox and ecliptic of date) using IAU 2006
!  precession model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2  d      TT as a 2-part Julian Date (Note 1)
!     DR,DD        d      ICRS right ascension and declination (radians)
!
!  Returned:
!     DL,DB        d      ecliptic longitude and latitude (radians)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) No assumptions are made about whether the coordinates represent
!     starlight and embody astrometric effects such as parallax or
!     aberration.
!
!  3) The transformation is approximately that from mean J2000.0 right
!     ascension and declination to ecliptic longitude and latitude (mean
!     equinox and ecliptic of date), with only frame bias (always less
!     than 25 mas) to disturb this classical picture.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     ECM06    J2000.0 to ecliptic rotation matrix, IAU 2006
!     RXP      product of r-matrix and p-vector
!     C2S      unit vector to spherical coordinates
!     ANP      normalize angle into range 0 to 2pi
!     ANPM     normalize angle into range +/- pi
!
!  This revision:  2016 February 9
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dr, dd, dl, db

double precision rm(3,3), v1(3), v2(3), a, b

!     DOUBLE PRECISION ANP, ANPM

!  Spherical to Cartesian.
call S2C ( dr, dd, v1 )

!  Rotation matrix, ICRS equatorial to ecliptic.
call ECM06 ( date1, date2, rm )

!  The transformation from ICRS to ecliptic.
call RXP ( rm, v1, v2 )

!  Cartesian to spherical.
call C2S ( v2, a, b )

!  Express in conventional ranges.
dl = ANP ( a )
db = ANPM ( b )

end subroutine EQEC06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function EQEQ94 ( date1, date2 )
!>
!  Equation of the equinoxes, IAU 1994 model.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2     d         TDB date (Note 1)
!
!  Returned:
!     EQEQ94      d         equation of the equinoxes (Note 2)
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The result, which is in radians, operates in the following sense:
!
!        Greenwich apparent ST = GMST + equation of the equinoxes
!
!  Called:
!     ANPM     normalize angle into range +/- pi
!     NUT80    nutation, IAU 1980
!     OBL80    mean obliquity, IAU 1980
!
!  References:
!
!     IAU Resolution C7, Recommendation 3 (1994)
!
!     Capitaine, N. & Gontier, A.-M., Astron.Astrophys., 275,
!     645-650 (1993)
!
!  This revision:  2017 October 12
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  2Pi
double precision d2pi
parameter (d2pi = 6.283185307179586476925287d0)

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t, om, dpsi, deps, eps0
!     DOUBLE PRECISION ANPM, OBL80

!  Interval between fundamental epoch J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Longitude of the mean ascending node of the lunar orbit on the
!  ecliptic, measured from the mean equinox of date.
om = ANPM( ( 450160.280d0 + ( -482890.539d0 + &
                 ( 7.455d0 + 0.008d0 * t ) * t ) * t ) * das2r &
               + mod(-5d0*t,1d0) * d2pi )

!  Nutation components and mean obliquity.
call NUT80 ( date1, date2, dpsi, deps )
eps0 = OBL80 ( date1, date2 )

!  Equation of the equinoxes.
EQEQ94 = dpsi * cos(eps0) + das2r * ( 0.00264d0 * sin(om) + &
                                          0.000063d0 * sin(om+om))

end function EQEQ94
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function ERA00 ( dj1, dj2 )
!>
!  Earth rotation angle (IAU 2000 model).
!
!  Status:  canonical model.
!
!  Given:
!     DJ1,DJ2     d      UT1 as a 2-part Julian Date (see note)
!
!  The result is the Earth rotation angle (radians), in the range 0 to
!  2pi.
!
!  Notes:
!
!  1) The UT1 date DJ1+DJ2 is a Julian Date, apportioned in any
!     convenient way between the arguments DJ1 and DJ2.  For example,
!     JD(UT1)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!             DJ1            DJ2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  The date & time method is
!     best matched to the algorithm used:  maximum accuracy (or, at
!     least, minimum noise) is delivered when the DJ1 argument is for
!     0hrs UT1 on the day in question and the DJ2 argument lies in the
!     range 0 to 1, or vice versa.
!
!  2) The algorithm is adapted from Expression 22 of Capitaine et al.
!     2000.  The time argument has been expressed in days directly,
!     and, to retain precision, integer contributions have been
!     eliminated.  The same formulation is given in IERS Conventions
!     (2003), Chap. 5, Eq. 14.
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!
!  References:
!
!     Capitaine N., Guinot B. and McCarthy D.D, 2000, Astron.
!     Astrophys., 355, 398-405.
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision dj1, dj2

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

double precision d1, d2, t, f

!     DOUBLE PRECISION ANP

!  Days since fundamental epoch.
if ( dj1 < dj2 ) then
   d1 = dj1
   d2 = dj2
else
   d1 = dj2
   d2 = dj1
end if
t = d1 + ( d2-dj00 )

!  Fractional part of T (days).
f = mod ( d1, 1d0 ) + mod ( d2, 1d0 )

!  Earth rotation angle at this UT1.
ERA00 = ANP ( d2pi * ( f + 0.7790572732640d0 &
                                 + 0.00273781191135448d0 * t ) )

end function ERA00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAD03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean elongation of the Moon from the Sun.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAD03   d    D, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     is from Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  Arcseconds to radians.
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Arcseconds in a full circle.
double precision turnas
parameter ( turnas = 1296000d0 )

!  Mean elongation of the Moon from the Sun (IERS Conventions 2003).
FAD03 = mod (      1072260.703692d0 + &
                  t*( 1602961601.2090d0 + &
                  t*(        - 6.3706d0 + &
                  t*(          0.006593d0 + &
                  t*(        - 0.00003169d0 )))), turnas ) * das2r

end function FAD03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAE03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of Earth.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAE03   d    mean longitude of Earth, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     comes from Souchay et al. (1999) after Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!     Souchay, J., Loysel, B., Kinoshita, H., Folgueira, M. 1999,
!     Astron.Astrophys.Supp.Ser. 135, 111
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  2Pi.
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Mean longitude of Earth (IERS Conventions 2003).
FAE03= mod ( 1.753470314d0 + 628.3075849991d0 * t, d2pi )

end function FAE03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAF03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of the Moon minus mean longitude of the ascending
!  node.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAF03   d    F, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     is from Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  Arcseconds to radians.
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Arcseconds in a full circle.
double precision turnas
parameter ( turnas = 1296000d0 )

!  Mean longitude of the Moon minus that of the ascending node
!  (IERS Conventions 2003).
FAF03 = mod (       335779.526232d0 + &
                  t*( 1739527262.8478d0 + &
                  t*(       - 12.7512d0 + &
                  t*(       -  0.001037d0 + &
                  t*(          0.00000417d0 )))), turnas ) * das2r

end function FAF03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAJU03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of Jupiter.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAJU03  d    mean longitude of Jupiter, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     comes from Souchay et al. (1999) after Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!     Souchay, J., Loysel, B., Kinoshita, H., Folgueira, M. 1999,
!     Astron.Astrophys.Supp.Ser. 135, 111
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  2Pi.
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Mean longitude of Jupiter (IERS Conventions 2003).
FAJU03= mod ( 0.599546497d0 + 52.9690962641d0 * t, d2pi )

end function FAJU03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAL03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean anomaly of the Moon.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAL03   d    l, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     is from Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  Arcseconds to radians.
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Arcseconds in a full circle.
double precision turnas
parameter ( turnas = 1296000d0 )

!  Mean anomaly of the Moon (IERS Conventions 2003).
FAL03 = mod (       485868.249036d0 + &
                  t*( 1717915923.2178d0 + &
                  t*(         31.8792d0 + &
                  t*(          0.051635d0 + &
                  t*(        - 0.00024470d0 )))), turnas ) * das2r

end function FAL03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FALP03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean anomaly of the Sun.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FALP03  d    l', radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     is from Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  Arcseconds to radians.
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Arcseconds in a full circle.
double precision turnas
parameter ( turnas = 1296000d0 )

!  Mean anomaly of the Sun (IERS Conventions 2003).
FALP03 = mod (     1287104.793048d0 + &
                   t*( 129596581.0481d0 + &
                   t*(       - 0.5532d0 + &
                   t*(         0.000136d0 + &
                   t*(       - 0.00001149d0 )))), turnas ) * das2r

end function FALP03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAMA03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of Mars.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAMA03  d    mean longitude of Mars, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     comes from Souchay et al. (1999) after Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!     Souchay, J., Loysel, B., Kinoshita, H., Folgueira, M. 1999,
!     Astron.Astrophys.Supp.Ser. 135, 111
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  2Pi.
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Mean longitude of Mars (IERS Conventions 2003).
FAMA03= mod ( 6.203480913d0 + 334.0612426700d0 * t, d2pi )

end function FAMA03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAME03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of Mercury.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAME03  d    mean longitude of Mercury, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     comes from Souchay et al. (1999) after Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!     Souchay, J., Loysel, B., Kinoshita, H., Folgueira, M. 1999,
!     Astron.Astrophys.Supp.Ser. 135, 111
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  2Pi.
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Mean longitude of Mercury (IERS Conventions 2003).
FAME03 = mod ( 4.402608842d0 + 2608.7903141574d0 * t, d2pi )

end function FAME03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FANE03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of Neptune.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FANE03  d    mean longitude of Neptune, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     is adapted from Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  2Pi.
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Mean longitude of Neptune (IERS Conventions 2003).
FANE03= mod ( 5.311886287d0 + 3.8133035638d0 * t, d2pi )

end function FANE03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAOM03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of the Moon's ascending node.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAOM03  d    Omega, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     is from Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  Arcseconds to radians.
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Arcseconds in a full circle.
double precision turnas
parameter ( turnas = 1296000d0 )

!  Mean longitude of the Moon's ascending node (IERS Conventions 2003).
FAOM03 = mod (      450160.398036d0 + &
                   t*( - 6962890.5431d0 + &
                   t*(         7.4722d0 + &
                   t*(         0.007702d0 + &
                   t*(       - 0.00005939d0 )))), turnas ) * das2r

end function FAOM03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAPA03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  general accumulated precession in longitude.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAPA03  d    general precession in longitude, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003).  It
!     is taken from Kinoshita & Souchay (1990) and comes originally from
!     Lieske et al. (1977).
!
!  References:
!
!     Kinoshita, H. and Souchay J. 1990, Celest.Mech. and Dyn.Astron.
!     48, 187
!
!     Lieske, J.H., Lederle, T., Fricke, W. & Morando, B. 1977,
!     Astron.Astrophys. 58, 1-16
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  General accumulated precession in longitude.
FAPA03= ( 0.024381750d0 + 0.00000538691d0 * t ) * t

end function FAPA03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FASA03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of Saturn.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FASA03  d    mean longitude of Saturn, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     comes from Souchay et al. (1999) after Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!     Souchay, J., Loysel, B., Kinoshita, H., Folgueira, M. 1999,
!     Astron.Astrophys.Supp.Ser. 135, 111
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  2Pi.
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Mean longitude of Saturn (IERS Conventions 2003).
FASA03= mod ( 0.874016757d0 + 21.3299104960d0 * t, d2pi )

end function FASA03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAUR03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of Uranus.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAUR03  d    mean longitude of Uranus, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     is adapted from Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  2Pi.
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Mean longitude of Uranus (IERS Conventions 2003).
FAUR03= mod ( 5.481293872d0 + 7.4781598567d0 * t, d2pi )

end function FAUR03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function FAVE03 ( t )
!>
!  Fundamental argument, IERS Conventions (2003):
!  mean longitude of Venus.
!
!  Status:  canonical model.
!
!  Given:
!     T           d    TDB, Julian centuries since J2000.0 (Note 1)
!
!  Returned:
!     FAVE03  d    mean longitude of Venus, radians (Note 2)
!
!  Notes:
!
!  1) Though T is strictly TDB, it is usually more convenient to use TT,
!     which makes no significant difference.
!
!  2) The expression used is as adopted in IERS Conventions (2003) and
!     comes from Souchay et al. (1999) after Simon et al. (1994).
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!     Souchay, J., Loysel, B., Kinoshita, H., Folgueira, M. 1999,
!     Astron.Astrophys.Supp.Ser. 135, 111
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision t

!  2Pi.
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Mean longitude of Venus (IERS Conventions 2003).
FAVE03= mod ( 3.176146697d0 + 1021.3285546211d0 * t, d2pi )

end function FAVE03
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine FK425 ( r1950, d1950, &
                       dr1950, dd1950, p1950, v1950, &
                       r2000, d2000, &
                       dr2000, dd2000, p2000, v2000 )
!>
!  Convert B1950.0 FK4 star catalog data to J2000.0 FK5.
!
!  Status:  support routine.
!
!  This routine converts a star's catalog data from the old FK4
!  (Bessel-Newcomb) system to the later IAU 1976 FK5 (Fricke) system.
!
!  Given:  (all B1950.0, FK4)
!     R1950,D1950      d     B1950.0 RA,Dec (rad)
!     DR1950,DD1950    d     B1950.0 proper motions (rad/trop.yr)
!     P1950            d     parallax (arcsec)
!     V1950            d     radial velocity (km/s, +ve = moving away)
!
!  Returned:  (all J2000.0, FK5)
!     R2000,D2000      d     J2000.0 RA,Dec (rad)
!     DR2000,DD2000    d     J2000.0 proper motions (rad/Jul.yr)
!     P2000            d     parallax (arcsec)
!     V2000            d     radial velocity (km/s, +ve = moving away)
!
!  Notes:
!
!  1) The proper motions in RA are dRA/dt rather than cos(Dec)*dRA/dt,
!     and are per year rather than per century.
!
!  2) The conversion is somewhat complicated, for several reasons:
!
!     . Change of standard epoch from B1950.0 to J2000.0.
!
!     . An intermediate transition date of 1984 January 1.0 TT.
!
!     . A change of precession model.
!
!     . Change of time unit for proper motion (tropical to Julian).
!
!     . FK4 positions include the E-terms of aberration, to simplify the
!       hand computation of annual aberration.  FK5 positions assume a
!       rigorous aberration computation based on the Earth's barycentric
!       velocity.
!
!     . The E-terms also affect proper motions, and in particular cause
!       objects at large distances to exhibit fictitious proper motions.
!
!     The algorithm is based on Smith et al. (1989) and Yallop et al.
!     (1989), which presented a matrix method due to Standish (1982) as
!     developed by Aoki et al. (1983), using Kinoshita's development of
!     Andoyer's post-Newcomb precession.  The numerical constants from
!     Seidelmann (1992) are used canonically.
!
!  3) Conversion from B1950.0 FK4 to J2000.0 FK5 only is provided for.
!     Conversions for different epochs and equinoxes would require
!     additional treatment for precession, proper motion and E-terms.
!
!  4) In the FK4 catalog the proper motions of stars within 10 degrees
!     of the poles do not embody differential E-terms effects and
!     should, strictly speaking, be handled in a different manner from
!     stars outside these regions.  However, given the general lack of
!     homogeneity of the star data available for routine astrometry, the
!     difficulties of handling positions that may have been determined
!     from astrometric fields spanning the polar and non-polar regions,
!     the likelihood that the differential E-terms effect was not taken
!     into account when allowing for proper motion in past astrometry,
!     and the undesirability of a discontinuity in the algorithm, the
!     decision has been made in this SOFA algorithm to include the
!     effects of differential E-terms on the proper motions for all
!     stars, whether polar or not.  At epoch J2000.0, and measuring "on
!     the sky" rather than in terms of RA change, the errors resulting
!     from this simplification are less than 1 milliarcsecond in
!     position and 1 milliarcsecond per century in proper motion.
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!     PV2S     pv-vector to spherical coordinates
!     PDP      scalar product of two p-vectors
!     PVMPV    pv-vector minus pv_vector
!     PVPPV    pv-vector plus pv_vector
!     S2PV     spherical coordinates to pv-vector
!     SXP      multiply p-vector by scalar
!
!  References:
!
!     Aoki, S. et al., 1983, "Conversion matrix of epoch B1950.0
!     FK4-based positions of stars to epoch J2000.0 positions in
!     accordance with the new IAU resolutions".  Astron.Astrophys.
!     128, 263-267.
!
!     Seidelmann, P.K. (ed), 1992, "Explanatory Supplement to the
!     Astronomical Almanac", ISBN 0-935702-68-7.
!
!     Smith, C.A. et al., 1989, "The transformation of astrometric
!     catalog systems to the equinox J2000.0".  Astron.J. 97, 265.
!
!     Standish, E.M., 1982, "Conversion of positions and proper motions
!     from B1950.0 to the IAU system at J2000.0".  Astron.Astrophys.,
!     115, 1, 20-22.
!
!     Yallop, B.D. et al., 1989, "Transformation of mean star places
!     from FK4 B1950.0 to FK5 J2000.0 using matrices in 6-space".
!     Astron.J. 97, 274.
!
!  This revision:   2018 January 11
!
!-----------------------------------------------------------------------

implicit none

double precision r1950, d1950, dr1950, dd1950, p1950, v1950, &
                 r2000, d2000, dr2000, dd2000, p2000, v2000

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Radians per year to arcsec per century
double precision pmf
parameter ( pmf = 100d0*60d0*60d0*360d0/d2pi )

!  Small number to avoid arithmetic problems
double precision tiny
parameter ( tiny = 1d-30 )

!  Miscellaneous
double precision r, d, ur, ud, px, rv, pxvf, w, rd
integer l, k, j, i

!  Pv-vectors
double precision r0(3,2), pv1(3,2), pv2(3,2), pv3(3,2)

!  Functions
!     DOUBLE PRECISION ANP

!
!  CANONICAL CONSTANTS  (Seidelmann 1992)
!

!  Km per sec to AU per tropical century
!  = 86400 * 36524.2198782 / 149597870.7
double precision vf
parameter ( vf = 21.095d0 )

!  Constant pv-vector (cf. Seidelmann 3.591-2, vectors A and Adot)
double precision a(3,2)
data a / -1.62557d-6, -0.31919d-6, -0.13843d-6, &
         +1.245d-3,   -1.580d-3,   -0.659d-3 /

!  3x2 matrix of pv-vectors (cf. Seidelmann 3.591-4, matrix M)
double precision em(3,2,3,2)
data em / &
   +0.9999256782d0,     -0.0111820611d0,     -0.0048579477d0, &
   +0.00000242395018d0, -0.00000002710663d0, -0.00000001177656d0, &
   +0.0111820610d0,     +0.9999374784d0,     -0.0000271765d0, &
   +0.00000002710663d0, +0.00000242397878d0, -0.00000000006587d0, &
   +0.0048579479d0,     -0.0000271474d0,     +0.9999881997d0, &
   +0.00000001177656d0, -0.00000000006582d0, +0.00000242410173d0, &
   -0.000551d0,         -0.238565d0,         +0.435739d0, &
   +0.99994704d0,       -0.01118251d0,       -0.00485767d0, &
   +0.238514d0,         -0.002667d0,         -0.008541d0, &
   +0.01118251d0,       +0.99995883d0,       -0.00002718d0, &
   -0.435623d0,         +0.012254d0,         +0.002117d0, &
   +0.00485767d0,       -0.00002714d0,       +1.00000956d0 &
        /

!  The FK4 data (units radians and arcsec per tropical century).
r = r1950
d = d1950
ur = dr1950*pmf
ud = dd1950*pmf
px = p1950
rv = v1950

!  Express as a pv-vector.
pxvf = px*vf
w = rv*pxvf
call S2PV ( r, d, 1d0, ur, ud, w, r0 )

!  Allow for E-terms (cf. Seidelmann 3.591-2).
call PVMPV ( r0, a, pv1 )
call PDP ( r0, a, w )
call SXP ( w, r0, pv2 )
call PDP ( r0, a(1,2), w )
call SXP ( w, r0, pv2(1,2) )
call PVPPV ( pv1, pv2, pv3 )

!  Convert pv-vector to Fricke system (cf. Seidelmann 3.591-3).
do 4 l = 1,2
   do 3 k=1,3
      w = 0d0
      do 2 j=1,2
         do 1 i=1,3
            w = w + em(i,j,k,l)*pv3(i,j)
1          continue
2       continue
      pv1(k,l) = w
3    continue
4 continue

!  Revert to catalog form.
call PV2S ( pv1, r, d, w, ur, ud, rd )
if ( px>tiny ) then
   rv = rd/pxvf
   px = px/w
end if

!  Return the results.
r2000 = ANP(r)
d2000 = d
dr2000 = ur/pmf
dd2000 = ud/pmf
v2000 = rv
p2000 = px

end subroutine FK425
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine FK45Z ( r1950, d1950, bepoch, r2000, d2000 )
!>
!  Convert a B1950.0 FK4 star position to J2000.0 FK5, assuming zero
!  proper motion in the FK5 system.
!
!  Status:  support routine.
!
!  This routine converts a star's catalog data from the old FK4
!  (Bessel-Newcomb) system to the later IAU 1976 FK5 (Fricke) system,
!  in such a way that the FK5 proper motion is zero.  Because such a
!  star has, in general, a non-zero proper motion in the FK4 system,
!  the routine requires the epoch at which the position in the FK4
!  system was determined.
!
!  Given:
!     R1950,D1950      d     B1950.0 FK4 RA,Dec at epoch (rad)
!     BEPOCH           d     Besselian epoch (e.g. 1979.3D0)
!
!  Returned:
!     R2000,D2000      d     J2000.0 FK5 RA,Dec (rad)
!
!  Notes:
!
!  1) The epoch BEPOCH is strictly speaking Besselian, but if a Julian
!     epoch is supplied the result will be affected only to a negligible
!     extent.
!
!  2) The method is from Appendix 2 of Aoki et al. (1983), but using the
!     constants of Seidelmann (1992).  See the routine FK425 for a
!     general introduction to the FK4 to FK5 conversion.
!
!  3) Conversion from equinox B1950.0 FK4 to equinox J2000.0 FK5 only is
!     provided for.  Conversions for different starting and/or ending
!     epochs would require additional treatment for precession, proper
!     motion and E-terms.
!
!  4) In the FK4 catalog the proper motions of stars within 10 degrees
!     of the poles do not embody differential E-terms effects and
!     should, strictly speaking, be handled in a different manner from
!     stars outside these regions.  However, given the general lack of
!     homogeneity of the star data available for routine astrometry, the
!     difficulties of handling positions that may have been determined
!     from astrometric fields spanning the polar and non-polar regions,
!     the likelihood that the differential E-terms effect was not taken
!     into account when allowing for proper motion in past astrometry,
!     and the undesirability of a discontinuity in the algorithm, the
!     decision has been made in this SOFA algorithm to include the
!     effects of differential E-terms on the proper motions for all
!     stars, whether polar or not.  At epoch 2000.0, and measuring "on
!     the sky" rather than in terms of RA change, the errors resulting
!     from this simplification are less than 1 milliarcsecond in
!     position and 1 milliarcsecond per century in proper motion.
!
!  References:
!
!     Aoki, S. et al., 1983, "Conversion matrix of epoch B1950.0
!     FK4-based positions of stars to epoch J2000.0 positions in
!     accordance with the new IAU resolutions".  Astron.Astrophys.
!     128, 263-267.
!
!     Seidelmann, P.K. (ed), 1992, "Explanatory Supplement to the
!     Astronomical Almanac", ISBN 0-935702-68-7.
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!     C2S      p-vector to spherical
!     EPB2JD   Besselian epoch to Julian date
!     EPJ      Julian date to Julian epoch
!     PDP      scalar product of two p-vectors
!     PMP      p-vector minus p-vector
!     PPSP     p-vector plus scaled p-vector
!     PVU      update a pv-vector
!     S2C      spherical to p-vector
!
!  This revision:   2018 January 11
!
!-----------------------------------------------------------------------

implicit none

double precision r1950, d1950, bepoch, r2000, d2000

!  2pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Radians per year to arcsec per century
double precision pmf
parameter ( pmf = 100d0*60d0*60d0*360d0/d2pi )

!  Position and position+velocity vectors
double precision r0(3), a1(3), p1(3), p2(3), pv1(3,2), pv2(3,2)

!  Miscellaneous
double precision w, djm0, djm
integer k, j, i

!  Functions
!     DOUBLE PRECISION EPJ, ANP

!
!  CANONICAL CONSTANTS
!

!  Vectors A and Adot (Seidelmann 3.591-2)
double precision a(3), ad(3)
data a,ad/ -1.62557d-6,  -0.31919d-6, -0.13843d-6, &
           +1.245d-3,    -1.580d-3,   -0.659d-3 /

!  3x2 matrix of p-vectors (cf. Seidelmann 3.591-4, matrix M)
double precision em(3,3,2)
data em / &
   +0.9999256782d0,     -0.0111820611d0,     -0.0048579477d0, &
   +0.0111820610d0,     +0.9999374784d0,     -0.0000271765d0, &
   +0.0048579479d0,     -0.0000271474d0,     +0.9999881997d0, &
   -0.000551d0,         -0.238565d0,         +0.435739d0, &
   +0.238514d0,         -0.002667d0,         -0.008541d0, &
   -0.435623d0,         +0.012254d0,         +0.002117d0 &
        /

!  Spherical coordinates to p-vector.
call S2C ( r1950, d1950, r0 )

!  Adjust p-vector A to give zero proper motion in FK5.
w = ( bepoch - 1950d0 ) / pmf
call PPSP ( a, w, ad, a1 )

!  Remove E-terms.
call PDP ( r0, a1, w )
call PPSP ( a1, -w, r0, p1 )
call PMP ( r0, p1, p2 )

!  Convert to Fricke system pv-vector (cf. Seidelmann 3.591-3).
do 3 k = 1,2
   do 2 j=1,3
      w = 0d0
      do 1 i=1,3
         w = w + em(i,j,k)*p2(i)
1       continue
      pv1(j,k) = w
2    continue
3 continue

!  Allow for fictitious proper motion.
call EPB2JD ( bepoch, djm0, djm )
w = ( EPJ(djm0,djm) - 2000d0 ) / pmf
call PVU ( w, pv1, pv2 )

!  Revert to spherical coordinates.
call C2S ( pv2, w, d2000 )
r2000 = ANP ( w )

end subroutine FK45Z
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine FK524 ( r2000, d2000, &
                       dr2000, dd2000, p2000, v2000, &
                       r1950, d1950, &
                       dr1950, dd1950, p1950, v1950 )
!>
!  Convert J2000.0 FK5 star catalog data to B1950.0 FK4.
!
!  Status:  support routine.
!
!  Given:  (all J2000.0, FK5)
!     R2000,D2000      d     J2000.0 RA,Dec (rad)
!     DR2000,DD2000    d     J2000.0 proper motions (rad/Jul.yr)
!     P2000            d     parallax (arcsec)
!     V2000            d     radial velocity (km/s, +ve = moving away)
!
!  Returned:  (all B1950.0, FK4)
!     R1950,D1950      d     B1950.0 RA,Dec (rad)
!     DR1950,DD1950    d     B1950.0 proper motions (rad/trop.yr)
!     P1950            d     parallax (arcsec)
!     V1950            d     radial velocity (km/s, +ve = moving away)
!
!  Notes:
!
!  1) The proper motions in RA are dRA/dt rather than cos(Dec)*dRA/dt,
!     and are per year rather than per century.
!
!  2) The conversion is somewhat complicated, for several reasons:
!
!     . Change of standard epoch from J2000.0 to B1950.0.
!
!     . An intermediate transition date of 1984 January 1.0 TT.
!
!     . A change of precession model.
!
!     . Change of time unit for proper motion (Julian to tropical).
!
!     . FK4 positions include the E-terms of aberration, to simplify the
!       hand computation of annual aberration.  FK5 positions assume a
!       rigorous aberration computation based on the Earth's barycentric
!       velocity.
!
!     . The E-terms also affect proper motions, and in particular cause
!       objects at large distances to exhibit fictitious proper motions.
!
!     The algorithm is based on Smith et al. (1989) and Yallop et al.
!     (1989), which presented a matrix method due to Standish (1982) as
!     developed by Aoki et al. (1983), using Kinoshita's development of
!     Andoyer's post-Newcomb precession.  The numerical constants from
!     Seidelmann (1992) are used canonically.
!
!  4) In the FK4 catalog the proper motions of stars within 10 degrees
!     of the poles do not embody differential E-terms effects and
!     should, strictly speaking, be handled in a different manner from
!     stars outside these regions.  However, given the general lack of
!     homogeneity of the star data available for routine astrometry, the
!     difficulties of handling positions that may have been determined
!     from astrometric fields spanning the polar and non-polar regions,
!     the likelihood that the differential E-terms effect was not taken
!     into account when allowing for proper motion in past astrometry,
!     and the undesirability of a discontinuity in the algorithm, the
!     decision has been made in this SOFA algorithm to include the
!     effects of differential E-terms on the proper motions for all
!     stars, whether polar or not.  At epoch J2000.0, and measuring "on
!     the sky" rather than in terms of RA change, the errors resulting
!     from this simplification are less than 1 milliarcsecond in
!     position and 1 milliarcsecond per century in proper motion.
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!     PDP      scalar product of two p-vectors
!     PM       modulus of p-vector
!     PMP      p-vector minus p-vector
!     PPP      p-vector pluus p-vector
!     PV2S     pv-vector to spherical coordinates
!     S2PV     spherical coordinates to pv-vector
!     SXP      multiply p-vector by scalar
!
!  References:
!
!     Aoki, S. et al., 1983, "Conversion matrix of epoch B1950.0
!     FK4-based positions of stars to epoch J2000.0 positions in
!     accordance with the new IAU resolutions".  Astron.Astrophys.
!     128, 263-267.
!
!     Seidelmann, P.K. (ed), 1992, "Explanatory Supplement to the
!     Astronomical Almanac", ISBN 0-935702-68-7.
!
!     Smith, C.A. et al., 1989, "The transformation of astrometric
!     catalog systems to the equinox J2000.0".  Astron.J. 97, 265.
!
!     Standish, E.M., 1982, "Conversion of positions and proper motions
!     from B1950.0 to the IAU system at J2000.0".  Astron.Astrophys.,
!     115, 1, 20-22.
!
!     Yallop, B.D. et al., 1989, "Transformation of mean star places
!     from FK4 B1950.0 to FK5 J2000.0 using matrices in 6-space".
!     Astron.J. 97, 274.
!
!  This revision:   2018 January 11
!
!-----------------------------------------------------------------------

implicit none

double precision r2000, d2000, dr2000, dd2000, p2000, v2000, &
                 r1950, d1950, dr1950, dd1950, p1950, v1950

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Radians per year to arcsec per century
double precision pmf
parameter ( pmf = 100d0*60d0*60d0*360d0/d2pi )

!  Small number to avoid arithmetic problems
double precision tiny
parameter ( tiny = 1d-30 )

!  Miscellaneous
double precision r, d, ur, ud, px, rv, pxvf, w, wr, rd
integer l, k, j, i

!  Vectors, p and pv
double precision r0(3,2), r1(3,2), p1(3), p2(3), p3(3), pv(3,2)

!  Functions
!     DOUBLE PRECISION ANP

!
!  CANONICAL CONSTANTS  (Seidelmann 1992)
!

!  Km per sec to AU per tropical century
!  = 86400 * 36524.2198782 / 149597870
double precision vf
parameter ( vf = 21.095d0 )

!  Constant pv-vector (cf. Seidelmann 3.591-2, vectors A and Adot)
double precision a(3,2)
data a/ -1.62557d-6,  -0.31919d-6, -0.13843d-6, &
        +1.245d-3,    -1.580d-3,   -0.659d-3 /

!  3x2 matrix of pv-vectors (cf. Seidelmann 3.592-1, matrix M^-1)
double precision emi(3,2,3,2)
data emi / &
   +0.9999256795d0,     +0.0111814828d0,     +0.0048590039d0, &
   -0.00000242389840d0, -0.00000002710544d0, -0.00000001177742d0, &
   -0.0111814828d0,     +0.9999374849d0,     -0.0000271771d0, &
   +0.00000002710544d0, -0.00000242392702d0, +0.00000000006585d0, &
   -0.0048590040d0,     -0.0000271557d0,     +0.9999881946d0, &
   +0.00000001177742d0, +0.00000000006585d0, -0.00000242404995d0, &
   -0.000551d0,         +0.238509d0,         -0.435614d0, &
   +0.99990432d0,       +0.01118145d0,       +0.00485852d0, &
   -0.238560d0,         -0.002667d0,         +0.012254d0, &
   -0.01118145d0,       +0.99991613d0,       -0.00002717d0, &
   +0.435730d0,         -0.008541d0,         +0.002117d0, &
   -0.00485852d0,       -0.00002716d0,       +0.99996684d0 &
        /

!  The FK5 data (units radians and arcsec per Julian century).
r = r2000
d = d2000
ur = dr2000*pmf
ud = dd2000*pmf
px = p2000
rv = v2000

!  Express as a pv-vector.
pxvf = px*vf
w = rv*pxvf
call S2PV ( r, d, 1d0, ur, ud, w, r0 )

!  Convert pv-vector to Bessel-Newcomb system (cf. Seidelmann 3.592-1).
do 4 l = 1,2
   do 3 k=1,3
      w = 0d0
      do 2 j=1,2
         do 1 i=1,3
            w = w + emi(i,j,k,l)*r0(i,j)
1          continue
2       continue
      r1(k,l) = w
3    continue
4 continue

!  Apply E-terms (equivalent to Seidelmann 3.592-3, two iterations).

!  Direction.
call PM ( r1, wr )
call PDP ( r1, a, w )
call SXP ( w, r1, p1 )
call SXP ( wr, a, p2 )
call PMP ( p2, p1, p3 )
call PPP ( r1, p3, p1 )

!  Recompute length.
call PM ( p1, wr )

!  Direction.
call PDP ( r1, a, w )
call SXP ( w, r1, p1 )
call SXP ( wr, a, p2 )
call PMP ( p2, p1, p3 )
call PPP ( r1, p3, pv )

!  Derivative.
call PDP ( r1, a(1,2), w )
call SXP ( w, pv, p1 )
call SXP ( wr, a(1,2), p2 )
call PMP ( p2, p1, p3 )
call PPP ( r1(1,2), p3, pv(1,2) )

!  Revert to catalog form.
call PV2S ( pv, r, d, w, ur, ud, rd )
if ( px>tiny ) then
   rv = rd/pxvf
   px = px/w
end if

!  Return the results.
r1950 = ANP(r)
d1950 = d
dr1950 = ur/pmf
dd1950 = ud/pmf
p1950 = px
v1950 = rv

end subroutine FK524
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine FK52H ( r5, d5, dr5, dd5, px5, rv5, &
                       rh, dh, drh, ddh, pxh, rvh )
!>
!  Transform FK5 (J2000.0) star data into the Hipparcos system.
!
!  Status:  support routine.
!
!  Given (all FK5, equinox J2000.0, epoch J2000.0):
!     R5        d      RA (radians)
!     D5        d      Dec (radians)
!     DR5       d      proper motion in RA (dRA/dt, rad/Jyear)
!     DD5       d      proper motion in Dec (dDec/dt, rad/Jyear)
!     PX5       d      parallax (arcsec)
!     RV5       d      radial velocity (km/s, positive = receding)
!
!  Returned (all Hipparcos, epoch J2000.0):
!     RH        d      RA (radians)
!     DH        d      Dec (radians)
!     DRH       d      proper motion in RA (dRA/dt, rad/Jyear)
!     DDH       d      proper motion in Dec (dDec/dt, rad/Jyear)
!     PXH       d      parallax (arcsec)
!     RVH       d      radial velocity (km/s, positive = receding)
!
!  Notes:
!
!  1) This routine transforms FK5 star positions and proper motions into
!     the system of the Hipparcos catalog.
!
!  2) The proper motions in RA are dRA/dt rather than cos(Dec)*dRA/dt,
!     and are per year rather than per century.
!
!  3) The FK5 to Hipparcos transformation is modeled as a pure rotation
!     and spin;  zonal errors in the FK5 catalog are not taken into
!     account.
!
!  4) See also H2FK5, FK5HZ, HFK5Z.
!
!  Called:
!     STARPV   star catalog data to space motion pv-vector
!     FK5HIP   FK5 to Hipparcos rotation and spin
!     RXP      product of r-matrix and p-vector
!     PXP      vector product of two p-vectors
!     PPP      p-vector plus p-vector
!     PVSTAR   space motion pv-vector to star catalog data
!
!  Reference:
!
!     F.Mignard & M.Froeschle, Astron.Astrophys., 354, 732-739 (2000).
!
!  This revision:  2017 October 12
!
!-----------------------------------------------------------------------

implicit none

double precision r5, d5, dr5, dd5, px5, rv5, &
                 rh, dh, drh, ddh, pxh, rvh

double precision pv5(3,2), r5h(3,3), s5h(3), wxp(3), vv(3), &
                 pvh(3,2)
integer j, i

!  FK5 barycentric position/velocity pv-vector (normalized).
call STARPV ( r5, d5, dr5, dd5, px5, rv5, pv5, j )

!  FK5 to Hipparcos orientation matrix and spin vector.
call FK5HIP ( r5h, s5h )

!  Make spin units per day instead of per year.
do 1 i=1,3
   s5h(i) = s5h(i) / 365.25d0
1 continue

!  Orient the FK5 position into the Hipparcos system.
call RXP ( r5h, pv5(1,1), pvh(1,1) )

!  Apply spin to the position giving an extra space motion component.
call PXP ( pv5(1,1), s5h, wxp )

!  Add this component to the FK5 space motion.
call PPP ( wxp, pv5(1,2), vv )

!  Orient the FK5 space motion into the Hipparcos system.
call RXP ( r5h, vv, pvh(1,2) )

!  Hipparcos pv-vector to spherical.
call PVSTAR ( pvh, rh, dh, drh, ddh, pxh, rvh, j )

end subroutine FK52H
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine FK54Z ( r2000, d2000, bepoch, &
                       r1950, d1950, dr1950, dd1950 )
!>
!  Convert a J2000.0 FK5 star position to B1950.0 FK4, assuming zero
!  proper motion in FK5 and parallax.
!
!  Status:  support routine.
!
!  Given:
!     R2000,D2000      d     J2000.0 FK5 RA,Dec (rad)
!     BEPOCH           d     Besselian epoch (e.g. 1950D0)
!
!  Returned:
!     R1950,D1950      d     B1950.0 FK4 RA,Dec (rad) at epoch BEPOCH
!     DR1950,DD1950    d     B1950.0 FK4 proper motions (rad/trop.yr)
!
!  Notes:
!
!  1) In contrast to the FK524 routine, here the FK5 proper motions,
!     the parallax and the radial velocity are presumed zero.
!
!  2) This routine converts a star position from the IAU 1976 FK5
!     (Fricke) system to the former FK4 (Bessel-Newcomb) system, for
!     cases such as distant radio sources where it is presumed there is
!     zero parallax and no proper motion.  Because of the E-terms of
!     aberration, such objects have (in general) non-zero proper motion
!     in FK4, and the present routine returns those fictitious proper
!     motions.
!
!  3) Conversion from B1950.0 FK4 to J2000.0 FK5 only is provided for.
!     Conversions involving other equinoxes would require additional
!     treatment for precession.
!
!  4) The position returned by this routine is in the B1950.0 FK4
!     reference system but at Besselian epoch BEPOCH.  For comparison
!     with catalogs the BEPOCH argument will frequently be 1950D0.  (In
!     this context the distinction between Besselian and Julian epoch is
!     insignificant.)
!
!  5) The RA component of the returned (fictitious) proper motion is
!     dRA/dt rather than cos(Dec)*dRA/dt.
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!     C2S      p-vector to spherical
!     FK524    FK4 to FK5
!     S2C      spherical to p-vector
!
!  This revision:   2018 January 11
!
!-----------------------------------------------------------------------

implicit none

double precision r2000, d2000, bepoch, &
                 r1950, d1950, dr1950, dd1950

double precision r, d, pr, pd, px, rv, p(3), w, v(3)
integer i

!     DOUBLE PRECISION ANP

!  FK5 equinox J2000.0 to FK4 equinox B1950.0.
call FK524 ( r2000, d2000, 0d0, 0d0, 0d0, 0d0, &
                 r, d, pr, pd, px, rv )

!  Spherical to Cartesian.
call S2C ( r, d, p )

!  Fictitious proper motion (radians per year).
v(1) = - pr*p(2) - pd*cos(r)*sin(d)
v(2) =   pr*p(1) - pd*sin(r)*sin(d)
v(3) =             pd*cos(d)

!  Apply the motion.
w = bepoch - 1950d0
do 1 i=1,3
   p(i) = p(i) + w*v(i)
1 continue

!  Cartesian to spherical.
call C2S ( p, w, d1950 )
r1950 = ANP ( w )

!  Fictitious proper motion.
dr1950 = pr
dd1950 = pd

end subroutine FK54Z
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine FK5HIP ( r5h, s5h )
!>
!  FK5 to Hipparcos rotation and spin.
!
!  Status:  support routine.
!
!  Returned:
!     R5H     d(3,3)   r-matrix: FK5 rotation wrt Hipparcos (Note 2)
!     S5H     d(3)     r-vector: FK5 spin wrt Hipparcos (Note 3)
!
!  Notes:
!
!  1) This routine models the FK5 to Hipparcos transformation as a
!     pure rotation and spin;  zonal errors in the FK5 catalogue are
!     not taken into account.
!
!  2) The r-matrix R5H operates in the sense:
!
!           P_Hipparcos = R5H x P_FK5
!
!     where P_FK5 is a p-vector in the FK5 frame, and P_Hipparcos is
!     the equivalent Hipparcos p-vector.
!
!  3) The r-vector S5H represents the time derivative of the FK5 to
!     Hipparcos rotation.  The units are radians per year (Julian,
!     TDB).
!
!  Called:
!     RV2M     r-vector to r-matrix
!
!  Reference:
!
!     F.Mignard & M.Froeschle, Astron.Astrophys., 354, 732-739 (2000).
!
!  This revision:  2017 October 12
!
!-----------------------------------------------------------------------

implicit none

double precision r5h(3,3), s5h(3)

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  FK5 to Hipparcos orientation and spin (radians, radians/year)
double precision epx, epy, epz
double precision omx, omy, omz

parameter ( epx = -19.9d-3 * das2r, &
            epy =  -9.1d-3 * das2r, &
            epz = +22.9d-3 * das2r )

parameter ( omx = -0.30d-3 * das2r, &
            omy = +0.60d-3 * das2r, &
            omz = +0.70d-3 * das2r )

double precision v(3)

!  FK5 to Hipparcos orientation expressed as an r-vector.
v(1) = epx
v(2) = epy
v(3) = epz

!  Re-express as an r-matrix.
call RV2M ( v, r5h )

!  Hipparcos wrt FK5 spin expressed as an r-vector.
s5h(1) = omx
s5h(2) = omy
s5h(3) = omz

end subroutine FK5HIP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine FK5HZ ( r5, d5, date1, date2, rh, dh )
!>
!  Transform an FK5 (J2000.0) star position into the system of the
!  Hipparcos catalogue, assuming zero Hipparcos proper motion.
!
!  Status:  support routine.
!
!  Given:
!     R5              d      FK5 RA (radians), equinox J2000.0, at date
!     D5              d      FK5 Dec (radians), equinox J2000.0, at date
!     DATE1,DATE2     d      TDB date (Notes 1,2)
!
!  Returned:
!     RH              d      Hipparcos RA (radians)
!     DH              d      Hipparcos Dec (radians)
!
!  Notes:
!
!  1) This routine converts a star position from the FK5 system to
!     the Hipparcos system, in such a way that the Hipparcos proper
!     motion is zero.  Because such a star has, in general, a non-zero
!     proper motion in the FK5 system, the routine requires the date
!     at which the position in the FK5 system was determined.
!
!  2) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  3) The FK5 to Hipparcos transformation is modeled as a pure
!     rotation and spin;  zonal errors in the FK5 catalogue are
!     not taken into account.
!
!  4) The position returned by this routine is in the Hipparcos
!     reference system but at date DATE1+DATE2.
!
!  5) See also FK52H, H2FK5, HFK5Z.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     FK5HIP   FK5 to Hipparcos rotation and spin
!     SXP      multiply p-vector by scalar
!     RV2M     r-vector to r-matrix
!     TRXP     product of transpose of r-matrix and p-vector
!     PXP      vector product of two p-vectors
!     C2S      p-vector to spherical
!     ANP      normalize angle into range 0 to 2pi
!
!  Reference:
!
!     F.Mignard & M.Froeschle, Astron. Astrophys. 354, 732-739 (2000).
!
!  This revision:  2012 September 5
!
!-----------------------------------------------------------------------

implicit none

double precision r5, d5, date1, date2, rh, dh

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian year
double precision djy
parameter ( djy = 365.25d0 )

double precision t, p5e(3), r5h(3,3), s5h(3), vst(3), rst(3,3), &
                 p5(3), ph(3), w

!     DOUBLE PRECISION ANP

!  Interval from given date to fundamental epoch J2000.0 (JY).
t = - ( ( date1-dj00 ) + date2 ) / djy

!  FK5 barycentric position vector.
call S2C ( r5, d5, p5e )

!  FK5 to Hipparcos orientation matrix and spin vector.
call FK5HIP ( r5h, s5h )

!  Accumulated Hipparcos wrt FK5 spin over that interval.
call SXP ( t, s5h, vst )

!  Express the accumulated spin as a rotation matrix.
call RV2M ( vst, rst )

!  Derotate the vector's FK5 axes back to date.
call TRXP ( rst, p5e, p5 )

!  Rotate the vector into the Hipparcos system.
call RXP ( r5h, p5, ph )

!  Hipparcos vector to spherical.
call C2S ( ph, w, dh )
rh = ANP ( w )

end subroutine FK5HZ
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine FW2M ( gamb, phib, psi, eps, r )
!>
!  Form rotation matrix given the Fukushima-Williams angles.
!
!  Status:  support routine.
!
!  Given:
!     GAMB       d      F-W angle gamma_bar (radians)
!     PHIB       d      F-W angle phi_bar (radians)
!     PSI        d      F-W angle psi (radians)
!     EPS        d      F-W angle epsilon (radians)
!
!  Returned:
!     R        d(3,3)   rotation matrix
!
!  Notes:
!
!  1) Naming the following points:
!
!           e = J2000.0 ecliptic pole,
!           p = GCRS pole,
!           E = ecliptic pole of date,
!     and   P = CIP,
!
!     the four Fukushima-Williams angles are as follows:
!
!        GAMB = gamma = epE
!        PHIB = phi = pE
!        PSI = psi = pEP
!        EPS = epsilon = EP
!
!  2) The matrix representing the combined effects of frame bias,
!     precession and nutation is:
!
!        NxPxB = R_1(-EPS).R_3(-PSI).R_1(PHIB).R_3(GAMB)
!
!  3) Three different matrices can be constructed, depending on the
!     supplied angles:
!
!     o  To obtain the nutation x precession x frame bias matrix,
!        generate the four precession angles, generate the nutation
!        components and add them to the psi_bar and epsilon_A angles,
!        and call the present routine.
!
!     o  To obtain the precession x frame bias matrix, generate the
!        four precession angles and call the present routine.
!
!     o  To obtain the frame bias matrix, generate the four precession
!        angles for date J2000.0 and call the present routine.
!
!     The nutation-only and precession-only matrices can if necessary
!     be obtained by combining these three appropriately.
!
!  Called:
!     IR       initialize r-matrix to identity
!     RZ       rotate around Z-axis
!     RX       rotate around X-axis
!
!  Reference:
!
!     Hilton, J. et al., 2006, Celest.Mech.Dyn.Astron. 94, 351
!
!  This revision:   2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision gamb, phib, psi, eps, r(3,3)

!  Construct the matrix.
call IR ( r )
call RZ ( gamb, r )
call RX ( phib, r )
call RZ ( -psi, r )
call RX ( -eps, r )

end subroutine FW2M
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine FW2XY ( gamb, phib, psi, eps, x, y )
!>
!  CIP X,Y given Fukushima-Williams bias-precession-nutation angles.
!
!  Status:  support routine.
!
!  Given:
!     GAMB       d      F-W angle gamma_bar (radians)
!     PHIB       d      F-W angle phi_bar (radians)
!     PSI        d      F-W angle psi (radians)
!     EPS        d      F-W angle epsilon (radians)
!
!  Returned:
!     X,Y        d      CIP unit vector X,Y
!
!  Notes:
!
!  1) Naming the following points:
!
!           e = J2000.0 ecliptic pole,
!           p = GCRS pole
!           E = ecliptic pole of date,
!     and   P = CIP,
!
!     the four Fukushima-Williams angles are as follows:
!
!        GAMB = gamma = epE
!        PHIB = phi = pE
!        PSI = psi = pEP
!        EPS = epsilon = EP
!
!  2) The matrix representing the combined effects of frame bias,
!     precession and nutation is:
!
!        NxPxB = R_1(-EPSA).R_3(-PSI).R_1(PHIB).R_3(GAMB)
!
!     The returned values x,y are elements (3,1) and (3,2) of the
!     matrix.  Near J2000.0, they are essentially angles in radians.
!
!  Called:
!     FW2M     F-W angles to r-matrix
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!
!  Reference:
!
!     Hilton, J. et al., 2006, Celest.Mech.Dyn.Astron. 94, 351
!
!  This revision:   2013 September 2
!
!-----------------------------------------------------------------------

implicit none

double precision gamb, phib, psi, eps, x, y

double precision r(3,3)

!  Form NxPxB matrix.
call FW2M ( gamb, phib, psi, eps, r )

!  Extract CIP X,Y.
call BPN2XY ( r, x, y )

end subroutine FW2XY
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine G2ICRS ( dl, db, dr, dd )
!>
!  Transformation from Galactic Coordinates to ICRS.
!
!  Status:  support routine.
!
!  Given:
!     DL       d      galactic longitude (radians)
!     DB       d      galactic latitude (radians)
!
!  Returned:
!     DR       d      ICRS right ascension (radians)
!     DD       d      ICRS declination (radians)
!
!  Notes:
!
!  1) The IAU 1958 system of Galactic coordinates was defined with
!     respect to the now obsolete reference system FK4 B1950.0.  When
!     interpreting the system in a modern context, several factors have
!     to be taken into account:
!
!     . The inclusion in FK4 positions of the E-terms of aberration.
!
!     . The distortion of the FK4 proper motion system by differential
!       Galactic rotation.
!
!     . The use of the B1950.0 equinox rather than the now-standard
!       J2000.0.
!
!     . The frame bias between ICRS and the J2000.0 mean place system.
!
!     The Hipparcos Catalogue (Perryman & ESA 1997) provides a rotation
!     matrix that transforms directly between ICRS and Galactic
!     coordinates with the above factors taken into account.  The
!     matrix is derived from three angles, namely the ICRS coordinates
!     of the Galactic pole and the longitude of the ascending node of
!     the galactic equator on the ICRS equator.  They are given in
!     degrees to five decimal places and for canonical purposes are
!     regarded as exact.  In the Hipparcos Catalogue the matrix elements
!     are given to 10 decimal places (about 20 microarcsec).  In the
!     present SOFA routine the matrix elements have been recomputed from
!     the canonical three angles and are given to 30 decimal places.
!
!  2) The inverse transformation is performed by the routine ICRS2G.
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!     ANPM     normalize angle into range +/- pi
!     S2C      spherical coordinates to unit vector
!     TRXP     product of transpose of r-matrix and p-vector
!     C2S      p-vector to spherical
!
!  Reference:
!     Perryman M.A.C. & ESA, 1997, ESA SP-1200, The Hipparcos and Tycho
!     catalogues.  Astrometric and photometric star catalogues
!     derived from the ESA Hipparcos Space Astrometry Mission.  ESA
!     Publications Division, Noordwijk, Netherlands.
!
!  This revision:   2015 January 9
!
!-----------------------------------------------------------------------

implicit none
double precision dl, db, dr, dd

!     DOUBLE PRECISION ANP, ANPM

double precision v1(3), v2(3)

!
!  L2,B2 system of galactic coordinates in the form presented in the
!  Hipparcos Catalogue.  In degrees:
!
!  P = 192.85948    right ascension of the Galactic north pole in ICRS
!  Q =  27.12825    declination of the Galactic north pole in ICRS
!  R =  32.93192    longitude of the ascending node of the Galactic
!                   plane on the ICRS equator
!
!  ICRS to galactic rotation matrix, obtained by computing
!  R_3(-R) R_1(pi/2-Q) R_3(pi/2+P) to the full precision shown:
!
double precision r(3,3)
data r(1,1), r(1,2), r(1,3), &
     r(2,1), r(2,2), r(2,3), &
     r(3,1), r(3,2), r(3,3) / &
    -0.054875560416215368492398900454d0, &
    -0.873437090234885048760383168409d0, &
    -0.483835015548713226831774175116d0, &
    +0.494109427875583673525222371358d0, &
    -0.444829629960011178146614061616d0, &
    +0.746982244497218890527388004556d0, &
    -0.867666149019004701181616534570d0, &
    -0.198076373431201528180486091412d0, &
    +0.455983776175066922272100478348d0 /

!  Spherical to Cartesian.
call S2C ( dl, db, v1 )

!  Galactic to ICRS.
call TRXP ( r, v1, v2 )

!  Cartesian to spherical.
call C2S ( v2, dr, dd )

!  Express in conventional ranges.
dr = ANP ( dr )
dd = ANPM ( dd )

end subroutine G2ICRS
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine GC2GD ( n, xyz, elong, phi, height, j )
!>
!  Transform geocentric coordinates to geodetic using the specified
!  reference ellipsoid.
!
!  Status:  canonical transformation.
!
!  Given:
!     N         i     ellipsoid identifier (Note 1)
!     XYZ       d(3)  geocentric vector (Note 2)
!
!  Returned:
!     ELONG     d     longitude (radians, east +ve, Note 3)
!     PHI       d     latitude (geodetic, radians, Note 3)
!     HEIGHT    d     height above ellipsoid (geodetic, Notes 2,3)
!     J         i     status:  0 = OK
!                             -1 = illegal identifier (Note 3)
!                             -2 = internal error (Note 3)
!
!  Notes:
!
!  1) The identifier N is a number that specifies the choice of
!     reference ellipsoid.  The following are supported:
!
!        N   ellipsoid
!
!        1    WGS84
!        2    GRS80
!        3    WGS72
!
!     The number N has no significance outside the SOFA software.
!
!  2) The geocentric vector (XYZ, given) and height (HEIGHT, returned)
!     are in meters.
!
!  3) An error status J=-1 means that the identifier N is illegal.  An
!     error status J=-2 is theoretically impossible.  In all error
!     cases, all three results are set to -1D9.
!
!  4) The inverse transformation is performed in the routine GD2GC.
!
!  Called:
!     EFORM    Earth reference ellipsoids
!     GC2GDE   geocentric to geodetic transformation, general
!
!  This revision:  2013 September 1
!
!-----------------------------------------------------------------------

implicit none

integer n
double precision xyz(3), elong, phi, height
integer j

double precision a, f

!  Obtain reference ellipsoid parameters.
call EFORM ( n, a, f, j )

!  If OK, transform x,y,z to longitude, geodetic latitude, height.
if ( j==0 ) then
   call GC2GDE ( a, f, xyz, elong, phi, height, j )
   if ( j<0 ) j=-2
end if

!  Deal with any errors.
if ( j<0 ) then
   elong = -1d9
   phi = -1d9
   height = -1d9
end if

end subroutine GC2GD
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine GC2GDE ( a, f, xyz, elong, phi, height, j )
!>
!  Transform geocentric coordinates to geodetic for a reference
!  ellipsoid of specified form.
!
!  Status:  support routine.
!
!  Given:
!     A         d      equatorial radius (Notes 2,4)
!     F         d      flattening (Note 3)
!     XYZ       d(3)   geocentric vector (Note 4)
!
!  Returned:
!     ELONG     d      longitude (radians, east +ve)
!     PHI       d      latitude (geodetic, radians)
!     HEIGHT    d      height above ellipsoid (geodetic, Note 4)
!     J         i      status:  0 = OK
!                              -1 = illegal F
!                              -2 = illegal A
!
!  Notes:
!
!  1) This routine is closely based on the GCONV2H subroutine by
!     Toshio Fukushima (see reference).
!
!  2) The equatorial radius, A, can be in any units, but meters is
!     the conventional choice.
!
!  3) The flattening, F, is (for the Earth) a value around 0.00335,
!     i.e. around 1/298.
!
!  4) The equatorial radius, A, and the geocentric vector, XYZ,
!     must be given in the same units, and determine the units of
!     the returned height, HEIGHT.
!
!  5) If an error occurs (J<0), ELONG, PHI and HEIGHT are unchanged.
!
!  6) The inverse transformation is performed in the routine GD2GCE.
!
!  7) The transformation for a standard ellipsoid (such as WGS84) can
!     more conveniently be performed by calling GC2GD, which uses a
!     numerical code (1 for WGS84) to identify the required A and F
!     values.
!
!  Reference:
!
!     Fukushima, T., "Transformation from Cartesian to geodetic
!     coordinates accelerated by Halley's method", J.Geodesy (2006)
!     79: 689-693
!
!  This revision:  2014 November 7
!
!-----------------------------------------------------------------------

implicit none

double precision a, f, xyz(3), elong, phi, height
integer j

!  Pi
double precision dpi
parameter ( dpi = 3.141592653589793238462643d0 )

double precision aeps2, e2, e4t, ec2, ec, b, x, y, z, p2, absz, p, &
                 s0, pn, zc, c0, c02, c03, s02, s03, a02, a0, a03, &
                 d0, f0, b0, s1, cc, s12, cc2

!  -------------
!  Preliminaries
!  -------------

!  Validate ellipsoid parameters.
if ( f<0d0 .or. f>=1d0 ) then
   j = -1
   go to 9999
else if ( a <= 0d0 ) then
   j = -2
   go to 9999
end if

!  Functions of ellipsoid parameters (with further validation of F).
aeps2 = a*a*1d-32
e2 = (2d0-f)*f
e4t = e2*e2*1.5d0
ec2 = 1d0-e2
if ( ec2 <= 0d0 ) then
   j = -1
   go to 9999
end if
ec = sqrt(ec2)
b = a*ec

!  Cartesian components.
x = xyz(1)
y = xyz(2)
z = xyz(3)

!  Distance from polar axis squared.
p2 = x*x + y*y

!  Longitude.
if ( p2>0d0 ) then
   elong = atan2(y,x)
else
   elong = 0d0
end if

!  Unsigned z-coordinate.
absz = abs(z)

!  Proceed unless polar case.
if ( p2>aeps2 ) then

!     Distance from polar axis.
   p = sqrt(p2)

!     Normalization.
   s0 = absz/a
   pn = p/a
   zc = ec*s0

!     Prepare Newton correction factors.
   c0 = ec*pn
   c02 = c0*c0
   c03 = c02*c0
   s02 = s0*s0
   s03 = s02*s0
   a02 = c02+s02
   a0 = sqrt(a02)
   a03 = a02*a0
   d0 = zc*a03 + e2*s03
   f0 = pn*a03 - e2*c03

!     Prepare Halley correction factor.
   b0 = e4t*s02*c02*pn*(a0-ec)
   s1 = d0*f0 - b0*s0
   cc = ec*(f0*f0-b0*c0)

!     Evaluate latitude and height.
   phi = atan(s1/cc)
   s12 = s1*s1
   cc2 = cc*cc
   height = (p*cc+absz*s1-a*sqrt(ec2*s12+cc2))/sqrt(s12+cc2)
else

!     Exception: pole.
   phi = dpi/2d0
   height = absz-b
end if

!  Restore sign of latitude.
if ( z<0d0 ) phi = -phi

!  OK status.
j = 0

!  Finished.
9999 continue

end subroutine GC2GDE
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine GD2GC ( n, elong, phi, height, xyz, j )
!>
!  Transform geodetic coordinates to geocentric using the specified
!  reference ellipsoid.
!
!  Status:  canonical transformation.
!
!  Given:
!     N         i     ellipsoid identifier (Note 1)
!     ELONG     d     longitude (radians, east +ve)
!     PHI       d     latitude (geodetic, radians, Note 3)
!     HEIGHT    d     height above ellipsoid (geodetic, Notes 2,3)
!
!  Returned:
!     XYZ       d(3)  geocentric vector (Note 2)
!     J         i     status:  0 = OK
!                             -1 = illegal identifier (Note 3)
!                             -2 = illegal case (Note 3)
!
!  Notes:
!
!  1) The identifier N is a number that specifies the choice of
!     reference ellipsoid.  The following are supported:
!
!        N   ellipsoid
!
!        1    WGS84
!        2    GRS80
!        3    WGS72
!
!     The number N has no significance outside the SOFA software.
!
!  2) The height (HEIGHT, given) and the geocentric vector (XYZ,
!     returned) are in meters.
!
!  3) No validation is performed on the arguments ELONG, PHI and HEIGHT.
!     An error status J=-1 means that the identifier N is illegal.  An
!     error status J=-2 protects against cases that would lead to
!     arithmetic exceptions.  In all error cases, XYZ is set to zeros.
!
!  4) The inverse transformation is performed in the routine GC2GD.
!
!  Called:
!     EFORM    Earth reference ellipsoids
!     GD2GCE   geodetic to geocentric transformation, general
!     ZP       zero p-vector
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

integer n
double precision elong, phi, height, xyz(3)
integer j

double precision a, f

!  Obtain reference ellipsoid parameters.
call EFORM ( n, a, f, j )

!  If OK, transform longitude, geodetic latitude, height to x,y,z.
if ( j==0 ) then
   call GD2GCE ( a, f, elong, phi, height, xyz, j )
   if ( j/=0 ) j=-2
end if

!  Deal with any errors.
if ( j/=0 ) call ZP ( xyz )

end subroutine GD2GC
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine GD2GCE ( a, f, elong, phi, height, xyz, j )
!>
!  Transform geodetic coordinates to geocentric for a reference
!  ellipsoid of specified form.
!
!  Status:  support routine.
!
!  Given:
!     A         d     equatorial radius (Notes 1,4)
!     F         d     flattening (Notes 2,4)
!     ELONG     d     longitude (radians, east +ve)
!     PHI       d     latitude (geodetic, radians, Note 4)
!     HEIGHT    d     height above ellipsoid (geodetic, Notes 3,4)
!
!  Returned:
!     XYZ       d(3)  geocentric vector (Note 3)
!     J         i     status:  0 = OK
!                             -1 = illegal case (Note 4)
!
!  Notes:
!
!  1) The equatorial radius, A, can be in any units, but meters is
!     the conventional choice.
!
!  2) The flattening, F, is (for the Earth) a value around 0.00335,
!     i.e. around 1/298.
!
!  3) The equatorial radius, A, and the height, HEIGHT, must be
!     given in the same units, and determine the units of the
!     returned geocentric vector, XYZ.
!
!  4) No validation is performed on individual arguments.  The error
!     status J=-1 protects against (unrealistic) cases that would lead
!     to arithmetic exceptions.  If an error occurs, XYZ is unchanged.
!
!  5) The inverse transformation is performed in the routine GC2GDE.
!
!  6) The transformation for a standard ellipsoid (such as WGS84) can
!     more conveniently be performed by calling GD2GC, which uses a
!     numerical code (1 for WGS84) to identify the required A and F
!     values.
!
!  References:
!
!     Green, R.M., Spherical Astronomy, Cambridge University Press,
!     (1985) Section 4.5, p96.
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Section 4.22, p202.
!
!  This revision:  2009 November 2
!
!-----------------------------------------------------------------------

implicit none

double precision a, f, elong, phi, height, xyz(3)
integer j

double precision sp, cp, w, d, ac, as, r

!  Functions of geodetic latitude.
sp = sin(phi)
cp = cos(phi)
w = 1d0-f
w = w*w
d = cp*cp + w*sp*sp
if ( d > 0d0 ) then
   ac = a / sqrt(d)
   as = w * ac

!     Geocentric vector.
   r = ( ac + height ) * cp
   xyz(1) = r * cos(elong)
   xyz(2) = r * sin(elong)
   xyz(3) = ( as + height ) * sp

!     Success.
   j = 0
else

!     Fail.
   j = -1
end if

end subroutine GD2GCE
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function GMST00 ( uta, utb, tta, ttb )
!>
!  Greenwich Mean Sidereal Time (model consistent with IAU 2000
!  resolutions).
!
!  Status:  canonical model.
!
!  Given:
!     UTA, UTB     d      UT1 as a 2-part Julian Date (Notes 1,2)
!     TTA, TTB     d      TT as a 2-part Julian Date (Notes 1,2)
!
!  Returned:
!     GMST00   d      Greenwich mean sidereal time (radians)
!
!  Notes:
!
!  1) The UT1 and TT dates UTA+UTB and TTA+TTB respectively, are both
!     Julian Dates, apportioned in any convenient way between the
!     argument pairs.  For example, JD=2450123.7 could be expressed in
!     any of these ways, among others:
!
!            Part A         Part B
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable (in the case of UT;  the TT is not at all critical
!     in this respect).  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  For UT, the date & time
!     method is best matched to the algorithm that is used by the Earth
!     Rotation Angle routine, called internally:  maximum accuracy (or,
!     at least, minimum noise) is delivered when the UTA argument is for
!     0hrs UT1 on the day in question and the UTB argument lies in the
!     range 0 to 1, or vice versa.
!
!  2) Both UT1 and TT are required, UT1 to predict the Earth rotation
!     and TT to predict the effects of precession.  If UT1 is used for
!     both purposes, errors of order 100 microarcseconds result.
!
!  3) This GMST is compatible with the IAU 2000 resolutions and must be
!     used only in conjunction with other IAU 2000 compatible components
!     such as precession-nutation and equation of the equinoxes.
!
!  4) The result is returned in the range 0 to 2pi.
!
!  5) The algorithm is from Capitaine et al. (2003) and IERS Conventions
!     2003.
!
!  Called:
!     ERA00    Earth rotation angle, IAU 2000
!     ANP      normalize angle into range 0 to 2pi
!
!  References:
!
!     Capitaine, N., Wallace, P.T. and McCarthy, D.D., "Expressions to
!     implement the IAU 2000 definition of UT1", Astronomy &
!     Astrophysics, 406, 1135-1149 (2003)
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision uta, utb, tta, ttb

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t

!     DOUBLE PRECISION ANP, ERA00

!  TT Julian centuries since J2000.0.
t = ( ( tta-dj00 ) + ttb ) / djc

!  Greenwich Mean Sidereal Time, IAU 2000.
GMST00 = ANP ( ERA00 ( uta, utb ) + &
                       (    0.014506d0   + &
                       ( 4612.15739966d0 + &
                       (  + 1.39667721d0 + &
                       (  - 0.00009344d0 + &
                       (  + 0.00001882d0 ) &
                                 * t ) * t ) * t ) * t ) * das2r )

end function GMST00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function GMST06 ( uta, utb, tta, ttb )
!>
!  Greenwich mean sidereal time (consistent with IAU 2006 precession).
!
!  Status:  canonical model.
!
!  Given:
!     UTA, UTB     d      UT1 as a 2-part Julian Date (Notes 1,2)
!     TTA, TTB     d      TT as a 2-part Julian Date (Notes 1,2)
!
!  Returned:
!     GMST06   d      Greenwich mean sidereal time (radians)
!
!  Notes:
!
!  1) The UT1 and TT dates UTA+UTB and TTA+TTB respectively, are both
!     Julian Dates, apportioned in any convenient way between the
!     argument pairs.  For example, JD=2450123.7 could be expressed in
!     any of these ways, among others:
!
!            Part A         Part B
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable (in the case of UT;  the TT is not at all critical
!     in this respect).  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  For UT, the date & time
!     method is best matched to the algorithm that is used by the Earth
!     rotation angle routine, called internally:  maximum accuracy (or,
!     at least, minimum noise) is delivered when the UTA argument is for
!     0hrs UT1 on the day in question and the UTB argument lies in the
!     range 0 to 1, or vice versa.
!
!  2) Both UT1 and TT are required, UT1 to predict the Earth rotation
!     and TT to predict the effects of precession.  If UT1 is used for
!     both purposes, errors of order 100 microarcseconds result.
!
!  3) This GMST is compatible with the IAU 2006 precession and must not
!     be used with other precession models.
!
!  4) The result is returned in the range 0 to 2pi.
!
!  Called:
!     ERA00    Earth rotation angle, IAU 2000
!     ANP      normalize angle into range 0 to 2pi
!
!  Reference:
!
!     Capitaine, N., Wallace, P.T. & Chapront, J., 2005,
!     Astron.Astrophys. 432, 355
!
!  This revision:  2010 March 9
!
!-----------------------------------------------------------------------

implicit none

double precision uta, utb, tta, ttb

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t

!     DOUBLE PRECISION ANP, ERA00

!  TT Julian centuries since J2000.0.
t = ( ( tta-dj00 ) + ttb ) / djc

!  Greenwich mean sidereal time, IAU 2006.
GMST06 = ANP ( ERA00 ( uta, utb ) + &
                       (    0.014506d0    + &
                       ( 4612.156534d0    + &
                       (    1.3915817d0   + &
                       (  - 0.00000044d0  + &
                       (  - 0.000029956d0 + &
                       (  - 0.0000000368d0 ) &
                           * t ) * t ) * t ) * t ) * t ) * das2r )

end function GMST06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function GMST82 ( dj1, dj2 )
!>
!  Universal Time to Greenwich Mean Sidereal Time (IAU 1982 model).
!
!  Status:  canonical model.
!
!  Given:
!     DJ1, DJ2     d      UT1 Julian Date (see note)
!
!  Returned:
!     GMST82   d      Greenwich mean sidereal time (radians)
!
!  Notes:
!
!  1) The UT1 epoch DJ1+DJ2 is a Julian Date, apportioned in any
!     convenient way between the arguments DJ1 and DJ2.  For example,
!     JD(UT1)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!             DJ1            DJ2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  The date & time method is
!     best matched to the algorithm used:  maximum accuracy (or, at
!     least, minimum noise) is delivered when the DJ1 argument is for
!     0hrs UT1 on the day in question and the DJ2 argument lies in the
!     range 0 to 1, or vice versa.
!
!  2) The algorithm is based on the IAU 1982 expression.  This is always
!     described as giving the GMST at 0 hours UT1.  In fact, it gives the
!     difference between the GMST and the UT, the steady 4-minutes-per-day
!     drawing-ahead of ST with respect to UT.  When whole days are ignored,
!     the expression happens to equal the GMST at 0 hours UT1 each day.
!
!  3) In this routine, the entire UT1 (the sum of the two arguments DJ1
!     and DJ2) is used directly as the argument for the standard formula,
!     the constant term of which is adjusted by 12 hours to take account
!     of the noon phasing of Julian Date.  The UT1 is then added, but
!     omitting whole days to conserve accuracy.
!
!  4) The result is returned in the range 0 to 2pi.
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!
!  References:
!
!     Transactions of the International Astronomical Union,
!     XVIII B, 67 (1983).
!
!     Aoki et al., Astron.Astrophys., 105, 359-361 (1982).
!
!  This revision:  2017 October 12
!
!-----------------------------------------------------------------------

implicit none

double precision dj1, dj2

!  Seconds of time to radians
double precision ds2r
parameter ( ds2r = 7.272205216643039903848712d-5 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Seconds per day, days per Julian century
double precision d2s, djc
parameter ( d2s = 86400d0, djc = 36525d0 )

!  Coefficients of IAU 1982 GMST-UT1 model
double precision a, b, c, d
parameter ( a = 24110.54841d0 - d2s/2d0, &
            b = 8640184.812866d0, &
            c = 0.093104d0, &
            d = -6.2d-6 )

!  Note: the first constant, A, has to be adjusted by 12 hours because
!  the UT1 is supplied as a Julian date, which begins at noon.

double precision d1, d2, t, f

!     DOUBLE PRECISION ANP

!  Julian centuries since fundamental epoch.
if ( dj1 < dj2 ) then
   d1 = dj1
   d2 = dj2
else
   d1 = dj2
   d2 = dj1
end if
t = ( d1 + ( d2-dj00 ) ) / djc

!  Fractional part of JD(UT1), in seconds.
f = d2s * ( mod(d1,1d0) + mod(d2,1d0) )

!  GMST at this UT1.
GMST82 = ANP ( ds2r * ( (a+(b+(c+d*t)*t)*t) + f ) )

end function GMST82
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function GST00A ( uta, utb, tta, ttb )
!>
!  Greenwich Apparent Sidereal Time (consistent with IAU 2000
!  resolutions).
!
!  Status:  canonical model.
!
!  Given:
!     UTA, UTB     d      UT1 as a 2-part Julian Date (Notes 1,2)
!     TTA, TTB     d      TT as a 2-part Julian Date (Notes 1,2)
!
!  Returned:
!     GST00A   d      Greenwich apparent sidereal time (radians)
!
!  Notes:
!
!  1) The UT1 and TT dates UTA+UTB and TTA+TTB respectively, are both
!     Julian Dates, apportioned in any convenient way between the
!     argument pairs.  For example, JD=2450123.7 could be expressed in
!     any of these ways, among others:
!
!            Part A         Part B
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable (in the case of UT;  the TT is not at all critical
!     in this respect).  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  For UT, the date & time
!     method is best matched to the algorithm that is used by the Earth
!     Rotation Angle routine, called internally:  maximum accuracy (or,
!     at least, minimum noise) is delivered when the UTA argument is for
!     0hrs UT1 on the day in question and the UTB argument lies in the
!     range 0 to 1, or vice versa.
!
!  2) Both UT1 and TT are required, UT1 to predict the Earth rotation
!     and TT to predict the effects of precession-nutation.  If UT1 is
!     used for both purposes, errors of order 100 microarcseconds
!     result.
!
!  3) This GAST is compatible with the IAU 2000 resolutions and must be
!     used only in conjunction with other IAU 2000 compatible components
!     such as precession-nutation.
!
!  4) The result is returned in the range 0 to 2pi.
!
!  5) The algorithm is from Capitaine et al. (2003) and IERS Conventions
!     2003.
!
!  Called:
!     GMST00   Greenwich mean sidereal time, IAU 2000
!     EE00A    equation of the equinoxes, IAU 2000A
!     ANP      normalize angle into range 0 to 2pi
!
!  References:
!
!     Capitaine, N., Wallace, P.T. and McCarthy, D.D., "Expressions to
!     implement the IAU 2000 definition of UT1", Astronomy &
!     Astrophysics, 406, 1135-1149 (2003)
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2007 December 8
!
!-----------------------------------------------------------------------

implicit none

double precision uta, utb, tta, ttb

!     DOUBLE PRECISION ANP, GMST00, EE00A

GST00A = ANP ( GMST00 ( uta,utb, tta,ttb ) + &
                       EE00A ( tta,ttb ) )

end function GST00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function GST00B ( uta, utb )
!>
!  Greenwich Apparent Sidereal Time (consistent with IAU 2000
!  resolutions but using the truncated nutation model IAU 2000B).
!
!  Status:  support routine.
!
!  Given:
!     UTA, UTB     d      UT1 as a 2-part Julian Date (Notes 1,2)
!
!  Returned:
!     GST00B   d      Greenwich apparent sidereal time (radians)
!
!  Notes:
!
!  1) The UT1 date UTA+UTB is a Julian Date, apportioned in any
!     convenient way between the argument pair.  For example,
!     JD=2450123.7 could be expressed in any of these ways, among
!     others:
!
!             UTA            UTB
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  For UT, the date & time
!     method is best matched to the algorithm that is used by the Earth
!     Rotation Angle routine, called internally:  maximum accuracy (or,
!     at least, minimum noise) is delivered when the UTA argument is for
!     0hrs UT1 on the day in question and the UTB argument lies in the
!     range 0 to 1, or vice versa.
!
!  2) The result is compatible with the IAU 2000 resolutions, except
!     that accuracy has been compromised for the sake of speed and
!     convenience in two respects:
!
!     . UT is used instead of TDB (or TT) to compute the precession
!       component of GMST and the equation of the equinoxes.  This
!       results in errors of order 0.1 mas at present.
!
!     . The IAU 2000B abridged nutation model (McCarthy & Luzum, 2001)
!       is used, introducing errors of up to 1 mas.
!
!  3) This GAST is compatible with the IAU 2000 resolutions and must be
!     used only in conjunction with other IAU 2000 compatible components
!     such as precession-nutation.
!
!  4) The result is returned in the range 0 to 2pi.
!
!  5) The algorithm is from Capitaine et al. (2003) and IERS Conventions
!     2003.
!
!  Called:
!     GMST00   Greenwich mean sidereal time, IAU 2000
!     EE00B    equation of the equinoxes, IAU 2000B
!     ANP      normalize angle into range 0 to 2pi
!
!  References:
!
!     Capitaine, N., Wallace, P.T. and McCarthy, D.D., "Expressions to
!     implement the IAU 2000 definition of UT1", Astronomy &
!     Astrophysics, 406, 1135-1149 (2003)
!
!     McCarthy, D.D. & Luzum, B.J., "An abridged model of the
!     precession-nutation of the celestial pole", Celestial Mechanics &
!     Dynamical Astronomy, 85, 37-49 (2003)
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2007 December 8
!
!-----------------------------------------------------------------------

implicit none

double precision uta, utb

!     DOUBLE PRECISION ANP, GMST00, EE00B

GST00B = ANP ( GMST00 ( uta,utb, uta,utb ) + &
                       EE00B ( uta,utb ) )

end function GST00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function GST06 ( uta, utb, tta, ttb, rnpb )
!>
!  Greenwich apparent sidereal time, IAU 2006, given the NPB matrix.
!
!  Status:  support routine.
!
!  Given:
!     UTA, UTB     d      UT1 as a 2-part Julian Date (Notes 1,2)
!     TTA, TTB     d      TT as a 2-part Julian Date (Notes 1,2)
!     RNPB       d(3,3)   nutation x precession x bias matrix
!
!  Returned:
!     GST06    d      Greenwich apparent sidereal time (radians)
!
!  Notes:
!
!  1) The UT1 and TT dates UTA+UTB and TTA+TTB respectively, are both
!     Julian Dates, apportioned in any convenient way between the
!     argument pairs.  For example, JD=2450123.7 could be expressed in
!     any of these ways, among others:
!
!            Part A         Part B
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable (in the case of UT;  the TT is not at all critical
!     in this respect).  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  For UT, the date & time
!     method is best matched to the algorithm that is used by the Earth
!     rotation angle routine, called internally:  maximum accuracy (or,
!     at least, minimum noise) is delivered when the UTA argument is for
!     0hrs UT1 on the day in question and the UTB argument lies in the
!     range 0 to 1, or vice versa.
!
!  2) Both UT1 and TT are required, UT1 to predict the Earth rotation
!     and TT to predict the effects of precession-nutation.  If UT1 is
!     used for both purposes, errors of order 100 microarcseconds
!     result.
!
!  3) Although the routine uses the IAU 2006 series for s+XY/2, it is
!     otherwise independent of the precession-nutation model and can in
!     practice be used with any equinox-based NPB matrix.
!
!  4) The result is returned in the range 0 to 2pi.
!
!  Called:
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     S06      the CIO locator s, given X,Y, IAU 2006
!     ANP      normalize angle into range 0 to 2pi
!     ERA00    Earth rotation angle, IAU 2000
!     EORS     equation of the origins, given NPB matrix and s
!
!  Reference:
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2008 January 2
!
!-----------------------------------------------------------------------

implicit none

double precision uta, utb, tta, ttb, rnpb(3,3)

double precision x, y, s

!     DOUBLE PRECISION S06, ANP, ERA00, EORS

!  Extract CIP coordinates.
call BPN2XY ( rnpb, x, y )

!  The CIO locator, s.
s = S06 ( tta, ttb, x, y )

!  Greenwich apparent sidereal time.
GST06 = ANP ( ERA00 ( uta, utb ) - &
                      EORS ( rnpb, s ) )

end function GST06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function GST06A ( uta, utb, tta, ttb )
!>
!  Greenwich apparent sidereal time (consistent with IAU 2000 and 2006
!  resolutions).
!
!  Status:  canonical model.
!
!  Given:
!     UTA, UTB     d      UT1 as a 2-part Julian Date (Notes 1,2)
!     TTA, TTB     d      TT as a 2-part Julian Date (Notes 1,2)
!
!  Returned:
!     GST06A   d      Greenwich apparent sidereal time (radians)
!
!  Notes:
!
!  1) The UT1 and TT dates UTA+UTB and TTA+TTB respectively, are both
!     Julian Dates, apportioned in any convenient way between the
!     argument pairs.  For example, JD=2450123.7 could be expressed in
!     any of these ways, among others:
!
!            Part A         Part B
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable (in the case of UT;  the TT is not at all critical
!     in this respect).  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  For UT, the date & time
!     method is best matched to the algorithm that is used by the Earth
!     rotation angle routine, called internally:  maximum accuracy (or,
!     at least, minimum noise) is delivered when the UTA argument is for
!     0hrs UT1 on the day in question and the UTB argument lies in the
!     range 0 to 1, or vice versa.
!
!  2) Both UT1 and TT are required, UT1 to predict the Earth rotation
!     and TT to predict the effects of precession-nutation.  If UT1 is
!     used for both purposes, errors of order 100 microarcseconds
!     result.
!
!  3) This GAST is compatible with the IAU 2000/2006 resolutions and
!     must be used only in conjunction with IAU 2006 precession and
!     IAU 2000A nutation.
!
!  4) The result is returned in the range 0 to 2pi.
!
!  Called:
!     PNM06A   classical NPB matrix, IAU 2006/2000A
!     GST06    Greenwich apparent ST, IAU 2006, given NPB matrix
!
!  Reference:
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2010 March 5
!
!-----------------------------------------------------------------------

implicit none

double precision uta, utb, tta, ttb

double precision rnpb(3,3)

!     DOUBLE PRECISION GST06

!  Classical nutation x precession x bias matrix, IAU 2000A/2006.
call PNM06A ( tta, ttb, rnpb )

!  Greenwich apparent sidereal time.
GST06A = GST06 ( uta, utb, tta, ttb, rnpb )

end function GST06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function GST94 ( uta, utb )
!>
!  Greenwich Apparent Sidereal Time (consistent with IAU 1982/94
!  resolutions).
!
!  Status:  support routine.
!
!  Given:
!     UTA, UTB     d      UT1 as a 2-part Julian Date (Notes 1,2)
!
!  Returned:
!     GST94    d      Greenwich apparent sidereal time (radians)
!
!  Notes:
!
!  1) The UT1 date UTA+UTB is a Julian Date, apportioned in any
!     convenient way between the argument pair.  For example,
!     JD=2450123.7 could be expressed in any of these ways, among
!     others:
!
!             UTA            UTB
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 and MJD methods are good compromises
!     between resolution and convenience.  For UT, the date & time
!     method is best matched to the algorithm that is used by the Earth
!     Rotation Angle routine, called internally:  maximum accuracy (or,
!     at least, minimum noise) is delivered when the UTA argument is for
!     0hrs UT1 on the day in question and the UTB argument lies in the
!     range 0 to 1, or vice versa.
!
!  2) The result is compatible with the IAU 1982 and 1994 resolutions,
!     except that accuracy has been compromised for the sake of
!     convenience in that UT is used instead of TDB (or TT) to compute
!     the equation of the equinoxes.
!
!  3) This GAST must be used only in conjunction with contemporaneous
!     IAU standards such as 1976 precession, 1980 obliquity and 1982
!     nutation.  It is not compatible with the IAU 2000 resolutions.
!
!  4) The result is returned in the range 0 to 2pi.
!
!  Called:
!     GMST82   Greenwich mean sidereal time, IAU 1982
!     EQEQ94   equation of the equinoxes, IAU 1994
!     ANP      normalize angle into range 0 to 2pi
!
!  References:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!     IAU Resolution C7, Recommendation 3 (1994)
!
!  This revision:  2007 December 8
!
!-----------------------------------------------------------------------

implicit none

double precision uta, utb

!     DOUBLE PRECISION ANP, GMST82, EQEQ94

GST94 = ANP ( GMST82 ( uta, utb ) + &
                      EQEQ94 ( uta, utb ) )

end function GST94
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine H2FK5 ( rh, dh, drh, ddh, pxh, rvh, &
                       r5, d5, dr5, dd5, px5, rv5 )
!>
!  Transform Hipparcos star data into the FK5 (J2000.0) system.
!
!  Status:  support routine.
!
!  Given (all Hipparcos, epoch J2000.0):
!     RH        d      RA (radians)
!     DH        d      Dec (radians)
!     DRH       d      proper motion in RA (dRA/dt, rad/Jyear)
!     DDH       d      proper motion in Dec (dDec/dt, rad/Jyear)
!     PXH       d      parallax (arcsec)
!     RVH       d      radial velocity (km/s, positive = receding)
!
!  Returned (all FK5, equinox J2000.0, epoch J2000.0):
!     R5        d      RA (radians)
!     D5        d      Dec (radians)
!     DR5       d      proper motion in RA (dRA/dt, rad/Jyear)
!     DD5       d      proper motion in Dec (dDec/dt, rad/Jyear)
!     PX5       d      parallax (arcsec)
!     RV5       d      radial velocity (km/s, positive = receding)
!
!  Notes:
!
!  1) This routine transforms Hipparcos star positions and proper
!     motions into FK5 J2000.0.
!
!  2) The proper motions in RA are dRA/dt rather than cos(Dec)*dRA/dt,
!     and are per year rather than per century.
!
!  3) The FK5 to Hipparcos transformation is modeled as a pure rotation
!     and spin;  zonal errors in the FK5 catalog are not taken into
!     account.
!
!  4) See also FK52H, FK5HZ, HFK5Z.
!
!  Called:
!     STARPV   star catalog data to space motion pv-vector
!     FK5HIP   FK5 to Hipparcos rotation and spin
!     RV2M     r-vector to r-matrix
!     RXP      product of r-matrix and p-vector
!     TRXP     product of transpose of r-matrix and p-vector
!     PXP      vector product of two p-vectors
!     PMP      p-vector minus p-vector
!     PVSTAR   space motion pv-vector to star catalog data
!
!  Reference:
!
!     F.Mignard & M.Froeschle, Astron.Astrophys., 354, 732-739 (2000).
!
!  This revision:  2017 October 12
!
!-----------------------------------------------------------------------

implicit none

double precision rh, dh, drh, ddh, pxh, rvh, &
                 r5, d5, dr5, dd5, px5, rv5

double precision pvh(3,2), r5h(3,3), s5h(3), sh(3), wxp(3), &
                 vv(3), pv5(3,2)
integer j, i

!  Hipparcos barycentric position/velocity pv-vector (normalized).
call STARPV ( rh, dh, drh, ddh, pxh, rvh, pvh, j )

!  FK5 to Hipparcos orientation matrix and spin vector.
call FK5HIP ( r5h, s5h )

!  Make spin units per day instead of per year.
do 1 i=1,3
   s5h(i) = s5h(i) / 365.25d0
1 continue

!  Orient the spin into the Hipparcos system.
call RXP ( r5h, s5h, sh )

!  De-orient the Hipparcos position into the FK5 system.
call TRXP ( r5h, pvh(1,1), pv5(1,1) )

!  Apply spin to the position giving an extra space motion component.
call PXP ( pvh(1,1), sh, wxp )

!  Subtract this component from the Hipparcos space motion.
call PMP ( pvh(1,2), wxp, vv )

!  De-orient the Hipparcos space motion into the FK5 system.
call TRXP ( r5h, vv, pv5(1,2) )

!  FK5 pv-vector to spherical.
call PVSTAR ( pv5, r5, d5, dr5, dd5, px5, rv5, j )

end subroutine H2FK5
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine HD2AE ( ha, dec, phi, az, el )
!>
!  Equatorial to horizon coordinates:  transform hour angle and
!  declination to azimuth and altitude.
!
!  Status:  support routine.
!
!  Given:
!     HA       d     hour angle (local)
!     DEC      d     declination
!     PHI      d     site latitude
!
!  Returned:
!     AZ       d     azimuth
!     EL       d     altitude (informally, elevation)
!
!  Notes:
!
!  1)  All the arguments are angles in radians.
!
!  2)  Azimuth is returned in the range 0-2pi;  north is zero, and east
!      is +pi/2.  Altitude is returned in the range +/- pi/2.
!
!  3)  The latitude PHI is pi/2 minus the angle between the Earth's
!      rotation axis and the adopted zenith.  In many applications it
!      will be sufficient to use the published geodetic latitude of the
!      site.  In very precise (sub-arcsecond) applications, PHI can be
!      corrected for polar motion.
!
!  4)  The returned azimuth AZ is with respect to the rotational north
!      pole, as opposed to the ITRS pole, and for sub-arcsecond accuracy
!      will need to be adjusted for polar motion if it is to be with
!      respect to north on a map of the Earth's surface.
!
!  5)  Should the user wish to work with respect to the astronomical
!      zenith rather than the geodetic zenith, PHI will need to be
!      adjusted for deflection of the vertical (often tens of
!      arcseconds), and the zero point of HA will also be affected.
!
!  6)  The transformation is the same as Vh = Rz(pi)*Ry(pi/2-phi)*Ve,
!      where Vh and Ve are lefthanded unit vectors in the (az,el) and
!      (ha,dec) systems respectively and Ry and Rz are rotations about
!      first the y-axis and then the z-axis.  (n.b. Rz(pi) simply
!      reverses the signs of the x and y components.)  For efficiency,
!      the algorithm is written out rather than calling other utility
!      functions.  For applications that require even greater
!      efficiency, additional savings are possible if constant terms
!      such as functions of latitude are computed once and for all.
!
!  7)  Again for efficiency, no range checking of arguments is carried
!      out.
!
!  Last revision:   2018 January 2
!
!-----------------------------------------------------------------------

implicit none

double precision ha, dec, phi, az, el

double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

double precision sh, ch, sd, cd, sp, cp, x, y, z, r, a

!  Useful trig functions.
sh = sin(ha)
ch = cos(ha)
sd = sin(dec)
cd = cos(dec)
sp = sin(phi)
cp = cos(phi)

!  Az,Alt unit vector.
x = - ch*cd*sp + sd*cp
y = - sh*cd
z = ch*cd*cp + sd*sp

!  To spherical.
r = sqrt(x*x + y*y)
if ( r==0d0 ) then
   a = 0d0
else
   a = atan2(y,x)
end if
if ( a<0d0 ) a = a+d2pi
az = a
el = atan2(z,r)

end subroutine HD2AE
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function HD2PA ( ha, dec, phi )
!>
!  Parallactic angle for a given hour angle and declination.
!
!  Given:
!     HA          d     hour angle
!     DEC         d     declination
!     PHI         d     site latitude
!
!  Returned:
!     HD2PA   d     parallactic angle
!
!  Notes:
!
!  1)  All the arguments are angles in radians.
!
!  2)  The parallactic angle at a point in the sky is the position angle
!      of the vertical, i.e. the angle between the directions to the
!      north celestial pole and to the zenith respectively.
!
!  3)  The result is returned in the range -pi to +pi.
!
!  4)  At the pole itself a zero result is returned.
!
!  5)  The latitude PHI is pi/2 minus the angle between the Earth's
!      rotation axis and the adopted zenith.  In many applications it
!      will be sufficient to use the published geodetic latitude of the
!      site.  In very precise (sub-arcsecond) applications, PHI can be
!      corrected for polar motion.
!
!  6)  Should the user wish to work with respect to the astronomical
!      zenith rather than the geodetic zenith, PHI will need to be
!      adjusted for deflection of the vertical (often tens of
!      arcseconds), and the zero point of HA will also be affected.
!
!  Reference:
!     Smart, W.M., "Spherical Astronomy", Cambridge University Press,
!     6th edition (Green, 1977), p49.
!
!  This revision:   2017 September 12
!
!-----------------------------------------------------------------------

implicit none

double precision ha, dec, phi

double precision cp, sqsz, cqsz

cp = cos(phi)
sqsz = cp*sin(ha)
cqsz = sin(phi)*cos(dec) - cp*sin(dec)*cos(ha)
if ( sqsz==0d0 .and. cqsz==0d0 ) cqsz = 1d0
HD2PA = atan2(sqsz,cqsz)

end function HD2PA
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine HFK5Z ( rh, dh, date1, date2, r5, d5, dr5, dd5 )
!>
!  Transform a Hipparcos star position into FK5 J2000.0, assuming
!  zero Hipparcos proper motion.
!
!  Status:  support routine.
!
!  Given:
!     RH              d      Hipparcos RA (radians)
!     DH              d      Hipparcos Dec (radians)
!     DATE1,DATE2     d      TDB date (Note 1)
!
!  Returned (all FK5, equinox J2000.0, date DATE1+DATE2):
!     R5              d      RA (radians)
!     D5              d      Dec (radians)
!     DR5             d      FK5 RA proper motion (rad/year, Note 4)
!     DD5             d      Dec proper motion (rad/year, Note 4)
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The proper motion in RA is dRA/dt rather than cos(Dec)*dRA/dt.
!
!  3) The FK5 to Hipparcos transformation is modeled as a pure
!     rotation and spin;  zonal errors in the FK5 catalogue are
!     not taken into account.
!
!  4) It was the intention that Hipparcos should be a close
!     approximation to an inertial frame, so that distant objects
!     have zero proper motion;  such objects have (in general)
!     non-zero proper motion in FK5, and this routine returns those
!     fictitious proper motions.
!
!  5) The position returned by this routine is in the FK5 J2000.0
!     reference system but at date DATE1+DATE2.
!
!  6) See also FK52H, H2FK5, FK5ZHZ.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     FK5HIP   FK5 to Hipparcos rotation and spin
!     RXP      product of r-matrix and p-vector
!     SXP      multiply p-vector by scalar
!     RXR      product of two r-matrices
!     TRXP     product of transpose of r-matrix and p-vector
!     PXP      vector product of two p-vectors
!     PV2S     pv-vector to spherical
!     ANP      normalize angle into range 0 to 2pi
!
!  Reference:
!
!     F.Mignard & M.Froeschle, Astron. Astrophys. 354, 732-739 (2000).
!
!  This revision:  2012 September 5
!
!-----------------------------------------------------------------------

implicit none

double precision rh, dh, date1, date2, r5, d5, dr5, dd5

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian year
double precision djy
parameter ( djy = 365.25d0 )

double precision t, ph(3), r5h(3,3), s5h(3), sh(3), vst(3), &
                 rst(3,3), r5ht(3,3), pv5e(3,2), vv(3), &
                 w, r, v

!     DOUBLE PRECISION ANP

!  Time interval from fundamental epoch J2000.0 to given date (JY).
t = ( ( date1-dj00 ) + date2 ) / djy

!  Hipparcos barycentric position vector (normalized).
call S2C ( rh, dh, ph )

!  FK5 to Hipparcos orientation matrix and spin vector.
call FK5HIP ( r5h, s5h )

!  Rotate the spin into the Hipparcos system.
call RXP ( r5h, s5h, sh )

!  Accumulated Hipparcos wrt FK5 spin over that interval.
call SXP ( t, s5h, vst )

!  Express the accumulated spin as a rotation matrix.
call RV2M ( vst, rst )

!  Rotation matrix:  accumulated spin, then FK5 to Hipparcos.
call RXR ( r5h, rst, r5ht )

!  De-orient & de-spin the Hipparcos position into FK5 J2000.0.
call TRXP ( r5ht, ph, pv5e )

!  Apply spin to the position giving a space motion.
call PXP ( sh, ph, vv )

!  De-orient & de-spin the Hipparcos space motion into FK5 J2000.0.
call TRXP ( r5ht, vv, pv5e(1,2) )

!  FK5 position/velocity pv-vector to spherical.
call PV2S ( pv5e, w, d5, r, dr5, dd5, v )
r5 = ANP ( w )

end subroutine HFK5Z
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ICRS2G ( dr, dd, dl, db  )
!>
!  Transformation from ICRS to Galactic Coordinates.
!
!  Status:  support routine.
!
!  Given:
!     DR       d      ICRS right ascension (radians)
!     DD       d      ICRS declination (radians)
!
!  Returned:
!     DL       d      galactic longitude (radians)
!     DB       d      galactic latitude (radians)
!
!  Notes:
!
!  1) The IAU 1958 system of Galactic coordinates was defined with
!     respect to the now obsolete reference system FK4 B1950.0.  When
!     interpreting the system in a modern context, several factors have
!     to be taken into account:
!
!     . The inclusion in FK4 positions of the E-terms of aberration.
!
!     . The distortion of the FK4 proper motion system by differential
!       Galactic rotation.
!
!     . The use of the B1950.0 equinox rather than the now-standard
!       J2000.0.
!
!     . The frame bias between ICRS and the J2000.0 mean place system.
!
!     The Hipparcos Catalogue (Perryman & ESA 1997) provides a rotation
!     matrix that transforms directly between ICRS and Galactic
!     coordinates with the above factors taken into account.  The
!     matrix is derived from three angles, namely the ICRS coordinates
!     of the Galactic pole and the longitude of the ascending node of
!     the galactic equator on the ICRS equator.  They are given in
!     degrees to five decimal places and for canonical purposes are
!     regarded as exact.  In the Hipparcos Catalogue the matrix elements
!     are given to 10 decimal places (about 20 microarcsec).  In the
!     present SOFA routine the matrix elements have been recomputed from
!     the canonical three angles and are given to 30 decimal places.
!
!  2) The inverse transformation is performed by the routine G2ICRS.
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!     ANPM     normalize angle into range +/- pi
!     S2C      spherical coordinates to unit vector
!     RXP      product of r-matrix and p-vector
!     C2S      p-vector to spherical
!
!  Reference:
!     Perryman M.A.C. & ESA, 1997, ESA SP-1200, The Hipparcos and Tycho
!     catalogues.  Astrometric and photometric star catalogues
!     derived from the ESA Hipparcos Space Astrometry Mission.  ESA
!     Publications Division, Noordwijk, Netherlands.
!
!  This revision:   2015 January 9
!
!-----------------------------------------------------------------------

implicit none
double precision dr, dd, dl, db

!     DOUBLE PRECISION ANP, ANPM

double precision v1(3), v2(3)

!
!  L2,B2 system of galactic coordinates in the form presented in the
!  Hipparcos Catalogue.  In degrees:
!
!  P = 192.85948    right ascension of the Galactic north pole in ICRS
!  Q =  27.12825    declination of the Galactic north pole in ICRS
!  R =  32.93192    longitude of the ascending node of the Galactic
!                   plane on the ICRS equator
!
!  ICRS to galactic rotation matrix, obtained by computing
!  R_3(-R) R_1(pi/2-Q) R_3(pi/2+P) to the full precision shown:
!
double precision r(3,3)
data r(1,1), r(1,2), r(1,3), &
     r(2,1), r(2,2), r(2,3), &
     r(3,1), r(3,2), r(3,3) / &
    -0.054875560416215368492398900454d0, &
    -0.873437090234885048760383168409d0, &
    -0.483835015548713226831774175116d0, &
    +0.494109427875583673525222371358d0, &
    -0.444829629960011178146614061616d0, &
    +0.746982244497218890527388004556d0, &
    -0.867666149019004701181616534570d0, &
    -0.198076373431201528180486091412d0, &
    +0.455983776175066922272100478348d0 /

!  Spherical to Cartesian.
call S2C ( dr, dd, v1 )

!  ICRS to Galactic.
call RXP ( r, v1, v2 )

!  Cartesian to spherical.
call C2S ( v2, dl, db )

!  Express in conventional ranges.
dl = ANP ( dl )
db = ANPM ( db )

end subroutine ICRS2G
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine IR ( r )
!>
!  Initialize an r-matrix to the identity matrix.
!
!  Status:  vector/matrix support routine.
!
!  Returned:
!     R        d(3,3)    r-matrix
!
!  This revision:  2012 April 3
!
!-----------------------------------------------------------------------

implicit none

double precision r(3,3)

r(1,1) = 1d0
r(1,2) = 0d0
r(1,3) = 0d0
r(2,1) = 0d0
r(2,2) = 1d0
r(2,3) = 0d0
r(3,1) = 0d0
r(3,2) = 0d0
r(3,3) = 1d0

end subroutine IR
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine JD2CAL ( dj1, dj2, iy, im, id, fd, j )
!>
!  Julian Date to Gregorian year, month, day, and fraction of a day.
!
!  Status:  support routine.
!
!  Given:
!     DJ1,DJ2     d     Julian Date (Notes 1, 2)
!
!  Returned:
!     IY          i     year
!     IM          i     month
!     ID          i     day
!     FD          d     fraction of day
!     J           i     status:
!                           0 = OK
!                          -1 = unacceptable date (Note 1)
!
!  Notes:
!
!  1) The earliest valid date is -68569.5 (-4900 March 1).  The
!     largest value accepted is 10^9.
!
!  2) The Julian Date is apportioned in any convenient way between
!     the arguments DJ1 and DJ2.  For example, JD=2450123.7 could
!     be expressed in any of these ways, among others:
!
!             DJ1            DJ2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!  3) In early eras the conversion is from the "Proleptic Gregorian
!     Calendar";  no account is taken of the date(s) of adoption of
!     the Gregorian Calendar, nor is the AD/BC numbering convention
!     observed.
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Section 12.92 (p604).
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none

double precision dj1, dj2
integer iy, im, id
double precision fd
integer j

!  Minimum and maximum allowed JD
double precision djmin, djmax
parameter ( djmin = -68569.5d0, djmax = 1d9 )

integer jd, l, n, i, k
double precision dj, d1, d2, f1, f2, f, d

!  Check if date is acceptable.
dj = dj1 + dj2
if ( dj<djmin .or. dj>djmax ) then
   j = -1
else
   j = 0

!     Copy the date, big then small, and re-align to midnight.
   if ( abs(dj1) >= abs(dj2) ) then
      d1 = dj1
      d2 = dj2
   else
      d1 = dj2
      d2 = dj1
   end if
   d2 = d2 - 0.5d0

!     Separate day and fraction.
   f1 = mod(d1,1d0)
   f2 = mod(d2,1d0)
   f = mod(f1+f2,1d0)
   if ( f < 0d0 ) f = f+1d0
   d = anint(d1-f1) + anint(d2-f2) + anint(f1+f2-f)
   jd = nint(d) + 1

!     Express day in Gregorian calendar.
   l = jd + 68569
   n = ( 4*l ) / 146097
   l = l - ( 146097*n + 3 ) / 4
   i = ( 4000 * (l+1) ) / 1461001
   l = l - ( 1461*i ) / 4 + 31
   k = ( 80*l ) / 2447
   id = l - ( 2447*k ) / 80
   l = k / 11
   im = k + 2 - 12*l
   iy = 100 * ( n-49 ) + i + l

   fd = f
end if

end subroutine JD2CAL
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine JDCALF ( ndp, dj1, dj2, iymdf, j )
!>
!  Julian Date to Gregorian Calendar, expressed in a form convenient
!  for formatting messages:  rounded to a specified precision, and with
!  the fields stored in a single array.
!
!  Status:  support routine.
!
!  Given:
!     NDP         i     number of decimal places of days in fraction
!     DJ1,DJ2     d     DJ1+DJ2 = Julian Date (Note 1)
!
!  Returned:
!     IYMDF       i(4)  year, month, day, fraction in Gregorian
!                       calendar
!     J           i     status:
!                          -1 = date out of range
!                           0 = OK
!                          +1 = NDP not 0-9 (interpreted as 0)
!
!  Notes:
!
!  1) The Julian Date is apportioned in any convenient way between
!     the arguments DJ1 and DJ2.  For example, JD=2450123.7 could
!     be expressed in any of these ways, among others:
!
!             DJ1            DJ2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!  2) In early eras the conversion is from the "Proleptic Gregorian
!     Calendar";  no account is taken of the date(s) of adoption of
!     the Gregorian Calendar, nor is the AD/BC numbering convention
!     observed.
!
!  3) Refer to the routine JD2CAL.
!
!  4) NDP should be 4 or less if internal overflows are to be
!     avoided on machines which use 16-bit integers.
!
!  Called:
!     JD2CAL   JD to Gregorian calendar
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Section 12.92 (p604).
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none

integer ndp
double precision dj1, dj2
integer iymdf(4), j

integer js
double precision denom, d1, d2, f1, f2, f

!  Denominator of fraction (e.g. 100 for 2 decimal places).
if ( ndp>=0 .and. ndp<=9 ) then
   j = 0
   denom = dble(10**ndp)
else
   j = 1
   denom = 1d0
end if

!  Copy the date, big then small, and realign to midnight.
if ( abs(dj1) >= abs(dj2) ) then
   d1 = dj1
   d2 = dj2
else
   d1 = dj2
   d2 = dj1
end if
d2 = d2 - 0.5d0

!  Separate days and fractions.
f1 = mod(d1,1d0)
f2 = mod(d2,1d0)
d1 = anint(d1-f1)
d2 = anint(d2-f2)

!  Round the total fraction to the specified number of places.
f = anint(( f1+f2 ) * denom) / denom

!  Re-assemble the rounded date and re-align to noon.
d2 = d2 + f + 0.5d0

!  Convert to Gregorian calendar.
call JD2CAL ( d1, d2, iymdf(1), iymdf(2), iymdf(3), f, js )
if ( js == 0 ) then
   iymdf(4) = nint(f*denom)
else
   j = js
end if

end subroutine JDCALF
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LD ( bm, p, q, e, em, dlim, p1 )
!>
!  Apply light deflection by a solar-system body, as part of
!  transforming coordinate direction into natural direction.
!
!  Status:  support routine.
!
!  Given:
!     BM       d      mass of the gravitating body (solar masses)
!     P        d(3)   direction from observer to source (unit vector)
!     Q        d(3)   direction from body to source (unit vector)
!     E        d(3)   direction from body to observer (unit vector)
!     EM       d      distance from body to observer (au)
!     DLIM     d      deflection limiter (Note 4)
!
!  Returned:
!     P1       d(3)   observer to deflected source (unit vector)
!
!  Notes:
!
!  1) The algorithm is based on Expr. (70) in Klioner (2003) and
!     Expr. (7.63) in the Explanatory Supplement (Urban & Seidelmann
!     2013), with some rearrangement to minimize the effects of machine
!     precision.
!
!  2) The mass parameter BM can, as required, be adjusted in order to
!     allow for such effects as quadrupole field.
!
!  3) The barycentric position of the deflecting body should ideally
!     correspond to the time of closest approach of the light ray to
!     the body.
!
!  4) The deflection limiter parameter DLIM is phi^2/2, where phi is the
!     angular separation (in radians) between source and body at which
!     limiting is applied.  As phi shrinks below the chosen threshold,
!     the deflection is artificially reduced, reaching zero for phi = 0.
!
!  5) The returned vector P1 is not normalized, but the consequential
!     departure from unit magnitude is always negligible.
!
!  6) To accumulate total light deflection taking into account the
!     contributions from several bodies, call the present routine for
!     each body in succession, in decreasing order of distance from the
!     observer.
!
!  7) For efficiency, validation is omitted.  The supplied vectors must
!     be of unit magnitude, and the deflection limiter non-zero and
!     positive.
!
!  References:
!
!     Urban, S. & Seidelmann, P. K. (eds), Explanatory Supplement to
!     the Astronomical Almanac, 3rd ed., University Science Books
!     (2013).
!
!     Klioner, Sergei A., "A practical relativistic model for micro-
!     arcsecond astrometry in space", Astr. J. 125, 1580-1597 (2003).
!
!  Called:
!     PDP      scalar product of two p-vectors
!     PXP      vector product of two p-vectors
!
!  This revision:   2013 September 3
!
!-----------------------------------------------------------------------

implicit none
double precision bm, p(3), q(3), e(3), em, dlim, p1(3)

!  Schwarzschild radius of the Sun (au)
!  = 2 * 1.32712440041 D20 / (2.99792458 D8)^2 / 1.49597870700 D11
double precision srs
parameter ( srs = 1.97412574336d-08 )

integer i
double precision qpe(3), qdqpe, w, eq(3), peq(3)

!  Q . (Q + E).
do 1 i=1,3
   qpe(i) = q(i) + e(i)
1 continue
call PDP ( q, qpe, qdqpe )

!  2 x G x BM / ( EM x c^2 x ( Q . (Q + E) ) ).
w = bm * srs / em / max ( qdqpe, dlim )

!  P x (E x Q).
call PXP ( e, q, eq )
call PXP ( p, eq, peq )

!  Apply the deflection.
do 2 i = 1,3
   p1(i) = p(i) + w*peq(i)
2 continue

end subroutine LD
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LDN ( n, b, ob, sc, sn )
!>
!  For a star, apply light deflection by multiple solar-system bodies,
!  as part of transforming coordinate direction into natural direction.
!
!  Status:  support routine.
!
!  Given:
!     N     i        number of bodies (Note 1)
!     B     d(8,N)   data for each of the N bodies (Notes 1,2):
!            (1,I)     mass of the body (solar masses, Note 3)
!            (2,I)     deflection limiter (Note 4)
!            (3-5,I)   barycentric position of the body (au)
!            (6-8,I)   barycentric velocity of the body (au/day)
!     OB    d(3)     barycentric position of the observer (au)
!     SC    d(3)     observer to star coordinate direction (unit vector)
!
!  Returned:
!     SN    d(3)     observer to deflected star (unit vector)
!
!  1) The array B contains N entries, one for each body to be
!     considered.  If N = 0, no gravitational light deflection will be
!     applied, not even for the Sun.
!
!  2) The array B should include an entry for the Sun as well as for any
!     planet or other body to be taken into account.  The entries should
!     be in the order in which the light passes the body.
!
!  3) In the entry in the B array for body I, the mass parameter B(1,I)
!     can, as required, be adjusted in order to allow for such effects
!     as quadrupole field.
!
!  4) The deflection limiter parameter B(2,I) is phi^2/2, where phi is
!     the angular separation (in radians) between star and body at which
!     limiting is applied.  As phi shrinks below the chosen threshold,
!     the deflection is artificially reduced, reaching zero for phi = 0.
!     Example values suitable for a terrestrial observer, together with
!     masses, are as follows:
!
!        body I     B(1,I)         B(2,I)
!
!        Sun        1D0            6D-6
!        Jupiter    0.00095435D0   3D-9
!        Saturn     0.00028574D0   3D-10
!
!  5) For cases where the starlight passes the body before reaching the
!     observer, the body is placed back along its barycentric track by
!     the light time from that point to the observer.  For cases where
!     the body is "behind" the observer no such shift is applied.  If
!     a different treatment is preferred, the user has the option of
!     instead using the LD routine.  Similarly, LD can be used
!     for cases where the source is nearby, not a star.
!
!  6) The returned vector SN is not normalized, but the consequential
!     departure from unit magnitude is always negligible.
!
!  7) For efficiency, validation is omitted.  The supplied masses must
!     be greater than zero, the position and velocity vectors must be
!     right, and the deflection limiter greater than zero.
!
!  Reference:
!
!     Urban, S. & Seidelmann, P. K. (eds), Explanatory Supplement to
!     the Astronomical Almanac, 3rd ed., University Science Books
!     (2013), Section 7.2.4.
!
!  Called:
!     CP       copy p-vector
!     PDP      scalar product of two p-vectors
!     PMP      p-vector minus p-vector
!     PPSP     p-vector plus scaled p-vector
!     PN       decompose p-vector into modulus and direction
!     LD       light deflection by a solar-system body
!
!  This revision:   2017 March 16
!
!-----------------------------------------------------------------------

implicit none
integer n
double precision b(8,n), ob(3), sc(3), sn(3)

!  Seconds per day.
double precision daysec
parameter ( daysec = 86400d0 )

!  Speed of light (m/s)
double precision cmps
parameter ( cmps = 299792458d0 )

!  Astronomical unit (m, IAU 2012)
double precision aum
parameter ( aum = 149597870.7d3 )

!  Light time for 1 au (day)
double precision cr
parameter ( cr = aum/cmps/daysec )

integer i
double precision s(3), v(3), d , dt, ev(3), em, e(3)

!  Star direction prior to deflection.
call CP ( sc, s )

!  Body by body.
do 1 i=1,n

!     Body to observer vector at epoch of observation (au).
   call PMP ( ob, b(3,i), v )

!     Minus the time since the light passed the body (days).
   call PDP ( s, v, d )
   dt = d * cr

!     Neutralize if the star is "behind" the observer.
   dt = min ( dt, 0d0 )

!     Backtrack the body to the time the light was passing the body.
   call PPSP ( v, -dt, b(6,i), ev )

!     Separate the body to observer vector into magnitude and direction.
   call PN ( ev, em, e )

!     Apply light deflection for this body.
   call LD ( b(1,i), s, s, e, em, b(2,i), v )

!     Update the star direction.
   call CP ( v, s )

!     Next body.
1 continue

!  Return the deflected star direction.
call CP ( s, sn )

end subroutine LDN
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LDSUN ( p, e, em, p1 )
!>
!  Deflection of starlight by the Sun.
!
!  Status:  support routine.
!
!  Given:
!     P        d(3)   direction from observer to star (unit vector)
!     E        d(3)   direction from Sun to observer (unit vector)
!     EM       d      distance from Sun to observer (au)
!
!  Returned:
!     P1       d(3)   observer to deflected star (unit vector)
!
!  Notes:
!
!  1) The source is presumed to be sufficiently distant that its
!     directions seen from the Sun and the observer are essentially
!     the same.
!
!  2) The deflection is restrained when the angle between the star and
!     the center of the Sun is less than a threshold value, falling to
!     zero deflection for zero separation.  The chosen threshold value
!     is within the solar limb for all solar-system applications, and
!     is about 5 arcminutes for the case of a terrestrial observer.
!
!  Called:
!     LD       light deflection by a solar-system body
!
!  This revision:   2016 June 16
!
!-----------------------------------------------------------------------

implicit none
double precision p(3), e(3), em, p1(3)

double precision dlim

!  Deflection limiter (smaller for distant observers).
dlim = 1d-6 / max(em*em,1d0)

!  Apply the deflection.
call LD ( 1d0, p, p, e, em, dlim, p1 )

end subroutine LDSUN
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LTECEQ ( epj, dl, db, dr, dd )
!>
!  Transformation from ecliptic coordinates (mean equinox and ecliptic
!  of date) to ICRS RA,Dec, using a long-term precession model.
!
!  Status:  support routine.
!
!  Given:
!     EPJ       d        Julian epoch (TT)
!     DL,DB     d        ecliptic longitude and latitude (radians)
!
!  Returned:
!     DR,DD     d        ICRS right ascension and declination (radians)
!
!  1) No assumptions are made about whether the coordinates represent
!     starlight and embody astrometric effects such as parallax or
!     aberration.
!
!  2) The transformation is approximately that from ecliptic longitude
!     and latitude (mean equinox and ecliptic of date) to mean J2000.0
!     right ascension and declination, with only frame bias (always less
!     than 25 mas) to disturb this classical picture.
!
!  3) The Vondrak et al. (2011, 2012) 400 millennia precession model
!     agrees with the IAU 2006 precession at J2000.0 and stays within
!     100 microarcseconds during the 20th and 21st centuries.  It is
!     accurate to a few arcseconds throughout the historical period,
!     worsening to a few tenths of a degree at the end of the
!     +/- 200,000 year time span.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     LTECM    J2000.0 to ecliptic rotation matrix, long term
!     TRXP     product of transpose of r-matrix and p-vector
!     C2S      unit vector to spherical coordinates
!     ANP      normalize angle into range 0 to 2pi
!     ANPM     normalize angle into range +/- pi
!
!  References:
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2011, New precession
!     expressions, valid for long time intervals, Astron.Astrophys. 534,
!     A22
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2012, New precession
!     expressions, valid for long time intervals (Corrigendum),
!     Astron.Astrophys. 541, C1
!
!  This revision:  2016 February 9
!
!-----------------------------------------------------------------------

implicit none

double precision epj, dl, db, dr, dd

double precision rm(3,3), v1(3), v2(3), a, b

!     DOUBLE PRECISION ANP, ANPM

!  Spherical to Cartesian.
call S2C ( dl, db, v1 )

!  Rotation matrix, ICRS equatorial to ecliptic.
call LTECM ( epj, rm )

!  The transformation from ecliptic to ICRS.
call TRXP ( rm, v1, v2 )

!  Cartesian to spherical.
call C2S ( v2, a, b )

!  Express in conventional ranges.
dr = ANP ( a )
dd = ANPM ( b )

end subroutine LTECEQ
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LTECM ( epj, rm )
!>
!  ICRS equatorial to ecliptic rotation matrix, long-term.
!
!  Status:  support routine.
!
!  Given:
!     EPJ       d        Julian epoch (TT)
!
!  Returned:
!     RM        d(3,3)   ICRS to ecliptic rotation matrix
!
!  Notes:
!
!  1) The matrix is in the sense
!
!        E_ep = RM x P_ICRS,
!
!     where P_ICRS is a vector with respect to ICRS right ascension
!     and declination axes and E_ep is the same vector with respect to
!     the (inertial) ecliptic and equinox of epoch EPJ.
!
!  2) P_ICRS is a free vector, merely a direction, typically of unit
!     magnitude, and not bound to any particular spatial origin, such as
!     the Earth, Sun or SSB.  No assumptions are made about whether it
!     represents starlight and embodies astrometric effects such as
!     parallax or aberration.  The transformation is approximately that
!     between mean J2000.0 right ascension and declination and ecliptic
!     longitude and latitude, with only frame bias (always less than
!     25 mas) to disturb this classical picture.
!
!  3) The Vondrak et al. (2011, 2012) 400 millennia precession model
!     agrees with the IAU 2006 precession at J2000.0 and stays within
!     100 microarcseconds during the 20th and 21st centuries.  It is
!     accurate to a few arcseconds throughout the historical period,
!     worsening to a few tenths of a degree at the end of the
!     +/- 200,000 year time span.
!
!  Called:
!     LTPEQU   equator pole, long term
!     LTPECL   ecliptic pole, long term
!     PXP      vector product
!     PN       normalize vector
!
!  References:
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2011, New precession
!     expressions, valid for long time intervals, Astron.Astrophys. 534,
!     A22
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2012, New precession
!     expressions, valid for long time intervals (Corrigendum),
!     Astron.Astrophys. 541, C1
!
!  This revision:  2015 December 6
!
!-----------------------------------------------------------------------

implicit none

double precision epj, rm(3,3)

!  Arcseconds to radians
double precision as2r
parameter ( as2r = 4.848136811095359935899141d-6 )

!  Frame bias (IERS Conventions 2010, Eqs. 5.21 and 5.33)
double precision dx, de, dr
parameter ( dx = -0.016617d0 * as2r, &
            de = -0.0068192d0 * as2r, &
            dr = -0.0146d0 * as2r )

double precision p(3), z(3), w(3), s, x(3), y(3)

!  Equator pole.
call LTPEQU ( epj, p )

!  Ecliptic pole (bottom row of equatorial to ecliptic matrix).
call LTPECL ( epj, z )

!  Equinox (top row of matrix).
call PXP ( p, z, w )
call PN ( w, s, x )

!  Middle row of matrix.
call PXP ( z, x, y )

!  Combine with frame bias.
rm(1,1) =   x(1)    - x(2)*dr + x(3)*dx
rm(1,2) =   x(1)*dr + x(2)    + x(3)*de
rm(1,3) = - x(1)*dx - x(2)*de + x(3)
rm(2,1) =   y(1)    - y(2)*dr + y(3)*dx
rm(2,2) =   y(1)*dr + y(2)    + y(3)*de
rm(2,3) = - y(1)*dx - y(2)*de + y(3)
rm(3,1) =   z(1)    - z(2)*dr + z(3)*dx
rm(3,2) =   z(1)*dr + z(2)    + z(3)*de
rm(3,3) = - z(1)*dx - z(2)*de + z(3)

end subroutine LTECM
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LTEQEC ( epj, dr, dd, dl, db )
!>
!  Transformation from ICRS equatorial coordinates to ecliptic
!  coordinates (mean equinox and ecliptic of date), using a long-term
!  precession model.
!
!  Status:  support routine.
!
!  Given:
!     EPJ       d        Julian epoch (TT)
!     DR,DD     d        ICRS right ascension and declination (radians)
!
!  Returned:
!     DL,DB     d        ecliptic longitude and latitude (radians)
!
!  1) No assumptions are made about whether the coordinates represent
!     starlight and embody astrometric effects such as parallax or
!     aberration.
!
!  2) The transformation is approximately that from mean J2000.0 right
!     ascension and declination to ecliptic longitude and latitude
!     (mean equinox and ecliptic of date), with only frame bias (always
!     less than 25 mas) to disturb this classical picture.
!
!  3) The Vondrak et al. (2011, 2012) 400 millennia precession model
!     agrees with the IAU 2006 precession at J2000.0 and stays within
!     100 microarcseconds during the 20th and 21st centuries.  It is
!     accurate to a few arcseconds throughout the historical period,
!     worsening to a few tenths of a degree at the end of the
!     +/- 200,000 year time span.
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     LTECM    J2000.0 to ecliptic rotation matrix, long term
!     RXP      product of r-matrix and p-vector
!     C2S      unit vector to spherical coordinates
!     ANP      normalize angle into range 0 to 2pi
!     ANPM     normalize angle into range +/- pi
!
!  References:
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2011, New precession
!     expressions, valid for long time intervals, Astron.Astrophys. 534,
!     A22
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2012, New precession
!     expressions, valid for long time intervals (Corrigendum),
!     Astron.Astrophys. 541, C1
!
!  This revision:  2016 February 9
!
!-----------------------------------------------------------------------

implicit none

double precision epj, dr, dd, dl, db

double precision rm(3,3), v1(3), v2(3), a, b

!     DOUBLE PRECISION ANP, ANPM

!  Spherical to Cartesian.
call S2C ( dr, dd, v1 )

!  Rotation matrix, ICRS equatorial to ecliptic.
call LTECM ( epj, rm )

!  The transformation from ICRS to ecliptic.
call RXP ( rm, v1, v2 )

!  Cartesian to spherical.
call C2S ( v2, a, b )

!  Express in conventional ranges.
dl = ANP ( a )
db = ANPM ( b )

end subroutine LTEQEC
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LTP ( epj, rp )
!>
!  Long-term precession matrix.
!
!  Status:  support routine.
!
!  Given:
!     EPJ       d        Julian epoch (TT)
!
!  Returned:
!     RP        d(3,3)   precession matrix, J2000.0 to date
!
!  Notes:
!
!  1) The matrix is in the sense
!
!        P_date = RP x P_J2000,
!
!     where P_J2000 is a vector with respect to the J2000.0 mean equator
!     and equinox and P_date is the same vector with respect to the
!     equator and equinox of epoch EPJ.
!
!  2) The Vondrak et al. (2011, 2012) 400 millennia precession model
!     agrees with the IAU 2006 precession at J2000.0 and stays within
!     100 microarcseconds during the 20th and 21st centuries.  It is
!     accurate to a few arcseconds throughout the historical period,
!     worsening to a few tenths of a degree at the end of the
!     +/- 200,000 year time span.
!
!  Called:
!     LTPEQU   equator pole, long term
!     LTPECL   ecliptic pole, long term
!     PXP      vector product
!     PN       normalize vector
!
!  References:
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2011, New precession
!     expressions, valid for long time intervals, Astron.Astrophys. 534,
!     A22
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2012, New precession
!     expressions, valid for long time intervals (Corrigendum),
!     Astron.Astrophys. 541, C1
!
!  This revision:  2015 December 6
!
!-----------------------------------------------------------------------

implicit none
double precision epj, rp(3,3)

integer i
double precision peqr(3), pecl(3), v(3), w, eqx(3)

!  Equator pole (bottom row of matrix).
call LTPEQU ( epj, peqr )

!  Ecliptic pole.
call LTPECL ( epj, pecl )

!  Equinox (top row of matrix).
call PXP ( peqr, pecl, v )
call PN ( v, w, eqx )

!  Middle row of matrix.
call PXP ( peqr, eqx, v )

!  Assemble the matrix.
do 1 i=1,3
   rp(1,i) = eqx(i)
   rp(2,i) = v(i)
   rp(3,i) = peqr(i)
1 continue

end subroutine LTP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LTPB ( epj, rpb )
!>
!  Long-term precession matrix, including ICRS frame bias.
!
!  Status:  support routine.
!
!  Given:
!     EPJ       d        Julian epoch (TT)
!
!  Returned:
!     RPB       d        precession-bias matrix, J2000.0 to date
!
!  Notes:
!
!  1) The matrix is in the sense
!
!        P_date = RPB x P_ICRS,
!
!     where P_J2000 is a vector in the International Celestial Reference
!     System, and P_date is the vector with respect to the Celestial
!     Intermediate Reference System at that date but with nutation
!     neglected.
!
!  2) A first order frame bias formulation is used, of sub-
!     microarcsecond accuracy compared with a full 3D rotation.
!
!  3) The Vondrak et al. (2011, 2012) 400 millennia precession model
!     agrees with the IAU 2006 precession at J2000.0 and stays within
!     100 microarcseconds during the 20th and 21st centuries.  It is
!     accurate to a few arcseconds throughout the historical period,
!     worsening to a few tenths of a degree at the end of the
!     +/- 200,000 year time span.
!
!  Called:
!     LTP      precession matrix, long term
!
!  References:
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2011, New precession
!     expressions, valid for long time intervals, Astron.Astrophys. 534,
!     A22
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2012, New precession
!     expressions, valid for long time intervals (Corrigendum),
!     Astron.Astrophys. 541, C1
!
!  This revision:  2015 December 6
!
!-----------------------------------------------------------------------

implicit none
double precision epj, rpb(3,3)

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Frame bias (IERS Conventions 2010, Eqs. 5.21 and 5.33)
double precision dx, de, dr
parameter ( dx = -0.016617d0 * das2r, &
            de = -0.0068192d0 * das2r, &
            dr = -0.0146d0 * das2r )

integer i
double precision rp(3,3)

!  Precession matrix.
call LTP  ( epj, rp )

!  Apply the bias.
do 1 i=1,3
   rpb(i,1) =   rp(i,1)    - rp(i,2)*dr + rp(i,3)*dx
   rpb(i,2) =   rp(i,1)*dr + rp(i,2)    + rp(i,3)*de
   rpb(i,3) = - rp(i,1)*dx - rp(i,2)*de + rp(i,3)
1 continue

end subroutine LTPB
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LTPECL ( epj, vec )
!>
!  Long-term precession of the ecliptic.
!
!  Status:  support routine.
!
!  Given:
!     EPJ       d        Julian epoch (TT)
!
!  Returned:
!     VEC       d(3)     ecliptic pole unit vector
!
!  Notes:
!
!  1) The returned vector is with respect to the J2000.0 mean equator
!     and equinox.
!
!  2) The Vondrak et al. (2011, 2012) 400 millennia precession model
!     agrees with the IAU 2006 precession at J2000.0 and stays within
!     100 microarcseconds during the 20th and 21st centuries.  It is
!     accurate to a few arcseconds throughout the historical period,
!     worsening to a few tenths of a degree at the end of the
!     +/- 200,000 year time span.
!
!  References:
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2011, New precession
!     expressions, valid for long time intervals, Astron.Astrophys. 534,
!     A22
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2012, New precession
!     expressions, valid for long time intervals (Corrigendum),
!     Astron.Astrophys. 541, C1
!
!  This revision:  2016 February 9
!
!-----------------------------------------------------------------------

implicit none
double precision epj, vec(3)

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Obliquity at J2000.0 (radians).
double precision eps0
parameter ( eps0 = 84381.406d0 * das2r )

!  Number of polynomial terms
integer npol
parameter ( npol = 4 )

!  Number of periodic terms
integer nper
parameter ( nper = 8 )

!  Miscellaneous
integer i, j
double precision t, p, q, w, a, s, c

!  Polynomial and periodic coefficients
double precision pqpol(npol,2), pqper(5,nper)

!  Polynomials
data ((pqpol(i,j),i=1,npol),j=1,2) / &
       +5851.607687d0, &
          -0.1189000d0, &
          -0.00028913d0, &
          +0.000000101d0, &
       -1600.886300d0, &
          +1.1689818d0, &
          -0.00000020d0, &
          -0.000000437d0 /

!  Periodics
 data ((pqper(i,j),i=1,5),j=1,nper) / &
   708.15d0,  -5486.751211d0,   -684.661560d0, &
                667.666730d0,  -5523.863691d0, &
  2309.00d0,    -17.127623d0,   2446.283880d0, &
              -2354.886252d0,   -549.747450d0, &
  1620.00d0,   -617.517403d0,    399.671049d0, &
               -428.152441d0,   -310.998056d0, &
   492.20d0,    413.442940d0,   -356.652376d0, &
                376.202861d0,    421.535876d0, &
  1183.00d0,     78.614193d0,   -186.387003d0, &
                184.778874d0,    -36.776172d0, &
   622.00d0,   -180.732815d0,   -316.800070d0, &
                335.321713d0,   -145.278396d0, &
   882.00d0,    -87.676083d0,    198.296701d0, &
               -185.138669d0,    -34.744450d0, &
   547.00d0,     46.140315d0,    101.135679d0, &
               -120.972830d0,     22.885731d0 /

!  Centuries since J2000.
t = (epj-2000d0)/100d0

!  Initialize P_A and Q_A accumulators.
p = 0d0
q = 0d0

!  Periodic terms.
w = d2pi*t
do 1 i=1,nper
   a = w/pqper(1,i)
   s = sin(a)
   c = cos(a)
   p = p + c*pqper(2,i) + s*pqper(4,i)
   q = q + c*pqper(3,i) + s*pqper(5,i)
1 continue

!  Polynomial terms.
w = 1d0
do 2 i=1,npol
   p = p + pqpol(i,1)*w
   q = q + pqpol(i,2)*w
   w = w*t
2 continue

!  P_A and Q_A (radians).
p = p*das2r
q = q*das2r

!  Form the ecliptic pole vector.
w = sqrt(max(1d0-p*p-q*q,0d0))
s = sin(eps0)
c = cos(eps0)
vec(1) = p
vec(2) = - q*c - w*s
vec(3) = - q*s + w*c

end subroutine LTPECL
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine LTPEQU ( epj, veq )
!>
!  Long-term precession of the equator.
!
!  Status:  support routine.
!
!  Given:
!     EPJ       d        Julian epoch (TT)
!
!  Returned:
!     VEQ       d(3)     equator pole unit vector
!
!  Notes:
!
!  1) The returned vector is with respect to the J2000.0 mean equator
!     and equinox.
!
!  2) The Vondrak et al. (2011, 2012) 400 millennia precession model
!     agrees with the IAU 2006 precession at J2000.0 and stays within
!     100 microarcseconds during the 20th and 21st centuries.  It is
!     accurate to a few arcseconds throughout the historical period,
!     worsening to a few tenths of a degree at the end of the
!     +/- 200,000 year time span.
!
!  References:
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2011, New precession
!     expressions, valid for long time intervals, Astron.Astrophys. 534,
!     A22
!
!     Vondrak, J., Capitaine, N. and Wallace, P., 2012, New precession
!     expressions, valid for long time intervals (Corrigendum),
!     Astron.Astrophys. 541, C1
!
!  This revision:  2016 February 9
!
!-----------------------------------------------------------------------

implicit none
double precision epj, veq(3)

!  Arcseconds to radians
double precision as2r
parameter ( as2r = 4.848136811095359935899141d-6 )

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Number of polynomial terms
integer npol
parameter ( npol = 4 )

!  Number of periodic terms
integer nper
parameter ( nper = 14 )

!  Miscellaneous
integer i, j
double precision t, x, y, w, a, s, c

!  Polynomial and periodic coefficients
double precision xypol(npol,2), xyper(5,nper)

!  Polynomials
data ((xypol(i,j),i=1,npol),j=1,2) / &
       +5453.282155d0, &
          +0.4252841d0, &
          -0.00037173d0, &
          -0.000000152d0, &
      -73750.930350d0, &
          -0.7675452d0, &
          -0.00018725d0, &
          +0.000000231d0 /

!  Periodics
 data ((xyper(i,j),i=1,5),j=1,nper) / &
   256.75d0,   -819.940624d0,  75004.344875d0, &
              81491.287984d0,   1558.515853d0, &
   708.15d0,  -8444.676815d0,    624.033993d0, &
                787.163481d0,   7774.939698d0, &
   274.20d0,   2600.009459d0,   1251.136893d0, &
               1251.296102d0,  -2219.534038d0, &
   241.45d0,   2755.175630d0,  -1102.212834d0, &
              -1257.950837d0,  -2523.969396d0, &
  2309.00d0,   -167.659835d0,  -2660.664980d0, &
              -2966.799730d0,    247.850422d0, &
   492.20d0,    871.855056d0,    699.291817d0, &
                639.744522d0,   -846.485643d0, &
   396.10d0,     44.769698d0,    153.167220d0, &
                131.600209d0,  -1393.124055d0, &
   288.90d0,   -512.313065d0,   -950.865637d0, &
               -445.040117d0,    368.526116d0, &
   231.10d0,   -819.415595d0,    499.754645d0, &
                584.522874d0,    749.045012d0, &
  1610.00d0,   -538.071099d0,   -145.188210d0, &
                -89.756563d0,    444.704518d0, &
   620.00d0,   -189.793622d0,    558.116553d0, &
                524.429630d0,    235.934465d0, &
   157.87d0,   -402.922932d0,    -23.923029d0, &
                -13.549067d0,    374.049623d0, &
   220.30d0,    179.516345d0,   -165.405086d0, &
               -210.157124d0,   -171.330180d0, &
  1200.00d0,     -9.814756d0,      9.344131d0, &
                -44.919798d0,    -22.899655d0 /

!  Centuries since J2000.
t = (epj-2000d0)/100d0

!  Initialize X and Y accumulators.
x = 0d0
y = 0d0

!  Periodic terms.
w = d2pi*t
do 1 i=1,nper
   a = w/xyper(1,i)
   s = sin(a)
   c = cos(a)
   x = x + c*xyper(2,i) + s*xyper(4,i)
   y = y + c*xyper(3,i) + s*xyper(5,i)
1 continue

!  Polynomial terms.
w = 1d0
do 2 i=1,npol
   x = x + xypol(i,1)*w
   y = y + xypol(i,2)*w
   w = w*t
2 continue

!  X and Y (direction cosines).
x = x*as2r
y = y*as2r

!  Form the equator pole vector.
veq(1) = x
veq(2) = y
veq(3) = sqrt(max(1d0-x*x-y*y,0d0))

end subroutine LTPEQU
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine NUM00A ( date1, date2, rmatn )
!>
!  Form the matrix of nutation for a given date, IAU 2000A model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RMATN        d(3,3)    nutation matrix
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(true) = RMATN * V(mean),
!     where the p-vector V(true) is with respect to the true
!     equatorial triad of date and the p-vector V(mean) is with
!     respect to the mean equatorial triad of date.
!
!  3) A faster, but slightly less accurate result (about 1 mas), can be
!     obtained by using instead the NUM00B routine.
!
!  Called:
!     PN00A    bias/precession/nutation, IAU 2000A
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Section 3.222-3 (p114).
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rmatn(3,3)

double precision dpsi, deps, epsa, &
                 rb(3,3), rp(3,3), rbp(3,3), rbpn(3,3)

!  Obtain the required matrix (discarding other results).
call PN00A ( date1, date2, &
                 dpsi, deps, epsa, rb, rp, rbp, rmatn, rbpn )

end subroutine NUM00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine NUM00B ( date1, date2, rmatn )
!>
!  Form the matrix of nutation for a given date, IAU 2000B model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RMATN       d(3,3)   nutation matrix
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(true) = RMATN * V(mean),
!     where the p-vector V(true) is with respect to the true
!     equatorial triad of date and the p-vector V(mean) is with
!     respect to the mean equatorial triad of date.
!
!  3) The present routine is faster, but slightly less accurate (about
!     1 mas), than the NUM00A routine.
!
!  Called:
!     PN00B    bias/precession/nutation, IAU 2000B
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Section 3.222-3 (p114).
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rmatn(3,3)

double precision dpsi, deps, epsa, &
                 rb(3,3), rp(3,3), rbp(3,3), rbpn(3,3)

!  Obtain the required matrix (discarding other results).
call PN00B ( date1, date2, &
                 dpsi, deps, epsa, rb, rp, rbp, rmatn, rbpn )

end subroutine NUM00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine NUM06A ( date1, date2, rmatn )
!>
!  Form the matrix of nutation for a given date, IAU 2006/2000A model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RMATN        d(3,3)    nutation matrix
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(true) = RMATN * V(mean),
!     where the p-vector V(true) is with respect to the true
!     equatorial triad of date and the p-vector V(mean) is with
!     respect to the mean equatorial triad of date.
!
!  Called:
!     OBL06    mean obliquity, IAU 2006
!     NUT06A   nutation, IAU 2006/2000A
!     NUMAT    form nutation matrix
!
!  References:
!
!     Capitaine, N., Wallace, P.T. & Chapront, J., 2005, Astron.
!     Astrophys. 432, 355
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2007 May 11
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rmatn(3,3)

double precision eps, dp, de

!     DOUBLE PRECISION OBL06

!  Mean obliquity.
eps = OBL06 ( date1, date2 )

!  Nutation components.
call NUT06A ( date1, date2, dp, de )

!  Nutation matrix.
call NUMAT ( eps, dp, de, rmatn )

end subroutine NUM06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine NUMAT ( epsa, dpsi, deps, rmatn )
!>
!  Form the matrix of nutation.
!
!  Status:  support routine.
!
!  Given:
!     EPSA          d       mean obliquity of date (Note 1)
!     DPSI,DEPS     d       nutation (Note 2)
!
!  Returned:
!     RMATN       d(3,3)    nutation matrix (Note 3)
!
!  Notes:
!
!
!  1) The supplied mean obliquity EPSA, must be consistent with the
!     precession-nutation models from which DPSI and DEPS were obtained.
!
!  2) The caller is responsible for providing the nutation components;
!     they are in longitude and obliquity, in radians and are with
!     respect to the equinox and ecliptic of date.
!
!  3) The matrix operates in the sense V(true) = RMATN * V(mean),
!     where the p-vector V(true) is with respect to the true
!     equatorial triad of date and the p-vector V(mean) is with
!     respect to the mean equatorial triad of date.
!
!  Called:
!     IR       initialize r-matrix to identity
!     RX       rotate around X-axis
!     RZ       rotate around Z-axis
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Section 3.222-3 (p114).
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision epsa, dpsi, deps, rmatn(3,3)

!  Build the rotation matrix.
call IR ( rmatn )
call RX ( epsa, rmatn )
call RZ ( -dpsi, rmatn )
call RX ( -(epsa+deps), rmatn )

end subroutine NUMAT
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine NUT00A ( date1, date2, dpsi, deps )
!>
!  Nutation, IAU 2000A model (MHB2000 luni-solar and planetary nutation
!  with free core nutation omitted).
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2   d    TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     DPSI,DEPS     d    nutation, luni-solar + planetary (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The nutation components in longitude and obliquity are in radians
!     and with respect to the equinox and ecliptic of date.  The
!     obliquity at J2000.0 is assumed to be the Lieske et al. (1977)
!     value of 84381.448 arcsec.
!
!     Both the luni-solar and planetary nutations are included.  The
!     latter are due to direct planetary nutations and the perturbations
!     of the lunar and terrestrial orbits.
!
!  3) The routine computes the MHB2000 nutation series with the
!     associated corrections for planetary nutations.  It is an
!     implementation of the nutation part of the IAU 2000A precession-
!     nutation model, formally adopted by the IAU General Assembly in
!     2000, namely MHB2000 (Mathews et al. 2002), but with the free core
!     nutation (FCN - see Note 4) omitted.
!
!  4) The full MHB2000 model also contains contributions to the
!     nutations in longitude and obliquity due to the free-excitation of
!     the free-core-nutation during the period 1979-2000.  These FCN
!     terms, which are time-dependent and unpredictable, are NOT
!     included in the present routine and, if required, must be
!     independently computed.  With the FCN corrections included, the
!     present routine delivers a pole which is at current epochs
!     accurate to a few hundred microarcseconds.  The omission of FCN
!     introduces further errors of about that size.
!
!  5) The present routine provides classical nutation.  The MHB2000
!     algorithm, from which it is adapted, deals also with (i) the
!     offsets between the GCRS and mean poles and (ii) the adjustments
!     in longitude and obliquity due to the changed precession rates.
!     These additional functions, namely frame bias and precession
!     adjustments, are supported by the SOFA routines BI00 and
!     PR00.
!
!  6) The MHB2000 algorithm also provides "total" nutations, comprising
!     the arithmetic sum of the frame bias, precession adjustments,
!     luni-solar nutation and planetary nutation.  These total nutations
!     can be used in combination with an existing IAU 1976 precession
!     implementation, such as PMAT76, to deliver GCRS-to-true
!     predictions of sub-mas accuracy at current epochs.  However, there
!     are three shortcomings in the MHB2000 model that must be taken
!     into account if more accurate or definitive results are required
!     (see Wallace 2002):
!
!       (i) The MHB2000 total nutations are simply arithmetic sums,
!           yet in reality the various components are successive Euler
!           rotations.  This slight lack of rigor leads to cross terms
!           that exceed 1 mas after a century.  The rigorous procedure
!           is to form the GCRS-to-true rotation matrix by applying the
!           bias, precession and nutation in that order.
!
!      (ii) Although the precession adjustments are stated to be with
!           respect to Lieske et al. (1977), the MHB2000 model does
!           not specify which set of Euler angles are to be used and
!           how the adjustments are to be applied.  The most literal and
!           straightforward procedure is to adopt the 4-rotation
!           epsilon_0, psi_A, omega_A, xi_A option, and to add DPSIPR to
!           psi_A and DEPSPR to both omega_A and eps_A.
!
!     (iii) The MHB2000 model predates the determination by Chapront
!           et al. (2002) of a 14.6 mas displacement between the J2000.0
!           mean equinox and the origin of the ICRS frame.  It should,
!           however, be noted that neglecting this displacement when
!           calculating star coordinates does not lead to a 14.6 mas
!           change in right ascension, only a small second-order
!           distortion in the pattern of the precession-nutation effect.
!
!     For these reasons, the SOFA routines do not generate the "total
!     nutations" directly, though they can of course easily be generated
!     by calling BI00, PR00 and the present routine and adding
!     the results.
!
!  7) The MHB2000 model contains 41 instances where the same frequency
!     appears multiple times, of which 38 are duplicates and three are
!     triplicates.  To keep the present code close to the original MHB
!     algorithm, this small inefficiency has not been corrected.
!
!  Called:
!     FAL03    mean anomaly of the Moon
!     FAF03    mean argument of the latitude of the Moon
!     FAOM03   mean longitude of the Moon's ascending node
!     FAME03   mean longitude of Mercury
!     FAVE03   mean longitude of Venus
!     FAE03    mean longitude of Earth
!     FAMA03   mean longitude of Mars
!     FAJU03   mean longitude of Jupiter
!     FASA03   mean longitude of Saturn
!     FAUR03   mean longitude of Uranus
!     FAPA03   general accumulated precession in longitude
!
!  References:
!
!     Chapront, J., Chapront-Touze, M. & Francou, G. 2002,
!     Astron.Astrophys. 387, 700
!
!     Lieske, J.H., Lederle, T., Fricke, W. & Morando, B. 1977,
!     Astron.Astrophys. 58, 1-16
!
!     Mathews, P.M., Herring, T.A., Buffet, B.A. 2002, J.Geophys.Res.
!     107, B4.  The MHB_2000 code itself was obtained on 9th September
!     2002 from ftp//maia.usno.navy.mil/conv2000/chapter5/IAU2000A.
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J. 1994, Astron.Astrophys. 282, 663-683
!
!     Souchay, J., Loysel, B., Kinoshita, H., Folgueira, M. 1999,
!     Astron.Astrophys.Supp.Ser. 135, 111
!
!     Wallace, P.T., "Software for Implementing the IAU 2000
!     Resolutions", in IERS Workshop 5.1 (2002)
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsi, deps

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Arcseconds in a full circle
double precision turnas
parameter ( turnas = 1296000d0 )

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Units of 0.1 microarcsecond to radians
double precision u2r
parameter ( u2r = das2r/1d7 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

!  Miscellaneous
integer i, j
double precision t, el, elp, f, d, om, arg, dp, de, sarg, carg, &
                 al, alsu, af, ad, aom, alme, alve, alea, alma, &
                 alju, alsa, alur, alne, apa, dpsils, depsls, &
                 dpsipl, depspl
!     DOUBLE PRECISION FAL03, FAF03, FAOM03, FAME03,
!    :                 FAVE03, FAE03, FAMA03, FAJU03,
!    :                 FASA03, FAUR03, FAPA03

!  -------------------------
!  Luni-Solar nutation model
!  -------------------------

!  Number of terms in the luni-solar nutation model
integer nls
parameter ( nls = 678 )

!  Coefficients for fundamental arguments
integer nals(5,nls)

!  Longitude and obliquity coefficients
double precision cls(6,nls)

!  ---------------
!  Planetary terms
!  ---------------

!  Number of terms in the planetary nutation model
integer npl
parameter ( npl = 687 )

!  Coefficients for fundamental arguments
integer napl(14,npl)

!  Longitude and obliquity coefficients
integer icpl(4,npl)

!  ----------------------------------------
!  Tables of argument and term coefficients
!  ----------------------------------------

!
!  Luni-Solar argument multipliers
!               L     L'    F     D     Om

data ( ( nals(i,j), i=1,5 ), j=  1, 10 ) / &
          0,    0,    0,    0,    1, &
          0,    0,    2,   -2,    2, &
          0,    0,    2,    0,    2, &
          0,    0,    0,    0,    2, &
          0,    1,    0,    0,    0, &
          0,    1,    2,   -2,    2, &
          1,    0,    0,    0,    0, &
          0,    0,    2,    0,    1, &
          1,    0,    2,    0,    2, &
          0,   -1,    2,   -2,    2 /
data ( ( nals(i,j), i=1,5 ), j= 11, 20 ) / &
          0,    0,    2,   -2,    1, &
         -1,    0,    2,    0,    2, &
         -1,    0,    0,    2,    0, &
          1,    0,    0,    0,    1, &
         -1,    0,    0,    0,    1, &
         -1,    0,    2,    2,    2, &
          1,    0,    2,    0,    1, &
         -2,    0,    2,    0,    1, &
          0,    0,    0,    2,    0, &
          0,    0,    2,    2,    2 /
data ( ( nals(i,j), i=1,5 ), j= 21, 30 ) / &
          0,   -2,    2,   -2,    2, &
         -2,    0,    0,    2,    0, &
          2,    0,    2,    0,    2, &
          1,    0,    2,   -2,    2, &
         -1,    0,    2,    0,    1, &
          2,    0,    0,    0,    0, &
          0,    0,    2,    0,    0, &
          0,    1,    0,    0,    1, &
         -1,    0,    0,    2,    1, &
          0,    2,    2,   -2,    2 /
data ( ( nals(i,j), i=1,5 ), j= 31, 40 ) / &
          0,    0,   -2,    2,    0, &
          1,    0,    0,   -2,    1, &
          0,   -1,    0,    0,    1, &
         -1,    0,    2,    2,    1, &
          0,    2,    0,    0,    0, &
          1,    0,    2,    2,    2, &
         -2,    0,    2,    0,    0, &
          0,    1,    2,    0,    2, &
          0,    0,    2,    2,    1, &
          0,   -1,    2,    0,    2 /
data ( ( nals(i,j), i=1,5 ), j= 41, 50 ) / &
          0,    0,    0,    2,    1, &
          1,    0,    2,   -2,    1, &
          2,    0,    2,   -2,    2, &
         -2,    0,    0,    2,    1, &
          2,    0,    2,    0,    1, &
          0,   -1,    2,   -2,    1, &
          0,    0,    0,   -2,    1, &
         -1,   -1,    0,    2,    0, &
          2,    0,    0,   -2,    1, &
          1,    0,    0,    2,    0 /
data ( ( nals(i,j), i=1,5 ), j= 51, 60 ) / &
          0,    1,    2,   -2,    1, &
          1,   -1,    0,    0,    0, &
         -2,    0,    2,    0,    2, &
          3,    0,    2,    0,    2, &
          0,   -1,    0,    2,    0, &
          1,   -1,    2,    0,    2, &
          0,    0,    0,    1,    0, &
         -1,   -1,    2,    2,    2, &
         -1,    0,    2,    0,    0, &
          0,   -1,    2,    2,    2 /
data ( ( nals(i,j), i=1,5 ), j= 61, 70 ) / &
         -2,    0,    0,    0,    1, &
          1,    1,    2,    0,    2, &
          2,    0,    0,    0,    1, &
         -1,    1,    0,    1,    0, &
          1,    1,    0,    0,    0, &
          1,    0,    2,    0,    0, &
         -1,    0,    2,   -2,    1, &
          1,    0,    0,    0,    2, &
         -1,    0,    0,    1,    0, &
          0,    0,    2,    1,    2 /
data ( ( nals(i,j), i=1,5 ), j= 71, 80 ) / &
         -1,    0,    2,    4,    2, &
         -1,    1,    0,    1,    1, &
          0,   -2,    2,   -2,    1, &
          1,    0,    2,    2,    1, &
         -2,    0,    2,    2,    2, &
         -1,    0,    0,    0,    2, &
          1,    1,    2,   -2,    2, &
         -2,    0,    2,    4,    2, &
         -1,    0,    4,    0,    2, &
          2,    0,    2,   -2,    1 /
data ( ( nals(i,j), i=1,5 ), j= 81, 90 ) / &
          2,    0,    2,    2,    2, &
          1,    0,    0,    2,    1, &
          3,    0,    0,    0,    0, &
          3,    0,    2,   -2,    2, &
          0,    0,    4,   -2,    2, &
          0,    1,    2,    0,    1, &
          0,    0,   -2,    2,    1, &
          0,    0,    2,   -2,    3, &
         -1,    0,    0,    4,    0, &
          2,    0,   -2,    0,    1 /
data ( ( nals(i,j), i=1,5 ), j= 91,100 ) / &
         -2,    0,    0,    4,    0, &
         -1,   -1,    0,    2,    1, &
         -1,    0,    0,    1,    1, &
          0,    1,    0,    0,    2, &
          0,    0,   -2,    0,    1, &
          0,   -1,    2,    0,    1, &
          0,    0,    2,   -1,    2, &
          0,    0,    2,    4,    2, &
         -2,   -1,    0,    2,    0, &
          1,    1,    0,   -2,    1 /
data ( ( nals(i,j), i=1,5 ), j=101,110 ) / &
         -1,    1,    0,    2,    0, &
         -1,    1,    0,    1,    2, &
          1,   -1,    0,    0,    1, &
          1,   -1,    2,    2,    2, &
         -1,    1,    2,    2,    2, &
          3,    0,    2,    0,    1, &
          0,    1,   -2,    2,    0, &
         -1,    0,    0,   -2,    1, &
          0,    1,    2,    2,    2, &
         -1,   -1,    2,    2,    1 /
data ( ( nals(i,j), i=1,5 ), j=111,120 ) / &
          0,   -1,    0,    0,    2, &
          1,    0,    2,   -4,    1, &
         -1,    0,   -2,    2,    0, &
          0,   -1,    2,    2,    1, &
          2,   -1,    2,    0,    2, &
          0,    0,    0,    2,    2, &
          1,   -1,    2,    0,    1, &
         -1,    1,    2,    0,    2, &
          0,    1,    0,    2,    0, &
          0,   -1,   -2,    2,    0 /
data ( ( nals(i,j), i=1,5 ), j=121,130 ) / &
          0,    3,    2,   -2,    2, &
          0,    0,    0,    1,    1, &
         -1,    0,    2,    2,    0, &
          2,    1,    2,    0,    2, &
          1,    1,    0,    0,    1, &
          1,    1,    2,    0,    1, &
          2,    0,    0,    2,    0, &
          1,    0,   -2,    2,    0, &
         -1,    0,    0,    2,    2, &
          0,    1,    0,    1,    0 /
data ( ( nals(i,j), i=1,5 ), j=131,140 ) / &
          0,    1,    0,   -2,    1, &
         -1,    0,    2,   -2,    2, &
          0,    0,    0,   -1,    1, &
         -1,    1,    0,    0,    1, &
          1,    0,    2,   -1,    2, &
          1,   -1,    0,    2,    0, &
          0,    0,    0,    4,    0, &
          1,    0,    2,    1,    2, &
          0,    0,    2,    1,    1, &
          1,    0,    0,   -2,    2 /
data ( ( nals(i,j), i=1,5 ), j=141,150 ) / &
         -1,    0,    2,    4,    1, &
          1,    0,   -2,    0,    1, &
          1,    1,    2,   -2,    1, &
          0,    0,    2,    2,    0, &
         -1,    0,    2,   -1,    1, &
         -2,    0,    2,    2,    1, &
          4,    0,    2,    0,    2, &
          2,   -1,    0,    0,    0, &
          2,    1,    2,   -2,    2, &
          0,    1,    2,    1,    2 /
data ( ( nals(i,j), i=1,5 ), j=151,160 ) / &
          1,    0,    4,   -2,    2, &
         -1,   -1,    0,    0,    1, &
          0,    1,    0,    2,    1, &
         -2,    0,    2,    4,    1, &
          2,    0,    2,    0,    0, &
          1,    0,    0,    1,    0, &
         -1,    0,    0,    4,    1, &
         -1,    0,    4,    0,    1, &
          2,    0,    2,    2,    1, &
          0,    0,    2,   -3,    2 /
data ( ( nals(i,j), i=1,5 ), j=161,170 ) / &
         -1,   -2,    0,    2,    0, &
          2,    1,    0,    0,    0, &
          0,    0,    4,    0,    2, &
          0,    0,    0,    0,    3, &
          0,    3,    0,    0,    0, &
          0,    0,    2,   -4,    1, &
          0,   -1,    0,    2,    1, &
          0,    0,    0,    4,    1, &
         -1,   -1,    2,    4,    2, &
          1,    0,    2,    4,    2 /
data ( ( nals(i,j), i=1,5 ), j=171,180 ) / &
         -2,    2,    0,    2,    0, &
         -2,   -1,    2,    0,    1, &
         -2,    0,    0,    2,    2, &
         -1,   -1,    2,    0,    2, &
          0,    0,    4,   -2,    1, &
          3,    0,    2,   -2,    1, &
         -2,   -1,    0,    2,    1, &
          1,    0,    0,   -1,    1, &
          0,   -2,    0,    2,    0, &
         -2,    0,    0,    4,    1 /
data ( ( nals(i,j), i=1,5 ), j=181,190 ) / &
         -3,    0,    0,    0,    1, &
          1,    1,    2,    2,    2, &
          0,    0,    2,    4,    1, &
          3,    0,    2,    2,    2, &
         -1,    1,    2,   -2,    1, &
          2,    0,    0,   -4,    1, &
          0,    0,    0,   -2,    2, &
          2,    0,    2,   -4,    1, &
         -1,    1,    0,    2,    1, &
          0,    0,    2,   -1,    1 /
data ( ( nals(i,j), i=1,5 ), j=191,200 ) / &
          0,   -2,    2,    2,    2, &
          2,    0,    0,    2,    1, &
          4,    0,    2,   -2,    2, &
          2,    0,    0,   -2,    2, &
          0,    2,    0,    0,    1, &
          1,    0,    0,   -4,    1, &
          0,    2,    2,   -2,    1, &
         -3,    0,    0,    4,    0, &
         -1,    1,    2,    0,    1, &
         -1,   -1,    0,    4,    0 /
data ( ( nals(i,j), i=1,5 ), j=201,210 ) / &
         -1,   -2,    2,    2,    2, &
         -2,   -1,    2,    4,    2, &
          1,   -1,    2,    2,    1, &
         -2,    1,    0,    2,    0, &
         -2,    1,    2,    0,    1, &
          2,    1,    0,   -2,    1, &
         -3,    0,    2,    0,    1, &
         -2,    0,    2,   -2,    1, &
         -1,    1,    0,    2,    2, &
          0,   -1,    2,   -1,    2 /
data ( ( nals(i,j), i=1,5 ), j=211,220 ) / &
         -1,    0,    4,   -2,    2, &
          0,   -2,    2,    0,    2, &
         -1,    0,    2,    1,    2, &
          2,    0,    0,    0,    2, &
          0,    0,    2,    0,    3, &
         -2,    0,    4,    0,    2, &
         -1,    0,   -2,    0,    1, &
         -1,    1,    2,    2,    1, &
          3,    0,    0,    0,    1, &
         -1,    0,    2,    3,    2 /
data ( ( nals(i,j), i=1,5 ), j=221,230 ) / &
          2,   -1,    2,    0,    1, &
          0,    1,    2,    2,    1, &
          0,   -1,    2,    4,    2, &
          2,   -1,    2,    2,    2, &
          0,    2,   -2,    2,    0, &
         -1,   -1,    2,   -1,    1, &
          0,   -2,    0,    0,    1, &
          1,    0,    2,   -4,    2, &
          1,   -1,    0,   -2,    1, &
         -1,   -1,    2,    0,    1 /
data ( ( nals(i,j), i=1,5 ), j=231,240 ) / &
          1,   -1,    2,   -2,    2, &
         -2,   -1,    0,    4,    0, &
         -1,    0,    0,    3,    0, &
         -2,   -1,    2,    2,    2, &
          0,    2,    2,    0,    2, &
          1,    1,    0,    2,    0, &
          2,    0,    2,   -1,    2, &
          1,    0,    2,    1,    1, &
          4,    0,    0,    0,    0, &
          2,    1,    2,    0,    1 /
data ( ( nals(i,j), i=1,5 ), j=241,250 ) / &
          3,   -1,    2,    0,    2, &
         -2,    2,    0,    2,    1, &
          1,    0,    2,   -3,    1, &
          1,    1,    2,   -4,    1, &
         -1,   -1,    2,   -2,    1, &
          0,   -1,    0,   -1,    1, &
          0,   -1,    0,   -2,    1, &
         -2,    0,    0,    0,    2, &
         -2,    0,   -2,    2,    0, &
         -1,    0,   -2,    4,    0 /
data ( ( nals(i,j), i=1,5 ), j=251,260 ) / &
          1,   -2,    0,    0,    0, &
          0,    1,    0,    1,    1, &
         -1,    2,    0,    2,    0, &
          1,   -1,    2,   -2,    1, &
          1,    2,    2,   -2,    2, &
          2,   -1,    2,   -2,    2, &
          1,    0,    2,   -1,    1, &
          2,    1,    2,   -2,    1, &
         -2,    0,    0,   -2,    1, &
          1,   -2,    2,    0,    2 /
data ( ( nals(i,j), i=1,5 ), j=261,270 ) / &
          0,    1,    2,    1,    1, &
          1,    0,    4,   -2,    1, &
         -2,    0,    4,    2,    2, &
          1,    1,    2,    1,    2, &
          1,    0,    0,    4,    0, &
          1,    0,    2,    2,    0, &
          2,    0,    2,    1,    2, &
          3,    1,    2,    0,    2, &
          4,    0,    2,    0,    1, &
         -2,   -1,    2,    0,    0 /
data ( ( nals(i,j), i=1,5 ), j=271,280 ) / &
          0,    1,   -2,    2,    1, &
          1,    0,   -2,    1,    0, &
          0,   -1,   -2,    2,    1, &
          2,   -1,    0,   -2,    1, &
         -1,    0,    2,   -1,    2, &
          1,    0,    2,   -3,    2, &
          0,    1,    2,   -2,    3, &
          0,    0,    2,   -3,    1, &
         -1,    0,   -2,    2,    1, &
          0,    0,    2,   -4,    2 /
data ( ( nals(i,j), i=1,5 ), j=281,290 ) / &
         -2,    1,    0,    0,    1, &
         -1,    0,    0,   -1,    1, &
          2,    0,    2,   -4,    2, &
          0,    0,    4,   -4,    4, &
          0,    0,    4,   -4,    2, &
         -1,   -2,    0,    2,    1, &
         -2,    0,    0,    3,    0, &
          1,    0,   -2,    2,    1, &
         -3,    0,    2,    2,    2, &
         -3,    0,    2,    2,    1 /
data ( ( nals(i,j), i=1,5 ), j=291,300 ) / &
         -2,    0,    2,    2,    0, &
          2,   -1,    0,    0,    1, &
         -2,    1,    2,    2,    2, &
          1,    1,    0,    1,    0, &
          0,    1,    4,   -2,    2, &
         -1,    1,    0,   -2,    1, &
          0,    0,    0,   -4,    1, &
          1,   -1,    0,    2,    1, &
          1,    1,    0,    2,    1, &
         -1,    2,    2,    2,    2 /
data ( ( nals(i,j), i=1,5 ), j=301,310 ) / &
          3,    1,    2,   -2,    2, &
          0,   -1,    0,    4,    0, &
          2,   -1,    0,    2,    0, &
          0,    0,    4,    0,    1, &
          2,    0,    4,   -2,    2, &
         -1,   -1,    2,    4,    1, &
          1,    0,    0,    4,    1, &
          1,   -2,    2,    2,    2, &
          0,    0,    2,    3,    2, &
         -1,    1,    2,    4,    2 /
data ( ( nals(i,j), i=1,5 ), j=311,320 ) / &
          3,    0,    0,    2,    0, &
         -1,    0,    4,    2,    2, &
          1,    1,    2,    2,    1, &
         -2,    0,    2,    6,    2, &
          2,    1,    2,    2,    2, &
         -1,    0,    2,    6,    2, &
          1,    0,    2,    4,    1, &
          2,    0,    2,    4,    2, &
          1,    1,   -2,    1,    0, &
         -3,    1,    2,    1,    2 /
data ( ( nals(i,j), i=1,5 ), j=321,330 ) / &
          2,    0,   -2,    0,    2, &
         -1,    0,    0,    1,    2, &
         -4,    0,    2,    2,    1, &
         -1,   -1,    0,    1,    0, &
          0,    0,   -2,    2,    2, &
          1,    0,    0,   -1,    2, &
          0,   -1,    2,   -2,    3, &
         -2,    1,    2,    0,    0, &
          0,    0,    2,   -2,    4, &
         -2,   -2,    0,    2,    0 /
data ( ( nals(i,j), i=1,5 ), j=331,340 ) / &
         -2,    0,   -2,    4,    0, &
          0,   -2,   -2,    2,    0, &
          1,    2,    0,   -2,    1, &
          3,    0,    0,   -4,    1, &
         -1,    1,    2,   -2,    2, &
          1,   -1,    2,   -4,    1, &
          1,    1,    0,   -2,    2, &
         -3,    0,    2,    0,    0, &
         -3,    0,    2,    0,    2, &
         -2,    0,    0,    1,    0 /
data ( ( nals(i,j), i=1,5 ), j=341,350 ) / &
          0,    0,   -2,    1,    0, &
         -3,    0,    0,    2,    1, &
         -1,   -1,   -2,    2,    0, &
          0,    1,    2,   -4,    1, &
          2,    1,    0,   -4,    1, &
          0,    2,    0,   -2,    1, &
          1,    0,    0,   -3,    1, &
         -2,    0,    2,   -2,    2, &
         -2,   -1,    0,    0,    1, &
         -4,    0,    0,    2,    0 /
data ( ( nals(i,j), i=1,5 ), j=351,360 ) / &
          1,    1,    0,   -4,    1, &
         -1,    0,    2,   -4,    1, &
          0,    0,    4,   -4,    1, &
          0,    3,    2,   -2,    2, &
         -3,   -1,    0,    4,    0, &
         -3,    0,    0,    4,    1, &
          1,   -1,   -2,    2,    0, &
         -1,   -1,    0,    2,    2, &
          1,   -2,    0,    0,    1, &
          1,   -1,    0,    0,    2 /
data ( ( nals(i,j), i=1,5 ), j=361,370 ) / &
          0,    0,    0,    1,    2, &
         -1,   -1,    2,    0,    0, &
          1,   -2,    2,   -2,    2, &
          0,   -1,    2,   -1,    1, &
         -1,    0,    2,    0,    3, &
          1,    1,    0,    0,    2, &
         -1,    1,    2,    0,    0, &
          1,    2,    0,    0,    0, &
         -1,    2,    2,    0,    2, &
         -1,    0,    4,   -2,    1 /
data ( ( nals(i,j), i=1,5 ), j=371,380 ) / &
          3,    0,    2,   -4,    2, &
          1,    2,    2,   -2,    1, &
          1,    0,    4,   -4,    2, &
         -2,   -1,    0,    4,    1, &
          0,   -1,    0,    2,    2, &
         -2,    1,    0,    4,    0, &
         -2,   -1,    2,    2,    1, &
          2,    0,   -2,    2,    0, &
          1,    0,    0,    1,    1, &
          0,    1,    0,    2,    2 /
data ( ( nals(i,j), i=1,5 ), j=381,390 ) / &
          1,   -1,    2,   -1,    2, &
         -2,    0,    4,    0,    1, &
          2,    1,    0,    0,    1, &
          0,    1,    2,    0,    0, &
          0,   -1,    4,   -2,    2, &
          0,    0,    4,   -2,    4, &
          0,    2,    2,    0,    1, &
         -3,    0,    0,    6,    0, &
         -1,   -1,    0,    4,    1, &
          1,   -2,    0,    2,    0 /
data ( ( nals(i,j), i=1,5 ), j=391,400 ) / &
         -1,    0,    0,    4,    2, &
         -1,   -2,    2,    2,    1, &
         -1,    0,    0,   -2,    2, &
          1,    0,   -2,   -2,    1, &
          0,    0,   -2,   -2,    1, &
         -2,    0,   -2,    0,    1, &
          0,    0,    0,    3,    1, &
          0,    0,    0,    3,    0, &
         -1,    1,    0,    4,    0, &
         -1,   -1,    2,    2,    0 /
data ( ( nals(i,j), i=1,5 ), j=401,410 ) / &
         -2,    0,    2,    3,    2, &
          1,    0,    0,    2,    2, &
          0,   -1,    2,    1,    2, &
          3,   -1,    0,    0,    0, &
          2,    0,    0,    1,    0, &
          1,   -1,    2,    0,    0, &
          0,    0,    2,    1,    0, &
          1,    0,    2,    0,    3, &
          3,    1,    0,    0,    0, &
          3,   -1,    2,   -2,    2 /
data ( ( nals(i,j), i=1,5 ), j=411,420 ) / &
          2,    0,    2,   -1,    1, &
          1,    1,    2,    0,    0, &
          0,    0,    4,   -1,    2, &
          1,    2,    2,    0,    2, &
         -2,    0,    0,    6,    0, &
          0,   -1,    0,    4,    1, &
         -2,   -1,    2,    4,    1, &
          0,   -2,    2,    2,    1, &
          0,   -1,    2,    2,    0, &
         -1,    0,    2,    3,    1 /
data ( ( nals(i,j), i=1,5 ), j=421,430 ) / &
         -2,    1,    2,    4,    2, &
          2,    0,    0,    2,    2, &
          2,   -2,    2,    0,    2, &
         -1,    1,    2,    3,    2, &
          3,    0,    2,   -1,    2, &
          4,    0,    2,   -2,    1, &
         -1,    0,    0,    6,    0, &
         -1,   -2,    2,    4,    2, &
         -3,    0,    2,    6,    2, &
         -1,    0,    2,    4,    0 /
data ( ( nals(i,j), i=1,5 ), j=431,440 ) / &
          3,    0,    0,    2,    1, &
          3,   -1,    2,    0,    1, &
          3,    0,    2,    0,    0, &
          1,    0,    4,    0,    2, &
          5,    0,    2,   -2,    2, &
          0,   -1,    2,    4,    1, &
          2,   -1,    2,    2,    1, &
          0,    1,    2,    4,    2, &
          1,   -1,    2,    4,    2, &
          3,   -1,    2,    2,    2 /
data ( ( nals(i,j), i=1,5 ), j=441,450 ) / &
          3,    0,    2,    2,    1, &
          5,    0,    2,    0,    2, &
          0,    0,    2,    6,    2, &
          4,    0,    2,    2,    2, &
          0,   -1,    1,   -1,    1, &
         -1,    0,    1,    0,    3, &
          0,   -2,    2,   -2,    3, &
          1,    0,   -1,    0,    1, &
          2,   -2,    0,   -2,    1, &
         -1,    0,    1,    0,    2 /
data ( ( nals(i,j), i=1,5 ), j=451,460 ) / &
         -1,    0,    1,    0,    1, &
         -1,   -1,    2,   -1,    2, &
         -2,    2,    0,    2,    2, &
         -1,    0,    1,    0,    0, &
         -4,    1,    2,    2,    2, &
         -3,    0,    2,    1,    1, &
         -2,   -1,    2,    0,    2, &
          1,    0,   -2,    1,    1, &
          2,   -1,   -2,    0,    1, &
         -4,    0,    2,    2,    0 /
data ( ( nals(i,j), i=1,5 ), j=461,470 ) / &
         -3,    1,    0,    3,    0, &
         -1,    0,   -1,    2,    0, &
          0,   -2,    0,    0,    2, &
          0,   -2,    0,    0,    2, &
         -3,    0,    0,    3,    0, &
         -2,   -1,    0,    2,    2, &
         -1,    0,   -2,    3,    0, &
         -4,    0,    0,    4,    0, &
          2,    1,   -2,    0,    1, &
          2,   -1,    0,   -2,    2 /
data ( ( nals(i,j), i=1,5 ), j=471,480 ) / &
          0,    0,    1,   -1,    0, &
         -1,    2,    0,    1,    0, &
         -2,    1,    2,    0,    2, &
          1,    1,    0,   -1,    1, &
          1,    0,    1,   -2,    1, &
          0,    2,    0,    0,    2, &
          1,   -1,    2,   -3,    1, &
         -1,    1,    2,   -1,    1, &
         -2,    0,    4,   -2,    2, &
         -2,    0,    4,   -2,    1 /
data ( ( nals(i,j), i=1,5 ), j=481,490 ) / &
         -2,   -2,    0,    2,    1, &
         -2,    0,   -2,    4,    0, &
          1,    2,    2,   -4,    1, &
          1,    1,    2,   -4,    2, &
         -1,    2,    2,   -2,    1, &
          2,    0,    0,   -3,    1, &
         -1,    2,    0,    0,    1, &
          0,    0,    0,   -2,    0, &
         -1,   -1,    2,   -2,    2, &
         -1,    1,    0,    0,    2 /
data ( ( nals(i,j), i=1,5 ), j=491,500 ) / &
          0,    0,    0,   -1,    2, &
         -2,    1,    0,    1,    0, &
          1,   -2,    0,   -2,    1, &
          1,    0,   -2,    0,    2, &
         -3,    1,    0,    2,    0, &
         -1,    1,   -2,    2,    0, &
         -1,   -1,    0,    0,    2, &
         -3,    0,    0,    2,    0, &
         -3,   -1,    0,    2,    0, &
          2,    0,    2,   -6,    1 /
data ( ( nals(i,j), i=1,5 ), j=501,510 ) / &
          0,    1,    2,   -4,    2, &
          2,    0,    0,   -4,    2, &
         -2,    1,    2,   -2,    1, &
          0,   -1,    2,   -4,    1, &
          0,    1,    0,   -2,    2, &
         -1,    0,    0,   -2,    0, &
          2,    0,   -2,   -2,    1, &
         -4,    0,    2,    0,    1, &
         -1,   -1,    0,   -1,    1, &
          0,    0,   -2,    0,    2 /
data ( ( nals(i,j), i=1,5 ), j=511,520 ) / &
         -3,    0,    0,    1,    0, &
         -1,    0,   -2,    1,    0, &
         -2,    0,   -2,    2,    1, &
          0,    0,   -4,    2,    0, &
         -2,   -1,   -2,    2,    0, &
          1,    0,    2,   -6,    1, &
         -1,    0,    2,   -4,    2, &
          1,    0,    0,   -4,    2, &
          2,    1,    2,   -4,    2, &
          2,    1,    2,   -4,    1 /
data ( ( nals(i,j), i=1,5 ), j=521,530 ) / &
          0,    1,    4,   -4,    4, &
          0,    1,    4,   -4,    2, &
         -1,   -1,   -2,    4,    0, &
         -1,   -3,    0,    2,    0, &
         -1,    0,   -2,    4,    1, &
         -2,   -1,    0,    3,    0, &
          0,    0,   -2,    3,    0, &
         -2,    0,    0,    3,    1, &
          0,   -1,    0,    1,    0, &
         -3,    0,    2,    2,    0 /
data ( ( nals(i,j), i=1,5 ), j=531,540 ) / &
          1,    1,   -2,    2,    0, &
         -1,    1,    0,    2,    2, &
          1,   -2,    2,   -2,    1, &
          0,    0,    1,    0,    2, &
          0,    0,    1,    0,    1, &
          0,    0,    1,    0,    0, &
         -1,    2,    0,    2,    1, &
          0,    0,    2,    0,    2, &
         -2,    0,    2,    0,    2, &
          2,    0,    0,   -1,    1 /
data ( ( nals(i,j), i=1,5 ), j=541,550 ) / &
          3,    0,    0,   -2,    1, &
          1,    0,    2,   -2,    3, &
          1,    2,    0,    0,    1, &
          2,    0,    2,   -3,    2, &
         -1,    1,    4,   -2,    2, &
         -2,   -2,    0,    4,    0, &
          0,   -3,    0,    2,    0, &
          0,    0,   -2,    4,    0, &
         -1,   -1,    0,    3,    0, &
         -2,    0,    0,    4,    2 /
data ( ( nals(i,j), i=1,5 ), j=551,560 ) / &
         -1,    0,    0,    3,    1, &
          2,   -2,    0,    0,    0, &
          1,   -1,    0,    1,    0, &
         -1,    0,    0,    2,    0, &
          0,   -2,    2,    0,    1, &
         -1,    0,    1,    2,    1, &
         -1,    1,    0,    3,    0, &
         -1,   -1,    2,    1,    2, &
          0,   -1,    2,    0,    0, &
         -2,    1,    2,    2,    1 /
data ( ( nals(i,j), i=1,5 ), j=561,570 ) / &
          2,   -2,    2,   -2,    2, &
          1,    1,    0,    1,    1, &
          1,    0,    1,    0,    1, &
          1,    0,    1,    0,    0, &
          0,    2,    0,    2,    0, &
          2,   -1,    2,   -2,    1, &
          0,   -1,    4,   -2,    1, &
          0,    0,    4,   -2,    3, &
          0,    1,    4,   -2,    1, &
          4,    0,    2,   -4,    2 /
data ( ( nals(i,j), i=1,5 ), j=571,580 ) / &
          2,    2,    2,   -2,    2, &
          2,    0,    4,   -4,    2, &
         -1,   -2,    0,    4,    0, &
         -1,   -3,    2,    2,    2, &
         -3,    0,    2,    4,    2, &
         -3,    0,    2,   -2,    1, &
         -1,   -1,    0,   -2,    1, &
         -3,    0,    0,    0,    2, &
         -3,    0,   -2,    2,    0, &
          0,    1,    0,   -4,    1 /
data ( ( nals(i,j), i=1,5 ), j=581,590 ) / &
         -2,    1,    0,   -2,    1, &
         -4,    0,    0,    0,    1, &
         -1,    0,    0,   -4,    1, &
         -3,    0,    0,   -2,    1, &
          0,    0,    0,    3,    2, &
         -1,    1,    0,    4,    1, &
          1,   -2,    2,    0,    1, &
          0,    1,    0,    3,    0, &
         -1,    0,    2,    2,    3, &
          0,    0,    2,    2,    2 /
data ( ( nals(i,j), i=1,5 ), j=591,600 ) / &
         -2,    0,    2,    2,    2, &
         -1,    1,    2,    2,    0, &
          3,    0,    0,    0,    2, &
          2,    1,    0,    1,    0, &
          2,   -1,    2,   -1,    2, &
          0,    0,    2,    0,    1, &
          0,    0,    3,    0,    3, &
          0,    0,    3,    0,    2, &
         -1,    2,    2,    2,    1, &
         -1,    0,    4,    0,    0 /
data ( ( nals(i,j), i=1,5 ), j=601,610 ) / &
          1,    2,    2,    0,    1, &
          3,    1,    2,   -2,    1, &
          1,    1,    4,   -2,    2, &
         -2,   -1,    0,    6,    0, &
          0,   -2,    0,    4,    0, &
         -2,    0,    0,    6,    1, &
         -2,   -2,    2,    4,    2, &
          0,   -3,    2,    2,    2, &
          0,    0,    0,    4,    2, &
         -1,   -1,    2,    3,    2 /
data ( ( nals(i,j), i=1,5 ), j=611,620 ) / &
         -2,    0,    2,    4,    0, &
          2,   -1,    0,    2,    1, &
          1,    0,    0,    3,    0, &
          0,    1,    0,    4,    1, &
          0,    1,    0,    4,    0, &
          1,   -1,    2,    1,    2, &
          0,    0,    2,    2,    3, &
          1,    0,    2,    2,    2, &
         -1,    0,    2,    2,    2, &
         -2,    0,    4,    2,    1 /
data ( ( nals(i,j), i=1,5 ), j=621,630 ) / &
          2,    1,    0,    2,    1, &
          2,    1,    0,    2,    0, &
          2,   -1,    2,    0,    0, &
          1,    0,    2,    1,    0, &
          0,    1,    2,    2,    0, &
          2,    0,    2,    0,    3, &
          3,    0,    2,    0,    2, &
          1,    0,    2,    0,    2, &
          1,    0,    3,    0,    3, &
          1,    1,    2,    1,    1 /
data ( ( nals(i,j), i=1,5 ), j=631,640 ) / &
          0,    2,    2,    2,    2, &
          2,    1,    2,    0,    0, &
          2,    0,    4,   -2,    1, &
          4,    1,    2,   -2,    2, &
         -1,   -1,    0,    6,    0, &
         -3,   -1,    2,    6,    2, &
         -1,    0,    0,    6,    1, &
         -3,    0,    2,    6,    1, &
          1,   -1,    0,    4,    1, &
          1,   -1,    0,    4,    0 /
data ( ( nals(i,j), i=1,5 ), j=641,650 ) / &
         -2,    0,    2,    5,    2, &
          1,   -2,    2,    2,    1, &
          3,   -1,    0,    2,    0, &
          1,   -1,    2,    2,    0, &
          0,    0,    2,    3,    1, &
         -1,    1,    2,    4,    1, &
          0,    1,    2,    3,    2, &
         -1,    0,    4,    2,    1, &
          2,    0,    2,    1,    1, &
          5,    0,    0,    0,    0 /
data ( ( nals(i,j), i=1,5 ), j=651,660 ) / &
          2,    1,    2,    1,    2, &
          1,    0,    4,    0,    1, &
          3,    1,    2,    0,    1, &
          3,    0,    4,   -2,    2, &
         -2,   -1,    2,    6,    2, &
          0,    0,    0,    6,    0, &
          0,   -2,    2,    4,    2, &
         -2,    0,    2,    6,    1, &
          2,    0,    0,    4,    1, &
          2,    0,    0,    4,    0 /
data ( ( nals(i,j), i=1,5 ), j=661,670 ) / &
          2,   -2,    2,    2,    2, &
          0,    0,    2,    4,    0, &
          1,    0,    2,    3,    2, &
          4,    0,    0,    2,    0, &
          2,    0,    2,    2,    0, &
          0,    0,    4,    2,    2, &
          4,   -1,    2,    0,    2, &
          3,    0,    2,    1,    2, &
          2,    1,    2,    2,    1, &
          4,    1,    2,    0,    2 /
data ( ( nals(i,j), i=1,5 ), j=671,678 ) / &
         -1,   -1,    2,    6,    2, &
         -1,    0,    2,    6,    1, &
          1,   -1,    2,    4,    1, &
          1,    1,    2,    4,    2, &
          3,    1,    2,    2,    2, &
          5,    0,    2,    0,    1, &
          2,   -1,    2,    4,    2, &
          2,    0,    2,    4,    1 /

!
!  Luni-Solar nutation coefficients, unit 1e-7 arcsec
!  longitude (sin, t*sin, cos), obliquity (cos, t*cos, sin)
!

data ( ( cls(i,j), i=1,6 ), j=  1, 10 ) / &
 -172064161d0, -174666d0,  33386d0, 92052331d0,  9086d0, 15377d0, &
  -13170906d0,   -1675d0, -13696d0,  5730336d0, -3015d0, -4587d0, &
   -2276413d0,    -234d0,   2796d0,   978459d0,  -485d0,  1374d0, &
    2074554d0,     207d0,   -698d0,  -897492d0,   470d0,  -291d0, &
    1475877d0,   -3633d0,  11817d0,    73871d0,  -184d0, -1924d0, &
    -516821d0,    1226d0,   -524d0,   224386d0,  -677d0,  -174d0, &
     711159d0,      73d0,   -872d0,    -6750d0,     0d0,   358d0, &
    -387298d0,    -367d0,    380d0,   200728d0,    18d0,   318d0, &
    -301461d0,     -36d0,    816d0,   129025d0,   -63d0,   367d0, &
     215829d0,    -494d0,    111d0,   -95929d0,   299d0,   132d0 /
data ( ( cls(i,j), i=1,6 ), j= 11, 20 ) / &
     128227d0,     137d0,    181d0,   -68982d0,    -9d0,    39d0, &
     123457d0,      11d0,     19d0,   -53311d0,    32d0,    -4d0, &
     156994d0,      10d0,   -168d0,    -1235d0,     0d0,    82d0, &
      63110d0,      63d0,     27d0,   -33228d0,     0d0,    -9d0, &
     -57976d0,     -63d0,   -189d0,    31429d0,     0d0,   -75d0, &
     -59641d0,     -11d0,    149d0,    25543d0,   -11d0,    66d0, &
     -51613d0,     -42d0,    129d0,    26366d0,     0d0,    78d0, &
      45893d0,      50d0,     31d0,   -24236d0,   -10d0,    20d0, &
      63384d0,      11d0,   -150d0,    -1220d0,     0d0,    29d0, &
     -38571d0,      -1d0,    158d0,    16452d0,   -11d0,    68d0 /
data ( ( cls(i,j), i=1,6 ), j= 21, 30 ) / &
      32481d0,       0d0,      0d0,   -13870d0,     0d0,     0d0, &
     -47722d0,       0d0,    -18d0,      477d0,     0d0,   -25d0, &
     -31046d0,      -1d0,    131d0,    13238d0,   -11d0,    59d0, &
      28593d0,       0d0,     -1d0,   -12338d0,    10d0,    -3d0, &
      20441d0,      21d0,     10d0,   -10758d0,     0d0,    -3d0, &
      29243d0,       0d0,    -74d0,     -609d0,     0d0,    13d0, &
      25887d0,       0d0,    -66d0,     -550d0,     0d0,    11d0, &
     -14053d0,     -25d0,     79d0,     8551d0,    -2d0,   -45d0, &
      15164d0,      10d0,     11d0,    -8001d0,     0d0,    -1d0, &
     -15794d0,      72d0,    -16d0,     6850d0,   -42d0,    -5d0 /
data ( ( cls(i,j), i=1,6 ), j= 31, 40 ) / &
      21783d0,       0d0,     13d0,     -167d0,     0d0,    13d0, &
     -12873d0,     -10d0,    -37d0,     6953d0,     0d0,   -14d0, &
     -12654d0,      11d0,     63d0,     6415d0,     0d0,    26d0, &
     -10204d0,       0d0,     25d0,     5222d0,     0d0,    15d0, &
      16707d0,     -85d0,    -10d0,      168d0,    -1d0,    10d0, &
      -7691d0,       0d0,     44d0,     3268d0,     0d0,    19d0, &
     -11024d0,       0d0,    -14d0,      104d0,     0d0,     2d0, &
       7566d0,     -21d0,    -11d0,    -3250d0,     0d0,    -5d0, &
      -6637d0,     -11d0,     25d0,     3353d0,     0d0,    14d0, &
      -7141d0,      21d0,      8d0,     3070d0,     0d0,     4d0 /
data ( ( cls(i,j), i=1,6 ), j= 41, 50 ) / &
      -6302d0,     -11d0,      2d0,     3272d0,     0d0,     4d0, &
       5800d0,      10d0,      2d0,    -3045d0,     0d0,    -1d0, &
       6443d0,       0d0,     -7d0,    -2768d0,     0d0,    -4d0, &
      -5774d0,     -11d0,    -15d0,     3041d0,     0d0,    -5d0, &
      -5350d0,       0d0,     21d0,     2695d0,     0d0,    12d0, &
      -4752d0,     -11d0,     -3d0,     2719d0,     0d0,    -3d0, &
      -4940d0,     -11d0,    -21d0,     2720d0,     0d0,    -9d0, &
       7350d0,       0d0,     -8d0,      -51d0,     0d0,     4d0, &
       4065d0,       0d0,      6d0,    -2206d0,     0d0,     1d0, &
       6579d0,       0d0,    -24d0,     -199d0,     0d0,     2d0 /
data ( ( cls(i,j), i=1,6 ), j= 51, 60 ) / &
       3579d0,       0d0,      5d0,    -1900d0,     0d0,     1d0, &
       4725d0,       0d0,     -6d0,      -41d0,     0d0,     3d0, &
      -3075d0,       0d0,     -2d0,     1313d0,     0d0,    -1d0, &
      -2904d0,       0d0,     15d0,     1233d0,     0d0,     7d0, &
       4348d0,       0d0,    -10d0,      -81d0,     0d0,     2d0, &
      -2878d0,       0d0,      8d0,     1232d0,     0d0,     4d0, &
      -4230d0,       0d0,      5d0,      -20d0,     0d0,    -2d0, &
      -2819d0,       0d0,      7d0,     1207d0,     0d0,     3d0, &
      -4056d0,       0d0,      5d0,       40d0,     0d0,    -2d0, &
      -2647d0,       0d0,     11d0,     1129d0,     0d0,     5d0 /
data ( ( cls(i,j), i=1,6 ), j= 61, 70 ) / &
      -2294d0,       0d0,    -10d0,     1266d0,     0d0,    -4d0, &
       2481d0,       0d0,     -7d0,    -1062d0,     0d0,    -3d0, &
       2179d0,       0d0,     -2d0,    -1129d0,     0d0,    -2d0, &
       3276d0,       0d0,      1d0,       -9d0,     0d0,     0d0, &
      -3389d0,       0d0,      5d0,       35d0,     0d0,    -2d0, &
       3339d0,       0d0,    -13d0,     -107d0,     0d0,     1d0, &
      -1987d0,       0d0,     -6d0,     1073d0,     0d0,    -2d0, &
      -1981d0,       0d0,      0d0,      854d0,     0d0,     0d0, &
       4026d0,       0d0,   -353d0,     -553d0,     0d0,  -139d0, &
       1660d0,       0d0,     -5d0,     -710d0,     0d0,    -2d0 /
data ( ( cls(i,j), i=1,6 ), j= 71, 80 ) / &
      -1521d0,       0d0,      9d0,      647d0,     0d0,     4d0, &
       1314d0,       0d0,      0d0,     -700d0,     0d0,     0d0, &
      -1283d0,       0d0,      0d0,      672d0,     0d0,     0d0, &
      -1331d0,       0d0,      8d0,      663d0,     0d0,     4d0, &
       1383d0,       0d0,     -2d0,     -594d0,     0d0,    -2d0, &
       1405d0,       0d0,      4d0,     -610d0,     0d0,     2d0, &
       1290d0,       0d0,      0d0,     -556d0,     0d0,     0d0, &
      -1214d0,       0d0,      5d0,      518d0,     0d0,     2d0, &
       1146d0,       0d0,     -3d0,     -490d0,     0d0,    -1d0, &
       1019d0,       0d0,     -1d0,     -527d0,     0d0,    -1d0 /
data ( ( cls(i,j), i=1,6 ), j= 81, 90 ) / &
      -1100d0,       0d0,      9d0,      465d0,     0d0,     4d0, &
       -970d0,       0d0,      2d0,      496d0,     0d0,     1d0, &
       1575d0,       0d0,     -6d0,      -50d0,     0d0,     0d0, &
        934d0,       0d0,     -3d0,     -399d0,     0d0,    -1d0, &
        922d0,       0d0,     -1d0,     -395d0,     0d0,    -1d0, &
        815d0,       0d0,     -1d0,     -422d0,     0d0,    -1d0, &
        834d0,       0d0,      2d0,     -440d0,     0d0,     1d0, &
       1248d0,       0d0,      0d0,     -170d0,     0d0,     1d0, &
       1338d0,       0d0,     -5d0,      -39d0,     0d0,     0d0, &
        716d0,       0d0,     -2d0,     -389d0,     0d0,    -1d0 /
data ( ( cls(i,j), i=1,6 ), j= 91,100 ) / &
       1282d0,       0d0,     -3d0,      -23d0,     0d0,     1d0, &
        742d0,       0d0,      1d0,     -391d0,     0d0,     0d0, &
       1020d0,       0d0,    -25d0,     -495d0,     0d0,   -10d0, &
        715d0,       0d0,     -4d0,     -326d0,     0d0,     2d0, &
       -666d0,       0d0,     -3d0,      369d0,     0d0,    -1d0, &
       -667d0,       0d0,      1d0,      346d0,     0d0,     1d0, &
       -704d0,       0d0,      0d0,      304d0,     0d0,     0d0, &
       -694d0,       0d0,      5d0,      294d0,     0d0,     2d0, &
      -1014d0,       0d0,     -1d0,        4d0,     0d0,    -1d0, &
       -585d0,       0d0,     -2d0,      316d0,     0d0,    -1d0 /
data ( ( cls(i,j), i=1,6 ), j=101,110 ) / &
       -949d0,       0d0,      1d0,        8d0,     0d0,    -1d0, &
       -595d0,       0d0,      0d0,      258d0,     0d0,     0d0, &
        528d0,       0d0,      0d0,     -279d0,     0d0,     0d0, &
       -590d0,       0d0,      4d0,      252d0,     0d0,     2d0, &
        570d0,       0d0,     -2d0,     -244d0,     0d0,    -1d0, &
       -502d0,       0d0,      3d0,      250d0,     0d0,     2d0, &
       -875d0,       0d0,      1d0,       29d0,     0d0,     0d0, &
       -492d0,       0d0,     -3d0,      275d0,     0d0,    -1d0, &
        535d0,       0d0,     -2d0,     -228d0,     0d0,    -1d0, &
       -467d0,       0d0,      1d0,      240d0,     0d0,     1d0 /
data ( ( cls(i,j), i=1,6 ), j=111,120 ) / &
        591d0,       0d0,      0d0,     -253d0,     0d0,     0d0, &
       -453d0,       0d0,     -1d0,      244d0,     0d0,    -1d0, &
        766d0,       0d0,      1d0,        9d0,     0d0,     0d0, &
       -446d0,       0d0,      2d0,      225d0,     0d0,     1d0, &
       -488d0,       0d0,      2d0,      207d0,     0d0,     1d0, &
       -468d0,       0d0,      0d0,      201d0,     0d0,     0d0, &
       -421d0,       0d0,      1d0,      216d0,     0d0,     1d0, &
        463d0,       0d0,      0d0,     -200d0,     0d0,     0d0, &
       -673d0,       0d0,      2d0,       14d0,     0d0,     0d0, &
        658d0,       0d0,      0d0,       -2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=121,130 ) / &
       -438d0,       0d0,      0d0,      188d0,     0d0,     0d0, &
       -390d0,       0d0,      0d0,      205d0,     0d0,     0d0, &
        639d0,     -11d0,     -2d0,      -19d0,     0d0,     0d0, &
        412d0,       0d0,     -2d0,     -176d0,     0d0,    -1d0, &
       -361d0,       0d0,      0d0,      189d0,     0d0,     0d0, &
        360d0,       0d0,     -1d0,     -185d0,     0d0,    -1d0, &
        588d0,       0d0,     -3d0,      -24d0,     0d0,     0d0, &
       -578d0,       0d0,      1d0,        5d0,     0d0,     0d0, &
       -396d0,       0d0,      0d0,      171d0,     0d0,     0d0, &
        565d0,       0d0,     -1d0,       -6d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=131,140 ) / &
       -335d0,       0d0,     -1d0,      184d0,     0d0,    -1d0, &
        357d0,       0d0,      1d0,     -154d0,     0d0,     0d0, &
        321d0,       0d0,      1d0,     -174d0,     0d0,     0d0, &
       -301d0,       0d0,     -1d0,      162d0,     0d0,     0d0, &
       -334d0,       0d0,      0d0,      144d0,     0d0,     0d0, &
        493d0,       0d0,     -2d0,      -15d0,     0d0,     0d0, &
        494d0,       0d0,     -2d0,      -19d0,     0d0,     0d0, &
        337d0,       0d0,     -1d0,     -143d0,     0d0,    -1d0, &
        280d0,       0d0,     -1d0,     -144d0,     0d0,     0d0, &
        309d0,       0d0,      1d0,     -134d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=141,150 ) / &
       -263d0,       0d0,      2d0,      131d0,     0d0,     1d0, &
        253d0,       0d0,      1d0,     -138d0,     0d0,     0d0, &
        245d0,       0d0,      0d0,     -128d0,     0d0,     0d0, &
        416d0,       0d0,     -2d0,      -17d0,     0d0,     0d0, &
       -229d0,       0d0,      0d0,      128d0,     0d0,     0d0, &
        231d0,       0d0,      0d0,     -120d0,     0d0,     0d0, &
       -259d0,       0d0,      2d0,      109d0,     0d0,     1d0, &
        375d0,       0d0,     -1d0,       -8d0,     0d0,     0d0, &
        252d0,       0d0,      0d0,     -108d0,     0d0,     0d0, &
       -245d0,       0d0,      1d0,      104d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=151,160 ) / &
        243d0,       0d0,     -1d0,     -104d0,     0d0,     0d0, &
        208d0,       0d0,      1d0,     -112d0,     0d0,     0d0, &
        199d0,       0d0,      0d0,     -102d0,     0d0,     0d0, &
       -208d0,       0d0,      1d0,      105d0,     0d0,     0d0, &
        335d0,       0d0,     -2d0,      -14d0,     0d0,     0d0, &
       -325d0,       0d0,      1d0,        7d0,     0d0,     0d0, &
       -187d0,       0d0,      0d0,       96d0,     0d0,     0d0, &
        197d0,       0d0,     -1d0,     -100d0,     0d0,     0d0, &
       -192d0,       0d0,      2d0,       94d0,     0d0,     1d0, &
       -188d0,       0d0,      0d0,       83d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=161,170 ) / &
        276d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
       -286d0,       0d0,      1d0,        6d0,     0d0,     0d0, &
        186d0,       0d0,     -1d0,      -79d0,     0d0,     0d0, &
       -219d0,       0d0,      0d0,       43d0,     0d0,     0d0, &
        276d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
       -153d0,       0d0,     -1d0,       84d0,     0d0,     0d0, &
       -156d0,       0d0,      0d0,       81d0,     0d0,     0d0, &
       -154d0,       0d0,      1d0,       78d0,     0d0,     0d0, &
       -174d0,       0d0,      1d0,       75d0,     0d0,     0d0, &
       -163d0,       0d0,      2d0,       69d0,     0d0,     1d0 /
data ( ( cls(i,j), i=1,6 ), j=171,180 ) / &
       -228d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
         91d0,       0d0,     -4d0,      -54d0,     0d0,    -2d0, &
        175d0,       0d0,      0d0,      -75d0,     0d0,     0d0, &
       -159d0,       0d0,      0d0,       69d0,     0d0,     0d0, &
        141d0,       0d0,      0d0,      -72d0,     0d0,     0d0, &
        147d0,       0d0,      0d0,      -75d0,     0d0,     0d0, &
       -132d0,       0d0,      0d0,       69d0,     0d0,     0d0, &
        159d0,       0d0,    -28d0,      -54d0,     0d0,    11d0, &
        213d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
        123d0,       0d0,      0d0,      -64d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=181,190 ) / &
       -118d0,       0d0,     -1d0,       66d0,     0d0,     0d0, &
        144d0,       0d0,     -1d0,      -61d0,     0d0,     0d0, &
       -121d0,       0d0,      1d0,       60d0,     0d0,     0d0, &
       -134d0,       0d0,      1d0,       56d0,     0d0,     1d0, &
       -105d0,       0d0,      0d0,       57d0,     0d0,     0d0, &
       -102d0,       0d0,      0d0,       56d0,     0d0,     0d0, &
        120d0,       0d0,      0d0,      -52d0,     0d0,     0d0, &
        101d0,       0d0,      0d0,      -54d0,     0d0,     0d0, &
       -113d0,       0d0,      0d0,       59d0,     0d0,     0d0, &
       -106d0,       0d0,      0d0,       61d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=191,200 ) / &
       -129d0,       0d0,      1d0,       55d0,     0d0,     0d0, &
       -114d0,       0d0,      0d0,       57d0,     0d0,     0d0, &
        113d0,       0d0,     -1d0,      -49d0,     0d0,     0d0, &
       -102d0,       0d0,      0d0,       44d0,     0d0,     0d0, &
        -94d0,       0d0,      0d0,       51d0,     0d0,     0d0, &
       -100d0,       0d0,     -1d0,       56d0,     0d0,     0d0, &
         87d0,       0d0,      0d0,      -47d0,     0d0,     0d0, &
        161d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         96d0,       0d0,      0d0,      -50d0,     0d0,     0d0, &
        151d0,       0d0,     -1d0,       -5d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=201,210 ) / &
       -104d0,       0d0,      0d0,       44d0,     0d0,     0d0, &
       -110d0,       0d0,      0d0,       48d0,     0d0,     0d0, &
       -100d0,       0d0,      1d0,       50d0,     0d0,     0d0, &
         92d0,       0d0,     -5d0,       12d0,     0d0,    -2d0, &
         82d0,       0d0,      0d0,      -45d0,     0d0,     0d0, &
         82d0,       0d0,      0d0,      -45d0,     0d0,     0d0, &
        -78d0,       0d0,      0d0,       41d0,     0d0,     0d0, &
        -77d0,       0d0,      0d0,       43d0,     0d0,     0d0, &
          2d0,       0d0,      0d0,       54d0,     0d0,     0d0, &
         94d0,       0d0,      0d0,      -40d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=211,220 ) / &
        -93d0,       0d0,      0d0,       40d0,     0d0,     0d0, &
        -83d0,       0d0,     10d0,       40d0,     0d0,    -2d0, &
         83d0,       0d0,      0d0,      -36d0,     0d0,     0d0, &
        -91d0,       0d0,      0d0,       39d0,     0d0,     0d0, &
        128d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
        -79d0,       0d0,      0d0,       34d0,     0d0,     0d0, &
        -83d0,       0d0,      0d0,       47d0,     0d0,     0d0, &
         84d0,       0d0,      0d0,      -44d0,     0d0,     0d0, &
         83d0,       0d0,      0d0,      -43d0,     0d0,     0d0, &
         91d0,       0d0,      0d0,      -39d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=221,230 ) / &
        -77d0,       0d0,      0d0,       39d0,     0d0,     0d0, &
         84d0,       0d0,      0d0,      -43d0,     0d0,     0d0, &
        -92d0,       0d0,      1d0,       39d0,     0d0,     0d0, &
        -92d0,       0d0,      1d0,       39d0,     0d0,     0d0, &
        -94d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         68d0,       0d0,      0d0,      -36d0,     0d0,     0d0, &
        -61d0,       0d0,      0d0,       32d0,     0d0,     0d0, &
         71d0,       0d0,      0d0,      -31d0,     0d0,     0d0, &
         62d0,       0d0,      0d0,      -34d0,     0d0,     0d0, &
        -63d0,       0d0,      0d0,       33d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=231,240 ) / &
        -73d0,       0d0,      0d0,       32d0,     0d0,     0d0, &
        115d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
       -103d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         63d0,       0d0,      0d0,      -28d0,     0d0,     0d0, &
         74d0,       0d0,      0d0,      -32d0,     0d0,     0d0, &
       -103d0,       0d0,     -3d0,        3d0,     0d0,    -1d0, &
        -69d0,       0d0,      0d0,       30d0,     0d0,     0d0, &
         57d0,       0d0,      0d0,      -29d0,     0d0,     0d0, &
         94d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
         64d0,       0d0,      0d0,      -33d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=241,250 ) / &
        -63d0,       0d0,      0d0,       26d0,     0d0,     0d0, &
        -38d0,       0d0,      0d0,       20d0,     0d0,     0d0, &
        -43d0,       0d0,      0d0,       24d0,     0d0,     0d0, &
        -45d0,       0d0,      0d0,       23d0,     0d0,     0d0, &
         47d0,       0d0,      0d0,      -24d0,     0d0,     0d0, &
        -48d0,       0d0,      0d0,       25d0,     0d0,     0d0, &
         45d0,       0d0,      0d0,      -26d0,     0d0,     0d0, &
         56d0,       0d0,      0d0,      -25d0,     0d0,     0d0, &
         88d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
        -75d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=251,260 ) / &
         85d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         49d0,       0d0,      0d0,      -26d0,     0d0,     0d0, &
        -74d0,       0d0,     -3d0,       -1d0,     0d0,    -1d0, &
        -39d0,       0d0,      0d0,       21d0,     0d0,     0d0, &
         45d0,       0d0,      0d0,      -20d0,     0d0,     0d0, &
         51d0,       0d0,      0d0,      -22d0,     0d0,     0d0, &
        -40d0,       0d0,      0d0,       21d0,     0d0,     0d0, &
         41d0,       0d0,      0d0,      -21d0,     0d0,     0d0, &
        -42d0,       0d0,      0d0,       24d0,     0d0,     0d0, &
        -51d0,       0d0,      0d0,       22d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=261,270 ) / &
        -42d0,       0d0,      0d0,       22d0,     0d0,     0d0, &
         39d0,       0d0,      0d0,      -21d0,     0d0,     0d0, &
         46d0,       0d0,      0d0,      -18d0,     0d0,     0d0, &
        -53d0,       0d0,      0d0,       22d0,     0d0,     0d0, &
         82d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
         81d0,       0d0,     -1d0,       -4d0,     0d0,     0d0, &
         47d0,       0d0,      0d0,      -19d0,     0d0,     0d0, &
         53d0,       0d0,      0d0,      -23d0,     0d0,     0d0, &
        -45d0,       0d0,      0d0,       22d0,     0d0,     0d0, &
        -44d0,       0d0,      0d0,       -2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=271,280 ) / &
        -33d0,       0d0,      0d0,       16d0,     0d0,     0d0, &
        -61d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
         28d0,       0d0,      0d0,      -15d0,     0d0,     0d0, &
        -38d0,       0d0,      0d0,       19d0,     0d0,     0d0, &
        -33d0,       0d0,      0d0,       21d0,     0d0,     0d0, &
        -60d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         48d0,       0d0,      0d0,      -10d0,     0d0,     0d0, &
         27d0,       0d0,      0d0,      -14d0,     0d0,     0d0, &
         38d0,       0d0,      0d0,      -20d0,     0d0,     0d0, &
         31d0,       0d0,      0d0,      -13d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=281,290 ) / &
        -29d0,       0d0,      0d0,       15d0,     0d0,     0d0, &
         28d0,       0d0,      0d0,      -15d0,     0d0,     0d0, &
        -32d0,       0d0,      0d0,       15d0,     0d0,     0d0, &
         45d0,       0d0,      0d0,       -8d0,     0d0,     0d0, &
        -44d0,       0d0,      0d0,       19d0,     0d0,     0d0, &
         28d0,       0d0,      0d0,      -15d0,     0d0,     0d0, &
        -51d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -36d0,       0d0,      0d0,       20d0,     0d0,     0d0, &
         44d0,       0d0,      0d0,      -19d0,     0d0,     0d0, &
         26d0,       0d0,      0d0,      -14d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=291,300 ) / &
        -60d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         35d0,       0d0,      0d0,      -18d0,     0d0,     0d0, &
        -27d0,       0d0,      0d0,       11d0,     0d0,     0d0, &
         47d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         36d0,       0d0,      0d0,      -15d0,     0d0,     0d0, &
        -36d0,       0d0,      0d0,       20d0,     0d0,     0d0, &
        -35d0,       0d0,      0d0,       19d0,     0d0,     0d0, &
        -37d0,       0d0,      0d0,       19d0,     0d0,     0d0, &
         32d0,       0d0,      0d0,      -16d0,     0d0,     0d0, &
         35d0,       0d0,      0d0,      -14d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=301,310 ) / &
         32d0,       0d0,      0d0,      -13d0,     0d0,     0d0, &
         65d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         47d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         32d0,       0d0,      0d0,      -16d0,     0d0,     0d0, &
         37d0,       0d0,      0d0,      -16d0,     0d0,     0d0, &
        -30d0,       0d0,      0d0,       15d0,     0d0,     0d0, &
        -32d0,       0d0,      0d0,       16d0,     0d0,     0d0, &
        -31d0,       0d0,      0d0,       13d0,     0d0,     0d0, &
         37d0,       0d0,      0d0,      -16d0,     0d0,     0d0, &
         31d0,       0d0,      0d0,      -13d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=311,320 ) / &
         49d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         32d0,       0d0,      0d0,      -13d0,     0d0,     0d0, &
         23d0,       0d0,      0d0,      -12d0,     0d0,     0d0, &
        -43d0,       0d0,      0d0,       18d0,     0d0,     0d0, &
         26d0,       0d0,      0d0,      -11d0,     0d0,     0d0, &
        -32d0,       0d0,      0d0,       14d0,     0d0,     0d0, &
        -29d0,       0d0,      0d0,       14d0,     0d0,     0d0, &
        -27d0,       0d0,      0d0,       12d0,     0d0,     0d0, &
         30d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -11d0,       0d0,      0d0,        5d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=321,330 ) / &
        -21d0,       0d0,      0d0,       10d0,     0d0,     0d0, &
        -34d0,       0d0,      0d0,       15d0,     0d0,     0d0, &
        -10d0,       0d0,      0d0,        6d0,     0d0,     0d0, &
        -36d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -9d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
        -12d0,       0d0,      0d0,        5d0,     0d0,     0d0, &
        -21d0,       0d0,      0d0,        5d0,     0d0,     0d0, &
        -29d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
        -15d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
        -20d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=331,340 ) / &
         28d0,       0d0,      0d0,        0d0,     0d0,    -2d0, &
         17d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -22d0,       0d0,      0d0,       12d0,     0d0,     0d0, &
        -14d0,       0d0,      0d0,        7d0,     0d0,     0d0, &
         24d0,       0d0,      0d0,      -11d0,     0d0,     0d0, &
         11d0,       0d0,      0d0,       -6d0,     0d0,     0d0, &
         14d0,       0d0,      0d0,       -6d0,     0d0,     0d0, &
         24d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         18d0,       0d0,      0d0,       -8d0,     0d0,     0d0, &
        -38d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=341,350 ) / &
        -31d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -16d0,       0d0,      0d0,        8d0,     0d0,     0d0, &
         29d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -18d0,       0d0,      0d0,       10d0,     0d0,     0d0, &
        -10d0,       0d0,      0d0,        5d0,     0d0,     0d0, &
        -17d0,       0d0,      0d0,       10d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
         16d0,       0d0,      0d0,       -6d0,     0d0,     0d0, &
         22d0,       0d0,      0d0,      -12d0,     0d0,     0d0, &
         20d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=351,360 ) / &
        -13d0,       0d0,      0d0,        6d0,     0d0,     0d0, &
        -17d0,       0d0,      0d0,        9d0,     0d0,     0d0, &
        -14d0,       0d0,      0d0,        8d0,     0d0,     0d0, &
          0d0,       0d0,      0d0,       -7d0,     0d0,     0d0, &
         14d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         19d0,       0d0,      0d0,      -10d0,     0d0,     0d0, &
        -34d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -20d0,       0d0,      0d0,        8d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,       -5d0,     0d0,     0d0, &
        -18d0,       0d0,      0d0,        7d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=361,370 ) / &
         13d0,       0d0,      0d0,       -6d0,     0d0,     0d0, &
         17d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -12d0,       0d0,      0d0,        5d0,     0d0,     0d0, &
         15d0,       0d0,      0d0,       -8d0,     0d0,     0d0, &
        -11d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
         13d0,       0d0,      0d0,       -5d0,     0d0,     0d0, &
        -18d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -35d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
        -19d0,       0d0,      0d0,       10d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=371,380 ) / &
        -26d0,       0d0,      0d0,       11d0,     0d0,     0d0, &
          8d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
        -10d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
         10d0,       0d0,      0d0,       -6d0,     0d0,     0d0, &
        -21d0,       0d0,      0d0,        9d0,     0d0,     0d0, &
        -15d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,       -5d0,     0d0,     0d0, &
        -29d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -19d0,       0d0,      0d0,       10d0,     0d0,     0d0, &
         12d0,       0d0,      0d0,       -5d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=381,390 ) / &
         22d0,       0d0,      0d0,       -9d0,     0d0,     0d0, &
        -10d0,       0d0,      0d0,        5d0,     0d0,     0d0, &
        -20d0,       0d0,      0d0,       11d0,     0d0,     0d0, &
        -20d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -17d0,       0d0,      0d0,        7d0,     0d0,     0d0, &
         15d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
          8d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
         14d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -12d0,       0d0,      0d0,        6d0,     0d0,     0d0, &
         25d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=391,400 ) / &
        -13d0,       0d0,      0d0,        6d0,     0d0,     0d0, &
        -14d0,       0d0,      0d0,        8d0,     0d0,     0d0, &
         13d0,       0d0,      0d0,       -5d0,     0d0,     0d0, &
        -17d0,       0d0,      0d0,        9d0,     0d0,     0d0, &
        -12d0,       0d0,      0d0,        6d0,     0d0,     0d0, &
        -10d0,       0d0,      0d0,        5d0,     0d0,     0d0, &
         10d0,       0d0,      0d0,       -6d0,     0d0,     0d0, &
        -15d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -22d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         28d0,       0d0,      0d0,       -1d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=401,410 ) / &
         15d0,       0d0,      0d0,       -7d0,     0d0,     0d0, &
         23d0,       0d0,      0d0,      -10d0,     0d0,     0d0, &
         12d0,       0d0,      0d0,       -5d0,     0d0,     0d0, &
         29d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
        -25d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
         22d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -18d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         15d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
        -23d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         12d0,       0d0,      0d0,       -5d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=411,420 ) / &
         -8d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
        -19d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -10d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
         21d0,       0d0,      0d0,       -9d0,     0d0,     0d0, &
         23d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
        -16d0,       0d0,      0d0,        8d0,     0d0,     0d0, &
        -19d0,       0d0,      0d0,        9d0,     0d0,     0d0, &
        -22d0,       0d0,      0d0,       10d0,     0d0,     0d0, &
         27d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         16d0,       0d0,      0d0,       -8d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=421,430 ) / &
         19d0,       0d0,      0d0,       -8d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
         -9d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
         -9d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
         -8d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
         18d0,       0d0,      0d0,       -9d0,     0d0,     0d0, &
         16d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
        -10d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
        -23d0,       0d0,      0d0,        9d0,     0d0,     0d0, &
         16d0,       0d0,      0d0,       -1d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=431,440 ) / &
        -12d0,       0d0,      0d0,        6d0,     0d0,     0d0, &
         -8d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
         30d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         24d0,       0d0,      0d0,      -10d0,     0d0,     0d0, &
         10d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
        -16d0,       0d0,      0d0,        7d0,     0d0,     0d0, &
        -16d0,       0d0,      0d0,        7d0,     0d0,     0d0, &
         17d0,       0d0,      0d0,       -7d0,     0d0,     0d0, &
        -24d0,       0d0,      0d0,       10d0,     0d0,     0d0, &
        -12d0,       0d0,      0d0,        5d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=441,450 ) / &
        -24d0,       0d0,      0d0,       11d0,     0d0,     0d0, &
        -23d0,       0d0,      0d0,        9d0,     0d0,     0d0, &
        -13d0,       0d0,      0d0,        5d0,     0d0,     0d0, &
        -15d0,       0d0,      0d0,        7d0,     0d0,     0d0, &
          0d0,       0d0,  -1988d0,        0d0,     0d0, -1679d0, &
          0d0,       0d0,    -63d0,        0d0,     0d0,   -27d0, &
         -4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          0d0,       0d0,      5d0,        0d0,     0d0,     4d0, &
          5d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
          0d0,       0d0,    364d0,        0d0,     0d0,   176d0 /
data ( ( cls(i,j), i=1,6 ), j=451,460 ) / &
          0d0,       0d0,  -1044d0,        0d0,     0d0,  -891d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          0d0,       0d0,    330d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=461,470 ) / &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          0d0,       0d0,      5d0,        0d0,     0d0,     0d0, &
          0d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
        -12d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=471,480 ) / &
         -5d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
          7d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
          0d0,       0d0,    -12d0,        0d0,     0d0,   -10d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=481,490 ) / &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
          0d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
          7d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=491,500 ) / &
         -8d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=501,510 ) / &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,       -3d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=511,520 ) / &
         -4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          8d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,       -3d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=521,530 ) / &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
        -13d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=531,540 ) / &
         10d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         10d0,       0d0,     13d0,        6d0,     0d0,    -5d0, &
          0d0,       0d0,     30d0,        0d0,     0d0,    14d0, &
          0d0,       0d0,   -162d0,        0d0,     0d0,  -138d0, &
          0d0,       0d0,     75d0,        0d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=541,550 ) / &
          5d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          9d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=551,560 ) / &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          7d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -6d0,       0d0,     -3d0,        3d0,     0d0,     1d0, &
          0d0,       0d0,     -3d0,        0d0,     0d0,    -2d0, &
         11d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         11d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=561,570 ) / &
         -1d0,       0d0,      3d0,        3d0,     0d0,    -1d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          0d0,       0d0,    -13d0,        0d0,     0d0,   -11d0, &
          3d0,       0d0,      6d0,        0d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        3d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=571,580 ) / &
          8d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         11d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          8d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         11d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -6d0,       0d0,      0d0,        3d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=581,590 ) / &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -8d0,       0d0,      0d0,        4d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
         -6d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=591,600 ) / &
         -5d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          0d0,       0d0,    -26d0,        0d0,     0d0,   -11d0, &
          0d0,       0d0,    -10d0,        0d0,     0d0,    -5d0, &
          5d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
        -13d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=601,610 ) / &
          3d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          7d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -6d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -7d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=611,620 ) / &
         13d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
        -11d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,       -3d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=621,630 ) / &
          3d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
        -12d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
          0d0,       0d0,     -5d0,        0d0,     0d0,    -2d0, &
         -7d0,       0d0,      0d0,        4d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=631,640 ) / &
          6d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         12d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=641,650 ) / &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         -6d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
          6d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=651,660 ) / &
         -6d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          7d0,       0d0,      0d0,       -4d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         -5d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         -6d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
         -6d0,       0d0,      0d0,        3d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         10d0,       0d0,      0d0,        0d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=661,670 ) / &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          7d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          7d0,       0d0,      0d0,       -3d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
         11d0,       0d0,      0d0,        0d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
         -6d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          5d0,       0d0,      0d0,       -2d0,     0d0,     0d0 /
data ( ( cls(i,j), i=1,6 ), j=671,678 ) / &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -4d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0, &
          4d0,       0d0,      0d0,       -2d0,     0d0,     0d0, &
          3d0,       0d0,      0d0,       -1d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        1d0,     0d0,     0d0, &
         -3d0,       0d0,      0d0,        2d0,     0d0,     0d0 /

!
!  Planetary argument multipliers
!    :         L   L'  F   D   Om  Me  Ve  E  Ma  Ju  Sa  Ur  Ne  pre

data ( ( napl(i,j), i=1,14 ), j=  1, 10 ) / &
         0,  0,  0,  0,  0,  0,  0,  8,-16,  4,  5,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -8, 16, -4, -5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  8,-16,  4,  5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,  2,  2, &
         0,  0,  0,  0,  0,  0,  0, -4,  8, -1, -5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4, -8,  3,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0,  3, -8,  3,  0,  0,  0,  0, &
        -1,  0,  0,  0,  0,  0, 10, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0, -2,  6, -3,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4, -8,  3,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j= 11, 20 ) / &
         0,  0,  1, -1,  1,  0,  0, -5,  8, -3,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -4,  8, -3,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  4, -8,  1,  5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -5,  6,  4,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -5,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  2, -5,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -5,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0, -2,  5,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0, -2,  5,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j= 21, 30 ) / &
         0,  0,  0,  0,  0,  0,  0,  0,  0, -2,  5,  0,  0,  2, &
         2,  0, -1, -1,  0,  0,  0,  3, -7,  0,  0,  0,  0,  0, &
         1,  0,  0, -2,  0,  0, 19,-21,  3,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  2, -4,  0, -3,  0,  0,  0,  0, &
         1,  0,  0, -1,  1,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0, -4, 10,  0,  0,  0, &
        -2,  0,  0,  2,  1,  0,  0,  2,  0,  0, -5,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  3, -7,  4,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  1,  0,  1, -1,  0,  0,  0, &
        -2,  0,  0,  2,  1,  0,  0,  2,  0, -2,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j= 31, 40 ) / &
        -1,  0,  0,  0,  0,  0, 18,-16,  0,  0,  0,  0,  0,  0, &
        -2,  0,  1,  1,  2,  0,  0,  1,  0, -2,  0,  0,  0,  0, &
        -1,  0,  1, -1,  1,  0, 18,-17,  0,  0,  0,  0,  0,  0, &
        -1,  0,  0,  1,  1,  0,  0,  2, -2,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -8, 13,  0,  0,  0,  0,  0,  2, &
         0,  0,  2, -2,  2,  0, -8, 11,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -8, 13,  0,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0, -8, 12,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  8,-13,  0,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  8,-14,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j= 41, 50 ) / &
         0,  0,  0,  0,  0,  0,  8,-13,  0,  0,  0,  0,  0,  1, &
        -2,  0,  0,  2,  1,  0,  0,  2,  0, -4,  5,  0,  0,  0, &
        -2,  0,  0,  2,  2,  0,  3, -3,  0,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  2,  0, -3,  1,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  3, -5,  0,  2,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  2,  0, -4,  3,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0, -1,  2,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  2,  0,  0, -2,  2,  0,  0,  0,  0,  0, &
        -1,  0,  1,  0,  1,  0,  3, -5,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j= 51, 60 ) / &
        -1,  0,  0,  1,  0,  0,  3, -4,  0,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  2,  0, -2, -2,  0,  0,  0, &
        -2,  0,  2,  0,  2,  0,  0, -5,  9,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  0, -1,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  0,  0,  2,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  1, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  2, &
        -1,  0,  0,  1,  0,  0,  0,  3, -4,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  1,  0,  0,  2,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j= 61, 70 ) / &
         0,  0,  1, -1,  2,  0,  0, -1,  0,  0,  2,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0, -9, 17,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  2,  0, -3,  5,  0,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0, -1,  2,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0, &
         1,  0,  0, -2,  0,  0, 17,-16,  0, -2,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  1, -3,  0,  0,  0, &
        -2,  0,  0,  2,  1,  0,  0,  5, -6,  0,  0,  0,  0,  0, &
         0,  0, -2,  2,  0,  0,  0,  9,-13,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  2,  0,  0, -1,  0,  0,  1,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j= 71, 80 ) / &
         0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  1,  0,  0,  1,  0,  0,  0, &
         0,  0, -2,  2,  0,  0,  5, -6,  0,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  1,  0,  5, -7,  0,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  6, -8,  0,  0,  0,  0,  0,  0, &
         2,  0,  1, -3,  1,  0, -6,  7,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  2,  0,  0,  0,  0,  1,  0,  0,  0,  0, &
         0,  0, -1,  1,  1,  0,  0,  1,  0,  1,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  0,  2,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j= 81, 90 ) / &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -8, 15,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -8, 15,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0, -9, 15,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  8,-15,  0,  0,  0,  0,  0, &
         1,  0, -1, -1,  0,  0,  0,  8,-15,  0,  0,  0,  0,  0, &
         2,  0,  0, -2,  0,  0,  2, -5,  0,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  2,  0, -5,  5,  0,  0,  0, &
         2,  0,  0, -2,  1,  0,  0, -6,  8,  0,  0,  0,  0,  0, &
         2,  0,  0, -2,  1,  0,  0, -2,  0,  3,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j= 91,100 ) / &
        -2,  0,  1,  1,  0,  0,  0,  1,  0, -3,  0,  0,  0,  0, &
        -2,  0,  1,  1,  1,  0,  0,  1,  0, -3,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  2,  0, -3,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  6, -8,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  2,  0, -1, -5,  0,  0,  0, &
        -1,  0,  0,  1,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
        -1,  0,  1,  1,  1,  0,-20, 20,  0,  0,  0,  0,  0,  0, &
         1,  0,  0, -2,  0,  0, 20,-21,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  8,-15,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0,-10, 15,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=101,110 ) / &
         0,  0, -1,  1,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0, &
         0,  0,  1, -1,  2,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0, -2,  4,  0,  0,  0, &
         2,  0,  0, -2,  1,  0, -6,  8,  0,  0,  0,  0,  0,  0, &
         0,  0, -2,  2,  1,  0,  5, -6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0, -1,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  0, -1,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  1,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=111,120 ) / &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  2, &
         0,  0,  2, -2,  1,  0,  0, -9, 13,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  7,-13,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  5, -6,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  9,-17,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -9, 17,  0,  0,  0,  0,  2, &
         1,  0,  0, -1,  1,  0,  0, -3,  4,  0,  0,  0,  0,  0, &
         1,  0,  0, -1,  1,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  2,  0,  0, -1,  2,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=121,130 ) / &
         0,  0, -1,  1,  1,  0,  0,  0,  2,  0,  0,  0,  0,  0, &
         0,  0, -2,  2,  0,  1,  0, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  3, -5,  0,  2,  0,  0,  0,  0, &
        -2,  0,  0,  2,  1,  0,  0,  2,  0, -3,  1,  0,  0,  0, &
        -2,  0,  0,  2,  1,  0,  3, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  8,-13,  0,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  8,-12,  0,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0, -8, 11,  0,  0,  0,  0,  0,  0, &
        -1,  0,  0,  1,  0,  0,  0,  2, -2,  0,  0,  0,  0,  0, &
        -1,  0,  0,  0,  1,  0, 18,-16,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=131,140 ) / &
         0,  0,  1, -1,  1,  0,  0, -1,  0, -1,  1,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  3, -7,  4,  0,  0,  0,  0,  0, &
        -2,  0,  1,  1,  1,  0,  0, -3,  7,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  2,  0,  0, -1,  0, -2,  5,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  0,  0, -2,  5,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
         1,  0,  0,  0,  1,  0,-10,  3,  0,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -2,  0,  0,  0,  0,  0,  0, &
        -1,  0,  0,  0,  1,  0, 10, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  4, -8,  3,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=141,150 ) / &
         0,  0,  0,  0,  1,  0,  0,  0,  0,  2, -5,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  1,  0,  2, -5,  0,  0,  0, &
         2,  0, -1, -1,  1,  0,  0,  3, -7,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  2,  0,  0, -5,  0,  0,  0, &
         0,  0,  0,  0,  1,  0, -3,  7, -4,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
         1,  0,  0,  0,  1,  0,-18, 16,  0,  0,  0,  0,  0,  0, &
        -2,  0,  1,  1,  1,  0,  0,  1,  0, -2,  0,  0,  0,  0, &
         0,  0,  1, -1,  2,  0, -8, 12,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0, -8, 13,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=151,160 ) / &
         0,  0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0,  0, -2,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -2,  2,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -1,  2,  0,  0,  0,  0,  1, &
        -1,  0,  0,  1,  1,  0,  3, -4,  0,  0,  0,  0,  0,  0, &
        -1,  0,  0,  1,  1,  0,  0,  3, -4,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  0, -2,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  2,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j=161,170 ) / &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  2, &
         0,  0,  1, -1,  0,  0,  3, -6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0, -3,  5,  0,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  2,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0, -2,  4,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0, -5,  6,  0,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  5, -7,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  5, -8,  0,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  1,  0,  6, -8,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0, -8, 15,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=171,180 ) / &
        -2,  0,  0,  2,  1,  0,  0,  2,  0, -3,  0,  0,  0,  0, &
        -2,  0,  0,  2,  1,  0,  0,  6, -8,  0,  0,  0,  0,  0, &
         1,  0,  0, -1,  1,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0, -1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0, -1,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j=181,190 ) / &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  2, &
         0,  0,  1, -1,  2,  0,  0, -1,  0,  0, -1,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  0,  0,  0, -1,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  1,  0,  0, -1,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -7, 13,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  7,-13,  0,  0,  0,  0,  0, &
         2,  0,  0, -2,  1,  0,  0, -5,  6,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -8, 11,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1, -1,  0,  2,  0,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=191,200 ) / &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -2,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  3,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  2, &
        -2,  0,  0,  2,  0,  0,  3, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  2,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
         0,  0,  0,  0,  2,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
         2,  0,  0, -2,  1,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
         0,  0,  1, -1,  2,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
         0,  0,  1, -1,  2,  0,  0,  0, -2,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=201,210 ) / &
         0,  0,  0,  0,  1,  0,  0,  1, -2,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  2, -2,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  1,  0,  0, -2,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -2,  0,  0,  2,  0,  0,  0, &
         0,  0,  1, -1,  1,  0,  3, -6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  1,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -3,  5,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -3,  5,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=211,220 ) / &
         0,  0,  2, -2,  2,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -3,  5,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0,  1, -4,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -2,  4,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0, -3,  4,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -2,  4,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0, -2,  4,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -5,  8,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=221,230 ) / &
         0,  0,  2, -2,  2,  0, -5,  6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -5,  8,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -5,  8,  0,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0, -5,  7,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -5,  8,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  5, -8,  0,  0,  0,  0,  0,  0, &
         0,  0,  1, -1,  2,  0,  0, -1,  0, -1,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  0,  0, -1,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -2,  0,  1,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=231,240 ) / &
         0,  0,  0,  0,  0,  0,  0, -6, 11,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  6,-11,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0, -1,  0,  4,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  1,  0, -4,  0,  0,  0,  0,  0,  0, &
         2,  0,  0, -2,  1,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  2,  0,  0, -2,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -7,  9,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  4, -5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j=241,250 ) / &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  2, &
         0,  0,  2, -2,  2,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  5,  0,  0,  2, &
         0,  0,  0,  0,  1,  0,  3, -5,  0,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  3, -4,  0,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  2, -4,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -4,  4,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=251,260 ) / &
         0,  0,  1, -1,  2,  0, -5,  7,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  3, -6,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -3,  6,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0, -4,  6,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -3,  6,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0, -3,  6,  0,  0,  0,  0,  2, &
         0,  0, -1,  1,  0,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  2, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -5,  9,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -5,  9,  0,  0,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j=261,270 ) / &
         0,  0,  0,  0,  0,  0,  0,  5, -9,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  0,  1,  0, -2,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
        -2,  0,  1,  1,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
         0,  0, -2,  2,  0,  0,  3, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -6, 10,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -6, 10,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -2,  3,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -2,  3,  0,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0, -2,  2,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=271,280 ) / &
         0,  0,  0,  0,  0,  0,  2, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  2, -3,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0, -1,  0,  3,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4, -8,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -4,  8,  0,  0,  0,  0,  2, &
         0,  0, -2,  2,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -4,  7,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=281,290 ) / &
         0,  0,  0,  0,  0,  0,  0, -4,  7,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  4, -7,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0, -2,  3,  0,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -5, 10,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  1,  0, -1,  2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  4,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -3,  5,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -3,  5,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=291,300 ) / &
         0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  1, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -1,  2,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -1,  2,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -7, 11,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -7, 11,  0,  0,  0,  0,  0,  1, &
         0,  0, -2,  2,  0,  0,  4, -4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  2, -3,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0, -4,  4,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=301,310 ) / &
         0,  0, -1,  1,  0,  0,  4, -5,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -4,  7,  0,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0, -4,  6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -4,  7,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -4,  6,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -4,  6,  0,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0, -4,  5,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -4,  6,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  4, -6,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=311,320 ) / &
        -2,  0,  0,  2,  0,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0, &
         0,  0, -1,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -1,  0,  5,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  1, -3,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -1,  3,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -7, 12,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -1,  1,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -1,  1,  0,  0,  0,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j=321,330 ) / &
         0,  0,  1, -1,  1,  0, -1,  0,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  1, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -2,  5,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -1,  0,  4,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  1,  0, -4,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0, -1,  1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -6, 10,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -6, 10,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=331,340 ) / &
         0,  0,  2, -2,  1,  0,  0, -3,  0,  3,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -3,  7,  0,  0,  0,  0,  2, &
        -2,  0,  0,  2,  0,  0,  4, -4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -5,  8,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  5, -8,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -1,  0,  3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -1,  0,  3,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  1,  0, -3,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -2,  4,  0,  0,  0,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j=341,350 ) / &
         0,  0,  1, -1,  1,  0, -2,  3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -2,  4,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -6,  9,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -6,  9,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  6, -9,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  1,  0, -2,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -4,  6,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4, -6,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  3, -4,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=351,360 ) / &
         0,  0,  0,  0,  0,  0,  0, -1,  0,  2,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  1,  0, -2,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -5,  9,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3, -4,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -3,  4,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -3,  4,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  3, -4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  3, -4,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  1,  0,  0,  2, -2,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=361,370 ) / &
         0,  0,  0,  0,  1,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  0, -3,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  1, -5,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -1,  0,  1,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1,  0, -1,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  1,  0, -3,  5,  0,  0,  0, &
         0,  0,  0,  0,  1,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  0, -2,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  2, -2,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=371,380 ) / &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  0, -1,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0, -2,  2,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -8, 14,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  2, -5,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  5, -8,  3,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  5, -8,  3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -1,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  3, -8,  3,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=381,390 ) / &
         0,  0,  0,  0,  0,  0,  0, -3,  8, -3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  1,  0, -2,  5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -8, 12,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -8, 12,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  1, -2,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  2,  0,  0,  2, &
         0,  0,  2, -2,  1,  0, -5,  5,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=391,400 ) / &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  3, -6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -3,  6,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -3,  6,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -1,  4,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -5,  7,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -5,  7,  0,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0, -5,  6,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=401,410 ) / &
         0,  0,  0,  0,  0,  0,  5, -7,  0,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0, -1,  0,  3,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  2,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -2,  6,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  1,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -6,  9,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  6, -9,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -2,  2,  0,  0,  0,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j=411,420 ) / &
         0,  0,  1, -1,  1,  0, -2,  1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  2, -2,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  1,  0,  3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -5,  7,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  5, -7,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  4, -5,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  1, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -1,  3,  0,  0,  0,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j=421,430 ) / &
         0,  0,  1, -1,  1,  0, -1,  2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -1,  3,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -7, 10,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -7, 10,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -4,  8,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -4,  5,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -4,  5,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  4, -5,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=431,440 ) / &
         0,  0,  0,  0,  0,  0,  0, -2,  0,  5,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -9, 13,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -1,  5,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -2,  0,  4,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0, -4,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -2,  7,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0, -3,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=441,450 ) / &
         0,  0,  0,  0,  0,  0, -2,  5,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -2,  5,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -6,  8,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -6,  8,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  6, -8,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  1,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0, -3,  9,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=451,460 ) / &
         0,  0,  0,  0,  0,  0,  0,  2,  0, -2,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  2,  0, -2,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -5, 10,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -3,  3,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0, -3,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=461,470 ) / &
         0,  0,  0,  0,  0,  0,  0, -5, 13,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0, -1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  2,  0, -1,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0, -2,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0, -2,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  3, -2,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  3, -2,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0, -1,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -6, 15,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -8, 15,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=471,480 ) / &
         0,  0,  0,  0,  0,  0, -3,  9, -4,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  2, -5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -2,  8, -1, -5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  6, -8,  3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  1, &
         0,  0,  1, -1,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=481,490 ) / &
         0,  0,  0,  0,  0,  0,  0, -6, 16, -4, -5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -2,  8, -3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -2,  8, -3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  6, -8,  1,  5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0, -2,  5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  3, -5,  4,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -8, 11,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -8, 11,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -8, 11,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=491,500 ) / &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  1,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  3, -3,  0,  2,  0,  0,  0,  2, &
         0,  0,  2, -2,  1,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
         0,  0,  1, -1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  1,  2,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  1,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -3,  7,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  0,  4,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -5,  6,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=501,510 ) / &
         0,  0,  0,  0,  0,  0, -5,  6,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  0,  2,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -1,  6,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  7, -9,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  2, -1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  2, -1,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  6, -7,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  5, -5,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=511,520 ) / &
         0,  0,  0,  0,  0,  0, -1,  4,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -1,  4,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -7,  9,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -7,  9,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  4, -3,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3, -1,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -4,  4,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=521,530 ) / &
         0,  0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -3,  0,  5,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -9, 12,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3,  0, -4,  0,  0,  0,  0, &
         0,  0,  2, -2,  1,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  7, -8,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3,  0, -3,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=531,540 ) / &
         0,  0,  0,  0,  0,  0,  0,  3,  0, -3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -2,  6,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -6,  7,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  6, -7,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  6, -6,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3,  0, -2,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  3,  0, -2,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  5, -4,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  3, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  3, -2,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=541,550 ) / &
         0,  0,  0,  0,  0,  0,  0,  3,  0, -1,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3,  0, -1,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3,  0,  0, -2,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4, -2,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3,  0,  0, -1,  0,  0,  2, &
         0,  0,  2, -2,  1,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0, -8, 16,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3,  0,  2, -5,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  7, -8,  3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -5, 16, -4, -5,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=551,560 ) / &
         0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0, -1,  8, -3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -8, 10,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -8, 10,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -8, 10,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  2,  2,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  3,  0,  1,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -3,  8,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -5,  5,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  5, -5,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=561,570 ) / &
         0,  0,  0,  0,  0,  0,  5, -5,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  5, -5,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  7, -7,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  7, -7,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  6, -5,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  7, -8,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  5, -3,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=571,580 ) / &
         0,  0,  0,  0,  0,  0,  4, -3,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  1,  2,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -9, 11,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -9, 11,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  4,  0, -4,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4,  0, -3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -6,  6,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  6, -6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  6, -6,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  4,  0, -2,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=581,590 ) / &
         0,  0,  0,  0,  0,  0,  0,  6, -4,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  3, -1,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  3, -1,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  3, -1,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4,  0, -1,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4,  0,  0, -2,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  5, -2,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  4,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  8, -9,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  5, -4,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=591,600 ) / &
         0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -7,  7,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  7, -7,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  4, -2,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  4, -2,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  4, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  4, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  5,  0, -4,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=601,610 ) / &
         0,  0,  0,  0,  0,  0,  0,  5,  0, -3,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  5,  0, -2,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -8,  8,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  8, -8,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  5, -3,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  5, -3,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0, -9,  9,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -9,  9,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0, -9,  9,  0,  0,  0,  0,  0,  1 /
data ( ( napl(i,j), i=1,14 ), j=611,620 ) / &
         0,  0,  0,  0,  0,  0,  9, -9,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  6, -4,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  2, &
         0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  1, &
         0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  2 /
data ( ( napl(i,j), i=1,14 ), j=621,630 ) / &
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2, &
         1,  0,  0, -2,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
         1,  0,  0, -2,  0,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
         1,  0,  0, -2,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
         1,  0,  0, -2,  0,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
        -1,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0,  0, &
        -1,  0,  0,  0,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
        -1,  0,  0,  2,  0,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
         1,  0,  0, -2,  0,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
        -2,  0,  0,  2,  0,  0,  0,  4, -8,  3,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=631,640 ) / &
        -1,  0,  0,  0,  0,  0,  0,  2,  0, -3,  0,  0,  0,  0, &
        -1,  0,  0,  0,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
        -1,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
        -1,  0,  0,  2,  0,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
         1,  0, -1,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
        -1,  0,  0,  2,  0,  0,  0,  2,  0, -3,  0,  0,  0,  0, &
        -2,  0,  0,  0,  0,  0,  0,  2,  0, -3,  0,  0,  0,  0, &
         1,  0,  0,  0,  0,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
        -1,  0,  1, -1,  1,  0,  0, -1,  0,  0,  0,  0,  0,  0, &
         1,  0,  1, -1,  1,  0,  0, -1,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=641,650 ) / &
        -1,  0,  0,  0,  0,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
        -1,  0,  0,  2,  1,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
         0,  0,  0,  0,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
        -1,  0,  0,  2,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
        -1,  0,  0,  2,  0,  0,  3, -3,  0,  0,  0,  0,  0,  0, &
         1,  0,  0, -2,  1,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
         1,  0,  2, -2,  2,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
         1,  0,  2, -2,  2,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
         1,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
         1,  0,  0,  0,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=651,660 ) / &
         0,  0,  0, -2,  0,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
         0,  0,  0, -2,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0, -1,  1,  0,  0,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0, -2,  3,  0,  0,  0,  0,  0,  0, &
         0,  0,  0,  2,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
         0,  0,  1,  1,  2,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
         1,  0,  2,  0,  2,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
        -1,  0,  2,  0,  2,  0, 10, -3,  0,  0,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=661,670 ) / &
         0,  0,  1,  1,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
         1,  0,  2,  0,  2,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
        -1,  0,  2,  0,  2,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
         2,  0,  2, -2,  2,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
         1,  0,  2,  0,  1,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
         0,  0,  1,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
        -1,  0,  2,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
        -2,  0,  2,  2,  2,  0,  0,  2,  0, -2,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=671,680 ) / &
         0,  0,  2,  0,  2,  0,  2, -3,  0,  0,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
        -1,  0,  2,  2,  2,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
         1,  0,  2,  0,  2,  0, -1,  1,  0,  0,  0,  0,  0,  0, &
        -1,  0,  2,  2,  2,  0,  0,  2,  0, -3,  0,  0,  0,  0, &
         2,  0,  2,  0,  2,  0,  0,  2,  0, -3,  0,  0,  0,  0, &
         1,  0,  2,  0,  2,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
         1,  0,  2,  0,  2,  0,  0,  4, -8,  3,  0,  0,  0,  0 /
data ( ( napl(i,j), i=1,14 ), j=681,687 ) / &
         1,  0,  1,  1,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
         0,  0,  2,  0,  2,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
         2,  0,  2,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
        -1,  0,  2,  2,  2,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
        -1,  0,  2,  2,  2,  0,  3, -3,  0,  0,  0,  0,  0,  0, &
         1,  0,  2,  0,  2,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
         0,  0,  2,  2,  2,  0,  0,  2,  0, -2,  0,  0,  0,  0 /

!
!  Planetary nutation coefficients, unit 1e-7 arcsec
!  longitude (sin, cos), obliquity (sin, cos)
!

data ( ( icpl(i,j), i=1,4 ), j=  1, 10 ) / &
       1440,          0,          0,          0, &
         56,       -117,        -42,        -40, &
        125,        -43,          0,        -54, &
          0,          5,          0,          0, &
          3,         -7,         -3,          0, &
          3,          0,          0,         -2, &
       -114,          0,          0,         61, &
       -219,         89,          0,          0, &
         -3,          0,          0,          0, &
       -462,       1604,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j= 11, 20 ) / &
         99,          0,          0,        -53, &
         -3,          0,          0,          2, &
          0,          6,          2,          0, &
          3,          0,          0,          0, &
        -12,          0,          0,          0, &
         14,       -218,        117,          8, &
         31,       -481,       -257,        -17, &
       -491,        128,          0,          0, &
      -3084,       5123,       2735,       1647, &
      -1444,       2409,      -1286,       -771 /
data ( ( icpl(i,j), i=1,4 ), j= 21, 30 ) / &
         11,        -24,        -11,         -9, &
         26,         -9,          0,          0, &
        103,        -60,          0,          0, &
          0,        -13,         -7,          0, &
        -26,        -29,        -16,         14, &
          9,        -27,        -14,         -5, &
         12,          0,          0,         -6, &
         -7,          0,          0,          0, &
          0,         24,          0,          0, &
        284,          0,          0,       -151 /
data ( ( icpl(i,j), i=1,4 ), j= 31, 40 ) / &
        226,        101,          0,          0, &
          0,         -8,         -2,          0, &
          0,         -6,         -3,          0, &
          5,          0,          0,         -3, &
        -41,        175,         76,         17, &
          0,         15,          6,          0, &
        425,        212,       -133,        269, &
       1200,        598,        319,       -641, &
        235,        334,          0,          0, &
         11,        -12,         -7,         -6 /
data ( ( icpl(i,j), i=1,4 ), j= 41, 50 ) / &
          5,         -6,          3,          3, &
         -5,          0,          0,          3, &
          6,          0,          0,         -3, &
         15,          0,          0,          0, &
         13,          0,          0,         -7, &
         -6,         -9,          0,          0, &
        266,        -78,          0,          0, &
       -460,       -435,       -232,        246, &
          0,         15,          7,          0, &
         -3,          0,          0,          2 /
data ( ( icpl(i,j), i=1,4 ), j= 51, 60 ) / &
          0,        131,          0,          0, &
          4,          0,          0,          0, &
          0,          3,          0,          0, &
          0,          4,          2,          0, &
          0,          3,          0,          0, &
        -17,        -19,        -10,          9, &
         -9,        -11,          6,         -5, &
         -6,          0,          0,          3, &
        -16,          8,          0,          0, &
          0,          3,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j= 61, 70 ) / &
         11,         24,         11,         -5, &
         -3,         -4,         -2,          1, &
          3,          0,          0,         -1, &
          0,         -8,         -4,          0, &
          0,          3,          0,          0, &
          0,          5,          0,          0, &
          0,          3,          2,          0, &
         -6,          4,          2,          3, &
         -3,         -5,          0,          0, &
         -5,          0,          0,          2 /
data ( ( icpl(i,j), i=1,4 ), j= 71, 80 ) / &
          4,         24,         13,         -2, &
        -42,         20,          0,          0, &
        -10,        233,          0,          0, &
         -3,          0,          0,          1, &
         78,        -18,          0,          0, &
          0,          3,          1,          0, &
          0,         -3,         -1,          0, &
          0,         -4,         -2,          1, &
          0,         -8,         -4,         -1, &
          0,         -5,          3,          0 /
data ( ( icpl(i,j), i=1,4 ), j= 81, 90 ) / &
         -7,          0,          0,          3, &
        -14,          8,          3,          6, &
          0,          8,         -4,          0, &
          0,         19,         10,          0, &
         45,        -22,          0,          0, &
         -3,          0,          0,          0, &
          0,         -3,          0,          0, &
          0,          3,          0,          0, &
          3,          5,          3,         -2, &
         89,        -16,         -9,        -48 /
data ( ( icpl(i,j), i=1,4 ), j= 91,100 ) / &
          0,          3,          0,          0, &
         -3,          7,          4,          2, &
       -349,        -62,          0,          0, &
        -15,         22,          0,          0, &
         -3,          0,          0,          0, &
        -53,          0,          0,          0, &
          5,          0,          0,         -3, &
          0,         -8,          0,          0, &
         15,         -7,         -4,         -8, &
         -3,          0,          0,          1 /
data ( ( icpl(i,j), i=1,4 ), j=101,110 ) / &
        -21,        -78,          0,          0, &
         20,        -70,        -37,        -11, &
          0,          6,          3,          0, &
          5,          3,          2,         -2, &
        -17,         -4,         -2,          9, &
          0,          6,          3,          0, &
         32,         15,         -8,         17, &
        174,         84,         45,        -93, &
         11,         56,          0,          0, &
        -66,        -12,         -6,         35 /
data ( ( icpl(i,j), i=1,4 ), j=111,120 ) / &
         47,          8,          4,        -25, &
          0,          8,          4,          0, &
         10,        -22,        -12,         -5, &
         -3,          0,          0,          2, &
        -24,         12,          0,          0, &
          5,         -6,          0,          0, &
          3,          0,          0,         -2, &
          4,          3,          1,         -2, &
          0,         29,         15,          0, &
         -5,         -4,         -2,          2 /
data ( ( icpl(i,j), i=1,4 ), j=121,130 ) / &
          8,         -3,         -1,         -5, &
          0,         -3,          0,          0, &
         10,          0,          0,          0, &
          3,          0,          0,         -2, &
         -5,          0,          0,          3, &
         46,         66,         35,        -25, &
        -14,          7,          0,          0, &
          0,          3,          2,          0, &
         -5,          0,          0,          0, &
        -68,        -34,        -18,         36 /
data ( ( icpl(i,j), i=1,4 ), j=131,140 ) / &
          0,         14,          7,          0, &
         10,         -6,         -3,         -5, &
         -5,         -4,         -2,          3, &
         -3,          5,          2,          1, &
         76,         17,          9,        -41, &
         84,        298,        159,        -45, &
          3,          0,          0,         -1, &
         -3,          0,          0,          2, &
         -3,          0,          0,          1, &
        -82,        292,        156,         44 /
data ( ( icpl(i,j), i=1,4 ), j=141,150 ) / &
        -73,         17,          9,         39, &
         -9,        -16,          0,          0, &
          3,          0,         -1,         -2, &
         -3,          0,          0,          0, &
         -9,         -5,         -3,          5, &
       -439,          0,          0,          0, &
         57,        -28,        -15,        -30, &
          0,         -6,         -3,          0, &
         -4,          0,          0,          2, &
        -40,         57,         30,         21 /
data ( ( icpl(i,j), i=1,4 ), j=151,160 ) / &
         23,          7,          3,        -13, &
        273,         80,         43,       -146, &
       -449,        430,          0,          0, &
         -8,        -47,        -25,          4, &
          6,         47,         25,         -3, &
          0,         23,         13,          0, &
         -3,          0,          0,          2, &
          3,         -4,         -2,         -2, &
        -48,       -110,        -59,         26, &
         51,        114,         61,        -27 /
data ( ( icpl(i,j), i=1,4 ), j=161,170 ) / &
       -133,          0,          0,         57, &
          0,          4,          0,          0, &
        -21,         -6,         -3,         11, &
          0,         -3,         -1,          0, &
        -11,        -21,        -11,          6, &
        -18,       -436,       -233,          9, &
         35,         -7,          0,          0, &
          0,          5,          3,          0, &
         11,         -3,         -1,         -6, &
         -5,         -3,         -1,          3 /
data ( ( icpl(i,j), i=1,4 ), j=171,180 ) / &
        -53,         -9,         -5,         28, &
          0,          3,          2,          1, &
          4,          0,          0,         -2, &
          0,         -4,          0,          0, &
        -50,        194,        103,         27, &
        -13,         52,         28,          7, &
        -91,        248,          0,          0, &
          6,         49,         26,         -3, &
         -6,        -47,        -25,          3, &
          0,          5,          3,          0 /
data ( ( icpl(i,j), i=1,4 ), j=181,190 ) / &
         52,         23,         10,        -23, &
         -3,          0,          0,          1, &
          0,          5,          3,          0, &
         -4,          0,          0,          0, &
         -4,          8,          3,          2, &
         10,          0,          0,          0, &
          3,          0,          0,         -2, &
          0,          8,          4,          0, &
          0,          8,          4,          1, &
         -4,          0,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=191,200 ) / &
         -4,          0,          0,          0, &
         -8,          4,          2,          4, &
          8,         -4,         -2,         -4, &
          0,         15,          7,          0, &
       -138,          0,          0,          0, &
          0,         -7,         -3,          0, &
          0,         -7,         -3,          0, &
         54,          0,          0,        -29, &
          0,         10,          4,          0, &
         -7,          0,          0,          3 /
data ( ( icpl(i,j), i=1,4 ), j=201,210 ) / &
        -37,         35,         19,         20, &
          0,          4,          0,          0, &
         -4,          9,          0,          0, &
          8,          0,          0,         -4, &
         -9,        -14,         -8,          5, &
         -3,         -9,         -5,          3, &
       -145,         47,          0,          0, &
        -10,         40,         21,          5, &
         11,        -49,        -26,         -7, &
      -2150,          0,          0,        932 /
data ( ( icpl(i,j), i=1,4 ), j=211,220 ) / &
        -12,          0,          0,          5, &
         85,          0,          0,        -37, &
          4,          0,          0,         -2, &
          3,          0,          0,         -2, &
        -86,        153,          0,          0, &
         -6,          9,          5,          3, &
          9,        -13,         -7,         -5, &
         -8,         12,          6,          4, &
        -51,          0,          0,         22, &
        -11,       -268,       -116,          5 /
data ( ( icpl(i,j), i=1,4 ), j=221,230 ) / &
          0,         12,          5,          0, &
          0,          7,          3,          0, &
         31,          6,          3,        -17, &
        140,         27,         14,        -75, &
         57,         11,          6,        -30, &
        -14,        -39,          0,          0, &
          0,         -6,         -2,          0, &
          4,         15,          8,         -2, &
          0,          4,          0,          0, &
         -3,          0,          0,          1 /
data ( ( icpl(i,j), i=1,4 ), j=231,240 ) / &
          0,         11,          5,          0, &
          9,          6,          0,          0, &
         -4,         10,          4,          2, &
          5,          3,          0,          0, &
         16,          0,          0,         -9, &
         -3,          0,          0,          0, &
          0,          3,          2,         -1, &
          7,          0,          0,         -3, &
        -25,         22,          0,          0, &
         42,        223,        119,        -22 /
data ( ( icpl(i,j), i=1,4 ), j=241,250 ) / &
        -27,       -143,        -77,         14, &
          9,         49,         26,         -5, &
      -1166,          0,          0,        505, &
         -5,          0,          0,          2, &
         -6,          0,          0,          3, &
         -8,          0,          1,          4, &
          0,         -4,          0,          0, &
        117,          0,          0,        -63, &
         -4,          8,          4,          2, &
          3,          0,          0,         -2 /
data ( ( icpl(i,j), i=1,4 ), j=251,260 ) / &
         -5,          0,          0,          2, &
          0,         31,          0,          0, &
         -5,          0,          1,          3, &
          4,          0,          0,         -2, &
         -4,          0,          0,          2, &
        -24,        -13,         -6,         10, &
          3,          0,          0,          0, &
          0,        -32,        -17,          0, &
          8,         12,          5,         -3, &
          3,          0,          0,         -1 /
data ( ( icpl(i,j), i=1,4 ), j=261,270 ) / &
          7,         13,          0,          0, &
         -3,         16,          0,          0, &
         50,          0,          0,        -27, &
          0,         -5,         -3,          0, &
         13,          0,          0,          0, &
          0,          5,          3,          1, &
         24,          5,          2,        -11, &
          5,        -11,         -5,         -2, &
         30,         -3,         -2,        -16, &
         18,          0,          0,         -9 /
data ( ( icpl(i,j), i=1,4 ), j=271,280 ) / &
          8,        614,          0,          0, &
          3,         -3,         -1,         -2, &
          6,         17,          9,         -3, &
         -3,         -9,         -5,          2, &
          0,          6,          3,         -1, &
       -127,         21,          9,         55, &
          3,          5,          0,          0, &
         -6,        -10,         -4,          3, &
          5,          0,          0,          0, &
         16,          9,          4,         -7 /
data ( ( icpl(i,j), i=1,4 ), j=281,290 ) / &
          3,          0,          0,         -2, &
          0,         22,          0,          0, &
          0,         19,         10,          0, &
          7,          0,          0,         -4, &
          0,         -5,         -2,          0, &
          0,          3,          1,          0, &
         -9,          3,          1,          4, &
         17,          0,          0,         -7, &
          0,         -3,         -2,         -1, &
        -20,         34,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=291,300 ) / &
        -10,          0,          1,          5, &
         -4,          0,          0,          2, &
         22,        -87,          0,          0, &
         -4,          0,          0,          2, &
         -3,         -6,         -2,          1, &
        -16,         -3,         -1,          7, &
          0,         -3,         -2,          0, &
          4,          0,          0,          0, &
        -68,         39,          0,          0, &
         27,          0,          0,        -14 /
data ( ( icpl(i,j), i=1,4 ), j=301,310 ) / &
          0,         -4,          0,          0, &
        -25,          0,          0,          0, &
        -12,         -3,         -2,          6, &
          3,          0,          0,         -1, &
          3,         66,         29,         -1, &
        490,          0,          0,       -213, &
        -22,         93,         49,         12, &
         -7,         28,         15,          4, &
         -3,         13,          7,          2, &
        -46,         14,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=311,320 ) / &
         -5,          0,          0,          0, &
          2,          1,          0,          0, &
          0,         -3,          0,          0, &
        -28,          0,          0,         15, &
          5,          0,          0,         -2, &
          0,          3,          0,          0, &
        -11,          0,          0,          5, &
          0,          3,          1,          0, &
         -3,          0,          0,          1, &
         25,        106,         57,        -13 /
data ( ( icpl(i,j), i=1,4 ), j=321,330 ) / &
          5,         21,         11,         -3, &
       1485,          0,          0,          0, &
         -7,        -32,        -17,          4, &
          0,          5,          3,          0, &
         -6,         -3,         -2,          3, &
         30,         -6,         -2,        -13, &
         -4,          4,          0,          0, &
        -19,          0,          0,         10, &
          0,          4,          2,         -1, &
          0,          3,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=331,340 ) / &
          4,          0,          0,         -2, &
          0,         -3,         -1,          0, &
         -3,          0,          0,          0, &
          5,          3,          1,         -2, &
          0,         11,          0,          0, &
        118,          0,          0,        -52, &
          0,         -5,         -3,          0, &
        -28,         36,          0,          0, &
          5,         -5,          0,          0, &
         14,        -59,        -31,         -8 /
data ( ( icpl(i,j), i=1,4 ), j=341,350 ) / &
          0,          9,          5,          1, &
       -458,          0,          0,        198, &
          0,        -45,        -20,          0, &
          9,          0,          0,         -5, &
          0,         -3,          0,          0, &
          0,         -4,         -2,         -1, &
         11,          0,          0,         -6, &
          6,          0,          0,         -2, &
        -16,         23,          0,          0, &
          0,         -4,         -2,          0 /
data ( ( icpl(i,j), i=1,4 ), j=351,360 ) / &
         -5,          0,          0,          2, &
       -166,        269,          0,          0, &
         15,          0,          0,         -8, &
         10,          0,          0,         -4, &
        -78,         45,          0,          0, &
          0,         -5,         -2,          0, &
          7,          0,          0,         -4, &
         -5,        328,          0,          0, &
          3,          0,          0,         -2, &
          5,          0,          0,         -2 /
data ( ( icpl(i,j), i=1,4 ), j=361,370 ) / &
          0,          3,          1,          0, &
         -3,          0,          0,          0, &
         -3,          0,          0,          0, &
          0,         -4,         -2,          0, &
      -1223,        -26,          0,          0, &
          0,          7,          3,          0, &
          3,          0,          0,          0, &
          0,          3,          2,          0, &
         -6,         20,          0,          0, &
       -368,          0,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=371,380 ) / &
        -75,          0,          0,          0, &
         11,          0,          0,         -6, &
          3,          0,          0,         -2, &
         -3,          0,          0,          1, &
        -13,        -30,          0,          0, &
         21,          3,          0,          0, &
         -3,          0,          0,          1, &
         -4,          0,          0,          2, &
          8,        -27,          0,          0, &
        -19,        -11,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=381,390 ) / &
         -4,          0,          0,          2, &
          0,          5,          2,          0, &
         -6,          0,          0,          2, &
         -8,          0,          0,          0, &
         -1,          0,          0,          0, &
        -14,          0,          0,          6, &
          6,          0,          0,          0, &
        -74,          0,          0,         32, &
          0,         -3,         -1,          0, &
          4,          0,          0,         -2 /
data ( ( icpl(i,j), i=1,4 ), j=391,400 ) / &
          8,         11,          0,          0, &
          0,          3,          2,          0, &
       -262,          0,          0,        114, &
          0,         -4,          0,          0, &
         -7,          0,          0,          4, &
          0,        -27,        -12,          0, &
        -19,         -8,         -4,          8, &
        202,          0,          0,        -87, &
         -8,         35,         19,          5, &
          0,          4,          2,          0 /
data ( ( icpl(i,j), i=1,4 ), j=401,410 ) / &
         16,         -5,          0,          0, &
          5,          0,          0,         -3, &
          0,         -3,          0,          0, &
          1,          0,          0,          0, &
        -35,        -48,        -21,         15, &
         -3,         -5,         -2,          1, &
          6,          0,          0,         -3, &
          3,          0,          0,         -1, &
          0,         -5,          0,          0, &
         12,         55,         29,         -6 /
data ( ( icpl(i,j), i=1,4 ), j=411,420 ) / &
          0,          5,          3,          0, &
       -598,          0,          0,          0, &
         -3,        -13,         -7,          1, &
         -5,         -7,         -3,          2, &
          3,          0,          0,         -1, &
          5,         -7,          0,          0, &
          4,          0,          0,         -2, &
         16,         -6,          0,          0, &
          8,         -3,          0,          0, &
          8,        -31,        -16,         -4 /
data ( ( icpl(i,j), i=1,4 ), j=421,430 ) / &
          0,          3,          1,          0, &
        113,          0,          0,        -49, &
          0,        -24,        -10,          0, &
          4,          0,          0,         -2, &
         27,          0,          0,          0, &
         -3,          0,          0,          1, &
          0,         -4,         -2,          0, &
          5,          0,          0,         -2, &
          0,         -3,          0,          0, &
        -13,          0,          0,          6 /
data ( ( icpl(i,j), i=1,4 ), j=431,440 ) / &
          5,          0,          0,         -2, &
        -18,        -10,         -4,          8, &
         -4,        -28,          0,          0, &
         -5,          6,          3,          2, &
         -3,          0,          0,          1, &
         -5,         -9,         -4,          2, &
         17,          0,          0,         -7, &
         11,          4,          0,          0, &
          0,         -6,         -2,          0, &
         83,         15,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=441,450 ) / &
         -4,          0,          0,          2, &
          0,       -114,        -49,          0, &
        117,          0,          0,        -51, &
         -5,         19,         10,          2, &
         -3,          0,          0,          0, &
         -3,          0,          0,          2, &
          0,         -3,         -1,          0, &
          3,          0,          0,          0, &
          0,         -6,         -2,          0, &
        393,          3,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=451,460 ) / &
         -4,         21,         11,          2, &
         -6,          0,         -1,          3, &
         -3,          8,          4,          1, &
          8,          0,          0,          0, &
         18,        -29,        -13,         -8, &
          8,         34,         18,         -4, &
         89,          0,          0,          0, &
          3,         12,          6,         -1, &
         54,        -15,         -7,        -24, &
          0,          3,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=461,470 ) / &
          3,          0,          0,         -1, &
          0,         35,          0,          0, &
       -154,        -30,        -13,         67, &
         15,          0,          0,          0, &
          0,          4,          2,          0, &
          0,          9,          0,          0, &
         80,        -71,        -31,        -35, &
          0,        -20,         -9,          0, &
         11,          5,          2,         -5, &
         61,        -96,        -42,        -27 /
data ( ( icpl(i,j), i=1,4 ), j=471,480 ) / &
         14,          9,          4,         -6, &
        -11,         -6,         -3,          5, &
          0,         -3,         -1,          0, &
        123,       -415,       -180,        -53, &
          0,          0,          0,        -35, &
         -5,          0,          0,          0, &
          7,        -32,        -17,         -4, &
          0,         -9,         -5,          0, &
          0,         -4,          2,          0, &
        -89,          0,          0,         38 /
data ( ( icpl(i,j), i=1,4 ), j=481,490 ) / &
          0,        -86,        -19,         -6, &
          0,          0,        -19,          6, &
       -123,       -416,       -180,         53, &
          0,         -3,         -1,          0, &
         12,         -6,         -3,         -5, &
        -13,          9,          4,          6, &
          0,        -15,         -7,          0, &
          3,          0,          0,         -1, &
        -62,        -97,        -42,         27, &
        -11,          5,          2,          5 /
data ( ( icpl(i,j), i=1,4 ), j=491,500 ) / &
          0,        -19,         -8,          0, &
         -3,          0,          0,          1, &
          0,          4,          2,          0, &
          0,          3,          0,          0, &
          0,          4,          2,          0, &
        -85,        -70,        -31,         37, &
        163,        -12,         -5,        -72, &
        -63,        -16,         -7,         28, &
        -21,        -32,        -14,          9, &
          0,         -3,         -1,          0 /
data ( ( icpl(i,j), i=1,4 ), j=501,510 ) / &
          3,          0,          0,         -2, &
          0,          8,          0,          0, &
          3,         10,          4,         -1, &
          3,          0,          0,         -1, &
          0,         -7,         -3,          0, &
          0,         -4,         -2,          0, &
          6,         19,          0,          0, &
          5,       -173,        -75,         -2, &
          0,         -7,         -3,          0, &
          7,        -12,         -5,         -3 /
data ( ( icpl(i,j), i=1,4 ), j=511,520 ) / &
         -3,          0,          0,          2, &
          3,         -4,         -2,         -1, &
         74,          0,          0,        -32, &
         -3,         12,          6,          2, &
         26,        -14,         -6,        -11, &
         19,          0,          0,         -8, &
          6,         24,         13,         -3, &
         83,          0,          0,          0, &
          0,        -10,         -5,          0, &
         11,         -3,         -1,         -5 /
data ( ( icpl(i,j), i=1,4 ), j=521,530 ) / &
          3,          0,          1,         -1, &
          3,          0,          0,         -1, &
         -4,          0,          0,          0, &
          5,        -23,        -12,         -3, &
       -339,          0,          0,        147, &
          0,        -10,         -5,          0, &
          5,          0,          0,          0, &
          3,          0,          0,         -1, &
          0,         -4,         -2,          0, &
         18,         -3,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=531,540 ) / &
          9,        -11,         -5,         -4, &
         -8,          0,          0,          4, &
          3,          0,          0,         -1, &
          0,          9,          0,          0, &
          6,         -9,         -4,         -2, &
         -4,        -12,          0,          0, &
         67,        -91,        -39,        -29, &
         30,        -18,         -8,        -13, &
          0,          0,          0,          0, &
          0,       -114,        -50,          0 /
data ( ( icpl(i,j), i=1,4 ), j=541,550 ) / &
          0,          0,          0,         23, &
        517,         16,          7,       -224, &
          0,         -7,         -3,          0, &
        143,         -3,         -1,        -62, &
         29,          0,          0,        -13, &
         -4,          0,          0,          2, &
         -6,          0,          0,          3, &
          5,         12,          5,         -2, &
        -25,          0,          0,         11, &
         -3,          0,          0,          1 /
data ( ( icpl(i,j), i=1,4 ), j=551,560 ) / &
          0,          4,          2,          0, &
        -22,         12,          5,         10, &
         50,          0,          0,        -22, &
          0,          7,          4,          0, &
          0,          3,          1,          0, &
         -4,          4,          2,          2, &
         -5,        -11,         -5,          2, &
          0,          4,          2,          0, &
          4,         17,          9,         -2, &
         59,          0,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=561,570 ) / &
          0,         -4,         -2,          0, &
         -8,          0,          0,          4, &
         -3,          0,          0,          0, &
          4,        -15,         -8,         -2, &
        370,         -8,          0,       -160, &
          0,          0,         -3,          0, &
          0,          3,          1,          0, &
         -6,          3,          1,          3, &
          0,          6,          0,          0, &
        -10,          0,          0,          4 /
data ( ( icpl(i,j), i=1,4 ), j=571,580 ) / &
          0,          9,          4,          0, &
          4,         17,          7,         -2, &
         34,          0,          0,        -15, &
          0,          5,          3,          0, &
         -5,          0,          0,          2, &
        -37,         -7,         -3,         16, &
          3,         13,          7,         -2, &
         40,          0,          0,          0, &
          0,         -3,         -2,          0, &
       -184,         -3,         -1,         80 /
data ( ( icpl(i,j), i=1,4 ), j=581,590 ) / &
         -3,          0,          0,          1, &
         -3,          0,          0,          0, &
          0,        -10,         -6,         -1, &
         31,         -6,          0,        -13, &
         -3,        -32,        -14,          1, &
         -7,          0,          0,          3, &
          0,         -8,         -4,          0, &
          3,         -4,          0,          0, &
          0,          4,          0,          0, &
          0,          3,          1,          0 /
data ( ( icpl(i,j), i=1,4 ), j=591,600 ) / &
         19,        -23,        -10,          2, &
          0,          0,          0,        -10, &
          0,          3,          2,          0, &
          0,          9,          5,         -1, &
         28,          0,          0,          0, &
          0,         -7,         -4,          0, &
          8,         -4,          0,         -4, &
          0,          0,         -2,          0, &
          0,          3,          0,          0, &
         -3,          0,          0,          1 /
data ( ( icpl(i,j), i=1,4 ), j=601,610 ) / &
         -9,          0,          1,          4, &
          3,         12,          5,         -1, &
         17,         -3,         -1,          0, &
          0,          7,          4,          0, &
         19,          0,          0,          0, &
          0,         -5,         -3,          0, &
         14,         -3,          0,         -1, &
          0,          0,         -1,          0, &
          0,          0,          0,         -5, &
          0,          5,          3,          0 /
data ( ( icpl(i,j), i=1,4 ), j=611,620 ) / &
         13,          0,          0,          0, &
          0,         -3,         -2,          0, &
          2,          9,          4,          3, &
          0,          0,          0,         -4, &
          8,          0,          0,          0, &
          0,          4,          2,          0, &
          6,          0,          0,         -3, &
          6,          0,          0,          0, &
          0,          3,          1,          0, &
          5,          0,          0,         -2 /
data ( ( icpl(i,j), i=1,4 ), j=621,630 ) / &
          3,          0,          0,         -1, &
         -3,          0,          0,          0, &
          6,          0,          0,          0, &
          7,          0,          0,          0, &
         -4,          0,          0,          0, &
          4,          0,          0,          0, &
          6,          0,          0,          0, &
          0,         -4,          0,          0, &
          0,         -4,          0,          0, &
          5,          0,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=631,640 ) / &
         -3,          0,          0,          0, &
          4,          0,          0,          0, &
         -5,          0,          0,          0, &
          4,          0,          0,          0, &
          0,          3,          0,          0, &
         13,          0,          0,          0, &
         21,         11,          0,          0, &
          0,         -5,          0,          0, &
          0,         -5,         -2,          0, &
          0,          5,          3,          0 /
data ( ( icpl(i,j), i=1,4 ), j=641,650 ) / &
          0,         -5,          0,          0, &
         -3,          0,          0,          2, &
         20,         10,          0,          0, &
        -34,          0,          0,          0, &
        -19,          0,          0,          0, &
          3,          0,          0,         -2, &
         -3,          0,          0,          1, &
         -6,          0,          0,          3, &
         -4,          0,          0,          0, &
          3,          0,          0,          0 /
data ( ( icpl(i,j), i=1,4 ), j=651,660 ) / &
          3,          0,          0,          0, &
          4,          0,          0,          0, &
          3,          0,          0,         -1, &
          6,          0,          0,         -3, &
         -8,          0,          0,          3, &
          0,          3,          1,          0, &
         -3,          0,          0,          0, &
          0,         -3,         -2,          0, &
        126,        -63,        -27,        -55, &
         -5,          0,          1,          2 /
data ( ( icpl(i,j), i=1,4 ), j=661,670 ) / &
         -3,         28,         15,          2, &
          5,          0,          1,         -2, &
          0,          9,          4,          1, &
          0,          9,          4,         -1, &
       -126,        -63,        -27,         55, &
          3,          0,          0,         -1, &
         21,        -11,         -6,        -11, &
          0,         -4,          0,          0, &
        -21,        -11,         -6,         11, &
         -3,          0,          0,          1 /
data ( ( icpl(i,j), i=1,4 ), j=671,680 ) / &
          0,          3,          1,          0, &
          8,          0,          0,         -4, &
         -6,          0,          0,          3, &
         -3,          0,          0,          1, &
          3,          0,          0,         -1, &
         -3,          0,          0,          1, &
         -5,          0,          0,          2, &
         24,        -12,         -5,        -11, &
          0,          3,          1,          0, &
          0,          3,          1,          0 /
data ( ( icpl(i,j), i=1,4 ), j=681,687 ) / &
          0,          3,          2,          0, &
        -24,        -12,         -5,         10, &
          4,          0,         -1,         -2, &
         13,          0,          0,         -6, &
          7,          0,          0,         -3, &
          3,          0,          0,         -1, &
          3,          0,          0,         -1 /

!  Interval between fundamental date J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  -------------------
!  LUNI-SOLAR NUTATION
!  -------------------

!
!  Fundamental (Delaunay) arguments
!

!  Mean anomaly of the Moon (IERS 2003).
el = FAL03 ( t )

!  Mean anomaly of the Sun (MHB2000).
elp = mod (       1287104.79305d0 + &
            t*( 129596581.0481d0 + &
            t*(       - 0.5532d0 + &
            t*(         0.000136d0 + &
            t*(       - 0.00001149d0 )))), turnas ) * das2r

!  Mean longitude of the Moon minus that of the ascending node
!  (IERS 2003.
f = FAF03 ( t )

!  Mean elongation of the Moon from the Sun (MHB2000).
d = mod (        1072260.70369d0 + &
          t*( 1602961601.2090d0 + &
          t*(        - 6.3706d0 + &
          t*(          0.006593d0 + &
          t*(        - 0.00003169d0 )))), turnas ) * das2r

!  Mean longitude of the ascending node of the Moon (IERS 2003).
om = FAOM03 ( t )

!  Initialize the nutation values.
dp = 0d0
de = 0d0

!  Summation of luni-solar nutation series (in reverse order).
do 100 i = nls, 1, -1

!     Argument and functions.
   arg = mod ( dble ( nals(1,i) ) * el  + &
               dble ( nals(2,i) ) * elp + &
               dble ( nals(3,i) ) * f   + &
               dble ( nals(4,i) ) * d   + &
               dble ( nals(5,i) ) * om, d2pi )
   sarg = sin(arg)
   carg = cos(arg)

!     Term.
   dp = dp + ( cls(1,i) + cls(2,i) * t ) * sarg &
           +   cls(3,i)                  * carg
   de = de + ( cls(4,i) + cls(5,i) * t ) * carg &
           +   cls(6,i)                  * sarg

100 continue

!  Convert from 0.1 microarcsec units to radians.
dpsils = dp * u2r
depsls = de * u2r

!  ------------------
!  PLANETARY NUTATION
!  ------------------

!  n.b.  The MHB2000 code computes the luni-solar and planetary nutation
!        in different routines, using slightly different Delaunay
!        arguments in the two cases.  This behaviour is faithfully
!        reproduced here.  Use of the IERS 2003 expressions for both
!        cases leads to negligible changes, well below
!        0.1 microarcsecond.

!  Mean anomaly of the Moon (MHB2000).
al = mod ( 2.35555598d0 + 8328.6914269554d0 * t, d2pi )

!  Mean anomaly of the Sun (MHB2000).
alsu = mod ( 6.24006013d0 + 628.301955d0 * t, d2pi )

!  Mean longitude of the Moon minus that of the ascending node
! (MHB2000).
af = mod ( 1.627905234d0 + 8433.466158131d0 * t, d2pi )

!  Mean elongation of the Moon from the Sun (MHB2000).
ad = mod ( 5.198466741d0 + 7771.3771468121d0 * t, d2pi )

!  Mean longitude of the ascending node of the Moon (MHB2000).
aom = mod ( 2.18243920d0 - 33.757045d0 * t, d2pi )

!  General accumulated precession in longitude (IERS 2003).
apa = FAPA03 ( t )

!  Planetary longitudes, Mercury through Uranus (IERS 2003).
alme = FAME03 ( t )
alve = FAVE03 ( t )
alea = FAE03 ( t )
alma = FAMA03 ( t )
alju = FAJU03 ( t )
alsa = FASA03 ( t )
alur = FAUR03 ( t )

!  Neptune longitude (MHB2000).
alne = mod ( 5.321159000d0 + 3.8127774000d0 * t, d2pi )

!  Initialize the nutation values.
dp = 0d0
de = 0d0

!  Summation of planetary nutation series (in reverse order).
do 200 i = npl, 1, -1

!     Argument and functions.
   arg = mod ( dble ( napl( 1,i) ) * al   + &
               dble ( napl( 2,i) ) * alsu + &
               dble ( napl( 3,i) ) * af   + &
               dble ( napl( 4,i) ) * ad   + &
               dble ( napl( 5,i) ) * aom  + &
               dble ( napl( 6,i) ) * alme + &
               dble ( napl( 7,i) ) * alve + &
               dble ( napl( 8,i) ) * alea + &
               dble ( napl( 9,i) ) * alma + &
               dble ( napl(10,i) ) * alju + &
               dble ( napl(11,i) ) * alsa + &
               dble ( napl(12,i) ) * alur + &
               dble ( napl(13,i) ) * alne + &
               dble ( napl(14,i) ) * apa, d2pi )
   sarg = sin(arg)
   carg = cos(arg)

!     Term.
   dp = dp + dble( icpl(1,i)) * sarg + dble( icpl(2,i)) * carg
   de = de + dble( icpl(3,i)) * sarg + dble( icpl(4,i)) * carg

200 continue

!  Convert from 0.1 microarcsec units to radians.
dpsipl = dp * u2r
depspl = de * u2r

!  -------
!  RESULTS
!  -------

!  Add luni-solar and planetary components.
dpsi = dpsils + dpsipl
deps = depsls + depspl

end subroutine NUT00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine NUT00B ( date1, date2, dpsi, deps )
!>
!  Nutation, IAU 2000B model.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2   d   TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     DPSI,DEPS     d   nutation, luni-solar + planetary (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.
!
!  2) The nutation components in longitude and obliquity are in radians
!     and with respect to the equinox and ecliptic of date.  The
!     obliquity at J2000.0 is assumed to be the Lieske et al. (1977)
!     value of 84381.448 arcsec.  (The errors that result from using
!     this routine with the IAU 2006 value of 84381.406 arcsec can be
!     neglected.)
!
!     The nutation model consists only of luni-solar terms, but includes
!     also a fixed offset which compensates for certain long-period
!     planetary terms (Note 7).
!
!  3) This routine is an implementation of the IAU 2000B abridged
!     nutation model formally adopted by the IAU General Assembly in
!     2000.  The routine computes the MHB_2000_SHORT luni-solar nutation
!     series (Luzum 2001), but without the associated corrections for
!     the precession rate adjustments and the offset between the GCRS
!     and J2000.0 mean poles.
!
!  4) The full IAU 2000A (MHB2000) nutation model contains nearly 1400
!     terms.  The IAU 2000B model (McCarthy & Luzum 2003) contains only
!     77 terms, plus additional simplifications, yet still delivers
!     results of 1 mas accuracy at present epochs.  This combination of
!     accuracy and size makes the IAU 2000B abridged nutation model
!     suitable for most practical applications.
!
!     The routine delivers a pole accurate to 1 mas from 1900 to 2100
!     (usually better than 1 mas, very occasionally just outside 1 mas).
!     The full IAU 2000A model, which is implemented in the routine
!     NUT00A (q.v.), delivers considerably greater accuracy at
!     current epochs;  however, to realize this improved accuracy,
!     corrections for the essentially unpredictable free-core-nutation
!     (FCN) must also be included.
!
!  5) The present routine provides classical nutation.  The
!     MHB_2000_SHORT algorithm, from which it is adapted, deals also
!     with (i) the offsets between the GCRS and mean poles and (ii) the
!     adjustments in longitude and obliquity due to the changed
!     precession rates.  These additional functions, namely frame bias
!     and precession adjustments, are supported by the SOFA routines
!     BI00 and PR00.
!
!  6) The MHB_2000_SHORT algorithm also provides "total" nutations,
!     comprising the arithmetic sum of the frame bias, precession
!     adjustments, and nutation (luni-solar + planetary).  These total
!     nutations can be used in combination with an existing IAU 1976
!     precession implementation, such as PMAT76, to deliver GCRS-to-
!     true predictions of mas accuracy at current epochs.  However, for
!     symmetry with the NUT00A routine (q.v. for the reasons), the
!     SOFA routines do not generate the "total nutations" directly.
!     Should they be required, they could of course easily be generated
!     by calling BI00, PR00 and the present routine and adding
!     the results.
!
!  7) The IAU 2000B model includes "planetary bias" terms that are fixed
!     in size but compensate for long-period nutations.  The amplitudes
!     quoted in McCarthy & Luzum (2003), namely Dpsi = -1.5835 mas and
!     Depsilon = +1.6339 mas, are optimized for the "total nutations"
!     method described in Note 6.  The Luzum (2001) values used in this
!     SOFA implementation, namely -0.135 mas and +0.388 mas, are
!     optimized for the "rigorous" method, where frame bias, precession
!     and nutation are applied separately and in that order.  During the
!     interval 1995-2050, the SOFA implementation delivers a maximum
!     error of 1.001 mas (not including FCN).
!
!  References:
!
!     Lieske, J.H., Lederle, T., Fricke, W., Morando, B., "Expressions
!     for the precession quantities based upon the IAU /1976/ system of
!     astronomical constants", Astron.Astrophys. 58, 1-2, 1-16. (1977)
!
!     Luzum, B., private communication, 2001 (Fortran code
!     MHB_2000_SHORT)
!
!     McCarthy, D.D. & Luzum, B.J., "An abridged model of the
!     precession-nutation of the celestial pole", Cel.Mech.Dyn.Astron.
!     85, 37-49 (2003)
!
!     Simon, J.-L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G., Laskar, J., Astron.Astrophys. 282, 663-683 (1994)
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsi, deps

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Milliarcseconds to radians
double precision dmas2r
parameter ( dmas2r = das2r / 1d3 )

!  Arcseconds in a full circle
double precision turnas
parameter ( turnas = 1296000d0 )

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Units of 0.1 microarcsecond to radians
double precision u2r
parameter ( u2r = das2r/1d7 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

!  Miscellaneous
double precision t, el, elp, f, d, om, arg, dp, de, sarg, carg, &
                 dpsils, depsls, dpsipl, depspl
integer i, j

!  -------------------------
!  Luni-Solar nutation model
!  -------------------------

!  Number of terms in the luni-solar nutation model
integer nls
parameter ( nls = 77 )

!  Coefficients for fundamental arguments
integer nals(5,nls)

!  Longitude and obliquity coefficients
double precision cls(6,nls)

!  ---------------------------------------
!  Fixed offset in lieu of planetary terms (radians)
!  ---------------------------------------

double precision dpplan, deplan
parameter ( dpplan = - 0.135d0 * dmas2r, &
            deplan = + 0.388d0 * dmas2r )

!  ----------------------------------------
!  Tables of argument and term coefficients
!  ----------------------------------------

!
!  Luni-Solar argument multipliers:
!
!               L     L'    F     D     Om

data ( ( nals(i,j), i=1,5 ), j= 1,10 ) / &
          0,    0,    0,    0,    1, &
          0,    0,    2,   -2,    2, &
          0,    0,    2,    0,    2, &
          0,    0,    0,    0,    2, &
          0,    1,    0,    0,    0, &
          0,    1,    2,   -2,    2, &
          1,    0,    0,    0,    0, &
          0,    0,    2,    0,    1, &
          1,    0,    2,    0,    2, &
          0,   -1,    2,   -2,    2 /
data ( ( nals(i,j), i=1,5 ), j=11,20 ) / &
          0,    0,    2,   -2,    1, &
         -1,    0,    2,    0,    2, &
         -1,    0,    0,    2,    0, &
          1,    0,    0,    0,    1, &
         -1,    0,    0,    0,    1, &
         -1,    0,    2,    2,    2, &
          1,    0,    2,    0,    1, &
         -2,    0,    2,    0,    1, &
          0,    0,    0,    2,    0, &
          0,    0,    2,    2,    2 /
data ( ( nals(i,j), i=1,5 ), j=21,30 ) / &
          0,   -2,    2,   -2,    2, &
         -2,    0,    0,    2,    0, &
          2,    0,    2,    0,    2, &
          1,    0,    2,   -2,    2, &
         -1,    0,    2,    0,    1, &
          2,    0,    0,    0,    0, &
          0,    0,    2,    0,    0, &
          0,    1,    0,    0,    1, &
         -1,    0,    0,    2,    1, &
          0,    2,    2,   -2,    2 /
data ( ( nals(i,j), i=1,5 ), j=31,40 ) / &
          0,    0,   -2,    2,    0, &
          1,    0,    0,   -2,    1, &
          0,   -1,    0,    0,    1, &
         -1,    0,    2,    2,    1, &
          0,    2,    0,    0,    0, &
          1,    0,    2,    2,    2, &
         -2,    0,    2,    0,    0, &
          0,    1,    2,    0,    2, &
          0,    0,    2,    2,    1, &
          0,   -1,    2,    0,    2 /
data ( ( nals(i,j), i=1,5 ), j=41,50 ) / &
          0,    0,    0,    2,    1, &
          1,    0,    2,   -2,    1, &
          2,    0,    2,   -2,    2, &
         -2,    0,    0,    2,    1, &
          2,    0,    2,    0,    1, &
          0,   -1,    2,   -2,    1, &
          0,    0,    0,   -2,    1, &
         -1,   -1,    0,    2,    0, &
          2,    0,    0,   -2,    1, &
          1,    0,    0,    2,    0 /
data ( ( nals(i,j), i=1,5 ), j=51,60 ) / &
          0,    1,    2,   -2,    1, &
          1,   -1,    0,    0,    0, &
         -2,    0,    2,    0,    2, &
          3,    0,    2,    0,    2, &
          0,   -1,    0,    2,    0, &
          1,   -1,    2,    0,    2, &
          0,    0,    0,    1,    0, &
         -1,   -1,    2,    2,    2, &
         -1,    0,    2,    0,    0, &
          0,   -1,    2,    2,    2 /
data ( ( nals(i,j), i=1,5 ), j=61,70 ) / &
         -2,    0,    0,    0,    1, &
          1,    1,    2,    0,    2, &
          2,    0,    0,    0,    1, &
         -1,    1,    0,    1,    0, &
          1,    1,    0,    0,    0, &
          1,    0,    2,    0,    0, &
         -1,    0,    2,   -2,    1, &
          1,    0,    0,    0,    2, &
         -1,    0,    0,    1,    0, &
          0,    0,    2,    1,    2 /
data ( ( nals(i,j), i=1,5 ), j=71,77 ) / &
         -1,    0,    2,    4,    2, &
         -1,    1,    0,    1,    1, &
          0,   -2,    2,   -2,    1, &
          1,    0,    2,    2,    1, &
         -2,    0,    2,    2,    2, &
         -1,    0,    0,    0,    2, &
          1,    1,    2,   -2,    2 /

!
!  Luni-Solar nutation coefficients, unit 1e-7 arcsec:
!  longitude (sin, t*sin, cos), obliquity (cos, t*cos, sin)
!

data ( ( cls(i,j), i=1,6 ), j= 1,10 ) / &
 -172064161d0, -174666d0,  33386d0, 92052331d0,  9086d0, 15377d0, &
  -13170906d0,   -1675d0, -13696d0,  5730336d0, -3015d0, -4587d0, &
   -2276413d0,    -234d0,   2796d0,   978459d0,  -485d0,  1374d0, &
    2074554d0,     207d0,   -698d0,  -897492d0,   470d0,  -291d0, &
    1475877d0,   -3633d0,  11817d0,    73871d0,  -184d0, -1924d0, &
    -516821d0,    1226d0,   -524d0,   224386d0,  -677d0,  -174d0, &
     711159d0,      73d0,   -872d0,    -6750d0,     0d0,   358d0, &
    -387298d0,    -367d0,    380d0,   200728d0,    18d0,   318d0, &
    -301461d0,     -36d0,    816d0,   129025d0,   -63d0,   367d0, &
     215829d0,    -494d0,    111d0,   -95929d0,   299d0,   132d0 /
data ( ( cls(i,j), i=1,6 ), j=11,20 ) / &
     128227d0,     137d0,    181d0,   -68982d0,    -9d0,    39d0, &
     123457d0,      11d0,     19d0,   -53311d0,    32d0,    -4d0, &
     156994d0,      10d0,   -168d0,    -1235d0,     0d0,    82d0, &
      63110d0,      63d0,     27d0,   -33228d0,     0d0,    -9d0, &
     -57976d0,     -63d0,   -189d0,    31429d0,     0d0,   -75d0, &
     -59641d0,     -11d0,    149d0,    25543d0,   -11d0,    66d0, &
     -51613d0,     -42d0,    129d0,    26366d0,     0d0,    78d0, &
      45893d0,      50d0,     31d0,   -24236d0,   -10d0,    20d0, &
      63384d0,      11d0,   -150d0,    -1220d0,     0d0,    29d0, &
     -38571d0,      -1d0,    158d0,    16452d0,   -11d0,    68d0 /
data ( ( cls(i,j), i=1,6 ), j=21,30 ) / &
      32481d0,       0d0,      0d0,   -13870d0,     0d0,     0d0, &
     -47722d0,       0d0,    -18d0,      477d0,     0d0,   -25d0, &
     -31046d0,      -1d0,    131d0,    13238d0,   -11d0,    59d0, &
      28593d0,       0d0,     -1d0,   -12338d0,    10d0,    -3d0, &
      20441d0,      21d0,     10d0,   -10758d0,     0d0,    -3d0, &
      29243d0,       0d0,    -74d0,     -609d0,     0d0,    13d0, &
      25887d0,       0d0,    -66d0,     -550d0,     0d0,    11d0, &
     -14053d0,     -25d0,     79d0,     8551d0,    -2d0,   -45d0, &
      15164d0,      10d0,     11d0,    -8001d0,     0d0,    -1d0, &
     -15794d0,      72d0,    -16d0,     6850d0,   -42d0,    -5d0 /
data ( ( cls(i,j), i=1,6 ), j=31,40 ) / &
      21783d0,       0d0,     13d0,     -167d0,     0d0,    13d0, &
     -12873d0,     -10d0,    -37d0,     6953d0,     0d0,   -14d0, &
     -12654d0,      11d0,     63d0,     6415d0,     0d0,    26d0, &
     -10204d0,       0d0,     25d0,     5222d0,     0d0,    15d0, &
      16707d0,     -85d0,    -10d0,      168d0,    -1d0,    10d0, &
      -7691d0,       0d0,     44d0,     3268d0,     0d0,    19d0, &
     -11024d0,       0d0,    -14d0,      104d0,     0d0,     2d0, &
       7566d0,     -21d0,    -11d0,    -3250d0,     0d0,    -5d0, &
      -6637d0,     -11d0,     25d0,     3353d0,     0d0,    14d0, &
      -7141d0,      21d0,      8d0,     3070d0,     0d0,     4d0 /
data ( ( cls(i,j), i=1,6 ), j=41,50 ) / &
      -6302d0,     -11d0,      2d0,     3272d0,     0d0,     4d0, &
       5800d0,      10d0,      2d0,    -3045d0,     0d0,    -1d0, &
       6443d0,       0d0,     -7d0,    -2768d0,     0d0,    -4d0, &
      -5774d0,     -11d0,    -15d0,     3041d0,     0d0,    -5d0, &
      -5350d0,       0d0,     21d0,     2695d0,     0d0,    12d0, &
      -4752d0,     -11d0,     -3d0,     2719d0,     0d0,    -3d0, &
      -4940d0,     -11d0,    -21d0,     2720d0,     0d0,    -9d0, &
       7350d0,       0d0,     -8d0,      -51d0,     0d0,     4d0, &
       4065d0,       0d0,      6d0,    -2206d0,     0d0,     1d0, &
       6579d0,       0d0,    -24d0,     -199d0,     0d0,     2d0 /
data ( ( cls(i,j), i=1,6 ), j=51,60 ) / &
       3579d0,       0d0,      5d0,    -1900d0,     0d0,     1d0, &
       4725d0,       0d0,     -6d0,      -41d0,     0d0,     3d0, &
      -3075d0,       0d0,     -2d0,     1313d0,     0d0,    -1d0, &
      -2904d0,       0d0,     15d0,     1233d0,     0d0,     7d0, &
       4348d0,       0d0,    -10d0,      -81d0,     0d0,     2d0, &
      -2878d0,       0d0,      8d0,     1232d0,     0d0,     4d0, &
      -4230d0,       0d0,      5d0,      -20d0,     0d0,    -2d0, &
      -2819d0,       0d0,      7d0,     1207d0,     0d0,     3d0, &
      -4056d0,       0d0,      5d0,       40d0,     0d0,    -2d0, &
      -2647d0,       0d0,     11d0,     1129d0,     0d0,     5d0 /
data ( ( cls(i,j), i=1,6 ), j=61,70 ) / &
      -2294d0,       0d0,    -10d0,     1266d0,     0d0,    -4d0, &
       2481d0,       0d0,     -7d0,    -1062d0,     0d0,    -3d0, &
       2179d0,       0d0,     -2d0,    -1129d0,     0d0,    -2d0, &
       3276d0,       0d0,      1d0,       -9d0,     0d0,     0d0, &
      -3389d0,       0d0,      5d0,       35d0,     0d0,    -2d0, &
       3339d0,       0d0,    -13d0,     -107d0,     0d0,     1d0, &
      -1987d0,       0d0,     -6d0,     1073d0,     0d0,    -2d0, &
      -1981d0,       0d0,      0d0,      854d0,     0d0,     0d0, &
       4026d0,       0d0,   -353d0,     -553d0,     0d0,  -139d0, &
       1660d0,       0d0,     -5d0,     -710d0,     0d0,    -2d0 /
data ( ( cls(i,j), i=1,6 ), j=71,77 ) / &
      -1521d0,       0d0,      9d0,      647d0,     0d0,     4d0, &
       1314d0,       0d0,      0d0,     -700d0,     0d0,     0d0, &
      -1283d0,       0d0,      0d0,      672d0,     0d0,     0d0, &
      -1331d0,       0d0,      8d0,      663d0,     0d0,     4d0, &
       1383d0,       0d0,     -2d0,     -594d0,     0d0,    -2d0, &
       1405d0,       0d0,      4d0,     -610d0,     0d0,     2d0, &
       1290d0,       0d0,      0d0,     -556d0,     0d0,     0d0 /

!  Interval between fundamental epoch J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  -------------------
!  LUNI-SOLAR NUTATION
!  -------------------

!
!  Fundamental (Delaunay) arguments from Simon et al. (1994)
!

!  Mean anomaly of the Moon.
el  = mod (         485868.249036d0 + &
            ( + 1717915923.2178d0 ) * t, turnas ) * das2r

!  Mean anomaly of the Sun.
elp = mod (        1287104.79305d0 + &
            (  + 129596581.0481d0 ) * t, turnas ) * das2r

!  Mean argument of the latitude of the Moon.
f   = mod (         335779.526232d0 + &
            ( + 1739527262.8478d0 ) * t, turnas ) * das2r

!  Mean elongation of the Moon from the Sun.
d   = mod (        1072260.70369d0 + &
            ( + 1602961601.2090d0 ) * t, turnas ) * das2r

!  Mean longitude of the ascending node of the Moon.
om  = mod (         450160.398036d0 + &
            (    - 6962890.5431d0 ) * t, turnas ) * das2r

!  Initialize the nutation values.
dp = 0d0
de = 0d0

!  Summation of luni-solar nutation series (in reverse order).
do 100 i = nls, 1, -1

!     Argument and functions.
   arg = mod ( dble ( nals(1,i) ) * el  + &
               dble ( nals(2,i) ) * elp + &
               dble ( nals(3,i) ) * f   + &
               dble ( nals(4,i) ) * d   + &
               dble ( nals(5,i) ) * om, d2pi )
   sarg = sin(arg)
   carg = cos(arg)

!     Term.
   dp = dp + ( cls(1,i) + cls(2,i) * t ) * sarg &
           +   cls(3,i)                  * carg
   de = de + ( cls(4,i) + cls(5,i) * t ) * carg &
           +   cls(6,i)                  * sarg

100 continue

!  Convert from 0.1 microarcsec units to radians.
dpsils = dp * u2r
depsls = de * u2r

!  -----------------------------
!  IN LIEU OF PLANETARY NUTATION
!  -----------------------------

!  Fixed offset to correct for missing terms in truncated series.
dpsipl = dpplan
depspl = deplan

!  -------
!  RESULTS
!  -------

!  Add luni-solar and planetary components.
dpsi = dpsils + dpsipl
deps = depsls + depspl

end subroutine NUT00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine NUT06A ( date1, date2, dpsi, deps )
!>
!  IAU 2000A nutation with adjustments to match the IAU 2006 precession.
!
!  Given:
!     DATE1,DATE2   d    TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     DPSI,DEPS     d    nutation, luni-solar + planetary (Note 2)
!
!  Status:  canonical model.
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The nutation components in longitude and obliquity are in radians
!     and with respect to the mean equinox and ecliptic of date,
!     IAU 2006 precession model (Hilton et al. 2006, Capitaine et al.
!     2005).
!
!  3) The routine first computes the IAU 2000A nutation, then applies
!     adjustments for (i) the consequences of the change in obliquity
!     from the IAU 1980 ecliptic to the IAU 2006 ecliptic and (ii) the
!     secular variation in the Earth's dynamical form factor J2.
!
!  4) The present routine provides classical nutation, complementing
!     the IAU 2000 frame bias and IAU 2006 precession.  It delivers a
!     pole which is at current epochs accurate to a few tens of
!     microarcseconds, apart from the free core nutation.
!
!  Called:
!     NUT00A   nutation, IAU 2000A
!
!  Reference:
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2011 April 3
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsi, deps

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

!  Miscellaneous
double precision t, fj2, dp, de

!  Interval between fundamental date J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Factor correcting for secular variation of J2.
fj2 = -2.7774d-6 * t

!  Obtain IAU 2000A nutation.
call NUT00A ( date1, date2, dp, de )

!  Apply P03 adjustments (Wallace & Capitaine, 2006, Eqs.5).
dpsi = dp + dp * ( 0.4697d-6 + fj2 )
deps = de + de * fj2

end subroutine NUT06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine NUT80 ( date1, date2, dpsi, deps )
!>
!  Nutation, IAU 1980 model.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2     d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     DPSI            d      nutation in longitude (radians)
!     DEPS            d      nutation in obliquity (radians)
!
!  Notes:
!
!  1) The DATE DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The nutation components are with respect to the ecliptic of
!     date.
!
!  Called:
!     ANPM     normalize angle into range +/- pi
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Section 3.222 (p111).
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsi, deps

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Units of 0.1 milliarcsecond to radians
double precision u2r
parameter ( u2r = das2r/1d4 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t, el, elp, f, d, om, dp, de, arg, s, c
integer i, j

!     DOUBLE PRECISION ANPM

!  ------------------------------------------------
!  Table of multiples of arguments and coefficients
!  ------------------------------------------------
!
!  The coefficient values are in 0.1 mas units and the rates of change
!  are in mas per Julian millennium.

real x(9,106)

!                Multiple of            Longitude        Obliquity
!           L    L'   F    D  Omega   coeff. of sin    coeff. of cos
!                                         1       t        1     t

data ((x(i,j),i=1,9),j=1,10) / &
      0.,  0.,  0.,  0.,  1., -171996., -1742.,  92025.,  89., &
      0.,  0.,  0.,  0.,  2.,    2062.,     2.,   -895.,   5., &
     -2.,  0.,  2.,  0.,  1.,      46.,     0.,    -24.,   0., &
      2.,  0., -2.,  0.,  0.,      11.,     0.,      0.,   0., &
     -2.,  0.,  2.,  0.,  2.,      -3.,     0.,      1.,   0., &
      1., -1.,  0., -1.,  0.,      -3.,     0.,      0.,   0., &
      0., -2.,  2., -2.,  1.,      -2.,     0.,      1.,   0., &
      2.,  0., -2.,  0.,  1.,       1.,     0.,      0.,   0., &
      0.,  0.,  2., -2.,  2.,  -13187.,   -16.,   5736., -31., &
      0.,  1.,  0.,  0.,  0.,    1426.,   -34.,     54.,  -1. /
data ((x(i,j),i=1,9),j=11,20) / &
      0.,  1.,  2., -2.,  2.,    -517.,    12.,    224.,  -6., &
      0., -1.,  2., -2.,  2.,     217.,    -5.,    -95.,   3., &
      0.,  0.,  2., -2.,  1.,     129.,     1.,    -70.,   0., &
      2.,  0.,  0., -2.,  0.,      48.,     0.,      1.,   0., &
      0.,  0.,  2., -2.,  0.,     -22.,     0.,      0.,   0., &
      0.,  2.,  0.,  0.,  0.,      17.,    -1.,      0.,   0., &
      0.,  1.,  0.,  0.,  1.,     -15.,     0.,      9.,   0., &
      0.,  2.,  2., -2.,  2.,     -16.,     1.,      7.,   0., &
      0., -1.,  0.,  0.,  1.,     -12.,     0.,      6.,   0., &
     -2.,  0.,  0.,  2.,  1.,      -6.,     0.,      3.,   0. /
data ((x(i,j),i=1,9),j=21,30) / &
      0., -1.,  2., -2.,  1.,      -5.,     0.,      3.,   0., &
      2.,  0.,  0., -2.,  1.,       4.,     0.,     -2.,   0., &
      0.,  1.,  2., -2.,  1.,       4.,     0.,     -2.,   0., &
      1.,  0.,  0., -1.,  0.,      -4.,     0.,      0.,   0., &
      2.,  1.,  0., -2.,  0.,       1.,     0.,      0.,   0., &
      0.,  0., -2.,  2.,  1.,       1.,     0.,      0.,   0., &
      0.,  1., -2.,  2.,  0.,      -1.,     0.,      0.,   0., &
      0.,  1.,  0.,  0.,  2.,       1.,     0.,      0.,   0., &
     -1.,  0.,  0.,  1.,  1.,       1.,     0.,      0.,   0., &
      0.,  1.,  2., -2.,  0.,      -1.,     0.,      0.,   0. /
data ((x(i,j),i=1,9),j=31,40) / &
      0.,  0.,  2.,  0.,  2.,   -2274.,    -2.,    977.,  -5., &
      1.,  0.,  0.,  0.,  0.,     712.,     1.,     -7.,   0., &
      0.,  0.,  2.,  0.,  1.,    -386.,    -4.,    200.,   0., &
      1.,  0.,  2.,  0.,  2.,    -301.,     0.,    129.,  -1., &
      1.,  0.,  0., -2.,  0.,    -158.,     0.,     -1.,   0., &
     -1.,  0.,  2.,  0.,  2.,     123.,     0.,    -53.,   0., &
      0.,  0.,  0.,  2.,  0.,      63.,     0.,     -2.,   0., &
      1.,  0.,  0.,  0.,  1.,      63.,     1.,    -33.,   0., &
     -1.,  0.,  0.,  0.,  1.,     -58.,    -1.,     32.,   0., &
     -1.,  0.,  2.,  2.,  2.,     -59.,     0.,     26.,   0./
data ((x(i,j),i=1,9),j=41,50) / &
      1.,  0.,  2.,  0.,  1.,     -51.,     0.,     27.,   0., &
      0.,  0.,  2.,  2.,  2.,     -38.,     0.,     16.,   0., &
      2.,  0.,  0.,  0.,  0.,      29.,     0.,     -1.,   0., &
      1.,  0.,  2., -2.,  2.,      29.,     0.,    -12.,   0., &
      2.,  0.,  2.,  0.,  2.,     -31.,     0.,     13.,   0., &
      0.,  0.,  2.,  0.,  0.,      26.,     0.,     -1.,   0., &
     -1.,  0.,  2.,  0.,  1.,      21.,     0.,    -10.,   0., &
     -1.,  0.,  0.,  2.,  1.,      16.,     0.,     -8.,   0., &
      1.,  0.,  0., -2.,  1.,     -13.,     0.,      7.,   0., &
     -1.,  0.,  2.,  2.,  1.,     -10.,     0.,      5.,   0. /
data ((x(i,j),i=1,9),j=51,60) / &
      1.,  1.,  0., -2.,  0.,      -7.,     0.,      0.,   0., &
      0.,  1.,  2.,  0.,  2.,       7.,     0.,     -3.,   0., &
      0., -1.,  2.,  0.,  2.,      -7.,     0.,      3.,   0., &
      1.,  0.,  2.,  2.,  2.,      -8.,     0.,      3.,   0., &
      1.,  0.,  0.,  2.,  0.,       6.,     0.,      0.,   0., &
      2.,  0.,  2., -2.,  2.,       6.,     0.,     -3.,   0., &
      0.,  0.,  0.,  2.,  1.,      -6.,     0.,      3.,   0., &
      0.,  0.,  2.,  2.,  1.,      -7.,     0.,      3.,   0., &
      1.,  0.,  2., -2.,  1.,       6.,     0.,     -3.,   0., &
      0.,  0.,  0., -2.,  1.,      -5.,     0.,      3.,   0. /
data ((x(i,j),i=1,9),j=61,70) / &
      1., -1.,  0.,  0.,  0.,       5.,     0.,      0.,   0., &
      2.,  0.,  2.,  0.,  1.,      -5.,     0.,      3.,   0., &
      0.,  1.,  0., -2.,  0.,      -4.,     0.,      0.,   0., &
      1.,  0., -2.,  0.,  0.,       4.,     0.,      0.,   0., &
      0.,  0.,  0.,  1.,  0.,      -4.,     0.,      0.,   0., &
      1.,  1.,  0.,  0.,  0.,      -3.,     0.,      0.,   0., &
      1.,  0.,  2.,  0.,  0.,       3.,     0.,      0.,   0., &
      1., -1.,  2.,  0.,  2.,      -3.,     0.,      1.,   0., &
     -1., -1.,  2.,  2.,  2.,      -3.,     0.,      1.,   0., &
     -2.,  0.,  0.,  0.,  1.,      -2.,     0.,      1.,   0. /
data ((x(i,j),i=1,9),j=71,80) / &
      3.,  0.,  2.,  0.,  2.,      -3.,     0.,      1.,   0., &
      0., -1.,  2.,  2.,  2.,      -3.,     0.,      1.,   0., &
      1.,  1.,  2.,  0.,  2.,       2.,     0.,     -1.,   0., &
     -1.,  0.,  2., -2.,  1.,      -2.,     0.,      1.,   0., &
      2.,  0.,  0.,  0.,  1.,       2.,     0.,     -1.,   0., &
      1.,  0.,  0.,  0.,  2.,      -2.,     0.,      1.,   0., &
      3.,  0.,  0.,  0.,  0.,       2.,     0.,      0.,   0., &
      0.,  0.,  2.,  1.,  2.,       2.,     0.,     -1.,   0., &
     -1.,  0.,  0.,  0.,  2.,       1.,     0.,     -1.,   0., &
      1.,  0.,  0., -4.,  0.,      -1.,     0.,      0.,   0. /
data ((x(i,j),i=1,9),j=81,90) / &
     -2.,  0.,  2.,  2.,  2.,       1.,     0.,     -1.,   0., &
     -1.,  0.,  2.,  4.,  2.,      -2.,     0.,      1.,   0., &
      2.,  0.,  0., -4.,  0.,      -1.,     0.,      0.,   0., &
      1.,  1.,  2., -2.,  2.,       1.,     0.,     -1.,   0., &
      1.,  0.,  2.,  2.,  1.,      -1.,     0.,      1.,   0., &
     -2.,  0.,  2.,  4.,  2.,      -1.,     0.,      1.,   0., &
     -1.,  0.,  4.,  0.,  2.,       1.,     0.,      0.,   0., &
      1., -1.,  0., -2.,  0.,       1.,     0.,      0.,   0., &
      2.,  0.,  2., -2.,  1.,       1.,     0.,     -1.,   0., &
      2.,  0.,  2.,  2.,  2.,      -1.,     0.,      0.,   0. /
data ((x(i,j),i=1,9),j=91,100) / &
      1.,  0.,  0.,  2.,  1.,      -1.,     0.,      0.,   0., &
      0.,  0.,  4., -2.,  2.,       1.,     0.,      0.,   0., &
      3.,  0.,  2., -2.,  2.,       1.,     0.,      0.,   0., &
      1.,  0.,  2., -2.,  0.,      -1.,     0.,      0.,   0., &
      0.,  1.,  2.,  0.,  1.,       1.,     0.,      0.,   0., &
     -1., -1.,  0.,  2.,  1.,       1.,     0.,      0.,   0., &
      0.,  0., -2.,  0.,  1.,      -1.,     0.,      0.,   0., &
      0.,  0.,  2., -1.,  2.,      -1.,     0.,      0.,   0., &
      0.,  1.,  0.,  2.,  0.,      -1.,     0.,      0.,   0., &
      1.,  0., -2., -2.,  0.,      -1.,     0.,      0.,   0. /
data ((x(i,j),i=1,9),j=101,106) / &
      0., -1.,  2.,  0.,  1.,      -1.,     0.,      0.,   0., &
      1.,  1.,  0., -2.,  1.,      -1.,     0.,      0.,   0., &
      1.,  0., -2.,  2.,  0.,      -1.,     0.,      0.,   0., &
      2.,  0.,  0.,  2.,  0.,       1.,     0.,      0.,   0., &
      0.,  0.,  2.,  4.,  2.,      -1.,     0.,      0.,   0., &
      0.,  1.,  0.,  1.,  0.,       1.,     0.,      0.,   0. /

!  Interval between fundamental epoch J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!
!  FUNDAMENTAL ARGUMENTS in the FK5 reference system
!

!  Mean longitude of the Moon minus mean longitude of the Moon's
!  perigee.
el = ANPM ( ( 485866.733d0 + ( 715922.633d0 + &
                  ( 31.310d0 + 0.064d0 * t ) * t ) * t ) * das2r &
                + mod(1325d0*t, 1d0) * d2pi )

!  Mean longitude of the Sun minus mean longitude of the Sun's perigee.
elp = ANPM ( ( 1287099.804d0 + ( 1292581.224d0 + &
                   ( -0.577d0 -0.012d0 * t ) * t ) * t ) * das2r &
                 + mod(99d0*t, 1d0) * d2pi )

!  Mean longitude of the Moon minus mean longitude of the Moon's node.
f = ANPM ( ( 335778.877d0 + ( 295263.137d0 + &
                 ( -13.257d0 + 0.011d0 * t ) * t ) * t ) * das2r &
               + mod(1342d0*t, 1d0) * d2pi )

!  Mean elongation of the Moon from the Sun.
d = ANPM ( ( 1072261.307d0 + ( 1105601.328d0 + &
                 ( -6.891d0 + 0.019d0 * t ) * t ) * t ) * das2r &
               + mod(1236d0*t, 1d0) * d2pi )

!  Longitude of the mean ascending node of the lunar orbit on the
!  ecliptic, measured from the mean equinox of date.
om = ANPM( ( 450160.280d0 + ( -482890.539d0 + &
                 ( 7.455d0 + 0.008d0 * t ) * t ) * t ) * das2r &
               + mod( -5d0*t, 1d0) * d2pi )

!  ---------------
!  Nutation series
!  ---------------

!  Change time argument from centuries to millennia.
t = t / 10d0

!  Initialize nutation components.
dp = 0d0
de = 0d0

!  Sum the nutation terms, ending with the biggest.
do 1 j=106,1,-1

!     Form argument for current term.
   arg = dble(x(1,j)) * el &
       + dble(x(2,j)) * elp &
       + dble(x(3,j)) * f &
       + dble(x(4,j)) * d &
       + dble(x(5,j)) * om

!     Accumulate current nutation term.
   s = dble(x(6,j)) + dble(x(7,j)) * t
   c = dble(x(8,j)) + dble(x(9,j)) * t
   if ( s /= 0d0 ) dp = dp + s * sin(arg)
   if ( c /= 0d0 ) de = de + c * cos(arg)

!     Next term.
1 continue

!  Convert results from 0.1 mas units to radians.
dpsi = dp * u2r
deps = de * u2r

end subroutine NUT80
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine NUTM80 ( date1, date2, rmatn )
!>
!  Form the matrix of nutation for a given date, IAU 1980 model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2      d       TDB date (Note 1)
!
!  Returned:
!     RMATN          d(3,3)    nutation matrix
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(true) = RMATN * V(mean),
!     where the p-vector V(true) is with respect to the true
!     equatorial triad of date and the p-vector V(mean) is with
!     respect to the mean equatorial triad of date.
!
!  Called:
!     NUT80    nutation, IAU 1980
!     OBL80    mean obliquity, IAU 1980
!     NUMAT    form nutation matrix
!
!  This revision:  2012 September 5
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rmatn(3,3)

double precision dpsi, deps, epsa
!     DOUBLE PRECISION OBL80

!  Nutation components and mean obliquity.
call NUT80 ( date1, date2, dpsi, deps )
epsa = OBL80 ( date1, date2 )

!  Build the rotation matrix.
call NUMAT ( epsa, dpsi, deps, rmatn )

end subroutine NUTM80
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function OBL06 ( date1, date2 )
!>
!  Mean obliquity of the ecliptic, IAU 2006 precession model.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2    d     TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     OBL06      d     obliquity of the ecliptic (radians, Note 2)
!
!  Notes:
!
!  1) The date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!             DATE1         DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The result is the angle between the ecliptic and mean equator of
!     date DATE1+DATE2.
!
!  Reference:
!
!     Hilton, J. et al., 2006, Celest.Mech.Dyn.Astron. 94, 351
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t

!  Interval between fundamental date J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Mean obliquity.
OBL06 = ( 84381.406d0       + &
            (   -46.836769d0    + &
            (    -0.0001831d0   + &
            (     0.00200340d0  + &
            (    -0.000000576d0 + &
            (    -0.0000000434d0 ) &
                             * t ) * t ) * t ) * t ) * t ) * das2r

end function OBL06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function OBL80 ( date1, date2 )
!>
!  Mean obliquity of the ecliptic, IAU 1980 model.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2     d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     OBL80       d      obliquity of the ecliptic (radians, Note 2)
!
!  Notes:
!
!  1) The date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!             DATE1         DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The result is the angle between the ecliptic and mean equator of
!     date DATE1+DATE2.
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Expression 3.222-1 (p114).
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t

!  Interval between fundamental epoch J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Mean obliquity of date.
OBL80 = das2r * ( 84381.448d0 + &
                      ( -46.8150d0 + &
                       ( -0.00059d0 + &
                          0.001813d0 * t ) * t ) * t )

end function OBL80
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine P06E ( date1, date2, &
                      eps0, psia, oma, bpa, bqa, pia, bpia, &
                      epsa, chia, za, zetaa, thetaa, pa, &
                      gam, phi, psi )
!>
!  Precession angles, IAU 2006, equinox based.
!
!  Status:  canonical models.
!
!  Given:
!     DATE1,DATE2   d    TT as a 2-part Julian Date (Note 1)
!
!  Returned (see Note 2):
!     EPS0          d    epsilon_0
!     PSIA          d    psi_A
!     OMA           d    omega_A
!     BPA           d    P_A
!     BQA           d    Q_A
!     PIA           d    pi_A
!     BPIA          d    Pi_A
!     EPSA          d    obliquity epsilon_A
!     CHIA          d    chi_A
!     ZA            d    z_A
!     ZETAA         d    zeta_A
!     THETAA        d    theta_A
!     PA            d    p_A
!     GAM           d    F-W angle gamma_J2000
!     PHI           d    F-W angle phi_J2000
!     PSI           d    F-W angle psi_J2000
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) This routine returns the set of equinox based angles for the
!     Capitaine et al. "P03" precession theory, adopted by the IAU in
!     2006.  The angles are set out in Table 1 of Hilton et al. (2006):
!
!      EPS0   epsilon_0   obliquity at J2000.0
!      PSIA   psi_A       luni-solar precession
!      OMA    omega_A     inclination of equator wrt J2000.0 ecliptic
!      BPA    P_A         ecliptic pole x, J2000.0 ecliptic triad
!      BQA    Q_A         ecliptic pole -y, J2000.0 ecliptic triad
!      PIA    pi_A        angle between moving and J2000.0 ecliptics
!      BPIA   Pi_A        longitude of ascending node of the ecliptic
!      EPSA   epsilon_A   obliquity of the ecliptic
!      CHIA   chi_A       planetary precession
!      ZA     z_A         equatorial precession: -3rd 323 Euler angle
!      ZETAA  zeta_A      equatorial precession: -1st 323 Euler angle
!      THETAA theta_A     equatorial precession: 2nd 323 Euler angle
!      PA     p_A         general precession
!      GAM    gamma_J2000 J2000.0 RA difference of ecliptic poles
!      PHI    phi_J2000   J2000.0 codeclination of ecliptic pole
!      PSI    psi_J2000   longitude difference of equator poles, J2000.0
!
!     The returned values are all radians.
!
!  3) Hilton et al. (2006) Table 1 also contains angles that depend on
!     models distinct from the P03 precession theory itself, namely the
!     IAU 2000A frame bias and nutation.  The quoted polynomials are
!     used in other SOFA routines:
!
!     . XY06 contains the polynomial parts of the X and Y series.
!
!     . S06 contains the polynomial part of the s+XY/2 series.
!
!     . PFW06 implements the series for the Fukushima-Williams
!       angles that are with respect to the GCRS pole (i.e. the variants
!       that include frame bias).
!
!  4) The IAU resolution stipulated that the choice of parameterization
!     was left to the user, and so an IAU compliant precession
!     implementation can be constructed using various combinations of
!     the angles returned by the present routine.
!
!  5) The parameterization used by SOFA is the version of the Fukushima-
!     Williams angles that refers directly to the GCRS pole.  These
!     angles may be calculated by calling the routine PFW06.  SOFA
!     also supports the direct computation of the CIP GCRS X,Y by
!     series, available by calling XY06.
!
!  6) The agreement between the different parameterizations is at the
!     1 microarcsecond level in the present era.
!
!  7) When constructing a precession formulation that refers to the GCRS
!     pole rather than the dynamical pole, it may (depending on the
!     choice of angles) be necessary to introduce the frame bias
!     explicitly.
!
!  Reference:
!
!     Hilton, J. et al., 2006, Celest.Mech.Dyn.Astron. 94, 351
!
!  Called:
!     OBL06    mean obliquity, IAU 2006
!
!  This revision:  2011 December 6
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, &
                 eps0, psia, oma, bpa, bqa, pia, bpia, &
                 epsa, chia, za, zetaa, thetaa, pa, &
                 gam, phi, psi

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t

!     DOUBLE PRECISION OBL06

!  Interval between fundamental date J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Obliquity at J2000.0.

eps0 = 84381.406d0 * das2r

!  Luni-solar precession.

psia = ( 5038.481507d0     + &
       (   -1.0790069d0    + &
       (   -0.00114045d0   + &
       (    0.000132851d0  + &
       (   -0.0000000951d0 ) &
       * t ) * t ) * t ) * t ) * t * das2r

!  Inclination of mean equator with respect to the J2000.0 ecliptic.

oma = eps0 + ( -0.025754d0     + &
             (  0.0512623d0    + &
             ( -0.00772503d0   + &
             ( -0.000000467d0  + &
             (  0.0000003337d0 ) &
             * t ) * t ) * t ) * t ) * t * das2r

!  Ecliptic pole x, J2000.0 ecliptic triad.

bpa = (  4.199094d0     + &
      (  0.1939873d0    + &
      ( -0.00022466d0   + &
      ( -0.000000912d0  + &
      (  0.0000000120d0 ) &
      * t ) * t ) * t ) * t ) * t * das2r

!  Ecliptic pole -y, J2000.0 ecliptic triad.

bqa = ( -46.811015d0     + &
      (   0.0510283d0    + &
      (   0.00052413d0   + &
      (  -0.000000646d0  + &
      (  -0.0000000172d0 ) &
      * t ) * t ) * t ) * t ) * t * das2r

!  Angle between moving and J2000.0 ecliptics.

pia = ( 46.998973d0     + &
      ( -0.0334926d0    + &
      ( -0.00012559d0   + &
      (  0.000000113d0  + &
      ( -0.0000000022d0 ) &
      * t ) * t ) * t ) * t ) * t * das2r

!  Longitude of ascending node of the moving ecliptic.

bpia = ( 629546.7936d0      + &
       (   -867.95758d0     + &
       (      0.157992d0    + &
       (     -0.0005371d0   + &
       (     -0.00004797d0  + &
       (      0.000000072d0 ) &
       * t ) * t ) * t ) * t ) * t ) * das2r

!  Mean obliquity of the ecliptic.

epsa = OBL06 ( date1, date2 )

!  Planetary precession.

chia = ( 10.556403d0     + &
       ( -2.3814292d0    + &
       ( -0.00121197d0   + &
       (  0.000170663d0  + &
       ( -0.0000000560d0 ) &
       * t ) * t ) * t ) * t ) * t * das2r

!  Equatorial precession: minus the third of the 323 Euler angles.

za = (   -2.650545d0     + &
     ( 2306.077181d0     + &
     (    1.0927348d0    + &
     (    0.01826837d0   + &
     (   -0.000028596d0  + &
     (   -0.0000002904d0 ) &
     * t ) * t ) * t ) * t ) * t ) * das2r

!  Equatorial precession: minus the first of the 323 Euler angles.

zetaa = (    2.650545d0     + &
        ( 2306.083227d0     + &
        (    0.2988499d0    + &
        (    0.01801828d0   + &
        (   -0.000005971d0  + &
        (   -0.0000003173d0 ) &
        * t ) * t ) * t ) * t ) * t ) * das2r

!  Equatorial precession: second of the 323 Euler angles.

thetaa = ( 2004.191903d0     + &
         (   -0.4294934d0    + &
         (   -0.04182264d0   + &
         (   -0.000007089d0  + &
         (   -0.0000001274d0 ) &
         * t ) * t ) * t ) * t ) * t * das2r

!  General precession.

pa = ( 5028.796195d0     + &
     (    1.1054348d0    + &
     (    0.00007964d0   + &
     (   -0.000023857d0  + &
     (    0.0000000383d0 ) &
     * t ) * t ) * t ) * t ) * t * das2r

!  Fukushima-Williams angles for precession.

gam = ( 10.556403d0     + &
      (  0.4932044d0    + &
      ( -0.00031238d0   + &
      ( -0.000002788d0  + &
      (  0.0000000260d0 ) &
      * t ) * t ) * t ) * t ) * t * das2r

phi = eps0 + ( -46.811015d0     + &
             (   0.0511269d0    + &
             (   0.00053289d0   + &
             (  -0.000000440d0  + &
             (  -0.0000000176d0 ) &
             * t ) * t ) * t ) * t ) * t * das2r

psi = ( 5038.481507d0     + &
      (    1.5584176d0    + &
      (   -0.00018522d0   + &
      (   -0.000026452d0  + &
      (   -0.0000000148d0 ) &
      * t ) * t ) * t ) * t ) * t * das2r

end subroutine P06E
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine P2PV ( p, pv )
!>
!  Extend a p-vector to a pv-vector by appending a zero velocity.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     P        d(3)      p-vector
!
!  Returned:
!     PV       d(3,2)    pv-vector
!
!  Called:
!     CP       copy p-vector
!     ZP       zero p-vector
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision p(3), pv(3,2)

call CP ( p, pv(1,1) )
call ZP ( pv(1,2) )

end subroutine P2PV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine P2S ( p, theta, phi, r )
!>
!  P-vector to spherical polar coordinates.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     P        d(3)      p-vector
!
!  Returned:
!     THETA    d         longitude angle (radians)
!     PHI      d         latitude angle (radians)
!     R        d         radial distance
!
!  Notes:
!
!  1) If P is null, zero THETA, PHI and R are returned.
!
!  2) At either pole, zero THETA is returned.
!
!  Called:
!     C2S      p-vector to spherical
!     PM       modulus of p-vector
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision p(3), theta, phi, r

call C2S ( p, theta, phi )
call PM ( p, r )

end subroutine P2S
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PAP ( a, b, theta )
!>
!  Position-angle from two p-vectors.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3)      direction of reference point
!     B        d(3)      direction of point whose PA is required
!
!  Returned:
!     THETA    d         position angle of B with respect to A (radians)
!
!  Notes:
!
!  1) The result is the position angle, in radians, of direction B with
!     respect to direction A.  It is in the range -pi to +pi.  The sense
!     is such that if B is a small distance "north" of A the position
!     angle is approximately zero, and if B is a small distance "east" of
!     A the position angle is approximately +pi/2.
!
!  2) A and B need not be unit vectors.
!
!  3) Zero is returned if the two directions are the same or if either
!     vector is null.
!
!  4) If A is at a pole, the result is ill-defined.
!
!  Called:
!     PN       decompose p-vector into modulus and direction
!     PM       modulus of p-vector
!     PXP      vector product of two p-vectors
!     PMP      p-vector minus p-vector
!     PDP      scalar product of two p-vectors
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision a(3), b(3), theta

double precision am, au(3), bm, st, ct, xa, ya, za, eta(3), &
                 xi(3), a2b(3)

!  Modulus and direction of the A vector.
call PN ( a, am, au )

!  Modulus of the B vector.
call PM ( b, bm )

!  Deal with the case of a null vector.
if ( am==0d0 .or. bm==0d0 ) then
   st = 0d0
   ct = 1d0
else

!     The "north" axis tangential from A (arbitrary length).
   xa = a(1)
   ya = a(2)
   za = a(3)
   eta(1) = - xa * za
   eta(2) = - ya * za
   eta(3) = xa*xa + ya*ya

!     The "east" axis tangential from A (same length).
   call PXP ( eta, au, xi )

!     The vector from A to B.
   call PMP ( b, a, a2b )

!     Resolve into components along the north and east axes.
   call PDP ( a2b, xi, st )
   call PDP ( a2b, eta, ct )

!     Deal with degenerate cases.
   if ( st==0d0 .and. ct==0d0 ) ct = 1d0

end if

!  Position angle.
theta = atan2(st,ct)

end subroutine PAP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PAS ( al, ap, bl, bp, theta )
!>
!  Position-angle from spherical coordinates.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     AL       d       longitude of point A (e.g. RA) in radians
!     AP       d       latitude of point A (e.g. Dec) in radians
!     BL       d       longitude of point B
!     BP       d       latitude of point B
!
!  Returned:
!     THETA    d       position angle of B with respect to A
!
!  Notes:
!
!  1) The result is the bearing (position angle), in radians, of point
!     B with respect to point A.  It is in the range -pi to +pi.  The
!     sense is such that if B is a small distance "east" of point A,
!     the bearing is approximately +pi/2.
!
!  2) Zero is returned if the two points are coincident.
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision al, ap, bl, bp, theta

double precision dl, x, y

dl = bl - al
y = sin(dl)*cos(bp)
x = sin(bp)*cos(ap) - cos(bp)*sin(ap)*cos(dl)
if ( x/=0d0 .or. y/=0d0 ) then
   theta = atan2(y,x)
else
   theta = 0d0
end if

end subroutine PAS
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PB06 ( date1, date2, bzeta, bz, btheta )
!>
!  This routine forms three Euler angles which implement general
!  precession from epoch J2000.0, using the IAU 2006 model.  Frame
!  bias (the offset between ICRS and mean J2000.0) is included.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d    TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     BZETA         d    1st rotation: radians clockwise around z
!     BZ            d    3rd rotation: radians clockwise around z
!     BTHETA        d    2nd rotation: radians counterclockwise around y
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the arguments DATE1 and DATE2.  For
!     example, JD(TT)=2450123.7 could be expressed in any of these
!     ways, among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The traditional accumulated precession angles zeta_A, z_A, theta_A
!     cannot be obtained in the usual way, namely through polynomial
!     expressions, because of the frame bias.  The latter means that two
!     of the angles undergo rapid changes near this date.  They are
!     instead the results of decomposing the precession-bias matrix
!     obtained by using the Fukushima-Williams method, which does not
!     suffer from the problem.  The decomposition returns values which
!     can be used in the conventional formulation and which include
!     frame bias.
!
!  3) The three angles are returned in the conventional order, which
!     is not the same as the order of the corresponding Euler rotations.
!     The precession-bias matrix is R_3(-z) x R_2(+theta) x R_3(-zeta).
!
!  4) Should zeta_A, z_A, theta_A angles be required that do not contain
!     frame bias, they are available by calling the SOFA routine
!     P06E.
!
!  Called:
!     PMAT06   PB matrix, IAU 2006
!     RZ       rotate around Z-axis
!
!  This revision:  2007 June 8
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, bzeta, bz, btheta

double precision r(3,3), r31, r32

!  Precession matrix via Fukushima-Williams angles.
call PMAT06 ( date1, date2, r )

!  Solve for z.
bz = atan2 ( r(2,3), r(1,3) )

!  Remove it from the matrix.
call RZ ( bz, r )

!  Solve for the remaining two angles.
bzeta = atan2 ( r(2,1), r(2,2) )
r31 = r(3,1)
r32 = r(3,2)
btheta = atan2 ( -sign(sqrt(r31*r31+r32*r32),r(1,3)), r(3,3) )

end subroutine PB06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PDP ( a, b, adb )
!>
!  p-vector inner (=scalar=dot) product.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3)      first p-vector
!     B        d(3)      second p-vector
!
!  Returned:
!     ADB      d         A . B
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision a(3), b(3), adb

double precision w
integer i

w = 0d0
do 1 i=1,3
   w = w + a(i)*b(i)
1 continue
adb = w

end subroutine PDP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PFW06 ( date1, date2, gamb, phib, psib, epsa )
!>
!  Precession angles, IAU 2006 (Fukushima-Williams 4-angle formulation).
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2   d    TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     GAMB          d    F-W angle gamma_bar (radians)
!     PHIB          d    F-W angle phi_bar (radians)
!     PSIB          d    F-W angle psi_bar (radians)
!     EPSA          d    F-W angle epsilon_A (radians)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) Naming the following points:
!
!           e = J2000.0 ecliptic pole,
!           p = GCRS pole,
!           E = mean ecliptic pole of date,
!     and   P = mean pole of date,
!
!     the four Fukushima-Williams angles are as follows:
!
!        GAMB = gamma_bar = epE
!        PHIB = phi_bar = pE
!        PSIB = psi_bar = pEP
!        EPSA = epsilon_A = EP
!
!  3) The matrix representing the combined effects of frame bias and
!     precession is:
!
!        PxB = R_1(-EPSA).R_3(-PSIB).R_1(PHIB).R_3(GAMB)
!
!  4) The matrix representing the combined effects of frame bias,
!     precession and nutation is simply:
!
!        NxPxB = R_1(-EPSA-dE).R_3(-PSIB-dP).R_1(PHIB).R_3(GAMB)
!
!     where dP and dE are the nutation components with respect to the
!     ecliptic of date.
!
!  Reference:
!
!     Hilton, J. et al., 2006, Celest.Mech.Dyn.Astron. 94, 351
!
!  Called:
!     OBL06    mean obliquity, IAU 2006
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, gamb, phib, psib, epsa

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t

!     DOUBLE PRECISION OBL06

!  Interval between fundamental date J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  P03 bias+precession angles.
gamb =        (    -0.052928d0    + &
              (    10.556378d0    + &
              (     0.4932044d0   + &
              (    -0.00031238d0  + &
              (    -0.000002788d0 + &
              (     0.0000000260d0 ) &
                             * t ) * t ) * t ) * t ) * t ) * das2r
phib =        ( 84381.412819d0    + &
              (   -46.811016d0    + &
              (     0.0511268d0   + &
              (     0.00053289d0  + &
              (    -0.000000440d0 + &
              (    -0.0000000176d0 ) &
                             * t ) * t ) * t ) * t ) * t ) * das2r
psib =        (    -0.041775d0    + &
              (  5038.481484d0    + &
              (     1.5584175d0   + &
              (    -0.00018522d0  + &
              (    -0.000026452d0 + &
              (    -0.0000000148d0 ) &
                             * t ) * t ) * t ) * t ) * t ) * das2r
epsa = OBL06 ( date1, date2 )

end subroutine PFW06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PLAN94 ( date1, date2, np, pv, j )
!>
!  This routine is part of the International Astronomical Union's
!  SOFA (Standards of Fundamental Astronomy) software collection.
!
!  Status:  support routine.
!
!  Approximate heliocentric position and velocity of a nominated major
!  planet:  Mercury, Venus, EMB, Mars, Jupiter, Saturn, Uranus or
!  Neptune (but not the Earth itself).
!
!  Given:
!     DATE1    d       TDB date part A (Note 1)
!     DATE2    d       TDB date part B (Note 1)
!     NP       i       planet (1=Mercury, 2=Venus, 3=EMB ... 8=Neptune)
!
!  Returned:
!     PV       d(3,2)  planet pos,vel (heliocentric, J2000.0, au, au/d)
!     J        i       status: -1 = illegal NP (outside 1-8)
!                               0 = OK
!                              +1 = warning: date outside 1000-3000 AD
!                              +2 = warning: solution failed to converge
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!     The limited accuracy of the present algorithm is such that any
!     of the methods is satisfactory.
!
!  2) If an NP value outside the range 1-8 is supplied, an error
!     status (J = -1) is returned and the PV vector set to zeroes.
!
!  3) For NP=3 the result is for the Earth-Moon Barycenter.  To
!     obtain the heliocentric position and velocity of the Earth,
!     use instead the SOFA routine EPV00.
!
!  4) On successful return, the array PV contains the following:
!
!        PV(1,1)  x       }
!        PV(2,1)  y       } heliocentric position, au
!        PV(3,1)  z       }
!
!        PV(1,2)  xdot    }
!        PV(2,2)  ydot    } heliocentric velocity, au/d
!        PV(3,2)  zdot    }
!
!     The reference frame is equatorial and is with respect to the
!     mean equator and equinox of epoch J2000.0.
!
!  5) The algorithm is due to J.L. Simon, P. Bretagnon, J. Chapront,
!     M. Chapront-Touze, G. Francou and J. Laskar (Bureau des
!     Longitudes, Paris, France).  From comparisons with JPL
!     ephemeris DE102, they quote the following maximum errors
!     over the interval 1800-2050:
!
!                     L (arcsec)    B (arcsec)      R (km)
!
!        Mercury          4             1             300
!        Venus            5             1             800
!        EMB              6             1            1000
!        Mars            17             1            7700
!        Jupiter         71             5           76000
!        Saturn          81            13          267000
!        Uranus          86             7          712000
!        Neptune         11             1          253000
!
!     Over the interval 1000-3000, they report that the accuracy is no
!     worse than 1.5 times that over 1800-2050.  Outside 1000-3000 the
!     accuracy declines.
!
!     Comparisons of the present routine with the JPL DE200 ephemeris
!     give the following RMS errors over the interval 1960-2025:
!
!                      position (km)     velocity (m/s)
!
!        Mercury            334               0.437
!        Venus             1060               0.855
!        EMB               2010               0.815
!        Mars              7690               1.98
!        Jupiter          71700               7.70
!        Saturn          199000              19.4
!        Uranus          564000              16.4
!        Neptune         158000              14.4
!
!     Comparisons against DE200 over the interval 1800-2100 gave the
!     following maximum absolute differences.  (The results using
!     DE406 were essentially the same.)
!
!                   L (arcsec)   B (arcsec)     R (km)   Rdot (m/s)
!
!        Mercury        7            1            500       0.7
!        Venus          7            1           1100       0.9
!        EMB            9            1           1300       1.0
!        Mars          26            1           9000       2.5
!        Jupiter       78            6          82000       8.2
!        Saturn        87           14         263000      24.6
!        Uranus        86            7         661000      27.4
!        Neptune       11            2         248000      21.4
!
!  6) The present SOFA re-implementation of the original Simon et al.
!     Fortran code differs from the original in the following respects:
!
!       *  The date is supplied in two parts.
!
!       *  The result is returned only in equatorial Cartesian form;
!          the ecliptic longitude, latitude and radius vector are not
!          returned.
!
!       *  The result is in the J2000.0 equatorial frame, not ecliptic.
!
!       *  More is done in-line:  there are fewer calls to other
!          routines.
!
!       *  Different error/warning status values are used.
!
!       *  A different Kepler's-equation-solver is used (avoiding
!          use of COMPLEX*16).
!
!       *  Polynomials in T are nested to minimize rounding errors.
!
!       *  Explicit double-precision constants are used to avoid
!          mixed-mode expressions.
!
!       *  There are other, cosmetic, changes to comply with SOFA
!          style conventions.
!
!     None of the above changes affects the result significantly.
!
!  7) The returned status, J, indicates the most serious condition
!     encountered during execution of the routine.  Illegal NP is
!     considered the most serious, overriding failure to converge,
!     which in turn takes precedence over the remote epoch warning.
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!
!  Reference:  Simon, J.L, Bretagnon, P., Chapront, J.,
!              Chapront-Touze, M., Francou, G., and Laskar, J.,
!              Astron.Astrophys., 282, 663 (1994).
!
!  This revision:  2017 October 12
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2
integer np
double precision pv(3,2)
integer j

!  Maximum number of iterations allowed to solve Kepler's equation
integer kmax
parameter ( kmax = 10 )

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian millennium
double precision djm
parameter ( djm = 365250d0 )

!  Sin and cos of J2000.0 mean obliquity (IAU 1976)
double precision sineps, coseps
parameter ( sineps = 0.3977771559319137d0, &
            coseps = 0.9174820620691818d0 )

!  Gaussian constant
double precision gk
parameter ( gk = 0.017202098950d0 )

integer jstat, i, k
double precision amas(8), a(3,8), dlm(3,8), e(3,8), &
                 pi(3,8), dinc(3,8), omega(3,8), &
                 kp(9,8), ca(9,8), sa(9,8), &
                 kq(10,8), cl(10,8), sl(10,8), &
                 t, da, dl, de, dp, di, dom, dmu, arga, argl, am, &
                 ae, dae, ae2, at, r, v, si2, xq, xp, tl, xsw, &
                 xcw, xm2, xf, ci2, xms, xmc, xpxq2, x, y, z

!     DOUBLE PRECISION ANPM

!  Planetary inverse masses
data amas / 6023600d0, 408523.5d0, 328900.5d0, 3098710d0, &
            1047.355d0, 3498.5d0, 22869d0, 19314d0 /

!
!  Tables giving the mean Keplerian elements, limited to T**2 terms:
!
!         A       semi-major axis (au)
!         DLM     mean longitude (degree and arcsecond)
!         E       eccentricity
!         PI      longitude of the perihelion (degree and arcsecond)
!         DINC    inclination (degree and arcsecond)
!         OMEGA   longitude of the ascending node (degree and arcsecond)
!
data a / &
  0.3870983098d0,             0d0,      0d0, &
  0.7233298200d0,             0d0,      0d0, &
  1.0000010178d0,             0d0,      0d0, &
  1.5236793419d0,           3d-10,      0d0, &
  5.2026032092d0,       19132d-10,  -39d-10, &
  9.5549091915d0, -0.0000213896d0,  444d-10, &
 19.2184460618d0,       -3716d-10,  979d-10, &
 30.1103868694d0,      -16635d-10,  686d-10 /
!
data dlm / &
 252.25090552d0, 5381016286.88982d0,  -1.92789d0, &
 181.97980085d0, 2106641364.33548d0,   0.59381d0, &
 100.46645683d0, 1295977422.83429d0,  -2.04411d0, &
 355.43299958d0,  689050774.93988d0,   0.94264d0, &
  34.35151874d0,  109256603.77991d0, -30.60378d0, &
  50.07744430d0,   43996098.55732d0,  75.61614d0, &
 314.05500511d0,   15424811.93933d0,  -1.75083d0, &
 304.34866548d0,    7865503.20744d0,   0.21103d0 /
!
data e / &
 0.2056317526d0,  0.0002040653d0,      -28349d-10, &
 0.0067719164d0, -0.0004776521d0,       98127d-10, &
 0.0167086342d0, -0.0004203654d0, -0.0000126734d0, &
 0.0934006477d0,  0.0009048438d0,      -80641d-10, &
 0.0484979255d0,  0.0016322542d0, -0.0000471366d0, &
 0.0555481426d0, -0.0034664062d0, -0.0000643639d0, &
 0.0463812221d0, -0.0002729293d0,  0.0000078913d0, &
 0.0094557470d0,  0.0000603263d0,            0d0  /
!
data pi / &
  77.45611904d0,  5719.11590d0,   -4.83016d0, &
 131.56370300d0,   175.48640d0, -498.48184d0, &
 102.93734808d0, 11612.35290d0,   53.27577d0, &
 336.06023395d0, 15980.45908d0,  -62.32800d0, &
  14.33120687d0,  7758.75163d0,  259.95938d0, &
  93.05723748d0, 20395.49439d0,  190.25952d0, &
 173.00529106d0,  3215.56238d0,  -34.09288d0, &
  48.12027554d0,  1050.71912d0,   27.39717d0 /
!
data dinc / &
 7.00498625d0, -214.25629d0,   0.28977d0, &
 3.39466189d0,  -30.84437d0, -11.67836d0, &
          0d0,  469.97289d0,  -3.35053d0, &
 1.84972648d0, -293.31722d0,  -8.11830d0, &
 1.30326698d0,  -71.55890d0,  11.95297d0, &
 2.48887878d0,   91.85195d0, -17.66225d0, &
 0.77319689d0,  -60.72723d0,   1.25759d0, &
 1.76995259d0,    8.12333d0,   0.08135d0 /
!
data omega / &
  48.33089304d0,  -4515.21727d0,  -31.79892d0, &
  76.67992019d0, -10008.48154d0,  -51.32614d0, &
 174.87317577d0,  -8679.27034d0,   15.34191d0, &
  49.55809321d0, -10620.90088d0, -230.57416d0, &
 100.46440702d0,   6362.03561d0,  326.52178d0, &
 113.66550252d0,  -9240.19942d0,  -66.23743d0, &
  74.00595701d0,   2669.15033d0,  145.93964d0, &
 131.78405702d0,   -221.94322d0,   -0.78728d0 /
!
!  Tables for trigonometric terms to be added to the mean elements
!  of the semi-major axes.
!
data kp / &
 69613, 75645, 88306, 59899, 15746, 71087, 142173,  3086,    0, &
 21863, 32794, 26934, 10931, 26250, 43725,  53867, 28939,    0, &
 16002, 21863, 32004, 10931, 14529, 16368,  15318, 32794,    0, &
 6345,   7818, 15636,  7077,  8184, 14163,   1107,  4872,    0, &
 1760,   1454,  1167,   880,   287,  2640,     19,  2047, 1454, &
  574,      0,   880,   287,    19,  1760,   1167,   306,  574, &
  204,      0,   177,  1265,     4,   385,    200,   208,  204, &
    0,    102,   106,     4,    98,  1367,    487,   204,    0 /
!
data ca / &
      4,    -13,    11,    -9,    -9,    -3,    -1,     4,    0, &
   -156,     59,   -42,     6,    19,   -20,   -10,   -12,    0, &
     64,   -152,    62,    -8,    32,   -41,    19,   -11,    0, &
    124,    621,  -145,   208,    54,   -57,    30,    15,    0, &
 -23437,  -2634,  6601,  6259, -1507, -1821,  2620, -2115,-1489, &
  62911,-119919, 79336, 17814,-24241, 12068,  8306, -4893, 8902, &
 389061,-262125,-44088,  8387,-22976, -2093,  -615, -9720, 6633, &
-412235,-157046,-31430, 37817, -9740,   -13, -7449,  9644,    0 /
!
data sa / &
     -29,    -1,     9,     6,    -6,     5,     4,     0,    0, &
     -48,  -125,   -26,   -37,    18,   -13,   -20,    -2,    0, &
    -150,   -46,    68,    54,    14,    24,   -28,    22,    0, &
    -621,   532,  -694,   -20,   192,   -94,    71,   -73,    0, &
  -14614,-19828, -5869,  1881, -4372, -2255,   782,   930,  913, &
  139737,     0, 24667, 51123, -5102,  7429, -4095, -1976,-9566, &
 -138081,     0, 37205,-49039,-41901,-33872,-27037,-12474,18797, &
       0, 28492,133236, 69654, 52322,-49577,-26430, -3593,    0 /
!
!  Tables giving the trigonometric terms to be added to the mean
!  elements of the mean longitudes.
!
data kq / &
  3086, 15746, 69613, 59899, 75645, 88306, 12661, 2658,  0,   0, &
 21863, 32794, 10931,    73,  4387, 26934,  1473, 2157,  0,   0, &
    10, 16002, 21863, 10931,  1473, 32004,  4387,   73,  0,   0, &
    10,  6345,  7818,  1107, 15636,  7077,  8184,  532, 10,   0, &
    19,  1760,  1454,   287,  1167,   880,   574, 2640, 19,1454, &
    19,   574,   287,   306,  1760,    12,    31,   38, 19, 574, &
     4,   204,   177,     8,    31,   200,  1265,  102,  4, 204, &
     4,   102,   106,     8,    98,  1367,   487,  204,  4, 102 /
!
data cl / &
     21,   -95, -157,   41,   -5,   42,   23,   30,     0,    0, &
   -160,  -313, -235,   60,  -74,  -76,  -27,   34,     0,    0, &
   -325,  -322,  -79,  232,  -52,   97,   55,  -41,     0,    0, &
   2268,  -979,  802,  602, -668,  -33,  345,  201,   -55,    0, &
   7610, -4997,-7689,-5841,-2617, 1115, -748, -607,  6074,  354, &
 -18549, 30125,20012, -730,  824,   23, 1289, -352,-14767,-2062, &
-135245,-14594, 4197,-4030,-5630,-2898, 2540, -306,  2939, 1986, &
  89948,  2103, 8963, 2695, 3682, 1648,  866, -154, -1963, -283 /
!
data sl / &
   -342,   136,  -23,   62,   66,  -52,  -33,   17,     0,    0, &
    524,  -149,  -35,  117,  151,  122,  -71,  -62,     0,    0, &
   -105,  -137,  258,   35, -116,  -88, -112,  -80,     0,    0, &
    854,  -205, -936, -240,  140, -341,  -97, -232,   536,    0, &
 -56980,  8016, 1012, 1448,-3024,-3710,  318,  503,  3767,  577, &
 138606,-13478,-4964, 1441,-1319,-1482,  427, 1236, -9167,-1918, &
  71234,-41116, 5334,-4935,-1848,   66,  434,-1748,  3780, -701, &
 -47645, 11647, 2166, 3194,  679,    0, -244, -419, -2531,   48 /

!  Validate the planet number.
if ( np<1 .or. np>8 ) then
   jstat = -1

!     Reset the result in case of failure.
   do 2 k=1,2
      do 1 i=1,3
         pv(i,k) = 0d0
1       continue
2    continue
else

!     Time: Julian millennia since J2000.0.
   t = ( ( date1-dj00 ) + date2 ) / djm

!     OK status unless remote epoch.
   if ( abs(t) <= 1d0 ) then
      jstat = 0
   else
      jstat = 1
   end if

!     Compute the mean elements.
   da = a(1,np) + &
      ( a(2,np) + &
        a(3,np) * t ) * t
   dl = ( 3600d0 * dlm(1,np) + &
                 ( dlm(2,np) + &
                   dlm(3,np) * t ) * t ) * das2r
   de = e(1,np) + &
      ( e(2,np) + &
        e(3,np) * t ) * t
   dp = ANPM ( ( 3600d0 * pi(1,np) + &
                            ( pi(2,np) + &
                              pi(3,np) * t ) * t ) * das2r )
   di = ( 3600d0 * dinc(1,np) + &
                 ( dinc(2,np) + &
                   dinc(3,np) * t ) * t ) * das2r
   dom = ANPM ( ( 3600d0 * omega(1,np) &
                           + ( omega(2,np) &
                             + omega(3,np) * t ) * t ) * das2r )

!     Apply the trigonometric terms.
   dmu = 0.35953620d0 * t
   do 3 k=1,8
      arga = kp(k,np) * dmu
      argl = kq(k,np) * dmu
      da = da + ( ca(k,np) * cos(arga) + &
                  sa(k,np) * sin(arga) ) * 1d-7
      dl = dl + ( cl(k,np) * cos(argl) + &
                  sl(k,np) * sin(argl) ) * 1d-7
3    continue
   arga = kp(9,np) * dmu
   da = da + t * ( ca(9,np) * cos(arga) + &
                   sa(9,np) * sin(arga) ) * 1d-7
   do 4 k=9,10
      argl = kq(k,np) * dmu
      dl = dl + t * ( cl(k,np) * cos(argl) + &
                      sl(k,np) * sin(argl) ) * 1d-7
4    continue
   dl = mod(dl, d2pi)

!     Iterative solution of Kepler's equation to get eccentric anomaly.
   am = dl - dp
   ae = am + de*sin(am)
   k = 0
5    continue
      dae = ( am - ae + de*sin(ae) ) / ( 1d0 - de*cos(ae) )
      ae = ae + dae
      k = k + 1
      if ( k>=kmax ) jstat = 2
   if ( k<kmax .and. abs(dae) > 1d-12 ) go to 5

!     True anomaly.
   ae2 = ae / 2d0
   at = 2d0 * atan2(sqrt((1d0+de)/(1d0-de)) * sin(ae2), &
                                              cos(ae2))

!     Distance (au) and speed (radians per day).
   r = da * ( 1d0 - de*cos(ae) )
   v = gk * sqrt( ( 1d0 + 1d0/amas(np) ) / (da*da*da))

   si2 = sin(di/2d0)
   xq = si2 * cos(dom)
   xp = si2 * sin(dom)
   tl = at + dp
   xsw = sin(tl)
   xcw = cos(tl)
   xm2 = 2d0 * ( xp*xcw - xq*xsw )
   xf = da / sqrt(1d0 - de*de)
   ci2 = cos(di/2d0)
   xms = ( de * sin(dp) + xsw ) * xf
   xmc = ( de * cos(dp) + xcw ) * xf
   xpxq2 = 2d0 * xp * xq

!     Position (J2000.0 ecliptic x,y,z in au).
   x = r * ( xcw - xm2*xp )
   y = r * ( xsw + xm2*xq )
   z = r * ( -xm2 * ci2 )

!     Rotate to equatorial.
   pv(1,1) = x
   pv(2,1) = y*coseps - z*sineps
   pv(3,1) = y*sineps + z*coseps

!     Velocity (J2000.0 ecliptic xdot,ydot,zdot in au/d).
   x = v * ( ( -1d0 + 2d0*xp*xp ) * xms + xpxq2 * xmc )
   y = v * ( ( 1d0 - 2d0*xq*xq ) * xmc - xpxq2 * xms )
   z = v * ( 2d0 * ci2 * ( xp*xms + xq*xmc ) )

!     Rotate to equatorial.
   pv(1,2) = x
   pv(2,2) = y*coseps - z*sineps
   pv(3,2) = y*sineps + z*coseps

end if

!  Return the status.
j = jstat

end subroutine PLAN94
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PM ( p, r )
!>
!  Modulus of p-vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     P        d(3)      p-vector
!
!  Returned:
!     R        d         modulus
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision p(3), r

integer i
double precision w, c

w = 0d0
do 1 i=1,3
   c = p(i)
   w = w + c*c
1 continue
r = sqrt(w)

end subroutine PM
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PMAT00 ( date1, date2, rbp )
!>
!  Precession matrix (including frame bias) from GCRS to a specified
!  date, IAU 2000 model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RBP         d(3,3)    bias-precession matrix (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the arguments DATE1 and DATE2.  For
!     example, JD(TT)=2450123.7 could be expressed in any of these
!     ways, among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(date) = RBP * V(GCRS), where
!     the p-vector V(GCRS) is with respect to the Geocentric Celestial
!     Reference System (IAU, 2000) and the p-vector V(date) is with
!     respect to the mean equatorial triad of the given date.
!
!  Called:
!     BP00     frame bias and precession matrices, IAU 2000
!
!  Reference:
!
!     IAU: Trans. International Astronomical Union, Vol. XXIVB;  Proc.
!     24th General Assembly, Manchester, UK.  Resolutions B1.3, B1.6.
!     (2000)
!
!  This revision:  2009 December 21
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rbp(3,3)

double precision rb(3,3), rp(3,3)

!  Obtain the required matrix (discarding others).
call BP00 ( date1, date2, rb, rp, rbp )

end subroutine PMAT00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PMAT06 ( date1, date2, rbp )
!>
!  Precession matrix (including frame bias) from GCRS to a specified
!  date, IAU 2006 model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RBP         d(3,3)    bias-precession matrix (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the arguments DATE1 and DATE2.  For
!     example, JD(TT)=2450123.7 could be expressed in any of these
!     ways, among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(date) = RBP * V(GCRS), where
!     the p-vector V(GCRS) is with respect to the Geocentric Celestial
!     Reference System (IAU, 2000) and the p-vector V(date) is with
!     respect to the mean equatorial triad of the given date.
!
!  Called:
!     PFW06    bias-precession F-W angles, IAU 2006
!     FW2M     F-W angles to r-matrix
!
!  References:
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2009 December 21
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rbp(3,3)

double precision gamb, phib, psib, epsa

!  Bias-precession Fukushima-Williams angles.
call PFW06 ( date1, date2, gamb, phib, psib, epsa )

!  Form the matrix.
call FW2M ( gamb, phib, psib, epsa, rbp )

end subroutine PMAT06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PMAT76 ( date1, date2, rmatp )
!>
!  Precession matrix from J2000.0 to a specified date, IAU 1976 model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       ending date, TT (Note 1)
!
!  Returned:
!     RMATP          d(3,3)  precession matrix, J2000.0 -> DATE1+DATE2
!
!  Notes:
!
!  1) The ending date DATE1+DATE2 is a Julian Date, apportioned
!     in any convenient way between the arguments DATE1 and DATE2.
!     For example, JD(TT)=2450123.7 could be expressed in any of
!     these ways, among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(date) = RMATP * V(J2000),
!     where the p-vector V(J2000) is with respect to the mean
!     equatorial triad of epoch J2000.0 and the p-vector V(date)
!     is with respect to the mean equatorial triad of the given
!     date.
!
!  3) Though the matrix method itself is rigorous, the precession
!     angles are expressed through canonical polynomials which are
!     valid only for a limited time span.  In addition, the IAU 1976
!     precession rate is known to be imperfect.  The absolute accuracy
!     of the present formulation is better than 0.1 arcsec from
!     1960AD to 2040AD, better than 1 arcsec from 1640AD to 2360AD,
!     and remains below 3 arcsec for the whole of the period
!     500BC to 3000AD.  The errors exceed 10 arcsec outside the
!     range 1200BC to 3900AD, exceed 100 arcsec outside 4200BC to
!     5600AD and exceed 1000 arcsec outside 6800BC to 8200AD.
!
!  Called:
!     PREC76   accumulated precession angles, IAU 1976
!     IR       initialize r-matrix to identity
!     RZ       rotate around Z-axis
!     RY       rotate around Y-axis
!     CR       copy r-matrix
!
!  References:
!
!     Lieske, J.H., 1979, Astron.Astrophys. 73, 282.
!      equations (6) & (7), p283.
!
!     Kaplan, G.H., 1981, USNO circular no. 163, pA2.
!
!  This revision:  2009 December 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rmatp(3,3)

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

double precision zeta, z, theta, wmat(3,3)

!  Precession Euler angles, J2000.0 to specified date.
call PREC76 ( dj00, 0d0, date1, date2, zeta, z, theta )

!  Form the rotation matrix.
call IR ( wmat )
call RZ ( -zeta, wmat )
call RY ( theta, wmat )
call RZ ( -z, wmat )
call CR ( wmat, rmatp )

end subroutine PMAT76
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PMP ( a, b, amb )
!>
!  P-vector subtraction.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3)      first p-vector
!     B        d(3)      second p-vector
!
!  Returned:
!     AMB      d(3)      A - B
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision a(3), b(3), amb(3)

integer i

do 1 i=1,3
   amb(i) = a(i) - b(i)
1 continue

end subroutine PMP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PMPX ( rc, dc, pr, pd, px, rv, pmt, pob, pco )
!>
!  Proper motion and parallax.
!
!  Status:  support routine.
!
!  Given:
!     RC,DC    d      ICRS RA,Dec at catalog epoch (radians)
!     PR       d      RA proper motion (radians/year; Note 1)
!     PD       d      Dec proper motion (radians/year)
!     PX       d      parallax (arcsec)
!     RV       d      radial velocity (km/s, +ve if receding)
!     PMT      d      proper motion time interval (SSB, Julian years)
!     POB      d(3)   SSB to observer vector (au)
!
!  Returned:
!     PCO      d(3)   coordinate direction (BCRS unit vector)
!
!  Notes:
!
!  1) The proper motion in RA is dRA/dt rather than cos(Dec)*dRA/dt.
!
!  2) The proper motion time interval is for when the starlight
!     reaches the solar system barycenter.
!
!  3) To avoid the need for iteration, the Roemer effect (i.e. the
!     small annual modulation of the proper motion coming from the
!     changing light time) is applied approximately, using the
!     direction of the star at the catalog epoch.
!
!  References:
!
!     1984 Astronomical Almanac, pp B39-B41.
!
!     Urban, S. & Seidelmann, P. K. (eds), Explanatory Supplement to
!     the Astronomical Almanac, 3rd ed., University Science Books
!     (2013), Section 7.2.
!
!  Called:
!     PDP      scalar product of two p-vectors
!     PN       decompose p-vector into modulus and direction
!
!  This revision:   2017 March 11
!
!-----------------------------------------------------------------------

implicit none
double precision rc, dc, pr, pd, px, rv, pmt, pob(3), pco(3)

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

!  Days per Julian year
double precision djy
parameter ( djy = 365.25d0 )

!  Days per Julian millennium
double precision djm
parameter ( djm = 365250d0 )

!  Speed of light (m/s)
double precision cmps
parameter ( cmps = 299792458d0 )

!  Astronomical unit (m, IAU 2012)
double precision aum
parameter ( aum = 149597870.7d3 )

!  Light time for 1 au, Julian years
double precision aulty
parameter ( aulty = aum/cmps/d2s/djy )

!  Km/s to au/year
double precision vf
parameter ( vf = d2s*djm/aum )

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

integer i
double precision sr, cr, sd, cd, x, y, z, p(3), pdb, &
                 dt, pxr, w, pdz, pm(3)

!  Catalog spherical coordinates to unit vector (and useful functions).
sr = sin(rc)
cr = cos(rc)
sd = sin(dc)
cd = cos(dc)
x = cr*cd
y = sr*cd
z = sd
p(1) = x
p(2) = y
p(3) = z

!  Component of observer vector in star direction.
call PDP ( p, pob, pdb )

!  Proper motion time interval (y), including Roemer effect.
dt = pmt + pdb*aulty

!  Space motion (radians per year).
pxr = px*das2r
w = vf*rv*pxr
pdz = pd*z
pm(1) = - pr*y - pdz*cr + w*x
pm(2) =   pr*x - pdz*sr + w*y
pm(3) =          pd*cd  + w*z

!  Coordinate direction of star (unit vector, BCRS).
do 1 i=1,3
   p(i) = p(i) + dt*pm(i) - pxr*pob(i)
1 continue
call PN ( p, w, pco )

end subroutine PMPX
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PMSAFE ( ra1, dec1, pmr1, pmd1, px1, rv1, &
                        ep1a, ep1b, ep2a, ep2b, &
                        ra2, dec2, pmr2, pmd2, px2, rv2, j )
!>
!  Star proper motion:  update star catalog data for space motion, with
!  special handling to handle the zero parallax case.
!
!  Status:  support routine.
!
!  Given:
!     RA1      d         right ascension (radians), before
!     DEC1     d         declination (radians), before
!     PMR1     d         RA proper motion (radians/year), before
!     PMD1     d         Dec proper motion (radians/year), before
!     PX1      d         parallax (arcseconds), before
!     RV1      d         radial velocity (km/s, +ve = receding), before
!     EP1A     d         "before" epoch, part A (Note 1)
!     EP1B     d         "before" epoch, part B (Note 1)
!     EP2A     d         "after" epoch, part A (Note 1)
!     EP2B     d         "after" epoch, part B (Note 1)
!
!  Returned:
!     RA2      d         right ascension (radians), after
!     DEC2     d         declination (radians), after
!     PMR2     d         RA proper motion (radians/year), after
!     PMD2     d         Dec proper motion (radians/year), after
!     PX2      d         parallax (arcseconds), after
!     RV2      d         radial velocity (km/s, +ve = receding), after
!     J        i         status:
!                          -1 = system error (should not occur)
!                           0 = no warnings or errors
!                           1 = distance overridden (Note 6)
!                           2 = excessive velocity (Note 7)
!                           4 = solution didn't converge (Note 8)
!                        else = binary logical OR of the above warnings
!
!  Notes:
!
!  1) The starting and ending TDB epochs EP1A+EP1B and EP2A+EP2B are
!     Julian Dates, apportioned in any convenient way between the two
!     parts (A and B).  For example, JD(TDB)=2450123.7 could be
!     expressed in any of these ways, among others:
!
!             EPnA          EPnB
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     resolution.  The MJD method and the date & time methods are both
!     good compromises between resolution and convenience.
!
!  2) In accordance with normal star-catalog conventions, the object's
!     right ascension and declination are freed from the effects of
!     secular aberration.  The frame, which is aligned to the catalog
!     equator and equinox, is Lorentzian and centered on the SSB.
!
!     The proper motions are the rate of change of the right ascension
!     and declination at the catalog epoch and are in radians per TDB
!     Julian year.
!
!     The parallax and radial velocity are in the same frame.
!
!  3) Care is needed with units.  The star coordinates are in radians
!     and the proper motions in radians per Julian year, but the
!     parallax is in arcseconds.
!
!  4) The RA proper motion is in terms of coordinate angle, not true
!     angle.  If the catalog uses arcseconds for both RA and Dec proper
!     motions, the RA proper motion will need to be divided by cos(Dec)
!     before use.
!
!  5) Straight-line motion at constant speed, in the inertial frame, is
!     assumed.
!
!  6) An extremely small (or zero or negative) parallax is overridden to
!     ensure that the object is at a finite but very large distance, but
!     not so large that the proper motion is equivalent to a large but
!     safe speed (about 0.1c using the chosen constant).  A warning
!     status of 1 is added to the status if this action has been taken.
!
!  7) If the space velocity is a significant fraction of c (see the
!     constant VMAX in the routine STARPV), it is arbitrarily set to
!     zero.  When this action occurs, 2 is added to the status.
!
!  8) The relativistic adjustment carried out in the STARPV routine
!     involves an iterative calculation.  If the process fails to
!     converge within a set number of iterations, 4 is added to the
!     status.
!
!  Called:
!     SEPS     angle between two points
!     STARPM   update star catalog data for space motion
!
!  This revision:   2013 June 6
!
!-----------------------------------------------------------------------

implicit none
double precision ra1, dec1, pmr1, pmd1, px1, rv1, &
                 ep1a, ep1b, ep2a, ep2b, &
                 ra2, dec2, pmr2, pmd2, px2, rv2
integer j

!  Minimum allowed parallax (arcsec)
double precision pxmin
parameter ( pxmin = 5d-7 )

!  Factor giving maximum allowed transverse speed of about 1% c
double precision f
parameter ( f = 326d0 )

integer jpx
double precision pm, px1a

!  Proper motion in one year (radians).
call SEPS ( ra1, dec1, ra1+pmr1, dec1+pmd1, pm )

!  Override the parallax to reduce the chances of a warning status.
jpx = 0
px1a = px1
pm = pm * f
if ( px1a < pm ) then
   jpx = 1
   px1a = pm
end if
if ( px1a < pxmin ) then
   jpx = 1
   px1a = pxmin
end if

!  Carry out the transformation using the modified parallax.
call STARPM ( ra1, dec1, pmr1, pmd1, px1a, rv1, &
                  ep1a, ep1b, ep2a, ep2b, &
                  ra2, dec2, pmr2, pmd2, px2, rv2, j )

!  Revise the status.
if ( mod(j,2) == 0 ) j = j + jpx

end subroutine PMSAFE
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PN ( p, r, u )
!>
!  Convert a p-vector into modulus and unit vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     P        d(3)      p-vector
!
!  Returned:
!     R        d         modulus
!     U        d(3)      unit vector
!
!  Note:
!     If P is null, the result is null.  Otherwise the result is
!     a unit vector.
!
!  Called:
!     PM       modulus of p-vector
!     ZP       zero p-vector
!     SXP      multiply p-vector by scalar
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision p(3), r, u(3)

double precision w

!  Obtain the modulus and test for zero.
call PM ( p, w )
if ( w == 0d0 ) then

!     Null vector.
   call ZP ( u )
else

!     Unit vector.
   call SXP ( 1d0/w, p, u )
end if

!  Return the modulus.
r = w

end subroutine PN
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PN00 ( date1, date2, dpsi, deps, &
                      epsa, rb, rp, rbp, rn, rbpn )
!>
!  Precession-nutation, IAU 2000 model:  a multi-purpose routine,
!  supporting classical (equinox-based) use directly and CIO-based
!  use indirectly.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d       TT as a 2-part Julian Date (Note 1)
!     DPSI,DEPS     d       nutation (Note 2)
!
!  Returned:
!     EPSA          d       mean obliquity (Note 3)
!     RB          d(3,3)    frame bias matrix (Note 4)
!     RP          d(3,3)    precession matrix (Note 5)
!     RBP         d(3,3)    bias-precession matrix (Note 6)
!     RN          d(3,3)    nutation matrix (Note 7)
!     RBPN        d(3,3)    GCRS-to-true matrix (Note 8)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The caller is responsible for providing the nutation components;
!     they are in longitude and obliquity, in radians and are with
!     respect to the equinox and ecliptic of date.  For high-accuracy
!     applications, free core nutation should be included as well as
!     any other relevant corrections to the position of the CIP.
!
!  3) The returned mean obliquity is consistent with the IAU 2000
!     precession-nutation models.
!
!  4) The matrix RB transforms vectors from GCRS to J2000.0 mean equator
!     and equinox by applying frame bias.
!
!  5) The matrix RP transforms vectors from J2000.0 mean equator and
!     equinox to mean equator and equinox of date by applying
!     precession.
!
!  6) The matrix RBP transforms vectors from GCRS to mean equator and
!     equinox of date by applying frame bias then precession.  It is the
!     product RP x RB.
!
!  7) The matrix RN transforms vectors from mean equator and equinox of
!     date to true equator and equinox of date by applying the nutation
!     (luni-solar + planetary).
!
!  8) The matrix RBPN transforms vectors from GCRS to true equator and
!     equinox of date.  It is the product RN x RBP, applying frame bias,
!     precession and nutation in that order.
!
!  Called:
!     PR00     IAU 2000 precession adjustments
!     OBL80    mean obliquity, IAU 1980
!     BP00     frame bias and precession matrices, IAU 2000
!     NUMAT    form nutation matrix
!     RXR      product of two r-matrices
!
!  Reference:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsi, deps, &
                 epsa, rb(3,3), rp(3,3), rbp(3,3), &
                 rn(3,3), rbpn(3,3)

double precision dpsipr, depspr

!     DOUBLE PRECISION OBL80

!  IAU 2000 precession-rate adjustments.
call PR00 ( date1, date2, dpsipr, depspr )

!  Mean obliquity, consistent with IAU 2000 precession-nutation.
epsa = OBL80 ( date1, date2 ) + depspr

!  Frame bias and precession matrices and their product.
call BP00 ( date1, date2, rb, rp, rbp )

!  Nutation matrix.
call NUMAT ( epsa, dpsi, deps, rn )

!  Bias-precession-nutation matrix (classical).
call RXR ( rn, rbp, rbpn )

end subroutine PN00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PN00A ( date1, date2, &
                       dpsi, deps, epsa, rb, rp, rbp, rn, rbpn )
!>
!  Precession-nutation, IAU 2000A model:  a multi-purpose routine,
!  supporting classical (equinox-based) use directly and CIO-based
!  use indirectly.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     DPSI,DEPS     d       nutation (Note 2)
!     EPSA          d       mean obliquity (Note 3)
!     RB          d(3,3)    frame bias matrix (Note 4)
!     RP          d(3,3)    precession matrix (Note 5)
!     RBP         d(3,3)    bias-precession matrix (Note 6)
!     RN          d(3,3)    nutation matrix (Note 7)
!     RBPN        d(3,3)    GCRS-to-true matrix (Notes 8,9)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The nutation components (luni-solar + planetary, IAU 2000A) in
!     longitude and obliquity are in radians and with respect to the
!     equinox and ecliptic of date.  Free core nutation is omitted;  for
!     the utmost accuracy, use the PN00 routine, where the nutation
!     components are caller-specified.  For faster but slightly less
!     accurate results, use the PN00B routine.
!
!  3) The mean obliquity is consistent with the IAU 2000 precession.
!
!  4) The matrix RB transforms vectors from GCRS to J2000.0 mean equator
!     and equinox by applying frame bias.
!
!  5) The matrix RP transforms vectors from J2000.0 mean equator and
!     equinox to mean equator and equinox of date by applying
!     precession.
!
!  6) The matrix RBP transforms vectors from GCRS to mean equator and
!     equinox of date by applying frame bias then precession.  It is the
!     product RP x RB.
!
!  7) The matrix RN transforms vectors from mean equator and equinox of
!     date to true equator and equinox of date by applying the nutation
!     (luni-solar + planetary).
!
!  8) The matrix RBPN transforms vectors from GCRS to true equator and
!     equinox of date.  It is the product RN x RBP, applying frame bias,
!     precession and nutation in that order.
!
!  9) The X,Y,Z coordinates of the IAU 2000A Celestial Intermediate Pole
!     are elements (3,1-3) of the matrix RBPN.
!
!  Called:
!     NUT00A   nutation, IAU 2000A
!     PN00     bias/precession/nutation results, IAU 2000
!
!  Reference:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003).
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsi, deps, epsa, &
                 rb(3,3), rp(3,3), rbp(3,3), rn(3,3), rbpn(3,3)

!  Nutation.
call NUT00A ( date1, date2, dpsi, deps )

!  Remaining results.
call PN00 ( date1, date2, dpsi, deps, &
                epsa, rb, rp, rbp, rn, rbpn )

end subroutine PN00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PN00B ( date1, date2, &
                       dpsi, deps, epsa, rb, rp, rbp, rn, rbpn )
!>
!  Precession-nutation, IAU 2000B model:  a multi-purpose routine,
!  supporting classical (equinox-based) use directly and CIO-based
!  use indirectly.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     DPSI,DEPS     d       nutation (Note 2)
!     EPSA          d       mean obliquity (Note 3)
!     RB          d(3,3)    frame bias matrix (Note 4)
!     RP          d(3,3)    precession matrix (Note 5)
!     RBP         d(3,3)    bias-precession matrix (Note 6)
!     RN          d(3,3)    nutation matrix (Note 7)
!     RBPN        d(3,3)    GCRS-to-true matrix (Notes 8,9)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The nutation components (luni-solar + planetary, IAU 2000B) in
!     longitude and obliquity are in radians and with respect to the
!     equinox and ecliptic of date.  For more accurate results, but
!     at the cost of increased computation, use the PN00A routine.
!     For the utmost accuracy, use the PN00 routine, where the
!     nutation components are caller-specified.
!
!  3) The mean obliquity is consistent with the IAU 2000 precession.
!
!  4) The matrix RB transforms vectors from GCRS to J2000.0 mean equator
!     and equinox by applying frame bias.
!
!  5) The matrix RP transforms vectors from J2000.0 mean equator and
!     equinox to mean equator and equinox of date by applying
!     precession.
!
!  6) The matrix RBP transforms vectors from GCRS to mean equator and
!     equinox of date by applying frame bias then precession.  It is the
!     product RP x RB.
!
!  7) The matrix RN transforms vectors from mean equator and equinox of
!     date to true equator and equinox of date by applying the nutation
!     (luni-solar + planetary).
!
!  8) The matrix RBPN transforms vectors from GCRS to true equator and
!     equinox of date.  It is the product RN x RBP, applying frame bias,
!     precession and nutation in that order.
!
!  9) The X,Y,Z coordinates of the IAU 2000B Celestial Intermediate Pole
!     are elements (3,1-3) of the matrix RBPN.
!
!  Called:
!     NUT00B   nutation, IAU 2000B
!     PN00     bias/precession/nutation results, IAU 2000
!
!  Reference:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003).
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsi, deps, epsa, &
                 rb(3,3), rp(3,3), rbp(3,3), rn(3,3), rbpn(3,3)

!  Nutation.
call NUT00B ( date1, date2, dpsi, deps )

!  Remaining results.
call PN00 ( date1, date2, dpsi, deps, &
                epsa, rb, rp, rbp, rn, rbpn )

end subroutine PN00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PN06 ( date1, date2, dpsi, deps, &
                      epsa, rb, rp, rbp, rn, rbpn )
!>
!  Precession-nutation, IAU 2006 model:  a multi-purpose routine,
!  supporting classical (equinox-based) use directly and CIO-based use
!  indirectly.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d       TT as a 2-part Julian Date (Note 1)
!     DPSI,DEPS     d       nutation (Note 2)
!
!  Returned:
!     EPSA          d       mean obliquity (Note 3)
!     RB          d(3,3)    frame bias matrix (Note 4)
!     RP          d(3,3)    precession matrix (Note 5)
!     RBP         d(3,3)    bias-precession matrix (Note 6)
!     RN          d(3,3)    nutation matrix (Note 7)
!     RBPN        d(3,3)    GCRS-to-true matrix (Note 8)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The caller is responsible for providing the nutation components;
!     they are in longitude and obliquity, in radians and are with
!     respect to the equinox and ecliptic of date.  For high-accuracy
!     applications, free core nutation should be included as well as
!     any other relevant corrections to the position of the CIP.
!
!  3) The returned mean obliquity is consistent with the IAU 2006
!     precession.
!
!  4) The matrix RB transforms vectors from GCRS to mean J2000.0 by
!     applying frame bias.
!
!  5) The matrix RP transforms vectors from mean J2000.0 to mean of date
!     by applying precession.
!
!  6) The matrix RBP transforms vectors from GCRS to mean of date by
!     applying frame bias then precession.  It is the product RP x RB.
!
!  7) The matrix RN transforms vectors from mean of date to true of date
!     by applying the nutation (luni-solar + planetary).
!
!  8) The matrix RBPN transforms vectors from GCRS to true of date
!     (CIP/equinox).  It is the product RN x RBP, applying frame bias,
!     precession and nutation in that order.
!
!  9) The X,Y,Z coordinates of the Celestial Intermediate Pole are
!     elements (3,1-3) of the matrix RBPN.
!
!  Called:
!     PFW06    bias-precession F-W angles, IAU 2006
!     FW2M     F-W angles to r-matrix
!     TR       transpose r-matrix
!     RXR      product of two r-matrices
!
!  References:
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2013 November 14
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsi, deps, &
                 epsa, rb(3,3), rp(3,3), rbp(3,3), &
                 rn(3,3), rbpn(3,3)

!  JD for MJD 0
double precision djm0
parameter (djm0 = 2400000.5d0 )

!  Reference epoch (J2000.0), MJD
double precision djm00
parameter ( djm00 = 51544.5d0 )

double precision gamb, phib, psib, eps, rt(3,3)

!  Bias-precession Fukushima-Williams angles of J2000.0 = frame bias.
call PFW06 ( djm0, djm00, gamb, phib, psib, eps )

!  B matrix.
call FW2M ( gamb, phib, psib, eps, rb )

!  Bias-precession Fukushima-Williams angles of date.
call PFW06 ( date1, date2, gamb, phib, psib, eps )

!  Bias-precession matrix.
call FW2M ( gamb, phib, psib, eps, rbp )

!  Solve for precession matrix.
call TR ( rb, rt )
call RXR ( rbp, rt, rp )

!  Equinox-based bias-precession-nutation matrix.
call FW2M ( gamb, phib, psib+dpsi, eps+deps, rbpn )

!  Solve for nutation matrix.
call TR ( rbp, rt )
call RXR ( rbpn, rt, rn )

!  Obliquity, mean of date.
epsa = eps

end subroutine PN06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PN06A ( date1, date2, &
                       dpsi, deps, epsa, rb, rp, rbp, rn, rbpn )
!>
!  Precession-nutation, IAU 2006/2000A models:  a multi-purpose routine,
!  supporting classical (equinox-based) use directly and CIO-based use
!  indirectly.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     DPSI,DEPS     d       nutation (Note 2)
!     EPSA          d       mean obliquity (Note 3)
!     RB          d(3,3)    frame bias matrix (Note 4)
!     RP          d(3,3)    precession matrix (Note 5)
!     RBP         d(3,3)    bias-precession matrix (Note 6)
!     RN          d(3,3)    nutation matrix (Note 7)
!     RBPN        d(3,3)    GCRS-to-true matrix (Notes 8,9)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The nutation components (luni-solar + planetary, IAU 2000A) in
!     longitude and obliquity are in radians and with respect to the
!     equinox and ecliptic of date.  Free core nutation is omitted;  for
!     the utmost accuracy, use the PN06 routine, where the nutation
!     components are caller-specified.
!
!  3) The mean obliquity is consistent with the IAU 2006 precession.
!
!  4) The matrix RB transforms vectors from GCRS to mean J2000.0 by
!     applying frame bias.
!
!  5) The matrix RP transforms vectors from mean J2000.0 to mean of date
!     by applying precession.
!
!  6) The matrix RBP transforms vectors from GCRS to mean of date by
!     applying frame bias then precession.  It is the product RP x RB.
!
!  7) The matrix RN transforms vectors from mean of date to true of date
!     by applying the nutation (luni-solar + planetary).
!
!  8) The matrix RBPN transforms vectors from GCRS to true of date
!     (CIP/equinox).  It is the product RN x RBP, applying frame bias,
!     precession and nutation in that order.
!
!  9) The X,Y,Z coordinates of the IAU 2006/2000A Celestial Intermediate
!     Pole are elements (3,1-3) of the matrix RBPN.
!
!  Called:
!     NUT06A   nutation, IAU 2006/2000A
!     PN06     bias/precession/nutation results, IAU 2006
!
!  Reference:
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsi, deps, epsa, &
                 rb(3,3), rp(3,3), rbp(3,3), rn(3,3), rbpn(3,3)

!  Nutation.
call NUT06A ( date1, date2, dpsi, deps )

!  Remaining results.
call PN06 ( date1, date2, dpsi, deps, &
                epsa, rb, rp, rbp, rn, rbpn )

end subroutine PN06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PNM00A ( date1, date2, rbpn )
!>
!  Form the matrix of precession-nutation for a given date (including
!  frame bias), equinox-based, IAU 2000A model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RBPN         d(3,3)    classical NPB matrix (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(date) = RBPN * V(GCRS), where
!     the p-vector V(date) is with respect to the true equatorial triad
!     of date DATE1+DATE2 and the p-vector V(GCRS) is with respect to
!     the Geocentric Celestial Reference System (IAU, 2000).
!
!  3) A faster, but slightly less accurate result (about 1 mas), can be
!     obtained by using instead the PNM00B routine.
!
!  Called:
!     PN00A    bias/precession/nutation, IAU 2000A
!
!  Reference:
!
!     IAU: Trans. International Astronomical Union, Vol. XXIVB;  Proc.
!     24th General Assembly, Manchester, UK.  Resolutions B1.3, B1.6.
!     (2000)
!
!  This revision:  2009 December 21
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rbpn(3,3)

double precision dpsi, deps, epsa, rb(3,3), rp(3,3), rbp(3,3), &
                 rn(3,3)

!  Obtain the required matrix (discarding other results).
call PN00A ( date1, date2, &
                 dpsi, deps, epsa, rb, rp, rbp, rn, rbpn )

end subroutine PNM00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PNM00B ( date1, date2, rbpn )
!>
!  Form the matrix of precession-nutation for a given date (including
!  frame bias), equinox-based, IAU 2000B model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RBPN         d(3,3)    bias-precession-nutation matrix (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(date) = RBPN * V(GCRS), where
!     the p-vector V(date) is with respect to the true equatorial triad
!     of date DATE1+DATE2 and the p-vector V(GCRS) is with respect to
!     the Geocentric Celestial Reference System (IAU, 2000).
!
!  3) The present routine is faster, but slightly less accurate (about
!     1 mas), than the PNM00A routine.
!
!  Called:
!     PN00B    bias/precession/nutation, IAU 2000B
!
!  Reference:
!
!     IAU: Trans. International Astronomical Union, Vol. XXIVB;  Proc.
!     24th General Assembly, Manchester, UK.  Resolutions B1.3, B1.6.
!     (2000)
!
!  This revision:  2009 December 21
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rbpn(3,3)

double precision  dpsi, deps, epsa, &
                  rb(3,3), rp(3,3), rbp(3,3), rn(3,3)

!  Obtain the required matrix (discarding other results).
call PN00B ( date1, date2, &
                 dpsi, deps, epsa, rb, rp, rbp, rn, rbpn )

end subroutine PNM00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PNM06A ( date1, date2, rnpb )
!>
!  Form the matrix of precession-nutation for a given date (including
!  frame bias), IAU 2006 precession and IAU 2000A nutation models.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     RNPB         d(3,3)    bias-precession-nutation matrix (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(date) = RNPB * V(GCRS), where
!     the p-vector V(date) is with respect to the true equatorial triad
!     of date DATE1+DATE2 and the p-vector V(GCRS) is with respect to
!     the Geocentric Celestial Reference System (IAU, 2000).
!
!  Called:
!     PFW06    bias-precession F-W angles, IAU 2006
!     NUT06A   nutation, IAU 2006/2000A
!     FW2M     F-W angles to r-matrix
!
!  Reference:
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855.
!
!  This revision:  2009 December 21
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rnpb(3,3)

double precision gamb, phib, psib, epsa, dp, de

!  Fukushima-Williams angles for frame bias and precession.
call PFW06 ( date1, date2, gamb, phib, psib, epsa )

!  Nutation components.
call NUT06A ( date1, date2, dp, de )

!  Equinox based nutation x precession x bias matrix.
call FW2M ( gamb, phib, psib+dp, epsa+de, rnpb )

end subroutine PNM06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PNM80 ( date1, date2, rmatpn )
!>
!  Form the matrix of precession/nutation for a given date, IAU 1976
!  precession model, IAU 1980 nutation model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2     d         TDB date (Note 1)
!
!  Returned:
!     RMATPN          d(3,3)    combined precession/nutation matrix
!
!  Notes:
!
!  1) The TDB date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TDB)=2450123.7 could be expressed in any of these ways, among
!     others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The matrix operates in the sense V(date) = RMATPN * V(J2000),
!     where the p-vector V(date) is with respect to the true
!     equatorial triad of date DATE1+DATE2 and the p-vector
!     V(J2000) is with respect to the mean equatorial triad of
!     epoch J2000.0.
!
!  Called:
!     PMAT76   precession matrix, IAU 1976
!     NUTM80   nutation matrix, IAU 1980
!     RXR      product of two r-matrices
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992),
!     Section 3.3 (p145).
!
!  This revision:  2012 September 5
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, rmatpn(3,3)

double precision rmatp(3,3), rmatn(3,3)

!  Precession matrix, J2000.0 to date.
call PMAT76 ( date1, date2, rmatp )

!  Nutation matrix.
call NUTM80 ( date1, date2, rmatn )

!  Combine the matrices:  PN = N x P.
call RXR ( rmatn, rmatp, rmatpn )

end subroutine PNM80
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine POM00 ( xp, yp, sp, rpom )
!>
!  Form the matrix of polar motion for a given date, IAU 2000.
!
!  Status:  support routine.
!
!  Given:
!     XP,YP      d      coordinates of the pole (radians, Note 1)
!     SP         d      the TIO locator s' (radians, Note 2)
!
!  Returned:
!     RPOM     d(3,3)   polar-motion matrix (Note 3)
!
!  Notes:
!
!  1) XP and YP are the coordinates (in radians) of the Celestial
!     Intermediate Pole with respect to the International Terrestrial
!     Reference System (see IERS Conventions 2003), measured along the
!     meridians to 0 and 90 deg west respectively.
!
!  2) SP is the TIO locator s', in radians, which positions the
!     Terrestrial Intermediate Origin on the equator.  It is obtained
!     from polar motion observations by numerical integration, and so is
!     in essence unpredictable.  However, it is dominated by a secular
!     drift of about 47 microarcseconds per century, and so can be taken
!     into account by using s' = -47*t, where t is centuries since
!     J2000.0.  The routine SP00 implements this approximation.
!
!  3) The matrix operates in the sense V(TRS) = RPOM * V(CIP), meaning
!     that it is the final rotation when computing the pointing
!     direction to a celestial source.
!
!  Called:
!     IR       initialize r-matrix to identity
!     RZ       rotate around Z-axis
!     RY       rotate around Y-axis
!     RX       rotate around X-axis
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision xp, yp, sp, rpom(3,3)

!  Construct the matrix.
call IR ( rpom )
call RZ ( sp, rpom )
call RY ( -xp, rpom )
call RX ( -yp, rpom )

end subroutine POM00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PPP ( a, b, apb )
!>
!  P-vector addition.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3)      first p-vector
!     B        d(3)      second p-vector
!
!  Returned:
!     APB      d(3)      A + B
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision a(3), b(3), apb(3)

integer i

do 1 i=1,3
   apb(i) = a(i) + b(i)
1 continue

end subroutine PPP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PPSP ( a, s, b, apsb )
!>
!  P-vector plus scaled p-vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3)      first p-vector
!     S        d         scalar (multiplier for B)
!     B        d(3)      second p-vector
!
!  Returned:
!     APSB     d(3)      A + S*B
!
!  This revision:  2007 August 18
!
!-----------------------------------------------------------------------

implicit none

double precision a(3), s, b(3), apsb(3)

integer i

do 1 i=1,3
   apsb(i) = a(i) + s*b(i)
1 continue

end subroutine PPSP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PR00 ( date1, date2, dpsipr, depspr )
!>
!  Precession-rate part of the IAU 2000 precession-nutation models
!  (part of MHB2000).
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2    d   TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     DPSIPR,DEPSPR  d   precession corrections (Notes 2,3)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The precession adjustments are expressed as "nutation components",
!     corrections in longitude and obliquity with respect to the J2000.0
!     equinox and ecliptic.
!
!  3) Although the precession adjustments are stated to be with respect
!     to Lieske et al. (1977), the MHB2000 model does not specify which
!     set of Euler angles are to be used and how the adjustments are to
!     be applied.  The most literal and straightforward procedure is to
!     adopt the 4-rotation epsilon_0, psi_A, omega_A, xi_A option, and
!     to add DPSIPR to psi_A and DEPSPR to both omega_A and eps_A.
!
!  4) This is an implementation of one aspect of the IAU 2000A nutation
!     model, formally adopted by the IAU General Assembly in 2000,
!     namely MHB2000 (Mathews et al. 2002).
!
!  References:
!
!     Lieske, J.H., Lederle, T., Fricke, W. & Morando, B., "Expressions
!     for the precession quantities based upon the IAU (1976) System of
!     Astronomical Constants", Astron.Astrophys., 58, 1-16 (1977)
!
!     Mathews, P.M., Herring, T.A., Buffet, B.A., "Modeling of nutation
!     and precession   New nutation series for nonrigid Earth and
!     insights into the Earth's interior", J.Geophys.Res., 107, B4,
!     2002.  The MHB2000 code itself was obtained on 9th September 2002
!     from ftp://maia.usno.navy.mil/conv2000/chapter5/IAU2000A.
!
!     Wallace, P.T., "Software for Implementing the IAU 2000
!     Resolutions", in IERS Workshop 5.1 (2002).
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, dpsipr, depspr

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t

!  ------------------------------------
!  Precession and obliquity corrections (radians per century)
!  ------------------------------------

double precision precor, oblcor
parameter ( precor = -0.29965d0 * das2r, &
            oblcor = -0.02524d0 * das2r )

!  Interval between fundamental epoch J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Precession rate contributions with respect to IAU 1976/80.
dpsipr = precor * t
depspr = oblcor * t

end subroutine PR00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PREC76 ( date01, date02, date11, date12, &
                        zeta, z, theta )
!>
!  IAU 1976 precession model.
!
!  This routine forms the three Euler angles which implement general
!  precession between two dates, using the IAU 1976 model (as for
!  the FK5 catalog).
!
!  Status:  canonical model.
!
!  Given:
!     DATE01,DATE02  d   TDB starting date (Note 1)
!     DATE11,DATE12  d   TDB ending date (Note 1)
!
!  Returned:
!     ZETA           d   1st rotation: radians clockwise around z
!     Z              d   3rd rotation: radians clockwise around z
!     THETA          d   2nd rotation: radians counterclockwise around y
!
!  Notes:
!
!  1) The dates DATE01+DATE02 and DATE11+DATE12 are Julian Dates,
!     apportioned in any convenient way between the arguments DATEn1 and
!     DATEn2.  For example, JD(TDB)=2450123.7 could be expressed in any
!     of these ways, among others:
!
!           DATEn1         DATEn2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in cases
!     where the loss of several decimal digits of resolution is
!     acceptable.  The J2000 method is best matched to the way the
!     argument is handled internally and will deliver the optimum
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!     The two dates may be expressed using different methods, but at
!     the risk of losing some resolution.
!
!  2) The accumulated precession angles zeta, z, theta are expressed
!     through canonical polynomials which are valid only for a limited
!     time span.  In addition, the IAU 1976 precession rate is known to
!     be imperfect.  The absolute accuracy of the present formulation is
!     better than 0.1 arcsec from 1960AD to 2040AD, better than 1 arcsec
!     from 1640AD to 2360AD, and remains below 3 arcsec for the whole of
!     the period 500BC to 3000AD.  The errors exceed 10 arcsec outside
!     the range 1200BC to 3900AD, exceed 100 arcsec outside 4200BC to
!     5600AD and exceed 1000 arcsec outside 6800BC to 8200AD.
!
!  3) The three angles are returned in the conventional order, which
!     is not the same as the order of the corresponding Euler rotations.
!     The precession matrix is R_3(-z) x R_2(+theta) x R_3(-zeta).
!
!  Reference:
!
!     Lieske, J.H., 1979, Astron.Astrophys. 73, 282.
!      equations (6) & (7), p283.
!
!  This revision:  2013 November 19
!
!-----------------------------------------------------------------------

implicit none

double precision date01, date02, date11, date12, zeta, z, theta

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

double precision t0, t, tas2r, w

!  Interval between fundamental epoch J2000.0 and start date (JC).
t0 = ( ( date01-dj00 ) + date02 ) / djc

!  Interval over which precession required (JC).
t = ( ( date11-date01 ) + ( date12-date02 ) ) / djc

!  Euler angles.
tas2r = t * das2r
w = 2306.2181d0 + ( &
       1.39656d0 &
     - 0.000139d0 * t0 ) * t0

zeta = ( w + ( ( 0.30188d0 &
               - 0.000344d0 * t0 ) &
               + 0.017998d0 * t ) * t ) * tas2r

z = ( w + ( ( 1.09468d0 &
            + 0.000066d0 * t0 ) &
            + 0.018203d0 * t ) * t ) * tas2r

theta = ( ( 2004.3109d0 + ( &
             - 0.85330d0 &
             - 0.000217d0 * t0 ) * t0 ) + ( ( &
             - 0.42665d0 &
             - 0.000217d0 * t0 ) &
             - 0.041833d0 * t ) * t ) * tas2r

end subroutine PREC76
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PV2P ( pv, p )
!>
!  Discard velocity component of a pv-vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     PV       d(3,2)      pv-vector
!
!  Returned:
!     P        d(3)        p-vector
!
!  Called:
!     CP       copy p-vector
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision pv(3,2), p(3)

call CP ( pv, p )

end subroutine PV2P
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PV2S ( pv, theta, phi, r, td, pd, rd )
!>
!  Convert position/velocity from Cartesian to spherical coordinates.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     PV       d(3,2)    pv-vector
!
!  Returned:
!     THETA    d         longitude angle (radians)
!     PHI      d         latitude angle (radians)
!     R        d         radial distance
!     TD       d         rate of change of THETA
!     PD       d         rate of change of PHI
!     RD       d         rate of change of R
!
!  Notes:
!
!  1) If the position part of PV is null, THETA, PHI, TD and PD
!     are indeterminate.  This is handled by extrapolating the
!     position through unit time by using the velocity part of
!     PV.  This moves the origin without changing the direction
!     of the velocity component.  If the position and velocity
!     components of PV are both null, zeroes are returned for all
!     six results.
!
!  2) If the position is a pole, THETA, TD and PD are indeterminate.
!     In such cases zeroes are returned for all three.
!
!  This revision:  2008 May 10
!
!-----------------------------------------------------------------------

implicit none

double precision pv(3,2), theta, phi, r, td, pd, rd

double precision x, y, z, xd, yd, zd, rxy2, rxy, r2, &
                 rtrue, rw, xyp

!  Components of position/velocity vector.
x =  pv(1,1)
y =  pv(2,1)
z =  pv(3,1)
xd = pv(1,2)
yd = pv(2,2)
zd = pv(3,2)

!  Component of R in XY plane squared.
rxy2 = x*x + y*y

!  Modulus squared.
r2 = rxy2 + z*z

!  Modulus.
rtrue = sqrt(r2)

!  If null vector, move the origin along the direction of movement.
rw = rtrue
if ( rtrue == 0d0 ) then
   x = xd
   y = yd
   z = zd
   rxy2 = x*x + y*y
   r2 = rxy2 + z*z
   rw = sqrt(r2)
end if

!  Position and velocity in spherical coordinates.
rxy = sqrt(rxy2)
xyp = x*xd + y*yd
if ( rxy2 /= 0d0 ) then
   theta = atan2(y,x)
   phi = atan2(z,rxy)
   td = ( x*yd - y*xd ) / rxy2
   pd = ( zd*rxy2 - z*xyp ) / ( r2*rxy )
else
   theta = 0d0
   if ( z/=0d0 ) then
      phi = atan2(z,rxy)
   else
      phi = 0d0
   end if
   td = 0d0
   pd = 0d0
end if
r = rtrue
if ( rw/=0d0 ) then
   rd = ( xyp + z*zd ) / rw
else
   rd = 0d0
end if

end subroutine PV2S
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PVDPV ( a, b, adb )
!>
!  Inner (=scalar=dot) product of two pv-vectors.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3,2)      first pv-vector
!     B        d(3,2)      second pv-vector
!
!  Returned:
!     ADB      d(2)        A . B (see note)
!
!  Note:
!
!     If the position and velocity components of the two pv-vectors are
!     ( Ap, Av ) and ( Bp, Bv ), the result, A . B, is the pair of
!     numbers ( Ap . Bp , Ap . Bv + Av . Bp ).  The two numbers are the
!     dot-product of the two p-vectors and its derivative.
!
!  Called:
!     PDP      scalar product of two p-vectors
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision a(3,2), b(3,2), adb(2)

double precision adbd, addb

!  A . B = constant part of result.
call PDP ( a(1,1), b(1,1), adb(1) )

!  A . Bdot
call PDP ( a(1,1), b(1,2), adbd )

!  Adot . B
call PDP ( a(1,2), b(1,1), addb )

!  Velocity part of result.
adb(2) = adbd + addb

end subroutine PVDPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PVM ( pv, r, s )
!>
!  Modulus of pv-vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     PV       d(3,2)    pv-vector
!
!  Returned:
!     R        d         modulus of position component
!     S        d         modulus of velocity component
!
!  Called:
!     PM       modulus of p-vector
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision pv(3,2), r, s

!  Distance.
call PM ( pv(1,1), r )

!  Speed.
call PM ( pv(1,2), s )

end subroutine PVM
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PVMPV ( a, b, amb )
!>
!  Subtract one pv-vector from another.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3,2)      first pv-vector
!     B        d(3,2)      second pv-vector
!
!  Returned:
!     AMB      d(3,2)      A - B
!
!  Called:
!     PMP      p-vector minus p-vector
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision a(3,2), b(3,2), amb(3,2)

integer i

do 1 i=1,2
   call PMP ( a(1,i), b(1,i), amb(1,i) )
1 continue

end subroutine PVMPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PVPPV ( a, b, apb )
!>
!  Add one pv-vector to another.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3,2)      first pv-vector
!     B        d(3,2)      second pv-vector
!
!  Returned:
!     APB      d(3,2)      A + B
!
!  Called:
!     PPP      p-vector plus p-vector
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision a(3,2), b(3,2), apb(3,2)

integer i

do 1 i=1,2
   call PPP ( a(1,i), b(1,i), apb(1,i) )
1 continue

end subroutine PVPPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PVSTAR ( pv, ra, dec, pmr, pmd, px, rv, j )
!>
!  Convert star position+velocity vector to catalog coordinates.
!
!  Status:  support routine.
!
!  Given (Note 1):
!     PV       d(3,2)    pv-vector (au, au/day)
!
!  Returned (Note 2):
!     RA       d         right ascension (radians)
!     DEC      d         declination (radians)
!     PMR      d         RA proper motion (radians/year)
!     PMD      d         Dec proper motion (radians/year)
!     PX       d         parallax (arcsec)
!     RV       d         radial velocity (km/s, positive = receding)
!     J        i         status:
!                           0 = OK
!                          -1 = superluminal speed (Note 5)
!                          -2 = null position vector
!
!  Notes:
!
!  1) The specified pv-vector is the coordinate direction (and its rate
!     of change) for the epoch at which the light leaving the star
!     reached the solar-system barycenter.
!
!  2) The star data returned by this routine are "observables" for an
!     imaginary observer at the solar-system barycenter.  Proper motion
!     and radial velocity are, strictly, in terms of barycentric
!     coordinate time, TCB.  For most practical applications, it is
!     permissible to neglect the distinction between TCB and ordinary
!     "proper" time on Earth (TT/TAI).  The result will, as a rule, be
!     limited by the intrinsic accuracy of the proper-motion and radial-
!     velocity data;  moreover, the supplied pv-vector is likely to be
!     merely an intermediate result (for example generated by the
!     routine STARPV), so that a change of time unit will cancel
!     out overall.
!
!     In accordance with normal star-catalog conventions, the object's
!     right ascension and declination are freed from the effects of
!     secular aberration.  The frame, which is aligned to the catalog
!     equator and equinox, is Lorentzian and centered on the SSB.
!
!     Summarizing, the specified pv-vector is for most stars almost
!     identical to the result of applying the standard geometrical
!     "space motion" transformation to the catalog data.  The
!     differences, which are the subject of the Stumpff paper cited
!     below, are:
!
!     (i) In stars with significant radial velocity and proper motion,
!     the constantly changing light-time distorts the apparent proper
!     motion.  Note that this is a classical, not a relativistic,
!     effect.
!
!     (ii) The transformation complies with special relativity.
!
!  3) Care is needed with units.  The star coordinates are in radians
!     and the proper motions in radians per Julian year, but the
!     parallax is in arcseconds; the radial velocity is in km/s, but
!     the pv-vector result is in au and au/day.
!
!  4) The proper motions are the rate of change of the right ascension
!     and declination at the catalog epoch and are in radians per Julian
!     year.  The RA proper motion is in terms of coordinate angle, not
!     true angle, and will thus be numerically larger at high
!     declinations.
!
!  5) Straight-line motion at constant speed in the inertial frame is
!     assumed.  If the speed is greater than or equal to the speed of
!     light, the routine aborts with an error status.
!
!  6) The inverse transformation is performed by the routine STARPV.
!
!  Called:
!     PN       decompose p-vector into modulus and direction
!     PDP      scalar product of two p-vectors
!     SXP      multiply p-vector by scalar
!     PMP      p-vector minus p-vector
!     PM       modulus of p-vector
!     PPP      p-vector plus p-vector
!     PV2S     pv-vector to spherical
!     ANP      normalize angle into range 0 to 2pi
!
!  Reference:
!
!     Stumpff, P., Astron.Astrophys. 144, 232-240 (1985).
!
!  This revision:  2017 March 16
!
!-----------------------------------------------------------------------

implicit none

double precision pv(3,2), ra, dec, pmr, pmd, px, rv
integer j

!  Julian years to days
double precision y2d
parameter ( y2d = 365.25d0 )

!  Radians to arcseconds
double precision dr2as
parameter ( dr2as = 206264.8062470963551564734d0 )

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

!  Speed of light (m/s)
double precision cmps
parameter ( cmps = 299792458d0 )

!  Astronomical unit (m, IAU 2012)
double precision aum
parameter ( aum = 149597870.7d3 )

!  Speed of light (au per day)
double precision c
parameter ( c = d2s*cmps/aum )

double precision r, x(3), vr, ur(3), vt, ut(3), bett, betr, d, w, &
                 del, usr(3), ust(3), a, rad, decd, rd
!     DOUBLE PRECISION ANP

!  Isolate the radial component of the velocity (au/day, inertial).
call PN ( pv(1,1), r, x )
call PDP ( x, pv(1,2), vr )
call SXP ( vr, x, ur )

!  Isolate the transverse component of the velocity (au/day, inertial).
call PMP ( pv(1,2), ur, ut )
call PM ( ut, vt )

!  Special-relativity dimensionless parameters.
bett = vt / c
betr = vr / c

!  The inertial-to-observed correction terms.
d = 1d0 + betr
w = betr*betr + bett*bett
if ( d==0d0 .or. w>=1d0 ) then
   j = -1
   go to 9
end if
del = - w / ( sqrt(1d0-w) + 1d0 )

!  Apply relativistic correction factor to radial velocity component.
if ( betr/=0d0 ) then
   w = ( betr-del ) / ( betr*d )
else
   w = 1d0
end if
call SXP ( w, ur, usr )

!  Apply relativistic correction factor to tangential velocity component.
call SXP ( 1d0/d, ut, ust )

!  Combine the two to obtain the observed velocity vector (au/day).
call PPP ( usr, ust, pv(1,2) )

!  Cartesian to spherical.
call PV2S ( pv, a, dec, r, rad, decd, rd )
if ( r == 0d0 ) then
   j = -2
   go to 9
end if

!  Return RA in range 0 to 2pi.
ra = ANP ( a )

!  Return proper motions in radians per year.
pmr = rad * y2d
pmd = decd * y2d

!  Return parallax in arcsec.
px = dr2as / r

!  Return radial velocity in km/s.
rv = 1d-3 * rd * aum / d2s

!  OK status.
j = 0

!  Exit.
9 continue

end subroutine PVSTAR
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PVTOB ( elong, phi, hm, xp, yp, sp, theta, pv )
!>
!  Position and velocity of a terrestrial observing station.
!
!  Status:  support routine.
!
!  Given:
!     ELONG      d       longitude (radians, east +ve, Note 1)
!     PHI        d       latitude (geodetic, radians, Note 1)
!     HM         d       height above reference ellipsoid (geodetic, m)
!     XP,YP      d       coordinates of the pole (radians, Note 2)
!     SP         d       the TIO locator s' (radians, Note 2)
!     THETA      d       Earth rotation angle (radians, Note 3)
!
!  Returned:
!     PV         d(3,2)  position/velocity vector (m, m/s, CIRS)
!
!  Notes:
!
!  1) The terrestrial coordinates are with respect to the WGS84
!     reference ellipsoid.
!
!  2) XP and YP are the coordinates (in radians) of the Celestial
!     Intermediate Pole with respect to the International Terrestrial
!     Reference System (see IERS Conventions 2003), measured along the
!     meridians 0 and 90 deg west respectively.  SP is the TIO locator
!     s', in radians, which positions the Terrestrial Intermediate
!     Origin on the equator.  For many applications, XP, YP and
!     (especially) SP can be set to zero.
!
!  3) If THETA is Greenwich apparent sidereal time instead of Earth
!     rotation angle, the result is with respect to the true equator
!     and equinox of date, i.e. with the x-axis at the equinox rather
!     than the celestial intermediate origin.
!
!  4) The velocity units are meters per UT1 second, not per SI second.
!     This is unlikely to have any practical consequences in the modern
!     era.
!
!  5) No validation is performed on the arguments.  Error cases that
!     could lead to arithmetic exceptions are trapped by the GD2GC
!     routine, and the result set to zeros.
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Urban, S. & Seidelmann, P. K. (eds), Explanatory Supplement to
!     the Astronomical Almanac, 3rd ed., University Science Books
!     (2013), Section 7.4.3.3.
!
!  Called:
!     GD2GC    geodetic to geocentric transformation
!     POM00    polar motion matrix
!     TRXP     product of transpose of r-matrix and p-vector
!
!  This revision:   2013 June 25
!
!-----------------------------------------------------------------------

implicit none
double precision elong, phi, hm, xp, yp, sp, theta, pv(3,2)

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

!  2Pi
double precision d2pi
parameter ( d2pi = 6.283185307179586476925287d0 )

!  Earth rotation rate in radians per UT1 second
double precision om
parameter ( om = 1.00273781191135448d0 * d2pi / d2s )

integer j
double precision xyzm(3), rpm(3,3), xyz(3), x, y, z, s, c

!  Geodetic to geocentric transformation (WGS84).
call GD2GC ( 1, elong, phi, hm, xyzm, j )

!  Polar motion and TIO position.
call POM00 ( xp, yp, sp, rpm )
call TRXP ( rpm, xyzm, xyz )
x = xyz(1)
y = xyz(2)
z = xyz(3)

!  routines of ERA.
s = sin(theta)
c = cos(theta)

!  Position.
pv(1,1) = c*x - s*y
pv(2,1) = s*x + c*y
pv(3,1) = z

!  Velocity.
pv(1,2) = om * ( -s*x - c*y )
pv(2,2) = om * (  c*x - s*y )
pv(3,2) = 0d0

end subroutine PVTOB
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PVU ( dt, pv, upv )
!>
!  Update a pv-vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     DT       d           time interval
!     PV       d(3,2)      pv-vector
!
!  Returned:
!     UPV      d(3,2)      p updated, v unchanged
!
!  Notes:
!
!  1) "Update" means "refer the position component of the vector
!     to a new epoch DT time units from the existing epoch".
!
!  2) The time units of DT must match those of the velocity.
!
!  Called:
!     PPSP     p-vector plus scaled p-vector
!     CP       copy p-vector
!
!  This revision:  2003 January 14
!
!-----------------------------------------------------------------------

implicit none

double precision dt, pv(3,2), upv(3,2)

call PPSP ( pv(1,1), dt, pv(1,2), upv(1,1) )
call CP ( pv(1,2), upv(1,2) )

end subroutine PVU
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PVUP ( dt, pv, p )
!>
!  Update a pv-vector, discarding the velocity component.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     DT       d           time interval
!     PV       d(3,2)      pv-vector
!
!  Returned:
!     P        d(3)        p-vector
!
!  Notes:
!
!  1) "Update" means "refer the position component of the vector to a
!     new date DT time units from the existing date".
!
!  2) The time units of DT must match those of the velocity.
!
!  This revision:  2008 May 8
!
!-----------------------------------------------------------------------

implicit none

double precision dt, pv(3,2), p(3)

integer i

do 1 i=1,3
   p(i) = pv(i,1) + pv(i,2)*dt
1 continue

end subroutine PVUP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PVXPV ( a, b, axb )
!>
!  Outer (=vector=cross) product of two pv-vectors.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3,2)      first pv-vector
!     B        d(3,2)      second pv-vector
!
!  Returned:
!     AXB      d(3,2)      A x B
!
!  Note:
!
!     If the position and velocity components of the two pv-vectors are
!     ( Ap, Av ) and ( Bp, Bv ), the result, A x B, is the pair of
!     vectors ( Ap x Bp, Ap x Bv + Av x Bp ).  The two vectors are the
!     cross-product of the two p-vectors and its derivative.
!
!  Called:
!     CPV      copy pv-vector
!     PXP      vector product of two p-vectors
!     PPP      p-vector plus p-vector
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision a(3,2), b(3,2), axb(3,2)

double precision wa(3,2), wb(3,2), axbd(3), adxb(3)

!  Make copies of the inputs.
call CPV ( a, wa )
call CPV ( b, wb )

!  A x B = position part of result.
call PXP ( wa(1,1), wb(1,1), axb(1,1) )

!  A x Bdot + Adot x B = velocity part of result.
call PXP ( wa(1,1), wb(1,2), axbd )
call PXP ( wa(1,2), wb(1,1), adxb )
call PPP ( axbd, adxb, axb(1,2) )

end subroutine PVXPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine PXP ( a, b, axb )
!>
!  p-vector outer (=vector=cross) product.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3)      first p-vector
!     B        d(3)      second p-vector
!
!  Returned:
!     AXB      d(3)      A x B
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision a(3), b(3), axb(3)

double precision xa, ya, za, xb, yb, zb

xa = a(1)
ya = a(2)
za = a(3)
xb = b(1)
yb = b(2)
zb = b(3)
axb(1) = ya*zb - za*yb
axb(2) = za*xb - xa*zb
axb(3) = xa*yb - ya*xb

end subroutine PXP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine REFCO ( phpa, tc, rh, wl, refa, refb )
!>
!  Determine the constants A and B in the atmospheric refraction model
!  dZ = A tan Z + B tan^3 Z.
!
!  Z is the "observed" zenith distance (i.e. affected by refraction)
!  and dZ is what to add to Z to give the "topocentric" (i.e. in vacuo)
!  zenith distance.
!
!  Status:  support routine.
!
!  Given:
!     PHPA     d      pressure at the observer (hPa = millibar)
!     TC       d      ambient temperature at the observer (deg C)
!     RH       d      relative humidity at the observer (range 0-1)
!     WL       d      wavelength (micrometers)
!
!  Returned:
!     REFA     d      tan Z coefficient (radians)
!     REFB     d      tan^3 Z coefficient (radians)
!
!  Notes:
!
!  1) The model balances speed and accuracy to give good results in
!     applications where performance at low altitudes is not paramount.
!     Performance is maintained across a range of conditions, and
!     applies to both optical/IR and radio.
!
!  2) The model omits the effects of (i) height above sea level (apart
!     from the reduced pressure itself), (ii) latitude (i.e. the
!     flattening of the Earth), (iii) variations in tropospheric lapse
!     rate and (iv) dispersive effects in the radio.
!
!     The model was tested using the following range of conditions:
!
!       lapse rates 0.0055, 0.0065, 0.0075 deg/meter
!       latitudes 0, 25, 50, 75 degrees
!       heights 0, 2500, 5000 meters ASL
!       pressures mean for height -10% to +5% in steps of 5%
!       temperatures -10 deg to +20 deg with respect to 280 deg at SL
!       relative humidity 0, 0.5, 1
!       wavelengths 0.4, 0.6, ... 2 micron, + radio
!       zenith distances 15, 45, 75 degrees
!
!     The accuracy with respect to raytracing through a model
!     atmosphere was as follows:
!
!                            worst         RMS
!
!       optical/IR           62 mas       8 mas
!       radio               319 mas      49 mas
!
!     For this particular set of conditions:
!
!       lapse rate 0.0065 K/meter
!       latitude 50 degrees
!       sea level
!       pressure 1005 mb
!       temperature 280.15 K
!       humidity 80%
!       wavelength 5740 Angstroms
!
!     the results were as follows:
!
!       ZD       raytrace     REFCO  Saastamoinen
!
!       10         10.27        10.27        10.27
!       20         21.19        21.20        21.19
!       30         33.61        33.61        33.60
!       40         48.82        48.83        48.81
!       45         58.16        58.18        58.16
!       50         69.28        69.30        69.27
!       55         82.97        82.99        82.95
!       60        100.51       100.54       100.50
!       65        124.23       124.26       124.20
!       70        158.63       158.68       158.61
!       72        177.32       177.37       177.31
!       74        200.35       200.38       200.32
!       76        229.45       229.43       229.42
!       78        267.44       267.29       267.41
!       80        319.13       318.55       319.10
!
!      deg        arcsec       arcsec       arcsec
!
!     The values for Saastamoinen's formula (which includes terms
!     up to tan^5) are taken from Hohenkerk and Sinclair (1985).
!
!  3) A WL value in the range 0-100 selects the optical/IR case and is
!     wavelength in micrometers.  Any value outside this range selects
!     the radio case.
!
!  4) Outlandish input parameters are silently limited to mathematically
!     safe values.  Zero pressure is permissible, and causes zeroes to
!     be returned.
!
!  5) The algorithm draws on several sources, as follows:
!
!     a) The formula for the saturation vapour pressure of water as
!        a function of temperature and temperature is taken from
!        Equations (A4.5-A4.7) of Gill (1982).
!
!     b) The formula for the water vapour pressure, given the
!        saturation pressure and the relative humidity, is from
!        Crane (1976), Equation (2.5.5).
!
!     c) The refractivity of air is a function of temperature,
!        total pressure, water-vapour pressure and, in the case
!        of optical/IR, wavelength.  The formulae for the two cases are
!        developed from Hohenkerk & Sinclair (1985) and Rueger (2002).
!
!     d) The formula for beta, the ratio of the scale height of the
!        atmosphere to the geocentric distance of the observer, is
!        an adaption of Equation (9) from Stone (1996).  The
!        adaptations, arrived at empirically, consist of (i) a small
!        adjustment to the coefficient and (ii) a humidity term for the
!        radio case only.
!
!     e) The formulae for the refraction constants as a function of
!        n-1 and beta are from Green (1987), Equation (4.31).
!
!  References:
!
!     Crane, R.K., Meeks, M.L. (ed), "Refraction Effects in the Neutral
!     Atmosphere", Methods of Experimental Physics: Astrophysics 12B,
!     Academic Press, 1976.
!
!     Gill, Adrian E., "Atmosphere-Ocean Dynamics", Academic Press,
!     1982.
!
!     Green, R.M., "Spherical Astronomy", Cambridge University Press,
!     1987.
!
!     Hohenkerk, C.Y., & Sinclair, A.T., NAO Technical Note No. 63,
!     1985.
!
!     Rueger, J.M., "Refractive Index Formulae for Electronic Distance
!     Measurement with Radio and Millimetre Waves", in Unisurv Report
!     S-68, School of Surveying and Spatial Information Systems,
!     University of New South Wales, Sydney, Australia, 2002.
!
!     Stone, Ronald C., P.A.S.P. 108, 1051-1058, 1996.
!
!  This revision:  2016 December 20
!
!-----------------------------------------------------------------------

implicit none
double precision phpa, tc, rh, wl, refa, refb

logical optic
double precision p, t, r, w, ps, pw, tk, wlsq, gamma, beta

!  Decide whether optical/IR or radio case:  switch at 100 microns.
optic = wl<=100d0

!  Restrict parameters to safe values.
t = min(max(tc,-150d0),200d0)
p = min(max(phpa,0d0),10000d0)
r = min(max(rh,0d0),1d0)
w = min(max(wl,0.1d0),1d6)

!  Water vapour pressure at the observer.
if (p>0d0) then
   ps = 10d0**((0.7859d0+0.03477d0*t)/(1d0+0.00412d0*t))* &
                                    (1d0+p*(4.5d-6+6d-10*t*t))
   pw = r*ps/(1d0-(1d0-r)*ps/p)
else
   pw = 0d0
end if

!  Refractive index minus 1 at the observer.
tk = t + 273.15d0
if (optic) then
   wlsq = w*w
   gamma = ((77.53484d-6+(4.39108d-7+3.666d-9/wlsq)/wlsq)*p &
                                                -11.2684d-6*pw)/tk
else
   gamma = (77.6890d-6*p-(6.3938d-6-0.375463d0/tk)*pw)/tk
end if

!  Formula for beta adapted from Stone, with empirical adjustments.
beta=4.4474d-6*tk
if (.not.optic) beta=beta-0.0074d0*pw*beta

!  Refraction constants from Green.
refa = gamma*(1d0-beta)
refb = -gamma*(beta-gamma/2d0)

end subroutine REFCO
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine RM2V ( r, w )
!>
!  Express an r-matrix as an r-vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     R        d(3,3)    rotation matrix
!
!  Returned:
!     W        d(3)      rotation vector (Note 1)
!
!  Notes:
!
!  1) A rotation matrix describes a rotation through some angle about
!     some arbitrary axis called the Euler axis.  The "rotation vector"
!     returned by this routine has the same direction as the Euler axis,
!     and its magnitude is the angle in radians.  (The magnitude and
!     direction can be separated by means of the routine PN.)
!
!  2) If R is null, so is the result.  If R is not a rotation matrix
!     the result is undefined.  R must be proper (i.e. have a positive
!     determinant) and real orthogonal (inverse = transpose).
!
!  3) The reference frame rotates clockwise as seen looking along
!     the rotation vector from the origin.
!
!  This revision:  2015 January 30
!
!-----------------------------------------------------------------------

implicit none

double precision r(3,3), w(3)

double precision x, y, z, s2, c2, phi, f

x = r(2,3) - r(3,2)
y = r(3,1) - r(1,3)
z = r(1,2) - r(2,1)
s2 = sqrt(x*x + y*y + z*z)
if ( s2 > 0d0 ) then
   c2 = r(1,1) + r(2,2) + r(3,3) - 1d0
   phi = atan2(s2,c2)
   f = phi / s2
   w(1) = x * f
   w(2) = y * f
   w(3) = z * f
else
   w(1) = 0d0
   w(2) = 0d0
   w(3) = 0d0
end if

end subroutine RM2V
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine RV2M ( w, r )
!>
!  Form the r-matrix corresponding to a given r-vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     W        d(3)      rotation vector (Note 1)
!
!  Returned:
!     R        d(3,3)    rotation matrix
!
!  Notes:
!
!  1) A rotation matrix describes a rotation through some angle about
!     some arbitrary axis called the Euler axis.  The "rotation vector"
!     supplied to this routine has the same direction as the Euler axis,
!     and its magnitude is the angle in radians.
!
!  2) If W is null, the unit matrix is returned.
!
!  3) The reference frame rotates clockwise as seen looking along the
!     rotation vector from the origin.
!
!  This revision:  2015 January 30
!
!-----------------------------------------------------------------------

implicit none

double precision w(3), r(3,3)

double precision x, y, z, phi, s, c, f

!  Euler angle (magnitude of rotation vector) and functions.
x = w(1)
y = w(2)
z = w(3)
phi = sqrt(x*x + y*y + z*z)
s = sin(phi)
c = cos(phi)
f = 1d0 - c

!  Euler axis (direction of rotation vector), perhaps null.
if ( phi > 0d0 ) then
   x = x / phi
   y = y / phi
   z = z / phi
end if

!  Form the rotation matrix.
r(1,1) = x*x*f + c
r(1,2) = x*y*f + z*s
r(1,3) = x*z*f - y*s
r(2,1) = y*x*f - z*s
r(2,2) = y*y*f + c
r(2,3) = y*z*f + x*s
r(3,1) = z*x*f + y*s
r(3,2) = z*y*f - x*s
r(3,3) = z*z*f + c

end subroutine RV2M
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine RX ( phi, r )
!>
!  Rotate an r-matrix about the x-axis.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     PHI      d         angle (radians)
!
!  Given and returned:
!     R        d(3,3)    r-matrix, rotated
!
!  Notes:
!
!  1) Calling this routine with positive PHI incorporates in the
!     supplied r-matrix R an additional rotation, about the x-axis,
!     anticlockwise as seen looking towards the origin from positive x.
!
!  2) The additional rotation can be represented by this matrix:
!
!         (  1        0            0      )
!         (                               )
!         (  0   + cos(PHI)   + sin(PHI)  )
!         (                               )
!         (  0   - sin(PHI)   + cos(PHI)  )
!
!  This revision:  2012 April 3
!
!-----------------------------------------------------------------------

implicit none

double precision phi, r(3,3)

double precision s, c, a21, a22, a23, a31, a32, a33

s = sin(phi)
c = cos(phi)

a21 =   c*r(2,1) + s*r(3,1)
a22 =   c*r(2,2) + s*r(3,2)
a23 =   c*r(2,3) + s*r(3,3)
a31 = - s*r(2,1) + c*r(3,1)
a32 = - s*r(2,2) + c*r(3,2)
a33 = - s*r(2,3) + c*r(3,3)

r(2,1) = a21
r(2,2) = a22
r(2,3) = a23
r(3,1) = a31
r(3,2) = a32
r(3,3) = a33

end subroutine RX
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine RXP ( r, p, rp )
!>
!  Multiply a p-vector by an r-matrix.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     R        d(3,3)    r-matrix
!     P        d(3)      p-vector
!
!  Returned:
!     RP       d(3)      R * P
!
!  Called:
!     CP       copy p-vector
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision r(3,3), p(3), rp(3)

double precision w, wrp(3)

integer i, j

!  Matrix R * vector P.
do 2 j=1,3
   w = 0d0
   do 1 i=1,3
      w = w + r(j,i)*p(i)
1    continue
   wrp(j) = w
2 continue

!  Return the result.
call CP ( wrp, rp )

end subroutine RXP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine RXPV ( r, pv, rpv )
!>
!  Multiply a pv-vector by an r-matrix.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     R        d(3,3)    r-matrix
!     PV       d(3,2)    pv-vector
!
!  Returned:
!     RPV      d(3,2)    R * PV
!
!  Called:
!     RXP      product of r-matrix and p-vector
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision r(3,3), pv(3,2), rpv(3,2)

call RXP ( r, pv(1,1), rpv(1,1) )
call RXP ( r, pv(1,2), rpv(1,2) )

end subroutine RXPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine RXR ( a, b, atb )
!>
!  Multiply two r-matrices.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3,3)    first r-matrix
!     B        d(3,3)    second r-matrix
!
!  Returned:
!     ATB      d(3,3)    A * B
!
!  Called:
!     CR       copy r-matrix
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision a(3,3), b(3,3), atb(3,3)

integer i, j, k
double precision w, wm(3,3)

do 3 i=1,3
   do 2 j=1,3
      w = 0d0
      do 1 k=1,3
         w = w + a(i,k)*b(k,j)
1       continue
      wm(i,j) = w
2    continue
3 continue
call CR ( wm, atb )

end subroutine RXR
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine RY ( theta, r )
!>
!  Rotate an r-matrix about the y-axis.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     THETA    d         angle (radians)
!
!  Given and returned:
!     R        d(3,3)    r-matrix, rotated
!
!  Notes:
!
!  1) Calling this routine with positive THETA incorporates in the
!     supplied r-matrix R an additional rotation, about the y-axis,
!     anticlockwise as seen looking towards the origin from positive y.
!
!  2) The additional rotation can be represented by this matrix:
!
!         (  + cos(THETA)     0      - sin(THETA)  )
!         (                                        )
!         (       0           1           0        )
!         (                                        )
!         (  + sin(THETA)     0      + cos(THETA)  )
!
!  This revision:  2012 April 3
!
!-----------------------------------------------------------------------

implicit none

double precision theta, r(3,3)

double precision s, c, a11, a12, a13, a31, a32, a33

s = sin(theta)
c = cos(theta)

a11 = c*r(1,1) - s*r(3,1)
a12 = c*r(1,2) - s*r(3,2)
a13 = c*r(1,3) - s*r(3,3)
a31 = s*r(1,1) + c*r(3,1)
a32 = s*r(1,2) + c*r(3,2)
a33 = s*r(1,3) + c*r(3,3)

r(1,1) = a11
r(1,2) = a12
r(1,3) = a13
r(3,1) = a31
r(3,2) = a32
r(3,3) = a33

end subroutine RY
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine RZ ( psi, r )
!>
!  Rotate an r-matrix about the z-axis.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     PSI      d         angle (radians)
!
!  Given and returned:
!     R        d(3,3)    r-matrix, rotated
!
!  Notes:
!
!  1) Calling this routine with positive PSI incorporates in the
!     supplied r-matrix R an additional rotation, about the z-axis,
!     anticlockwise as seen looking towards the origin from positive z.
!
!  2) The additional rotation can be represented by this matrix:
!
!         (  + cos(PSI)   + sin(PSI)     0  )
!         (                                 )
!         (  - sin(PSI)   + cos(PSI)     0  )
!         (                                 )
!         (       0            0         1  )
!
!  This revision:  2012 April 3
!
!-----------------------------------------------------------------------

implicit none

double precision psi, r(3,3)

double precision s, c, a11, a12, a13, a21, a22, a23

s = sin(psi)
c = cos(psi)

a11 =   c*r(1,1) + s*r(2,1)
a12 =   c*r(1,2) + s*r(2,2)
a13 =   c*r(1,3) + s*r(2,3)
a21 = - s*r(1,1) + c*r(2,1)
a22 = - s*r(1,2) + c*r(2,2)
a23 = - s*r(1,3) + c*r(2,3)

r(1,1) = a11
r(1,2) = a12
r(1,3) = a13
r(2,1) = a21
r(2,2) = a22
r(2,3) = a23

end subroutine RZ
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function S00 ( date1, date2, x, y )
!>
!  The CIO locator s, positioning the Celestial Intermediate Origin on
!  the equator of the Celestial Intermediate Pole, given the CIP's X,Y
!  coordinates.  Compatible with IAU 2000A precession-nutation.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!     X,Y            d      CIP coordinates (Note 3)
!
!  Returned:
!     S00        d      the CIO locator s in radians (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The CIO locator s is the difference between the right ascensions
!     of the same point in two systems:  the two systems are the GCRS
!     and the CIP,CIO, and the point is the ascending node of the
!     CIP equator.  The quantity s remains below 0.1 arcsecond
!     throughout 1900-2100.
!
!  3) The series used to compute s is in fact for s+XY/2, where X and Y
!     are the x and y components of the CIP unit vector;  this series is
!     more compact than a direct series for s would be.  This routine
!     requires X,Y to be supplied by the caller, who is responsible for
!     providing values that are consistent with the supplied date.
!
!  4) The model is consistent with the IAU 2000A precession-nutation.
!
!  Called:
!     FAL03    mean anomaly of the Moon
!     FALP03   mean anomaly of the Sun
!     FAF03    mean argument of the latitude of the Moon
!     FAD03    mean elongation of the Moon from the Sun
!     FAOM03   mean longitude of the Moon's ascending node
!     FAVE03   mean longitude of Venus
!     FAE03    mean longitude of Earth
!     FAPA03   general accumulated precession in longitude
!
!  References:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, x, y

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

!  Time since J2000.0, in Julian centuries
double precision t

!  Miscellaneous
integer i, j
double precision a, s0, s1, s2, s3, s4, s5
!     DOUBLE PRECISION FAL03, FALP03, FAF03,
!    :                 FAD03, FAOM03, FAVE03, FAE03,
!    :                 FAPA03

!  Fundamental arguments
double precision fa(8)

!  ---------------------
!  The series for s+XY/2
!  ---------------------

!  Number of terms in the series
integer nsp, ns0, ns1, ns2, ns3, ns4
parameter ( nsp=6, ns0=33, ns1=3, ns2=25, ns3=4, ns4=1 )

!  Polynomial coefficients
double precision sp ( nsp )

!  Coefficients of l,l',F,D,Om,LVe,LE,pA
integer ks0 ( 8, ns0 ), &
        ks1 ( 8, ns1 ), &
        ks2 ( 8, ns2 ), &
        ks3 ( 8, ns3 ), &
        ks4 ( 8, ns4 )

!  Sine and cosine coefficients
double precision ss0 ( 2, ns0 ), &
                 ss1 ( 2, ns1 ), &
                 ss2 ( 2, ns2 ), &
                 ss3 ( 2, ns3 ), &
                 ss4 ( 2, ns4 )

!  Polynomial coefficients
data sp /    94d-6, &
           3808.35d-6, &
           -119.94d-6, &
         -72574.09d-6, &
             27.70d-6, &
             15.61d-6 /

!  Argument coefficients for t^0
data ( ( ks0(i,j), i=1,8), j=1,10 ) / &
  0,  0,  0,  0,  1,  0,  0,  0, &
  0,  0,  0,  0,  2,  0,  0,  0, &
  0,  0,  2, -2,  3,  0,  0,  0, &
  0,  0,  2, -2,  1,  0,  0,  0, &
  0,  0,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  3,  0,  0,  0, &
  0,  0,  2,  0,  1,  0,  0,  0, &
  0,  0,  0,  0,  3,  0,  0,  0, &
  0,  1,  0,  0,  1,  0,  0,  0, &
  0,  1,  0,  0, -1,  0,  0,  0 /
data ( ( ks0(i,j), i=1,8), j=11,20 ) / &
  1,  0,  0,  0, -1,  0,  0,  0, &
  1,  0,  0,  0,  1,  0,  0,  0, &
  0,  1,  2, -2,  3,  0,  0,  0, &
  0,  1,  2, -2,  1,  0,  0,  0, &
  0,  0,  4, -4,  4,  0,  0,  0, &
  0,  0,  1, -1,  1, -8, 12,  0, &
  0,  0,  2,  0,  0,  0,  0,  0, &
  0,  0,  2,  0,  2,  0,  0,  0, &
  1,  0,  2,  0,  3,  0,  0,  0, &
  1,  0,  2,  0,  1,  0,  0,  0 /
data ( ( ks0(i,j), i=1,8), j=21,30 ) / &
  0,  0,  2, -2,  0,  0,  0,  0, &
  0,  1, -2,  2, -3,  0,  0,  0, &
  0,  1, -2,  2, -1,  0,  0,  0, &
  0,  0,  0,  0,  0,  8,-13, -1, &
  0,  0,  0,  2,  0,  0,  0,  0, &
  2,  0, -2,  0, -1,  0,  0,  0, &
  0,  1,  2, -2,  2,  0,  0,  0, &
  1,  0,  0, -2,  1,  0,  0,  0, &
  1,  0,  0, -2, -1,  0,  0,  0, &
  0,  0,  4, -2,  4,  0,  0,  0 /
data ( ( ks0(i,j), i=1,8), j=31,ns0 ) / &
  0,  0,  2, -2,  4,  0,  0,  0, &
  1,  0, -2,  0, -3,  0,  0,  0, &
  1,  0, -2,  0, -1,  0,  0,  0 /

!  Argument coefficients for t^1
data ( ( ks1(i,j), i=1,8), j=1,ns1 ) / &
  0,  0,  0,  0,  2,  0,  0,  0, &
  0,  0,  0,  0,  1,  0,  0,  0, &
  0,  0,  2, -2,  3,  0,  0,  0 /

!  Argument coefficients for t^2
data ( ( ks2(i,j), i=1,8), j=1,10 ) / &
  0,  0,  0,  0,  1,  0,  0,  0, &
  0,  0,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  2,  0,  0,  0, &
  0,  0,  0,  0,  2,  0,  0,  0, &
  0,  1,  0,  0,  0,  0,  0,  0, &
  1,  0,  0,  0,  0,  0,  0,  0, &
  0,  1,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  1,  0,  0,  0, &
  1,  0,  2,  0,  2,  0,  0,  0, &
  0,  1, -2,  2, -2,  0,  0,  0 /
data ( ( ks2(i,j), i=1,8), j=11,20 ) / &
  1,  0,  0, -2,  0,  0,  0,  0, &
  0,  0,  2, -2,  1,  0,  0,  0, &
  1,  0, -2,  0, -2,  0,  0,  0, &
  0,  0,  0,  2,  0,  0,  0,  0, &
  1,  0,  0,  0,  1,  0,  0,  0, &
  1,  0, -2, -2, -2,  0,  0,  0, &
  1,  0,  0,  0, -1,  0,  0,  0, &
  1,  0,  2,  0,  1,  0,  0,  0, &
  2,  0,  0, -2,  0,  0,  0,  0, &
  2,  0, -2,  0, -1,  0,  0,  0 /
data ( ( ks2(i,j), i=1,8), j=21,ns2 ) / &
  0,  0,  2,  2,  2,  0,  0,  0, &
  2,  0,  2,  0,  2,  0,  0,  0, &
  2,  0,  0,  0,  0,  0,  0,  0, &
  1,  0,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  0,  0,  0,  0 /

!  Argument coefficients for t^3
data ( ( ks3(i,j), i=1,8), j=1,ns3 ) / &
  0,  0,  0,  0,  1,  0,  0,  0, &
  0,  0,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  2,  0,  0,  0, &
  0,  0,  0,  0,  2,  0,  0,  0 /

!  Argument coefficients for t^4
data ( ( ks4(i,j), i=1,8), j=1,ns4 ) / &
  0,  0,  0,  0,  1,  0,  0,  0 /

!  Sine and cosine coefficients for t^0
data ( ( ss0(i,j), i=1,2), j=1,10 ) / &
            -2640.73d-6,          +0.39d-6, &
              -63.53d-6,          +0.02d-6, &
              -11.75d-6,          -0.01d-6, &
              -11.21d-6,          -0.01d-6, &
               +4.57d-6,           0.00d-6, &
               -2.02d-6,           0.00d-6, &
               -1.98d-6,           0.00d-6, &
               +1.72d-6,           0.00d-6, &
               +1.41d-6,          +0.01d-6, &
               +1.26d-6,          +0.01d-6 /
data ( ( ss0(i,j), i=1,2), j=11,20 ) / &
               +0.63d-6,           0.00d-6, &
               +0.63d-6,           0.00d-6, &
               -0.46d-6,           0.00d-6, &
               -0.45d-6,           0.00d-6, &
               -0.36d-6,           0.00d-6, &
               +0.24d-6,          +0.12d-6, &
               -0.32d-6,           0.00d-6, &
               -0.28d-6,           0.00d-6, &
               -0.27d-6,           0.00d-6, &
               -0.26d-6,           0.00d-6 /
data ( ( ss0(i,j), i=1,2), j=21,30 ) / &
               +0.21d-6,           0.00d-6, &
               -0.19d-6,           0.00d-6, &
               -0.18d-6,           0.00d-6, &
               +0.10d-6,          -0.05d-6, &
               -0.15d-6,           0.00d-6, &
               +0.14d-6,           0.00d-6, &
               +0.14d-6,           0.00d-6, &
               -0.14d-6,           0.00d-6, &
               -0.14d-6,           0.00d-6, &
               -0.13d-6,           0.00d-6 /
data ( ( ss0(i,j), i=1,2), j=31,ns0 ) / &
               +0.11d-6,           0.00d-6, &
               -0.11d-6,           0.00d-6, &
               -0.11d-6,           0.00d-6 /

!  Sine and cosine coefficients for t^1
data ( ( ss1(i,j), i=1,2), j=1,ns1 ) / &
               -0.07d-6,          +3.57d-6, &
               +1.71d-6,          -0.03d-6, &
                0.00d-6,          +0.48d-6 /

!  Sine and cosine coefficients for t^2
data ( ( ss2(i,j), i=1,2), j=1,10 ) / &
             +743.53d-6,          -0.17d-6, &
              +56.91d-6,          +0.06d-6, &
               +9.84d-6,          -0.01d-6, &
               -8.85d-6,          +0.01d-6, &
               -6.38d-6,          -0.05d-6, &
               -3.07d-6,           0.00d-6, &
               +2.23d-6,           0.00d-6, &
               +1.67d-6,           0.00d-6, &
               +1.30d-6,           0.00d-6, &
               +0.93d-6,           0.00d-6 /
data ( ( ss2(i,j), i=1,2), j=11,20 ) / &
               +0.68d-6,           0.00d-6, &
               -0.55d-6,           0.00d-6, &
               +0.53d-6,           0.00d-6, &
               -0.27d-6,           0.00d-6, &
               -0.27d-6,           0.00d-6, &
               -0.26d-6,           0.00d-6, &
               -0.25d-6,           0.00d-6, &
               +0.22d-6,           0.00d-6, &
               -0.21d-6,           0.00d-6, &
               +0.20d-6,           0.00d-6 /
data ( ( ss2(i,j), i=1,2), j=21,ns2 ) / &
               +0.17d-6,           0.00d-6, &
               +0.13d-6,           0.00d-6, &
               -0.13d-6,           0.00d-6, &
               -0.12d-6,           0.00d-6, &
               -0.11d-6,           0.00d-6 /

!  Sine and cosine coefficients for t^3
data ( ( ss3(i,j), i=1,2), j=1,ns3 ) / &
               +0.30d-6,         -23.51d-6, &
               -0.03d-6,          -1.39d-6, &
               -0.01d-6,          -0.24d-6, &
                0.00d-6,          +0.22d-6 /

!  Sine and cosine coefficients for t^4
data ( ( ss4(i,j), i=1,2), j=1,ns4 ) / &
               -0.26d-6,          -0.01d-6 /

!  Interval between fundamental epoch J2000.0 and current date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Fundamental Arguments (from IERS Conventions 2003)

!  Mean anomaly of the Moon.
fa(1) = FAL03 ( t )

!  Mean anomaly of the Sun.
fa(2) = FALP03 ( t )

!  Mean longitude of the Moon minus that of the ascending node.
fa(3) = FAF03 ( t )

!  Mean elongation of the Moon from the Sun.
fa(4) = FAD03 ( t )

!  Mean longitude of the ascending node of the Moon.
fa(5) = FAOM03 ( t )

!  Mean longitude of Venus.
fa(6) = FAVE03 ( t )

!  Mean longitude of Earth.
fa(7) = FAE03 ( t )

!  General precession in longitude.
fa(8) = FAPA03 ( t )

!  Evaluate s.
s0 = sp(1)
s1 = sp(2)
s2 = sp(3)
s3 = sp(4)
s4 = sp(5)
s5 = sp(6)

do 2 i = ns0,1,-1
   a = 0d0
   do 1 j=1,8
      a = a + dble(ks0(j,i))*fa(j)
1    continue
   s0 = s0 + ( ss0(1,i)*sin(a) + ss0(2,i)*cos(a) )
2 continue

do 4 i = ns1,1,-1
   a = 0d0
   do 3 j=1,8
      a = a + dble(ks1(j,i))*fa(j)
3    continue
   s1 = s1 + ( ss1(1,i)*sin(a) + ss1(2,i)*cos(a) )
4 continue

do 6 i = ns2,1,-1
   a = 0d0
   do 5 j=1,8
      a = a + dble(ks2(j,i))*fa(j)
5    continue
   s2 = s2 + ( ss2(1,i)*sin(a) + ss2(2,i)*cos(a) )
6 continue

do 8 i = ns3,1,-1
   a = 0d0
   do 7 j=1,8
      a = a + dble(ks3(j,i))*fa(j)
7    continue
   s3 = s3 + ( ss3(1,i)*sin(a) + ss3(2,i)*cos(a) )
8 continue

do 10 i = ns4,1,-1
   a = 0d0
   do 9 j=1,8
      a = a + dble(ks4(j,i))*fa(j)
9    continue
   s4 = s4 + ( ss4(1,i)*sin(a) + ss4(2,i)*cos(a) )
10 continue

S00 = ( s0 + &
          ( s1 + &
          ( s2 + &
          ( s3 + &
          ( s4 + &
            s5 * t ) * t ) * t ) * t ) * t ) * das2r - x*y/2d0

end function S00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function S00A ( date1, date2 )
!>
!  The CIO locator s, positioning the Celestial Intermediate Origin on
!  the equator of the Celestial Intermediate Pole, using the IAU 2000A
!  precession-nutation model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     S00A       d      the CIO locator s in radians (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The CIO locator s is the difference between the right ascensions
!     of the same point in two systems.  The two systems are the GCRS
!     and the CIP,CIO, and the point is the ascending node of the
!     CIP equator.  The CIO locator s remains a small fraction of
!     1 arcsecond throughout 1900-2100.
!
!  3) The series used to compute s is in fact for s+XY/2, where X and Y
!     are the x and y components of the CIP unit vector;  this series is
!     more compact than a direct series for s would be.  The present
!     routine uses the full IAU 2000A nutation model when predicting the
!     CIP position.  Faster results, with no significant loss of
!     accuracy, can be obtained via the routine S00B, which uses
!     instead the IAU 2000B truncated model.
!
!  Called:
!     PNM00A   classical NPB matrix, IAU 2000A
!     BNP2XY    extract CIP X,Y from the BPN matrix
!     S00      the CIO locator s, given X,Y, IAU 2000A
!
!  References:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

double precision rbpn(3,3), x, y

!     DOUBLE PRECISION S00

!  Bias-precession-nutation-matrix, IAU 2000A.
call PNM00A ( date1, date2, rbpn )

!  Extract the CIP coordinates.
call BPN2XY ( rbpn, x, y )

!  Compute the CIO locator s, given the CIP coordinates.
S00A = S00 ( date1, date2, x, y )

end function S00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function S00B ( date1, date2 )
!>
!  The CIO locator s, positioning the Celestial Intermediate Origin on
!  the equator of the Celestial Intermediate Pole, using the IAU 2000B
!  precession-nutation model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     S00B       d      the CIO locator s in radians (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The CIO locator s is the difference between the right ascensions
!     of the same point in two systems.  The two systems are the GCRS
!     and the CIP,CIO, and the point is the ascending node of the
!     CIP equator.  The CIO locator s remains a small fraction of
!     1 arcsecond throughout 1900-2100.
!
!  3) The series used to compute s is in fact for s+XY/2, where X and Y
!     are the x and y components of the CIP unit vector;  this series is
!     more compact than a direct series for s would be.  The present
!     routine uses the IAU 2000B truncated nutation model when
!     predicting the CIP position.  The routine S00A uses instead
!     the full IAU 2000A model, but with no significant increase in
!     accuracy and at some cost in speed.
!
!  Called:
!     PNM00B   classical NPB matrix, IAU 2000B
!     BNP2XY    extract CIP X,Y from the BPN matrix
!     S00      the CIO locator s, given X,Y, IAU 2000A
!
!  References:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

double precision rbpn(3,3), x, y

!     DOUBLE PRECISION S00

!  Bias-precession-nutation-matrix, IAU 2000B.
call PNM00B ( date1, date2, rbpn )

!  Extract the CIP coordinates.
call BPN2XY ( rbpn, x, y )

!  Compute the CIO locator s, given the CIP coordinates.
S00B = S00 ( date1, date2, x, y )

end function S00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function S06 ( date1, date2, x, y )
!>
!  The CIO locator s, positioning the Celestial Intermediate Origin on
!  the equator of the Celestial Intermediate Pole, given the CIP's X,Y
!  coordinates.  Compatible with IAU 2006/2000A precession-nutation.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!     X,Y            d      CIP coordinates (Note 3)
!
!  Returned:
!     S06        d      the CIO locator s in radians (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The CIO locator s is the difference between the right ascensions
!     of the same point in two systems:  the two systems are the GCRS
!     and the CIP,CIO, and the point is the ascending node of the
!     CIP equator.  The quantity s remains below 0.1 arcsecond
!     throughout 1900-2100.
!
!  3) The series used to compute s is in fact for s+XY/2, where X and Y
!     are the x and y components of the CIP unit vector;  this series is
!     more compact than a direct series for s would be.  This routine
!     requires X,Y to be supplied by the caller, who is responsible for
!     providing values that are consistent with the supplied date.
!
!  4) The model is consistent with the "P03" precession (Capitaine et
!     al. 2003), adopted by IAU 2006 Resolution 1, 2006, and the
!     IAU 2000A nutation (with P03 adjustments).
!
!  Called:
!     FAL03    mean anomaly of the Moon
!     FALP03   mean anomaly of the Sun
!     FAF03    mean argument of the latitude of the Moon
!     FAD03    mean elongation of the Moon from the Sun
!     FAOM03   mean longitude of the Moon's ascending node
!     FAVE03   mean longitude of Venus
!     FAE03    mean longitude of Earth
!     FAPA03   general accumulated precession in longitude
!
!  References:
!
!     Capitaine, N., Wallace, P.T. & Chapront, J., 2003, Astron.
!     Astrophys. 432, 355
!
!     McCarthy, D.D., Petit, G. (eds.) 2004, IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG
!
!  This revision:   2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, x, y

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

!  Time since J2000.0, in Julian centuries
double precision t

!  Miscellaneous
integer i, j
double precision a, s0, s1, s2, s3, s4, s5
!     DOUBLE PRECISION FAL03, FALP03, FAF03,
!    :                 FAD03, FAOM03, FAVE03, FAE03,
!    :                 FAPA03

!  Fundamental arguments
double precision fa(8)

!  ---------------------
!  The series for s+XY/2
!  ---------------------

!  Number of terms in the series
integer nsp, ns0, ns1, ns2, ns3, ns4
parameter ( nsp=6, ns0=33, ns1=3, ns2=25, ns3=4, ns4=1 )

!  Polynomial coefficients
double precision sp ( nsp )

!  Coefficients of l,l',F,D,Om,LVe,LE,pA
integer ks0 ( 8, ns0 ), &
        ks1 ( 8, ns1 ), &
        ks2 ( 8, ns2 ), &
        ks3 ( 8, ns3 ), &
        ks4 ( 8, ns4 )

!  Sine and cosine coefficients
double precision ss0 ( 2, ns0 ), &
                 ss1 ( 2, ns1 ), &
                 ss2 ( 2, ns2 ), &
                 ss3 ( 2, ns3 ), &
                 ss4 ( 2, ns4 )

!  Polynomial coefficients
data sp /    94d-6, &
           3808.65d-6, &
           -122.68d-6, &
         -72574.11d-6, &
             27.98d-6, &
             15.62d-6 /

!  Argument coefficients for t^0
data ( ( ks0(i,j), i=1,8), j=1,10 ) / &
  0,  0,  0,  0,  1,  0,  0,  0, &
  0,  0,  0,  0,  2,  0,  0,  0, &
  0,  0,  2, -2,  3,  0,  0,  0, &
  0,  0,  2, -2,  1,  0,  0,  0, &
  0,  0,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  3,  0,  0,  0, &
  0,  0,  2,  0,  1,  0,  0,  0, &
  0,  0,  0,  0,  3,  0,  0,  0, &
  0,  1,  0,  0,  1,  0,  0,  0, &
  0,  1,  0,  0, -1,  0,  0,  0 /
data ( ( ks0(i,j), i=1,8), j=11,20 ) / &
  1,  0,  0,  0, -1,  0,  0,  0, &
  1,  0,  0,  0,  1,  0,  0,  0, &
  0,  1,  2, -2,  3,  0,  0,  0, &
  0,  1,  2, -2,  1,  0,  0,  0, &
  0,  0,  4, -4,  4,  0,  0,  0, &
  0,  0,  1, -1,  1, -8, 12,  0, &
  0,  0,  2,  0,  0,  0,  0,  0, &
  0,  0,  2,  0,  2,  0,  0,  0, &
  1,  0,  2,  0,  3,  0,  0,  0, &
  1,  0,  2,  0,  1,  0,  0,  0 /
data ( ( ks0(i,j), i=1,8), j=21,30 ) / &
  0,  0,  2, -2,  0,  0,  0,  0, &
  0,  1, -2,  2, -3,  0,  0,  0, &
  0,  1, -2,  2, -1,  0,  0,  0, &
  0,  0,  0,  0,  0,  8,-13, -1, &
  0,  0,  0,  2,  0,  0,  0,  0, &
  2,  0, -2,  0, -1,  0,  0,  0, &
  0,  1,  2, -2,  2,  0,  0,  0, &
  1,  0,  0, -2,  1,  0,  0,  0, &
  1,  0,  0, -2, -1,  0,  0,  0, &
  0,  0,  4, -2,  4,  0,  0,  0 /
data ( ( ks0(i,j), i=1,8), j=31,ns0 ) / &
  0,  0,  2, -2,  4,  0,  0,  0, &
  1,  0, -2,  0, -3,  0,  0,  0, &
  1,  0, -2,  0, -1,  0,  0,  0 /

!  Argument coefficients for t^1
data ( ( ks1(i,j), i=1,8), j=1,ns1 ) / &
  0,  0,  0,  0,  2,  0,  0,  0, &
  0,  0,  0,  0,  1,  0,  0,  0, &
  0,  0,  2, -2,  3,  0,  0,  0 /

!  Argument coefficients for t^2
data ( ( ks2(i,j), i=1,8), j=1,10 ) / &
  0,  0,  0,  0,  1,  0,  0,  0, &
  0,  0,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  2,  0,  0,  0, &
  0,  0,  0,  0,  2,  0,  0,  0, &
  0,  1,  0,  0,  0,  0,  0,  0, &
  1,  0,  0,  0,  0,  0,  0,  0, &
  0,  1,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  1,  0,  0,  0, &
  1,  0,  2,  0,  2,  0,  0,  0, &
  0,  1, -2,  2, -2,  0,  0,  0 /
data ( ( ks2(i,j), i=1,8), j=11,20 ) / &
  1,  0,  0, -2,  0,  0,  0,  0, &
  0,  0,  2, -2,  1,  0,  0,  0, &
  1,  0, -2,  0, -2,  0,  0,  0, &
  0,  0,  0,  2,  0,  0,  0,  0, &
  1,  0,  0,  0,  1,  0,  0,  0, &
  1,  0, -2, -2, -2,  0,  0,  0, &
  1,  0,  0,  0, -1,  0,  0,  0, &
  1,  0,  2,  0,  1,  0,  0,  0, &
  2,  0,  0, -2,  0,  0,  0,  0, &
  2,  0, -2,  0, -1,  0,  0,  0 /
data ( ( ks2(i,j), i=1,8), j=21,ns2 ) / &
  0,  0,  2,  2,  2,  0,  0,  0, &
  2,  0,  2,  0,  2,  0,  0,  0, &
  2,  0,  0,  0,  0,  0,  0,  0, &
  1,  0,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  0,  0,  0,  0 /

!  Argument coefficients for t^3
data ( ( ks3(i,j), i=1,8), j=1,ns3 ) / &
  0,  0,  0,  0,  1,  0,  0,  0, &
  0,  0,  2, -2,  2,  0,  0,  0, &
  0,  0,  2,  0,  2,  0,  0,  0, &
  0,  0,  0,  0,  2,  0,  0,  0 /

!  Argument coefficients for t^4
data ( ( ks4(i,j), i=1,8), j=1,ns4 ) / &
  0,  0,  0,  0,  1,  0,  0,  0 /

!  Sine and cosine coefficients for t^0
data ( ( ss0(i,j), i=1,2), j=1,10 ) / &
            -2640.73d-6,          +0.39d-6, &
              -63.53d-6,          +0.02d-6, &
              -11.75d-6,          -0.01d-6, &
              -11.21d-6,          -0.01d-6, &
               +4.57d-6,           0.00d-6, &
               -2.02d-6,           0.00d-6, &
               -1.98d-6,           0.00d-6, &
               +1.72d-6,           0.00d-6, &
               +1.41d-6,          +0.01d-6, &
               +1.26d-6,          +0.01d-6 /
data ( ( ss0(i,j), i=1,2), j=11,20 ) / &
               +0.63d-6,           0.00d-6, &
               +0.63d-6,           0.00d-6, &
               -0.46d-6,           0.00d-6, &
               -0.45d-6,           0.00d-6, &
               -0.36d-6,           0.00d-6, &
               +0.24d-6,          +0.12d-6, &
               -0.32d-6,           0.00d-6, &
               -0.28d-6,           0.00d-6, &
               -0.27d-6,           0.00d-6, &
               -0.26d-6,           0.00d-6 /
data ( ( ss0(i,j), i=1,2), j=21,30 ) / &
               +0.21d-6,           0.00d-6, &
               -0.19d-6,           0.00d-6, &
               -0.18d-6,           0.00d-6, &
               +0.10d-6,          -0.05d-6, &
               -0.15d-6,           0.00d-6, &
               +0.14d-6,           0.00d-6, &
               +0.14d-6,           0.00d-6, &
               -0.14d-6,           0.00d-6, &
               -0.14d-6,           0.00d-6, &
               -0.13d-6,           0.00d-6 /
data ( ( ss0(i,j), i=1,2), j=31,ns0 ) / &
               +0.11d-6,           0.00d-6, &
               -0.11d-6,           0.00d-6, &
               -0.11d-6,           0.00d-6 /

!  Sine and cosine coefficients for t^1
data ( ( ss1(i,j), i=1,2), j=1,ns1 ) / &
               -0.07d-6,          +3.57d-6, &
               +1.73d-6,          -0.03d-6, &
                0.00d-6,          +0.48d-6 /

!  Sine and cosine coefficients for t^2
data ( ( ss2(i,j), i=1,2), j=1,10 ) / &
             +743.52d-6,          -0.17d-6, &
              +56.91d-6,          +0.06d-6, &
               +9.84d-6,          -0.01d-6, &
               -8.85d-6,          +0.01d-6, &
               -6.38d-6,          -0.05d-6, &
               -3.07d-6,           0.00d-6, &
               +2.23d-6,           0.00d-6, &
               +1.67d-6,           0.00d-6, &
               +1.30d-6,           0.00d-6, &
               +0.93d-6,           0.00d-6 /
data ( ( ss2(i,j), i=1,2), j=11,20 ) / &
               +0.68d-6,           0.00d-6, &
               -0.55d-6,           0.00d-6, &
               +0.53d-6,           0.00d-6, &
               -0.27d-6,           0.00d-6, &
               -0.27d-6,           0.00d-6, &
               -0.26d-6,           0.00d-6, &
               -0.25d-6,           0.00d-6, &
               +0.22d-6,           0.00d-6, &
               -0.21d-6,           0.00d-6, &
               +0.20d-6,           0.00d-6 /
data ( ( ss2(i,j), i=1,2), j=21,ns2 ) / &
               +0.17d-6,           0.00d-6, &
               +0.13d-6,           0.00d-6, &
               -0.13d-6,           0.00d-6, &
               -0.12d-6,           0.00d-6, &
               -0.11d-6,           0.00d-6 /

!  Sine and cosine coefficients for t^3
data ( ( ss3(i,j), i=1,2), j=1,ns3 ) / &
               +0.30d-6,         -23.42d-6, &
               -0.03d-6,          -1.46d-6, &
               -0.01d-6,          -0.25d-6, &
                0.00d-6,          +0.23d-6 /

!  Sine and cosine coefficients for t^4
data ( ( ss4(i,j), i=1,2), j=1,ns4 ) / &
               -0.26d-6,          -0.01d-6 /

!  Interval between fundamental epoch J2000.0 and current date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Fundamental Arguments (from IERS Conventions 2003)

!  Mean anomaly of the Moon.
fa(1) = FAL03 ( t )

!  Mean anomaly of the Sun.
fa(2) = FALP03 ( t )

!  Mean longitude of the Moon minus that of the ascending node.
fa(3) = FAF03 ( t )

!  Mean elongation of the Moon from the Sun.
fa(4) = FAD03 ( t )

!  Mean longitude of the ascending node of the Moon.
fa(5) = FAOM03 ( t )

!  Mean longitude of Venus.
fa(6) = FAVE03 ( t )

!  Mean longitude of Earth.
fa(7) = FAE03 ( t )

!  General precession in longitude.
fa(8) = FAPA03 ( t )

!  Evaluate s.
s0 = sp(1)
s1 = sp(2)
s2 = sp(3)
s3 = sp(4)
s4 = sp(5)
s5 = sp(6)

do 2 i = ns0,1,-1
   a = 0d0
   do 1 j=1,8
      a = a + dble(ks0(j,i))*fa(j)
1    continue
   s0 = s0 + ( ss0(1,i)*sin(a) + ss0(2,i)*cos(a) )
2 continue

do 4 i = ns1,1,-1
   a = 0d0
   do 3 j=1,8
      a = a + dble(ks1(j,i))*fa(j)
3    continue
   s1 = s1 + ( ss1(1,i)*sin(a) + ss1(2,i)*cos(a) )
4 continue

do 6 i = ns2,1,-1
   a = 0d0
   do 5 j=1,8
      a = a + dble(ks2(j,i))*fa(j)
5    continue
   s2 = s2 + ( ss2(1,i)*sin(a) + ss2(2,i)*cos(a) )
6 continue

do 8 i = ns3,1,-1
   a = 0d0
   do 7 j=1,8
      a = a + dble(ks3(j,i))*fa(j)
7    continue
   s3 = s3 + ( ss3(1,i)*sin(a) + ss3(2,i)*cos(a) )
8 continue

do 10 i = ns4,1,-1
   a = 0d0
   do 9 j=1,8
      a = a + dble(ks4(j,i))*fa(j)
9    continue
   s4 = s4 + ( ss4(1,i)*sin(a) + ss4(2,i)*cos(a) )
10 continue

S06 = ( s0 + &
          ( s1 + &
          ( s2 + &
          ( s3 + &
          ( s4 + &
            s5 * t ) * t ) * t ) * t ) * t ) * das2r - x*y/2d0

end function S06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function S06A ( date1, date2 )
!>
!  The CIO locator s, positioning the Celestial Intermediate Origin on
!  the equator of the Celestial Intermediate Pole, using the IAU 2006
!  precession and IAU 2000A nutation models.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     S06A       d      the CIO locator s in radians (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The CIO locator s is the difference between the right ascensions
!     of the same point in two systems.  The two systems are the GCRS
!     and the CIP,CIO, and the point is the ascending node of the
!     CIP equator.  The CIO locator s remains a small fraction of
!     1 arcsecond throughout 1900-2100.
!
!  3) The series used to compute s is in fact for s+XY/2, where X and Y
!     are the x and y components of the CIP unit vector;  this series is
!     more compact than a direct series for s would be.  The present
!     routine uses the full IAU 2000A nutation model when predicting the
!     CIP position.
!
!  Called:
!     PNM06A   classical NPB matrix, IAU 2006/2000A
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     S06      the CIO locator s, given X,Y, IAU 2006
!
!  References:
!
!     Capitaine, N., Chapront, J., Lambert, S. and Wallace, P.,
!     "Expressions for the Celestial Intermediate Pole and Celestial
!     Ephemeris Origin consistent with the IAU 2000A precession-nutation
!     model", Astron.Astrophys. 400, 1145-1154 (2003)
!
!     n.b. The celestial ephemeris origin (CEO) was renamed "celestial
!          intermediate origin" (CIO) by IAU 2006 Resolution 2.
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!     McCarthy, D. D., Petit, G. (eds.), 2004, IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2010 January 18
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

double precision rnpb(3,3), x, y

!     DOUBLE PRECISION S06

!  Bias-precession-nutation-matrix, IAU 20006/2000A.
call PNM06A ( date1, date2, rnpb )

!  Extract the CIP coordinates.
call BPN2XY ( rnpb, x, y )

!  Compute the CIO locator s, given the CIP coordinates.
S06A = S06 ( date1, date2, x, y )

end function S06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine S2C ( theta, phi, c )
!>
!  Convert spherical coordinates to Cartesian.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     THETA    d         longitude angle (radians)
!     PHI      d         latitude angle (radians)
!
!  Returned:
!     C        d(3)      direction cosines
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision theta, phi, c(3)

double precision cp

cp = cos(phi)
c(1) = cos(theta) * cp
c(2) = sin(theta) * cp
c(3) = sin(phi)

end subroutine S2C
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine S2P ( theta, phi, r, p )
!>
!  Convert spherical polar coordinates to p-vector.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     THETA    d         longitude angle (radians)
!     PHI      d         latitude angle (radians)
!     R        d         radial distance
!
!  Returned:
!     P        d(3)      Cartesian coordinates
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     SXP      multiply p-vector by scalar
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision theta, phi, r, p(3)

double precision u(3)

call S2C ( theta, phi, u )
call SXP ( r, u, p )

end subroutine S2P
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine S2PV ( theta, phi, r, td, pd, rd, pv )
!>
!  Convert position/velocity from spherical to Cartesian coordinates.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     THETA    d         longitude angle (radians)
!     PHI      d         latitude angle (radians)
!     R        d         radial distance
!     TD       d         rate of change of THETA
!     PD       d         rate of change of PHI
!     RD       d         rate of change of R
!
!  Returned:
!     PV       d(3,2)    pv-vector
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision theta, phi, r, td, pd, rd, pv(3,2)

double precision st, ct, sp, cp, rcp, x, y, rpd, w

st = sin(theta)
ct = cos(theta)
sp = sin(phi)
cp = cos(phi)
rcp = r*cp
x = rcp*ct
y = rcp*st
rpd = r*pd
w = rpd*sp - cp*rd

pv(1,1) = x
pv(2,1) = y
pv(3,1) = r*sp
pv(1,2) = - y*td - w*ct
pv(2,2) =   x*td - w*st
pv(3,2) = rpd*cp + sp*rd

end subroutine S2PV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine S2XPV ( s1, s2, pv, spv )
!>
!  Multiply a pv-vector by two scalars.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     S1       d         scalar to multiply position component by
!     S2       d         scalar to multiply velocity component by
!     PV       d(3,2)    pv-vector
!
!  Returned:
!     SPV      d(3,2)    pv-vector: p scaled by S1, v scaled by S2
!
!  Called:
!     SXP      multiply p-vector by scalar
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision s1, s2, pv(3,2), spv(3,2)

call SXP ( s1, pv(1,1), spv(1,1) )
call SXP ( s2, pv(1,2), spv(1,2) )

end subroutine S2XPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine SEPP ( a, b, s )
!>
!  Angular separation between two p-vectors.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     A        d(3)      first p-vector (not necessarily unit length)
!     B        d(3)      second p-vector (not necessarily unit length)
!
!  Returned:
!     S        d         angular separation (radians, always positive)
!
!  Notes:
!
!  1) If either vector is null, a zero result is returned.
!
!  2) The angular separation is most simply formulated in terms of
!     scalar product.  However, this gives poor accuracy for angles
!     near zero and pi.  The present algorithm uses both cross product
!     and dot product, to deliver full accuracy whatever the size of
!     the angle.
!
!  Called:
!     PXP      vector product of two p-vectors
!     PM       modulus of p-vector
!     PDP      scalar product of two p-vectors
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision a(3), b(3), s

double precision axb(3), ss, cs

!  Sine of the angle between the vectors, multiplied by the two moduli.
call PXP ( a, b, axb )
call PM ( axb, ss )

!  Cosine of the angle, multiplied by the two moduli.
call PDP ( a, b, cs )

!  The angle.
if ( ss/=0d0 .or. cs/=0d0 ) then
   s = atan2(ss,cs)
else
   s = 0d0
end if

end subroutine SEPP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine SEPS ( al, ap, bl, bp, s )
!>
!  Angular separation between two sets of spherical coordinates.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     AL       d         first longitude (radians)
!     AP       d         first latitude (radians)
!     BL       d         second longitude (radians)
!     BP       d         second latitude (radians)
!
!  Returned:
!     S        d         angular separation (radians)
!
!  Called:
!     S2C      spherical coordinates to unit vector
!     SEPP     angular separation between two p-vectors
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision al, ap, bl, bp, s

double precision ac(3), bc(3)

!  Spherical to Cartesian.
call S2C ( al, ap, ac )
call S2C ( bl, bp, bc )

!  Angle between the vectors.
call SEPP ( ac, bc, s )

end subroutine SEPS
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
double precision function SP00 ( date1, date2 )
!>
!  The TIO locator s', positioning the Terrestrial Intermediate Origin
!  on the equator of the Celestial Intermediate Pole.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2    d      TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     SP00       d      the TIO locator s' in radians (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The TIO locator s' is obtained from polar motion observations by
!     numerical integration, and so is in essence unpredictable.
!     However, it is dominated by a secular drift of about
!     47 microarcseconds per century, which is the approximation
!     evaluated by the present routine.
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2009 December 15
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

!  Time since J2000.0, in Julian centuries
double precision t

!  Interval between fundamental epoch J2000.0 and current date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Approximate s'.
SP00 = -47d-6 * t * das2r

end function SP00
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine STARPM ( ra1, dec1, pmr1, pmd1, px1, rv1, &
                        ep1a, ep1b, ep2a, ep2b, &
                        ra2, dec2, pmr2, pmd2, px2, rv2, j )
!>
!  Star proper motion:  update star catalog data for space motion.
!
!  Status:  support routine.
!
!  Given:
!     RA1      d         right ascension (radians), before
!     DEC1     d         declination (radians), before
!     PMR1     d         RA proper motion (radians/year), before
!     PMD1     d         Dec proper motion (radians/year), before
!     PX1      d         parallax (arcseconds), before
!     RV1      d         radial velocity (km/s, +ve = receding), before
!     EP1A     d         "before" epoch, part A (Note 1)
!     EP1B     d         "before" epoch, part B (Note 1)
!     EP2A     d         "after" epoch, part A (Note 1)
!     EP2B     d         "after" epoch, part B (Note 1)
!
!  Returned:
!     RA2      d         right ascension (radians), after
!     DEC2     d         declination (radians), after
!     PMR2     d         RA proper motion (radians/year), after
!     PMD2     d         Dec proper motion (radians/year), after
!     PX2      d         parallax (arcseconds), after
!     RV2      d         radial velocity (km/s, +ve = receding), after
!     J        i         status:
!                          -1 = system error (should not occur)
!                           0 = no warnings or errors
!                           1 = distance overridden (Note 6)
!                           2 = excessive velocity (Note 7)
!                           4 = solution didn't converge (Note 8)
!                        else = binary logical OR of the above warnings
!
!  Notes:
!
!  1) The starting and ending TDB epochs EP1A+EP1B and EP2A+EP2B are
!     Julian Dates, apportioned in any convenient way between the two
!     parts (A and B).  For example, JD(TDB)=2450123.7 could be
!     expressed in any of these ways, among others:
!
!             EPnA          EPnB
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) In accordance with normal star-catalog conventions, the object's
!     right ascension and declination are freed from the effects of
!     secular aberration.  The frame, which is aligned to the catalog
!     equator and equinox, is Lorentzian and centered on the SSB.
!
!     The proper motions are the rate of change of the right ascension
!     and declination at the catalog epoch and are in radians per TDB
!     Julian year.
!
!     The parallax and radial velocity are in the same frame.
!
!  3) Care is needed with units.  The star coordinates are in radians
!     and the proper motions in radians per Julian year, but the
!     parallax is in arcseconds.
!
!  4) The RA proper motion is in terms of coordinate angle, not true
!     angle.  If the catalog uses arcseconds for both RA and Dec proper
!     motions, the RA proper motion will need to be divided by cos(Dec)
!     before use.
!
!  5) Straight-line motion at constant speed, in the inertial frame,
!     is assumed.
!
!  6) An extremely small (or zero or negative) parallax is interpreted
!     to mean that the object is on the "celestial sphere", the radius
!     of which is an arbitrary (large) value (see the STARPV routine
!     for the value used).  When the distance is overridden in this way,
!     the status, initially zero, has 1 added to it.
!
!  7) If the space velocity is a significant fraction of c (see the
!     constant VMAX in the routine STARPV), it is arbitrarily set to
!     zero.  When this action occurs, 2 is added to the status.
!
!  8) The relativistic adjustment carried out in the STARPV routine
!     involves an iterative calculation.  If the process fails to
!     converge within a set number of iterations, 4 is added to the
!     status.
!
!  Called:
!     STARPV   star catalog data to space motion pv-vector
!     PVU      update a pv-vector
!     PDP      scalar product of two p-vectors
!     PVSTAR   space motion pv-vector to star catalog data
!
!  This revision:  2017 March 16
!
!-----------------------------------------------------------------------

implicit none

double precision ra1, dec1, pmr1, pmd1, px1, rv1, &
                 ep1a, ep1b, ep2a, ep2b, &
                 ra2, dec2, pmr2, pmd2, px2, rv2
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

!  Speed of light (m/s)
double precision cmps
parameter ( cmps = 299792458d0 )

!  Astronomical unit (m, IAU 2012)
double precision aum
parameter ( aum = 149597870.7d3 )

!  Speed of light (au per day)
double precision c
parameter ( c = d2s*cmps/aum )

double precision pv1(3,2), r, tl1, dt, pv(3,2), r2, rdv, v2, &
                 c2mv2, tl2, pv2(3,2)
integer j1, j2

!  RA,Dec etc. at the "before" epoch to space motion pv-vector.
call STARPV ( ra1, dec1, pmr1, pmd1, px1, rv1, pv1, j1 )

!  Light time when observed (days).
call PM ( pv1, r )
tl1 = r / c

!  Time interval, "before" to "after" (days).
dt = ( ep2a-ep1a ) + ( ep2b-ep1b )

!  Move star along track from the "before" observed position to the
!  "after" geometric position.
call PVU ( dt+tl1, pv1, pv )

!  From this geometric position, deduce the observed light time (days)
!  at the "after" epoch (with theoretically unneccessary error check).
call PDP ( pv(1,1), pv(1,1), r2 )
call PDP ( pv(1,1), pv(1,2), rdv )
call PDP ( pv(1,2), pv(1,2), v2 )
c2mv2 = c*c - v2
if ( c2mv2 <= 0d0 ) then
   j = -1
   go to 9
end if
tl2 = ( - rdv + sqrt(rdv*rdv + c2mv2*r2) ) / c2mv2

!  Move the position along track from the observed place at the
!  "before" epoch to the observed place at the "after" epoch.
call PVU ( dt + ( tl1-tl2 ), pv1, pv2 )

!  Space motion pv-vector to RA,Dec etc. at the "after" epoch.
call PVSTAR ( pv2, ra2, dec2, pmr2, pmd2, px2, rv2, j2 )

!  Return the status.
if ( j2 /= 0 ) j1 = -1
j = j1

!  Exit.
9 continue

end subroutine STARPM
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine STARPV ( ra, dec, pmr, pmd, px, rv, pv, j )
!>
!  Convert star catalog coordinates to position+velocity vector.
!
!  Status:  support routine.
!
!  Given (Note 1):
!     RA       d         right ascension (radians)
!     DEC      d         declination (radians)
!     PMR      d         RA proper motion (radians/year)
!     PMD      d         Dec proper motion (radians/year)
!     PX       d         parallax (arcseconds)
!     RV       d         radial velocity (km/s, positive = receding)
!
!  Returned (Note 2):
!     PV       d(3,2)    pv-vector (au, au/day)
!     J        i         status:
!                           0 = no warnings
!                           1 = distance overridden (Note 6)
!                           2 = excessive velocity (Note 7)
!                           4 = solution didn't converge (Note 8)
!                        else = binary logical OR of the above
!
!  Notes:
!
!  1) The star data accepted by this routine are "observables" for an
!     imaginary observer at the solar-system barycenter.  Proper motion
!     and radial velocity are, strictly, in terms of barycentric
!     coordinate time, TCB.  For most practical applications, it is
!     permissible to neglect the distinction between TCB and ordinary
!     "proper" time on Earth (TT/TAI).  The result will, as a rule, be
!     limited by the intrinsic accuracy of the proper-motion and radial-
!     velocity data;  moreover, the pv-vector is likely to be merely an
!     intermediate result, so that a change of time unit would cancel
!     out overall.
!
!     In accordance with normal star-catalog conventions, the object's
!     right ascension and declination are freed from the effects of
!     secular aberration.  The frame, which is aligned to the catalog
!     equator and equinox, is Lorentzian and centered on the SSB.
!
!  2) The resulting position and velocity pv-vector is with respect to
!     the same frame and, like the catalog coordinates, is freed from
!     the effects of secular aberration.  Should the "coordinate
!     direction", where the object was located at the catalog epoch, be
!     required, it may be obtained by calculating the magnitude of the
!     position vector PV(1-3,1) dividing by the speed of light in au/day
!     to give the light-time, and then multiplying the space velocity
!     PV(1-3,2) by this light-time and adding the result to PV(1-3,1).
!
!     Summarizing, the pv-vector returned is for most stars almost
!     identical to the result of applying the standard geometrical
!     "space motion" transformation.  The differences, which are the
!     subject of the Stumpff paper referenced below, are:
!
!     (i) In stars with significant radial velocity and proper motion,
!     the constantly changing light-time distorts the apparent proper
!     motion.  Note that this is a classical, not a relativistic,
!     effect.
!
!     (ii) The transformation complies with special relativity.
!
!  3) Care is needed with units.  The star coordinates are in radians
!     and the proper motions in radians per Julian year, but the
!     parallax is in arcseconds; the radial velocity is in km/s, but
!     the pv-vector result is in au and au/day.
!
!  4) The RA proper motion is in terms of coordinate angle, not true
!     angle.  If the catalog uses arcseconds for both RA and Dec proper
!     motions, the RA proper motion will need to be divided by cos(Dec)
!     before use.
!
!  5) Straight-line motion at constant speed, in the inertial frame,
!     is assumed.
!
!  6) An extremely small (or zero or negative) parallax is interpreted
!     to mean that the object is on the "celestial sphere", the radius
!     of which is an arbitrary (large) value (see the constant PXMIN).
!     When the distance is overridden in this way, the status, initially
!     zero, has 1 added to it.
!
!  7) If the space velocity is a significant fraction of c (see the
!     constant VMAX), it is arbitrarily set to zero.  When this action
!     occurs, 2 is added to the status.
!
!  8) The relativistic adjustment involves an iterative calculation.
!     If the process fails to converge within a set number (IMAX) of
!     iterations, 4 is added to the status.
!
!  9) The inverse transformation is performed by the routine PVSTAR.
!
!  Called:
!     S2PV     spherical coordinates to pv-vector
!     PM       modulus of p-vector
!     ZP       zero p-vector
!     PN       decompose p-vector into modulus and direction
!     PDP      scalar product of two p-vectors
!     SXP      multiply p-vector by scalar
!     PMP      p-vector minus p-vector
!     PPP      p-vector plus p-vector
!
!  Reference:
!
!     Stumpff, P., Astron.Astrophys. 144, 232-240 (1985).
!
!  This revision:  2017 March 16
!
!-----------------------------------------------------------------------

implicit none

double precision ra, dec, pmr, pmd, px, rv, pv(3,2)
integer j

!  Smallest allowed parallax
double precision pxmin
parameter ( pxmin = 1d-7 )

!  Largest allowed speed (fraction of c)
double precision vmax
parameter ( vmax = 0.5d0 )

!  Julian years to days
double precision y2d
parameter ( y2d = 365.25d0 )

!  Radians to arcseconds
double precision dr2as
parameter ( dr2as = 206264.8062470963551564734d0 )

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

!  Speed of light (m/s)
double precision cmps
parameter ( cmps = 299792458d0 )

!  Astronomical unit (m, IAU 2012)
double precision aum
parameter ( aum = 149597870.7d3 )

!  Speed of light (au per day)
double precision c
parameter ( c = d2s*cmps/aum )

!  Maximum number of iterations for relativistic solution
integer i,imax
parameter ( imax = 100 )

integer iwarn
double precision w, r, rd, rad, decd, v, x(3), usr(3), ust(3), &
                 vsr, vst, betst, betsr, bett, betr, od, odel, &
                 dd, ddel, odd, oddel, d, del, ur(3), ut(3)

!  Distance (au).
if ( px>=pxmin ) then
   w = px
   iwarn = 0
else
   w = pxmin
   iwarn = 1
end if
r = dr2as / w

!  Radial velocity (au/day).
rd = d2s * rv * 1d3 / aum

!  Proper motion (radian/day).
rad = pmr / y2d
decd = pmd / y2d

!  To pv-vector (au,au/day).
call S2PV ( ra, dec, r, rad, decd, rd, pv )

!  If excessive velocity, arbitrarily set it to zero.
call PM ( pv(1,2), v )
if ( v/c > vmax ) then
   call ZP ( pv(1,2) )
   iwarn = iwarn + 2
end if

!  Isolate the radial component of the velocity (au/day).
call PN ( pv(1,1), w, x )
call PDP ( x, pv(1,2), vsr )
call SXP ( vsr, x, usr )

!  Isolate the transverse component of the velocity (au/day).
call PMP ( pv(1,2), usr, ust )
call PM ( ust, vst )

!  Special-relativity dimensionless parameters.
betsr = vsr / c
betst = vst / c

!  Determine the inertial-to-observed relativistic correction terms.
od = 0d0
odel = 0d0
odd = 0d0
oddel = 0d0
bett = betst
betr = betsr
do 1 i=1,imax
   d = 1d0 + betr
   w = betr*betr + bett*bett
   del = - w / ( sqrt(1d0-w) + 1d0 )
   betr = d*betsr + del
   bett = d*betst
   if ( i > 1 ) then
      dd = abs(d-od)
      ddel = abs(del-odel)
      if ( i>2 .and. &
           dd>=odd .and. &
           ddel>=oddel ) go to 2
      if ( i >= imax ) iwarn = iwarn + 4
      odd = dd
      oddel = ddel
   end if
   od = d
   odel = del
1 continue
2 continue

!  Replace observed radial velocity with inertial value.
if ( betsr /= 0d0 ) then
   w = d + del/betsr
else
   w = 1d0
end if
call SXP ( w, usr, ur )

!  Replace observed tangential velocity with inertial value.
call SXP ( d, ust, ut )

!  Combine the two to obtain the inertial space velocity.
call PPP ( ur, ut, pv(1,2) )

!  Return the status.
j = iwarn

end subroutine STARPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine SXP ( s, p, sp )
!>
!  Multiply a p-vector by a scalar.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     S        d         scalar
!     P        d(3)      p-vector
!
!  Returned:
!     SP       d(3)      S * P
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision s, p(3), sp(3)

integer i

do 1 i=1,3
   sp(i) = s * p(i)
1 continue

end subroutine SXP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine SXPV ( s, pv, spv )
!>
!  Multiply a pv-vector by a scalar.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     S        d         scalar
!     PV       d(3,2)    pv-vector
!
!  Returned:
!     SPV      d(3,2)    S * PV
!
!  Called:
!     S2XPV    multiply pv-vector by two scalars
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision s, pv(3,2), spv(3,2)

call S2XPV ( s, s, pv, spv )

end subroutine SXPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TAITT ( tai1, tai2, tt1, tt2, j )
!>
!  Time scale transformation:  International Atomic Time, TAI, to
!  Terrestrial Time, TT.
!
!  Status:  canonical.
!
!  Given:
!     TAI1,TAI2    d      TAI as a 2-part Julian Date
!
!  Returned:
!     TT1,TT2      d      TT as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Note:
!
!     TAI1+TAI2 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where TAI1 is the Julian
!     Day Number and TAI2 is the fraction of a day.  The returned
!     TT1,TT2 follow suit.
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tai1, tai2, tt1, tt2
integer j

!  TT minus TAI (days).
double precision dtat
parameter ( dtat = 32.184d0/86400d0 )

!  Result, safeguarding precision.
if ( abs(tai1)>abs(tai2) ) then
   tt1 = tai1
   tt2 = tai2 + dtat
else
   tt1 = tai1 + dtat
   tt2 = tai2
end if

!  Status (always OK).
j = 0

end subroutine TAITT
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TAIUT1 ( tai1, tai2, dta, ut11, ut12, j )
!>
!  Time scale transformation:  International Atomic Time, TAI, to
!  Universal Time, UT1.
!
!  Status:  canonical.
!
!  Given:
!     TAI1,TAI2    d      TAI as a 2-part Julian Date
!     DTA          d      UT1-TAI in seconds
!
!  Returned:
!     UT11,UT12    d      UT1 as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Notes:
!
!  1) TAI1+TAI2 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where TAI1 is the Julian
!     Day Number and TAI2 is the fraction of a day.  The returned
!     UT11,UT12 follow suit.
!
!  2) The argument DTA, i.e. UT1-TAI, is an observed quantity, and is
!     available from IERS tabulations.
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tai1, tai2, dta, ut11, ut12
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

double precision dtad

!  Result, safeguarding precision.
dtad = dta/d2s
if ( abs(tai1)>abs(tai2) ) then
   ut11 = tai1
   ut12 = tai2 + dtad
else
   ut11 = tai1 + dtad
   ut12 = tai2
end if

!  Status (always OK).
j = 0

end subroutine TAIUT1
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TAIUTC ( tai1, tai2, utc1, utc2, j )
!>
!  Time scale transformation:  International Atomic Time, TAI, to
!  Coordinated Universal Time, UTC.
!
!  Status:  canonical.
!
!  Given:
!     TAI1,TAI2    d      TAI as a 2-part Julian Date (Note 1)
!
!  Returned:
!     UTC1,UTC2    d      UTC as a 2-part quasi Julian Date (Notes 1-3)
!     J            i      status: +1 = dubious year (Note 4)
!                                  0 = OK
!                                 -1 = unacceptable date
!
!  Notes:
!
!  1) TAI1+TAI2 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where TAI1 is the Julian
!     Day Number and TAI2 is the fraction of a day.  The returned UTC1
!     and UTC2 form an analogous pair, except that a special convention
!     is used, to deal with the problem of leap seconds - see the next
!     note.
!
!  2) JD cannot unambiguously represent UTC during a leap second unless
!     special measures are taken.  The convention in the present routine
!     is that the JD day represents UTC days whether the length is
!     86399, 86400 or 86401 SI seconds.  In the 1960-1972 era there were
!     smaller jumps (in either direction) each time the linear UTC(TAI)
!     expression was changed, and these "mini-leaps" are also included
!     in the SOFA convention.
!
!  3) The routine D2DTF can be used to transform the UTC quasi-JD
!     into calendar date and clock time, including UTC leap second
!     handling.
!
!  4) The warning status "dubious year" flags UTCs that predate the
!     introduction of the time scale or that are too far in the future
!     to be trusted.  See DAT for further details.
!
!  Called:
!     UTCTAI   UTC to TAI
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tai1, tai2, utc1, utc2
integer j

logical big1
integer i, js
double precision a1, a2, u1, u2, g1, g2

!  Put the two parts of the TAI into big-first order.
big1 = abs(tai1) >= abs(tai2)
if ( big1 ) then
   a1 = tai1
   a2 = tai2
else
   a1 = tai2
   a2 = tai1
end if

!  Initial guess for UTC.
u1 = a1
u2 = a2

!  Iterate (though in most cases just once is enough).
do i=1,3

!     Guessed UTC to TAI.
   call UTCTAI ( u1, u2, g1, g2, js )
   if ( js<0 ) go to 9

!     Adjust guessed UTC.
   u2 = u2 + (a1-g1)
   u2 = u2 + (a2-g2)

end do

!  Return the UTC result, preserving the TAI order.
if ( big1 ) then
   utc1 = u1
   utc2 = u2
else
   utc1 = u2
   utc2 = u1
end if

!  Status.
9 continue
j = js

end subroutine TAIUTC
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TCBTDB ( tcb1, tcb2, tdb1, tdb2, j )
!>
!  Time scale transformation:  Barycentric Coordinate Time, TCB, to
!  Barycentric Dynamical Time, TDB.
!
!  Status:  canonical.
!
!  Given:
!     TCB1,TCB2    d      TCB as a 2-part Julian Date
!
!  Returned:
!     TDB1,TDB2    d      TDB as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Notes:
!
!  1) TCB1+TCB2 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where TCB1 is the Julian
!     Day Number and TCB2 is the fraction of a day.  The returned
!     TDB1,TDB2 follow suit.
!
!  2) The 2006 IAU General Assembly introduced a conventional linear
!     transformation between TDB and TCB.  This transformation
!     compensates for the drift between TCB and terrestrial time TT,
!     and keeps TDB approximately centered on TT.  Because the
!     relationship between TT and TCB depends on the adopted solar
!     system ephemeris, the degree of alignment between TDB and TT over
!     long intervals will vary according to which ephemeris is used.
!     Former definitions of TDB attempted to avoid this problem by
!     stipulating that TDB and TT should differ only by periodic
!     effects.  This is a good description of the nature of the
!     relationship but eluded precise mathematical formulation.  The
!     conventional linear relationship adopted in 2006 sidestepped
!     these difficulties whilst delivering a TDB that in practice was
!     consistent with values before that date.
!
!  3) TDB is essentially the same as Teph, the time argument for the
!     JPL solar system ephemerides.
!
!  Reference:
!
!     IAU 2006 Resolution B3
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tcb1, tcb2, tdb1, tdb2
integer j

!  1977 Jan 1.0 TAI = 1977/1/1 00:00:32.184 TCB, as two-part JD
double precision t77td, t77tf
parameter ( t77td = 2443144d0, &
            t77tf = 0.5003725d0 )

!  L_B, and TDB0 (d)
double precision elb, tdb0
parameter ( elb = 1.550519768d-8, &
            tdb0 = -6.55d-5/86400d0 )

double precision d

!  Result, safeguarding precision.
if ( abs(tcb1)>abs(tcb2) ) then
   d = tcb1 - t77td
   tdb1 = tcb1
   tdb2 = tcb2 + tdb0 - ( d + ( tcb2-t77tf ) ) * elb
else
   d = tcb2 - t77td
   tdb1 = tcb1 + tdb0 - ( d + ( tcb1-t77tf ) ) * elb
   tdb2 = tcb2
end if

!  Status (always OK).
j = 0

end subroutine TCBTDB
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TCGTT ( tcg1, tcg2, tt1, tt2, j )
!>
!  Time scale transformation:  Geocentric Coordinate Time, TCG, to
!  Terrestrial Time, TT.
!
!  Status:  canonical.
!
!  Given:
!     TCG1,TCG2    d      TCG as a 2-part Julian Date
!
!  Returned:
!     TT1,TT2      d      TT as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Note:
!
!     TCG1+TCG2 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where TCG1 is the Julian
!     Day Number and TCG2 is the fraction of a day.  The returned
!     TT1,TT2 follow suit.
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),.
!     IERS Technical Note No. 32, BKG (2004)
!
!     IAU 2000 Resolution B1.9
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tcg1, tcg2, tt1, tt2
integer j

!  JD for MJD 0
double precision djm0
parameter (djm0 = 2400000.5d0 )

!  1977 Jan 1 00:00:32.184 TT, as MJD
double precision t77t
parameter ( t77t = 43144.0003725d0 )

!  L_G = 1 - dTT/dTCG
double precision elg
parameter ( elg = 6.969290134d-10 )

!  Result, safeguarding precision.
if ( abs(tcg1)>abs(tcg2) ) then
   tt1 = tcg1
   tt2 = tcg2 - ( ( tcg1-djm0 ) + ( tcg2-t77t ) ) * elg
else
   tt1 = tcg1 - ( ( tcg2-djm0 ) + ( tcg1-t77t ) ) * elg
   tt2 = tcg2
end if

!  Status (always OK).
j = 0

end subroutine TCGTT
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------

subroutine TDBTCB ( tdb1, tdb2, tcb1, tcb2, j )
!>
!  Time scale transformation:  Barycentric Dynamical Time, TDB, to
!  Barycentric Coordinate Time, TCB.
!
!  Status:  canonical.
!
!  Given:
!     TDB1,TDB2    d      TDB as a 2-part Julian Date
!
!  Returned:
!     TCB1,TCB2    d      TCB as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Notes:
!
!  1) TDB1+TDB2 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where TDB1 is the Julian
!     Day Number and TDB2 is the fraction of a day.  The returned
!     TCB1,TCB2 follow suit.
!
!  2) The 2006 IAU General Assembly introduced a conventional linear
!     transformation between TDB and TCB.  This transformation
!     compensates for the drift between TCB and terrestrial time TT,
!     and keeps TDB approximately centered on TT.  Because the
!     relationship between TT and TCB depends on the adopted solar
!     system ephemeris, the degree of alignment between TDB and TT over
!     long intervals will vary according to which ephemeris is used.
!     Former definitions of TDB attempted to avoid this problem by
!     stipulating that TDB and TT should differ only by periodic
!     effects.  This is a good description of the nature of the
!     relationship but eluded precise mathematical formulation.  The
!     conventional linear relationship adopted in 2006 sidestepped
!     these difficulties whilst delivering a TDB that in practice was
!     consistent with values before that date.
!
!  3) TDB is essentially the same as Teph, the time argument for the
!     JPL solar system ephemerides.
!
!  Reference:
!
!     IAU 2006 Resolution B3
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tdb1, tdb2, tcb1, tcb2
integer j

!  1977 Jan 1.0 TAI = 1977/1/1 00:00:32.184 TCB, as two-part JD
double precision t77td, t77tf
parameter ( t77td = 2443144d0, &
            t77tf = 0.5003725d0 )

!  L_B, and TDB0 (d)
double precision elb, tdb0
parameter ( elb = 1.550519768d-8, &
            tdb0 = -6.55d-5/86400d0 )

!  TDB to TCB rate
double precision elbb
parameter ( elbb = elb/(1d0-elb) )

double precision d, f

!  Result, preserving date format but safeguarding precision.
if ( abs(tdb1)>abs(tdb2) ) then
   d = t77td - tdb1
   f = tdb2 - tdb0
   tcb1 = tdb1
   tcb2 = f - ( d - ( f - t77tf ) ) * elbb
else
   d = t77td - tdb2
   f = tdb1 - tdb0
   tcb1 = f - ( d - ( f - t77tf ) ) * elbb
   tcb2 = tdb2
end if

!  Status (always OK).
j = 0

end subroutine TDBTCB
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TDBTT ( tdb1, tdb2, dtr, tt1, tt2, j )
!>
!  Time scale transformation:  Barycentric Dynamical Time, TDB, to
!  Terrestrial Time, TT.
!
!  Status:  canonical.
!
!  Given:
!     TDB1,TDB2    d      TDB as a 2-part Julian Date
!     DTR          d      TDB-TT in seconds
!
!  Returned:
!     TT1,TT2      d      TT as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Notes:
!
!  1) TDB1+TDB2 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where TDB1 is the Julian
!     Day Number and TDB2 is the fraction of a day.  The returned
!     TT1,TT2 follow suit.
!
!  2) The argument DTR represents the quasi-periodic component of the
!     GR transformation between TT and TCB.  It is dependent upon the
!     adopted solar-system ephemeris, and can be obtained by numerical
!     integration, by interrogating a precomputed time ephemeris or by
!     evaluating a model such as that implemented in the SOFA routine
!     DTDB.  The quantity is dominated by an annual term of 1.7 ms
!     amplitude.
!
!  3) TDB is essentially the same as Teph, the time argument for the
!     JPL solar system ephemerides.
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     IAU 2006 Resolution 3
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tdb1, tdb2, dtr, tt1, tt2
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

double precision dtrd

!  Result, safeguarding precision.
dtrd = dtr/d2s
if ( abs(tdb1)>abs(tdb2) ) then
   tt1 = tdb1
   tt2 = tdb2 - dtrd
else
   tt1 = tdb1 - dtrd
   tt2 = tdb2
end if

!  Status (always OK).
j = 0

end subroutine TDBTT
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TF2A ( s, ihour, imin, sec, rad, j )
!>
!  Convert hours, minutes, seconds to radians.
!
!  Status:  support routine.
!
!  Given:
!     S          c      sign:  '-' = negative, otherwise positive
!     IHOUR      i      hours
!     IMIN       i      minutes
!     SEC        d      seconds
!
!  Returned:
!     RAD        d      angle in radians
!     J          i      status:  0 = OK
!                                1 = IHOUR outside range 0-23
!                                2 = IMIN outside range 0-59
!                                3 = SEC outside range 0-59.999...
!
!  Notes:
!
!  1)  If the s argument is a string, only the leftmost character is
!      used and no warning status is provided.
!
!  2)  The result is computed even if any of the range checks fail.
!
!  3)  Negative IHOUR, IMIN and/or SEC produce a warning status, but the
!      absolute value is used in the conversion.
!
!  4)  If there are multiple errors, the status value reflects only the
!      first, the smallest taking precedence.
!
!  This revision:  2013 December 2
!
!-----------------------------------------------------------------------

implicit none

character s
integer ihour, imin
double precision sec, rad
integer j

!  Seconds of time to radians
double precision ds2r
parameter ( ds2r = 7.272205216643039903848712d-5 )

double precision w

!  Preset the status.
j = 0

!  Validate seconds, minutes, hours.
if ( sec<0d0 .or. sec>=60d0 ) j=3
if ( imin<0 .or. imin>59 ) j=2
if ( ihour<0 .or. ihour>23 ) j=1

!  Compute the angle.
w = ( 60d0 * ( 60d0 * dble( abs(ihour) ) + &
                      dble( abs(imin) ) ) + &
                            abs(sec) ) * ds2r

!  Apply the sign.
if ( s == '-' ) w = -w

!  Return the result.
rad = w

end subroutine TF2A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TF2D ( s, ihour, imin, sec, days, j )
!>
!  Convert hours, minutes, seconds to days.
!
!  Status:  support routine.
!
!  Given:
!     S          c      sign:  '-' = negative, otherwise positive
!     IHOUR      i      hours
!     IMIN       i      minutes
!     SEC        d      seconds
!
!  Returned:
!     DAYS       d      interval in days
!     J          i      status:  0 = OK
!                                1 = IHOUR outside range 0-23
!                                2 = IMIN outside range 0-59
!                                3 = SEC outside range 0-59.999...
!
!  Notes:
!
!  1)  If the s argument is a string, only the leftmost character is
!      used and no warning status is provided.
!
!  2)  The result is computed even if any of the range checks fail.
!
!  3)  Negative IHOUR, IMIN and/or SEC produce a warning status, but the
!      absolute value is used in the conversion.
!
!  4)  If there are multiple errors, the status value reflects only the
!      first, the smallest taking precedence.
!
!  This revision:  2013 December 2
!
!-----------------------------------------------------------------------

implicit none

character s
integer ihour, imin
double precision sec, days
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

double precision w

!  Preset the status.
j = 0

!  Validate seconds, minutes, hours.
if ( sec<0d0 .or. sec>=60d0 ) j=3
if ( imin<0 .or. imin>59 ) j=2
if ( ihour<0 .or. ihour>23 ) j=1

!  Compute the interval.
w = ( 60d0 * ( 60d0 * dble( abs(ihour) ) + &
                      dble( abs(imin) ) ) + &
                            abs(sec) ) / d2s

!  Apply the sign.
if ( s == '-' ) w = -w

!  Return the result.
days = w

end subroutine TF2D
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TPORS ( xi, eta, a, b, a01, b01, a02, b02, n )
!>
!  In the tangent plane projection, given the rectangular coordinates
!  of a star and its spherical coordinates, determine the spherical
!  coordinates of the tangent point.
!
!  Status:  support routine.
!
!  Given:
!     XI,ETA    d       rectangular coordinates of star image (Note 2)
!     A,B       d       star's spherical coordinates (Note 3)
!
!  Returned:
!     A01,B01   d       tangent point's spherical coordinates, Soln. 1
!     A02,B02   d       tangent point's spherical coordinates, Soln. 2
!     N         i       number of solutions:
!                         0 = no solutions returned (Note 5)
!                         1 = only the first solution is useful (Note 6)
!                         2 = both solutions are useful (Note 6)
!
!  Notes:
!
!  1) The tangent plane projection is also called the "gnomonic
!     projection" and the "central projection".
!
!  2) The eta axis points due north in the adopted coordinate system.
!     If the spherical coordinates are observed (RA,Dec), the tangent
!     plane coordinates (xi,eta) are conventionally called the "standard
!     coordinates".  If the spherical coordinates are with respect to a
!     right-handed triad, (xi,eta) are also right-handed.  The units of
!     (xi,eta) are, effectively, radians at the tangent point.
!
!  3) All angular arguments are in radians.
!
!  4) The angles A01 and A02 are returned in the range 0-2pi.  The
!     angles B01 and B02 are returned in the range +/-pi, but in the
!     usual, non-pole-crossing, case, the range is +/-pi/2.
!
!  5) Cases where there is no solution can arise only near the poles.
!     For example, it is clearly impossible for a star at the pole
!     itself to have a non-zero xi value, and hence it is meaningless
!     to ask where the tangent point would have to be to bring about
!     this combination of xi and dec.
!
!  6) Also near the poles, cases can arise where there are two useful
!     solutions.  The returned value N indicates whether the second of
!     the two solutions returned is useful;  N=1 indicates only one
!     useful solution, the usual case.
!
!  7) The basis of the algorithm is to solve the spherical triangle PSC,
!     where P is the north celestial pole, S is the star and C is the
!     tangent point.  The spherical coordinates of the tangent point are
!     [a0,b0];  writing rho^2 = (xi^2+eta^2) and r^2 = (1+rho^2), side c
!     is then (pi/2-b), side p is sqrt(xi^2+eta^2) and side s (to be
!     found) is (pi/2-b0).  Angle C is given by sin(C) = xi/rho and
!     cos(C) = eta/rho.  Angle P (to be found) is the longitude
!     difference between star and tangent point (a-a0).
!
!  8) This routine is a member of the following set:
!
!         spherical       vector       solve for
!
!         TPXES      TPXEV      xi,eta
!         TPSTS      TPSTV       star
!       > TPORS <    TPORV      origin
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!
!  References:
!
!     Calabretta M.R. & Greisen, E.W., 2002, "Representations of
!     celestial coordinates in FITS", Astron.Astrophys. 395, 1077
!
!     Green, R.M., "Spherical Astronomy", Cambridge University Press,
!     1987, Chapter 13.
!
!  This revision:   2018 January 2
!
!-----------------------------------------------------------------------

implicit none

double precision xi, eta, a, b, a01, b01, a02, b02
integer n

double precision xi2, r, sb, cb, rsb, rcb, w2, w, s, c

!     DOUBLE PRECISION ANP

xi2 = xi*xi
r = sqrt(1d0+xi2+eta*eta)
sb = sin(b)
cb = cos(b)
rsb = r*sb
rcb = r*cb
w2 = rcb*rcb - xi2
if ( w2 >= 0d0 ) then
   w = sqrt(w2)
   s = rsb - eta*w
   c = rsb*eta + w
   if ( xi == 0d0 .and. w == 0d0 ) w = 1d0
   a01 = ANP(a - atan2(xi,w))
   b01 = atan2(s,c)
   w = -w
   s = rsb - eta*w
   c = rsb*eta + w
   a02 = ANP(a - atan2(xi,w))
   b02 = atan2(s,c)
   if ( abs(rsb) < 1d0 ) then
      n = 1
   else
      n = 2
   end if
else
   n = 0
end if

end subroutine TPORS
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TPORV ( xi, eta, v, v01, v02, n )
!>
!  In the tangent plane projection, given the rectangular coordinates
!  of a star and its direction cosines, determine the direction
!  cosines of the tangent point.
!
!  Status:  support routine.
!
!  Given:
!     XI,ETA    d       rectangular coordinates of star image (Note 2)
!     V         d(3)    star's direction cosines (Note 3)
!
!  Returned:
!     V01       d(3)    tangent point's direction cosines, Solution 1
!     V02       d(3)    tangent point's direction cosines, Solution 2
!     N         i       number of solutions:
!                         0 = no solutions returned (Note 4)
!                         1 = only the first solution is useful (Note 5)
!                         2 = both solutions are useful (Note 5)
!
!  Notes:
!
!  1) The tangent plane projection is also called the "gnomonic
!     projection" and the "central projection".
!
!  2) The eta axis points due north in the adopted coordinate system.
!     If the direction cosines represent observed (RA,Dec), the tangent
!     plane coordinates (xi,eta) are conventionally called the "standard
!     coordinates".  If the direction cosines are with respect to a
!     right-handed triad, (xi,eta) are also right-handed.  The units of
!     (xi,eta) are, effectively, radians at the tangent point.
!
!  3) The vector V must be of unit length or the result will be wrong.
!
!  4) Cases where there is no solution can arise only near the poles.
!     For example, it is clearly impossible for a star at the pole
!     itself to have a non-zero xi value, and hence it is meaningless
!     to ask where the tangent point would have to be.
!
!  5) Also near the poles, cases can arise where there are two useful
!     solutions.  The returned value N indicates whether the second of
!     the two solutions returned is useful;  N=1 indicates only one
!     useful solution, the usual case.
!
!  6) The basis of the algorithm is to solve the spherical triangle PSC,
!     where P is the north celestial pole, S is the star and C is the
!     tangent point.  Calling the celestial spherical coordinates of the
!     star and tangent point (a,b) and (a0,b0) respectively, and writing
!     rho^2 = (xi^2+eta^2) and r^2 = (1+rho^2), and transforming the
!     vector V into (a,b) in the normal way, side c is then (pi/2-b),
!     side p is sqrt(xi^2+eta^2) and side s (to be found) is (pi/2-b0),
!     while angle C is given by sin(C) = xi/rho and cos(C) = eta/rho;
!     angle P (to be found) is (a-a0).  After solving the spherical
!     triangle, the result (a0,b0) can be expressed in vector form as
!     V0.
!
!  7) This routine is a member of the following set:
!
!         spherical       vector       solve for
!
!         TPXES      TPXEV      xi,eta
!         TPSTS      TPSTV       star
!         TPORS    > TPORV <    origin
!
!  References:
!
!     Calabretta M.R. & Greisen, E.W., 2002, "Representations of
!     celestial coordinates in FITS", Astron.Astrophys. 395, 1077
!
!     Green, R.M., "Spherical Astronomy", Cambridge University Press,
!     1987, Chapter 13.
!
!  This revision:   2018 January 2
!
!-----------------------------------------------------------------------

implicit none

double precision xi, eta, v(3), v01(3), v02(3)
integer n

double precision x, y, z, rxy2, xi2, eta2p1, r, rsb, rcb, w2, w, c

x = v(1)
y = v(2)
z = v(3)
rxy2 = x*x+y*y
xi2 = xi*xi
eta2p1 = eta*eta+1d0
r = sqrt(xi2+eta2p1)
rsb = r*z
rcb = r*sqrt(x*x+y*y)
w2 = rcb*rcb-xi2
if ( w2 > 0d0 ) then
   w = sqrt(w2)
   c = (rsb*eta+w) / (eta2p1*sqrt(rxy2*(w2+xi2)))
   v01(1) = c * (x*w+y*xi)
   v01(2) = c * (y*w-x*xi)
   v01(3) = (rsb-eta*w) / eta2p1
   w = -w
   c = (rsb*eta+w) / (eta2p1*sqrt(rxy2*(w2+xi2)))
   v02(1) = c * (x*w+y*xi)
   v02(2) = c * (y*w-x*xi)
   v02(3) = (rsb-eta*w) / eta2p1
   if ( abs(rsb) < 1d0 ) then
      n = 1
   else
      n = 2
   end if
else
   n = 0
end if

end subroutine TPORV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TPSTS ( xi, eta, a0, b0, a, b )
!>
!  In the tangent plane projection, given the star's rectangular
!  coordinates and the spherical coordinates of the tangent point,
!  solve for the spherical coordinates of the star.
!
!  Status:  support routine.
!
!  Given:
!     XI,ETA    d       rectangular coordinates of star image (Note 2)
!     A0,B0     d       tangent point's spherical coordinates
!
!  Returned:
!     A,B       d       star's spherical coordinates
!
!  1) The tangent plane projection is also called the "gnomonic
!     projection" and the "central projection".
!
!  2) The eta axis points due north in the adopted coordinate system.
!     If the spherical coordinates are observed (RA,Dec), the tangent
!     plane coordinates (xi,eta) are conventionally called the "standard
!     coordinates".  If the direction cosines are with respect to a
!     right-handed triad, (xi,eta) are also right-handed.  The units of
!     (xi,eta) are, effectively, radians at the tangent point.
!
!  3) All angular arguments are in radians.
!
!  4) This routine is a member of the following set:
!
!         spherical       vector       solve for
!
!         TPXES      TPXEV      xi,eta
!       > TPSTS <    TPSTV       star
!         TPORS      TPORV      origin
!
!  Called:
!     ANP      normalize angle into range 0 to 2pi
!
!  References:
!
!     Calabretta M.R. & Greisen, E.W., 2002, "Representations of
!     celestial coordinates in FITS", Astron.Astrophys. 395, 1077
!
!     Green, R.M., "Spherical Astronomy", Cambridge University Press,
!     1987, Chapter 13.
!
!  This revision:   2018 January 2
!
!-----------------------------------------------------------------------

implicit none

double precision xi, eta, a0, b0, a, b

double precision sb0, cb0, d

!     DOUBLE PRECISION ANP

sb0 = sin(b0)
cb0 = cos(b0)
d = cb0 - eta*sb0
a = ANP(atan2(xi,d)+a0)
b = atan2(sb0+eta*cb0,sqrt(xi*xi+d*d))

end subroutine TPSTS
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TPSTV ( xi, eta, v0, v )
!>
!  In the tangent plane projection, given the star's rectangular
!  coordinates and the direction cosines of the tangent point, solve
!  for the direction cosines of the star.
!
!  Status:  support routine.
!
!  Given:
!     XI,ETA    d       rectangular coordinates of star image (Note 2)
!     V0        d(3)    tangent point's direction cosines (Note 4)
!
!  Returned:
!     V         d(3)    star's direction cosines
!
!  1) The tangent plane projection is also called the "gnomonic
!     projection" and the "central projection".
!
!  2) The eta axis points due north in the adopted coordinate system.
!     If the direction cosines represent observed (RA,Dec), the tangent
!     plane coordinates (xi,eta) are conventionally called the "standard
!     coordinates".  If the direction cosines are with respect to a
!     right-handed triad, (xi,eta) are also right-handed.  The units of
!     (xi,eta) are, effectively, radians at the tangent point.
!
!  3) The method used is to complete the star vector in the (xi,eta)
!     based triad and normalize it, then rotate the triad to put the
!     tangent point at the pole with the x-axis aligned to zero
!     longitude.  Writing (a0,b0) for the celestial spherical
!     coordinates of the tangent point, the sequence of rotations is
!     (b0-pi/2) around the x-axis followed by (-a0-pi/2) around the
!     z-axis.
!
!  4) If vector V0 is not of unit length, the returned vector V will
!     be wrong.
!
!  5) If vector V0 points at a pole, the returned vector V will be
!     based on the arbitrary assumption that the longitude coordinate
!     of the tangent point is zero.
!
!  6) This routine is a member of the following set:
!
!         spherical       vector       solve for
!
!         TPXES      TPXEV      xi,eta
!         TPSTS    > TPSTV <     star
!         TPORS      TPORV      origin
!
!  References:
!
!     Calabretta M.R. & Greisen, E.W., 2002, "Representations of
!     celestial coordinates in FITS", Astron.Astrophys. 395, 1077
!
!     Green, R.M., "Spherical Astronomy", Cambridge University Press,
!     1987, Chapter 13.
!
!  This revision:   2018 January 2
!
!-----------------------------------------------------------------------

implicit none

double precision xi, eta, v0(3), v(3)

double precision x, y, z, r, f

!  Tangent point.
x = v0(1)
y = v0(2)
z = v0(3)

!  Deal with polar case.
r = sqrt(x*x+y*y)
if ( r == 0d0 ) then
   r = 1d-20
   x = r
end if

!  Star vector length to tangent plane.
f = sqrt(1d0+xi*xi+eta*eta)

!  Apply the transformation and normalize.
v(1) = ( x - (xi*y+eta*x*z) / r ) / f
v(2) = ( y + (xi*x-eta*y*z) / r ) / f
v(3) = ( z + eta*r ) / f

end subroutine TPSTV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TPXES ( a, b, a0, b0, xi, eta, j )
!>
!  In the tangent plane projection, given celestial spherical
!  coordinates for a star and the tangent point, solve for the star's
!  rectangular coordinates in the tangent plane.
!
!  Status:  support routine.
!
!  Given:
!     A,B       d       star's spherical coordinates
!     A0,B0     d       tangent point's spherical coordinates
!
!  Returned:
!     XI,ETA    d       rectangular coordinates of star image (Note 2)
!     J         i       status:  0 = OK
!                                1 = star too far from axis
!                                2 = antistar on tangent plane
!                                3 = antistar too far from axis
!
!  Notes:
!
!  1) The tangent plane projection is also called the "gnomonic
!     projection" and the "central projection".
!
!  2) The eta axis points due north in the adopted coordinate system.
!     If the spherical coordinates are observed (RA,Dec), the tangent
!     plane coordinates (xi,eta) are conventionally called the "standard
!     coordinates".  For right-handed spherical coordinates, (xi,eta)
!     are also right-handed.  The units of (xi,eta) are, effectively,
!     radians at the tangent point.
!
!  3) All angular arguments are in radians.
!
!  4) This routine is a member of the following set:
!
!         spherical       vector       solve for
!
!       > TPXES <    TPXEV       xi,eta
!         TPSTS      TPSTV        star
!         TPORS      TPORV       origin
!
!  References:
!
!     Calabretta M.R. & Greisen, E.W., 2002, "Representations of
!     celestial coordinates in FITS", Astron.Astrophys. 395, 1077
!
!     Green, R.M., "Spherical Astronomy", Cambridge University Press,
!     1987, Chapter 13.
!
!  This revision:   2018 January 2
!
!-----------------------------------------------------------------------

implicit none

double precision a, b, a0, b0, xi, eta
integer j

double precision tiny
parameter ( tiny = 1d-6 )

double precision sb0, sb, cb0, cb, da, sda, cda, d

!  Functions of the spherical coordinates.
sb0 = sin(b0)
sb = sin(b)
cb0 = cos(b0)
cb = cos(b)
da = a - a0
sda = sin(da)
cda = cos(da)

!  Reciprocal of star vector length to tangent plane.
d = sb*sb0 + cb*cb0*cda

!  Check for error cases.
if ( d > tiny ) then
   j = 0
else if ( d >= 0d0 ) then
   j = 1
   d = tiny
else if ( d > -tiny ) then
   j = 2
   d = -tiny
else
   j = 3
end if

!  Return the tangent plane coordinates (even in dubious cases).
xi = cb*sda / d
eta = ( sb*cb0 - cb*sb0*cda ) / d

end subroutine TPXES
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TPXEV ( v, v0, xi, eta, j )
!>
!  In the tangent plane projection, given celestial direction cosines
!  for a star and the tangent point, solve for the star's rectangular
!  coordinates in the tangent plane.
!
!  Status:  support routine.
!
!  Given:
!     V         d(3)       direction cosines of star (Note 4)
!     V0        d(3)       direction cosines of tangent point (Note 4)
!
!  Returned:
!     XI,ETA    d          tangent plane coordinates of star
!     J         i          status: 0 = OK
!                                  1 = star too far from axis
!                                  2 = antistar on tangent plane
!                                  3 = antistar too far from axis
!
!  Notes:
!
!  1) The tangent plane projection is also called the "gnomonic
!     projection" and the "central projection".
!
!  2) The eta axis points due north in the adopted coordinate system.
!     If the direction cosines represent observed (RA,Dec), the tangent
!     plane coordinates (xi,eta) are conventionally called the "standard
!     coordinates".  If the direction cosines are with respect to a
!     right-handed triad, (xi,eta) are also right-handed.  The units of
!     (xi,eta) are, effectively, radians at the tangent point.
!
!  3) The method used is to extend the star vector to the tangent
!     plane and then rotate the triad so that (x,y) becomes (xi,eta).
!     Writing (a,b) for the celestial spherical coordinates of the
!     star, the sequence of rotations is (a+pi/2) around the z-axis
!     followed by (pi/2-b) around the x-axis.
!
!  4) If vector V0 is not of unit length, or if vector V is of zero
!     length, the results will be wrong.
!
!  5) If V0 points at a pole, the returned (XI,ETA) will be based on the
!     arbitrary assumption that the longitude coordinate of the tangent
!     point is zero.
!
!  6) This routine is a member of the following set:
!
!         spherical       vector       solve for
!
!         TPXES    > TPXEV <    xi,eta
!         TPSTS      TPSTV       star
!         TPORS      TPORV      origin
!
!  References:
!
!     Calabretta M.R. & Greisen, E.W., 2002, "Representations of
!     celestial coordinates in FITS", Astron.Astrophys. 395, 1077
!
!     Green, R.M., "Spherical Astronomy", Cambridge University Press,
!     1987, Chapter 13.
!
!  This revision:   2018 January 2
!
!-----------------------------------------------------------------------

implicit none

double precision v(3), v0(3), xi, eta
integer j

double precision tiny
parameter ( tiny = 1d-6 )

double precision x, y, z, x0, y0, z0, r2, r, w, d

!  Star and tangent point.
x = v(1)
y = v(2)
z = v(3)
x0 = v0(1)
y0 = v0(2)
z0 = v0(3)

!  Deal with polar case.
r2 = x0*x0 + y0*y0
r = sqrt(r2)
if ( r == 0d0 ) then
   r = 1d-20
   x0 = r
end if

!  Reciprocal of star vector length to tangent plane.
w = x*x0 + y*y0
d = w + z*z0

!  Check for error cases.
if ( d > tiny ) then
   j = 0
else if ( d >= 0d0 ) then
   j = 1
   d = tiny
else if ( d > -tiny ) then
   j = 2
   d = -tiny
else
   j = 3
end if

!  Return the tangent plane coordinates (even in dubious cases).
d = r*d
xi = ( y*x0 - x*y0 ) / d
eta = ( z*r2 - z0*w ) / d

end subroutine TPXEV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TR ( r, rt )
!>
!  Transpose an r-matrix.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     R        d(3,3)    r-matrix
!
!  Returned:
!     RT       d(3,3)    transpose
!
!  Called:
!     CR       copy r-matrix
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision r(3,3), rt(3,3)

double precision wm(3,3)
integer i, j

do 2 i=1,3
   do 1 j=1,3
      wm(i,j) = r(j,i)
1    continue
2 continue
call CR ( wm, rt )

end subroutine TR
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TRXP ( r, p, trp )
!>
!  Multiply a p-vector by the transpose of an r-matrix.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     R        d(3,3)    r-matrix
!     P        d(3)      p-vector
!
!  Returned:
!     TRP      d(3)      R * P
!
!  Called:
!     TR       transpose r-matrix
!     RXP      product of r-matrix and p-vector
!
!  This revision:  2009 July 11
!
!-----------------------------------------------------------------------

implicit none

double precision r(3,3), p(3), trp(3)

double precision ri(3,3)

!  Transpose of matrix R.
call TR ( r, ri )

!  Matrix RI * vector P -> vector TRP.
call RXP ( ri, p, trp )

end subroutine TRXP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TRXPV ( r, pv, trpv )
!>
!  Multiply a pv-vector by the transpose of an r-matrix.
!
!  Status:  vector/matrix support routine.
!
!  Given:
!     R        d(3,3)    r-matrix
!     PV       d(3,2)    pv-vector
!
!  Returned:
!     TRPV     d(3,2)    R * PV
!
!  Called:
!     TR       transpose r-matrix
!     RXPV     product of r-matrix and pv-vector
!
!  This revision:  2009 July 11
!
!-----------------------------------------------------------------------

implicit none

double precision r(3,3), pv(3,2), trpv(3,2)

double precision ri(3,3)

!  Transpose of matrix R.
call TR ( r, ri )

!  Matrix RI * vector PV -> vector TRPV.
call RXPV ( ri, pv, trpv )

end subroutine TRXPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TTTAI ( tt1, tt2, tai1, tai2, j )
!>
!  Time scale transformation:  Terrestrial Time, TT, to International
!  Atomic Time, TAI.
!
!  Status:  canonical.
!
!  Given:
!     TT1,TT2      d      TT as a 2-part Julian Date
!
!  Returned:
!     TAI1,TAI2    d      TAI as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Note:
!
!     TT1+TT2 is Julian Date, apportioned in any convenient way between
!     the two arguments, for example where TT1 is the Julian Day Number
!     and TT2 is the fraction of a day.  The returned TAI1,TAI2 follow
!     suit.
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tt1, tt2, tai1, tai2
integer j

!  TT minus TAI (days).
double precision dtat
parameter ( dtat = 32.184d0/86400d0 )

!  Result, safeguarding precision.
if ( abs(tt1)>abs(tt2) ) then
   tai1 = tt1
   tai2 = tt2 - dtat
else
   tai1 = tt1 - dtat
   tai2 = tt2
end if

!  Status (always OK).
j = 0

end subroutine TTTAI
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TTTCG ( tt1, tt2, tcg1, tcg2, j )
!>
!  Time scale transformation:  Terrestrial Time, TT, to Geocentric
!  Coordinate Time, TCG.
!
!  Status:  canonical.
!
!  Given:
!     TT1,TT2      d      TT as a 2-part Julian Date
!
!  Returned:
!     TCG1,TCG2    d      TCG as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Note:
!
!     TT1+TT2 is Julian Date, apportioned in any convenient way between
!     the two arguments, for example where TT1 is the Julian Day Number
!     and TT2 is the fraction of a day.  The returned TCG1,TCG2 follow
!     suit.
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     IAU 2000 Resolution B1.9
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tt1, tt2, tcg1, tcg2
integer j

!  JD for MJD 0
double precision djm0
parameter (djm0 = 2400000.5d0 )

!  1977 Jan 1 00:00:32.184 TT, as MJD
double precision t77t
parameter ( t77t = 43144.0003725d0 )

!  L_G = 1 - dTT/dTCG
double precision elg
parameter ( elg = 6.969290134d-10 )

!  TT to TCG rate
double precision elgg
parameter ( elgg = elg/(1d0-elg) )

!  Result, safeguarding precision.
if ( abs(tt1)>abs(tt2) ) then
   tcg1 = tt1
   tcg2 = tt2 + ( ( tt1-djm0 ) + ( tt2-t77t ) ) * elgg
else
   tcg1 = tt1 + ( ( tt2-djm0 ) + ( tt1-t77t ) ) * elgg
   tcg2 = tt2
end if

!  Status (always OK).
j = 0

end subroutine TTTCG
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TTTDB ( tt1, tt2, dtr, tdb1, tdb2, j )
!>
!  Time scale transformation:  Terrestrial Time, TT, to Barycentric
!  Dynamical Time, TDB.
!
!  Status:  canonical.
!
!  Given:
!     TT1,TT2      d      TT as a 2-part Julian Date
!     DTR          d      TDB-TT in seconds
!
!  Returned:
!     TDB1,TDB2    d      TDB as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Notes:
!
!  1) TT1+TT2 is Julian Date, apportioned in any convenient way between
!     the two arguments, for example where TT1 is the Julian Day Number
!     and TT2 is the fraction of a day.  The returned TDB1,TDB2 follow
!     suit.
!
!  2) The argument DTR represents the quasi-periodic component of the
!     GR transformation between TT and TCB.  It is dependent upon the
!     adopted solar-system ephemeris, and can be obtained by numerical
!     integration, by interrogating a precomputed time ephemeris or by
!     evaluating a model such as that implemented in the SOFA routine
!     DTDB.  The quantity is dominated by an annual term of 1.7 ms
!     amplitude.
!
!  3) TDB is essentially the same as Teph, the time argument for the JPL
!     solar system ephemerides.
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     IAU 2006 Resolution 3
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tt1, tt2, dtr, tdb1, tdb2
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

double precision dtrd

!  Result, safeguarding precision.
dtrd = dtr/d2s
if ( abs(tt1)>abs(tt2) ) then
   tdb1 = tt1
   tdb2 = tt2 + dtrd
else
   tdb1 = tt1 + dtrd
   tdb2 = tt2
end if

!  Status (always OK).
j = 0

end subroutine TTTDB
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine TTUT1 ( tt1, tt2, dt, ut11, ut12, j )
!>
!  Time scale transformation:  Terrestrial Time, TT, to Universal Time,
!  UT1.
!
!  Status:  canonical.
!
!  Given:
!     TT1,TT2      d      TT as a 2-part Julian Date
!     DT           d      TT-UT1 in seconds
!
!  Returned:
!     UT11,UT12    d      UT1 as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Notes:
!
!  1) TT1+TT2 is Julian Date, apportioned in any convenient way between
!     the two arguments, for example where TT1 is the Julian Day Number
!     and TT2 is the fraction of a day.  The returned UT11,UT12 follow
!     suit.
!
!  2) The argument DT is classical Delta T.
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision tt1, tt2, dt, ut11, ut12
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

double precision dtd

!  Result, safeguarding precision.
dtd = dt/d2s
if ( abs(tt1)>abs(tt2) ) then
   ut11 = tt1
   ut12 = tt2 - dtd
else
   ut11 = tt1 - dtd
   ut12 = tt2
end if

!  Status (always OK).
j = 0

end subroutine TTUT1
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine UT1TAI ( ut11, ut12, dta, tai1, tai2, j )
!>
!  Time scale transformation:  Universal Time, UT1, to International
!  Atomic Time, TAI.
!
!  Status:  canonical.
!
!  Given:
!     UT11,UT12    d      UT1 as a 2-part Julian Date
!     DTA          d      UT1-TAI in seconds
!
!  Returned:
!     TAI1,TAI2    d      TAI as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Notes:
!
!  1) UT11+UT12 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where UT11 is the Julian
!     Day Number and UT12 is the fraction of a day.  The returned
!     TAI1,TAI2 follow suit.
!
!  2) The argument DTA, i.e. UT1-TAI, is an observed quantity, and is
!     available from IERS tabulations.
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision ut11, ut12, dta, tai1, tai2
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

double precision dtad

!  Result, safeguarding precision.
dtad = dta/d2s
if ( abs(ut11)>abs(ut12) ) then
   tai1 = ut11
   tai2 = ut12 - dtad
else
   tai1 = ut11 - dtad
   tai2 = ut12
end if

!  Status (always OK).
j = 0

end subroutine UT1TAI
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine UT1TT ( ut11, ut12, dt, tt1, tt2, j )
!>
!  Time scale transformation:  Universal Time, UT1, to Terrestrial Time,
!  TT.
!
!  Status:  canonical.
!
!  Given:
!     UT11,UT12    d      UT1 as a 2-part Julian Date
!     DT           d      TT-UT1 in seconds
!
!  Returned:
!     TT1,TT2      d      TT as a 2-part Julian Date
!     J            i      status:  0 = OK
!
!  Notes:
!
!  1) UT11+UT12 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where UT11 is the Julian
!     Day Number and UT12 is the fraction of a day.  The returned
!     TT1,TT2 follow suit.
!
!  2) The argument DT is classical Delta T.
!
!  Reference:
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision ut11, ut12, dt, tt1, tt2
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

double precision dtd

!  Result, safeguarding precision.
dtd = dt/d2s
if ( abs(ut11)>abs(ut12) ) then
   tt1 = ut11
   tt2 = ut12 + dtd
else
   tt1 = ut11 + dtd
   tt2 = ut12
end if

!  Status (always OK).
j = 0

end subroutine UT1TT
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine UT1UTC ( ut11, ut12, dut1, utc1, utc2, j )
!>
!  Time scale transformation:  Universal Time, UT1, to Coordinated
!  Universal Time, UTC.
!
!  Status:  canonical.
!
!  Given:
!     UT11,UT12    d      UT1 as a 2-part Julian Date (Note 1)
!     DUT1         d      Delta UT1: UT1-UTC in seconds (Note 2)
!
!  Returned:
!     UTC1,UTC2    d      UTC as a 2-part quasi Julian Date (Notes 3,4)
!     J            i      status: +1 = dubious year (Note 5)
!                                  0 = OK
!                                 -1 = unacceptable date
!
!  Notes:
!
!  1) UT11+UT12 is Julian Date, apportioned in any convenient way
!     between the two arguments, for example where UT11 is the Julian
!     Day Number and UT12 is the fraction of a day.  The returned UTC1
!     and UTC2 form an analogous pair, except that a special convention
!     is used, to deal with the problem of leap seconds - see Note 3.
!
!  2) Delta UT1 can be obtained from tabulations provided by the
!     International Earth Rotation and Reference Systems Service.  The
!     value changes abruptly by 1s at a leap second;  however, close to
!     a leap second the algorithm used here is tolerant of the "wrong"
!     choice of value being made.
!
!  3) JD cannot unambiguously represent UTC during a leap second unless
!     special measures are taken.  The convention in the present routine
!     is that the returned quasi JD day UTC1+UTC2 represents UTC days
!     whether the length is 86399, 86400 or 86401 SI seconds.
!
!  4) The routine D2DTF can be used to transform the UTC quasi-JD
!     into calendar date and clock time, including UTC leap second
!     handling.
!
!  5) The warning status "dubious year" flags UTCs that predate the
!     introduction of the time scale or that are too far in the future
!     to be trusted.  See DAT for further details.
!
!  Called:
!     JD2CAL   JD to Gregorian calendar
!     DAT      delta(AT) = TAI-UTC
!     CAL2JD   Gregorian calendar to JD
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision ut11, ut12, dut1, utc1, utc2
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

logical big1
integer i, iy, im, id, js
double precision duts, u1, u2, d1, dats1, d2, fd, dats2, ddats, &
                 us1, us2, du

!  UT1-UTC in seconds.
duts = dut1

!  Put the two parts of the UT1 into big-first order.
big1 = abs(ut11) >= abs(ut12)
if ( big1 ) then
   u1 = ut11
   u2 = ut12
else
   u1 = ut12
   u2 = ut11
end if

!  See if the UT1 can possibly be in a leap-second day.
d1 = u1
dats1 = 0d0
do 1 i=-1,3
   d2 = u2 + dble(i)
   call JD2CAL ( d1, d2, iy, im, id, fd, js )
   if ( js/=0 ) go to 9
   call DAT ( iy, im, id, 0d0, dats2, js )
   if ( js<0 ) go to 9
   if ( i==-1 ) dats1 = dats2
   ddats = dats2 - dats1
   if ( abs(ddats)>=0.5d0 ) then

!        Yes, leap second nearby: ensure UT1-UTC is "before" value.
      if ( ddats*duts>=0d0 ) duts = duts-ddats

!        UT1 for the start of the UTC day that ends in a leap.
      call CAL2JD ( iy, im, id, d1, d2, js )
      us1 = d1
      us2 = d2 - 1d0 + duts/d2s

!        Is the UT1 after this point?
      du = u1 - us1
      du = du + ( u2 - us2 )
      if ( du>0d0 ) then

!           Yes:  fraction of the current UTC day that has elapsed.
         fd = du * d2s / ( d2s + ddats )

!           Ramp UT1-UTC to bring about SOFA's JD(UTC) convention.
         duts = duts + ddats*min(fd,1d0)
      end if

!        Break.
      go to 2
   end if
   dats1 = dats2
1 continue
2 continue

!  Subtract the (possibly adjusted) UT1-UTC from UT1 to give UTC.
u2 = u2 - duts/d2s

!  Result, safeguarding precision.
if ( big1 ) then
   utc1 = u1
   utc2 = u2
else
   utc1 = u2
   utc2 = u1
end if

!  Return the status.
9 continue
j = js

end subroutine UT1UTC
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine UTCTAI ( utc1, utc2, tai1, tai2, j )
!>
!  Time scale transformation:  Coordinated Universal Time, UTC, to
!  International Atomic Time, TAI.
!
!  Status:  canonical.
!
!  Given:
!     UTC1,UTC2    d      UTC as a 2-part quasi Julian Date (Notes 1-4)
!
!  Returned:
!     TAI1,TAI2    d      TAI as a 2-part Julian Date (Note 5)
!     J            i      status: +1 = dubious year (Note 3)
!                                  0 = OK
!                                 -1 = unacceptable date
!
!  Notes:
!
!  1) UTC1+UTC2 is quasi Julian Date (see Note 2), apportioned in any
!     convenient way between the two arguments, for example where UTC1
!     is the Julian Day Number and UTC2 is the fraction of a day.
!
!  2) JD cannot unambiguously represent UTC during a leap second unless
!     special measures are taken.  The convention in the present routine
!     is that the JD day represents UTC days whether the length is
!     86399, 86400 or 86401 SI seconds.  In the 1960-1972 era there were
!     smaller jumps (in either direction) each time the linear UTC(TAI)
!     expression was changed, and these "mini-leaps" are also included
!     in the SOFA convention.
!
!  3) The warning status "dubious year" flags UTCs that predate the
!     introduction of the time scale or that are too far in the future
!     to be trusted.  See DAT for further details.
!
!  4) The routine DTF2D converts from calendar date and time of day
!     into 2-part Julian Date, and in the case of UTC implements the
!     leap-second-ambiguity convention described above.
!
!  5) The returned TAI1,TAI2 are such that their sum is the TAI Julian
!     Date.
!
!  Called:
!     JD2CAL   JD to Gregorian calendar
!     DAT      delta(AT) = TAI-UTC
!     CAL2JD   Gregorian calendar to JD
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  This revision:  2019 June 20
!
!-----------------------------------------------------------------------

implicit none
double precision utc1, utc2, tai1, tai2
integer j

!  Days to seconds
double precision d2s
parameter ( d2s = 86400d0 )

logical big1
integer iy, im, id, js, iyt, imt, idt
double precision u1, u2, fd, dat0, dat12, w, dat24, dlod, dleap, &
                 z1, z2, a2

!  Put the two parts of the UTC into big-first order.
big1 = abs(utc1) >= abs(utc2)
if ( big1 ) then
   u1 = utc1
   u2 = utc2
else
   u1 = utc2
   u2 = utc1
end if

!  Get TAI-UTC at 0h today.
call JD2CAL ( u1, u2, iy, im, id, fd, js )
if ( js/=0 ) go to 9
call DAT ( iy, im, id, 0d0, dat0, js )
if ( js<0 ) go to 9

!  Get TAI-UTC at 12h today (to detect drift).
call DAT ( iy, im, id, 0.5d0, dat12, js )
if ( js<0 ) go to 9

!  Get TAI-UTC at 0h tomorrow (to detect jumps).
call JD2CAL ( u1+1.5d0, u2-fd, iyt, imt, idt, w, js )
if ( js/=0 ) go to 9
call DAT ( iyt, imt, idt, 0d0, dat24, js )
if ( js<0 ) go to 9

!  Separate TAI-UTC change into per-day (DLOD) and any jump (DLEAP).
dlod = 2d0 * ( dat12 - dat0 )
dleap = dat24 - ( dat0 + dlod )

!  Remove any scaling applied to spread leap into preceding day.
fd = fd * (d2s+dleap)/d2s

!  Scale from (pre-1972) UTC seconds to SI seconds.
fd = fd * (d2s+dlod)/d2s

!  Today's calendar date to 2-part JD.
call CAL2JD ( iy, im, id, z1, z2, js )
if ( js/=0 ) go to 9

!  Assemble the TAI result, preserving the UTC split and order.
a2 = z1 - u1
a2 = ( a2 + z2 ) + ( fd + dat0/d2s )
if ( big1 ) then
   tai1 = u1
   tai2 = a2
else
   tai1 = a2
   tai2 = u1
end if

!  Status.
9 continue
j = js

end subroutine UTCTAI
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine UTCUT1 ( utc1, utc2, dut1, ut11, ut12, j )
!>
!  Time scale transformation:  Coordinated Universal Time, UTC, to
!  Universal Time, UT1.
!
!  Status:  canonical.
!
!  Given:
!     UTC1,UTC2    d      UTC as a 2-part quasi Julian Date (Notes 1-4)
!     DUT1         d      Delta UT1 = UT1-UTC in seconds (Note 5)
!
!  Returned:
!     UT11,UT12    d      UT1 as a 2-part Julian Date (Note 6)
!     J            i      status: +1 = dubious year (Note 3)
!                                  0 = OK
!                                 -1 = unacceptable date
!
!  Notes:
!
!  1) UTC1+UTC2 is quasi Julian Date (see Note 2), apportioned in any
!     convenient way between the two arguments, for example where UTC1
!     is the Julian Day Number and UTC2 is the fraction of a day.
!
!  2) JD cannot unambiguously represent UTC during a leap second unless
!     special measures are taken.  The convention in the present routine
!     is that the JD day represents UTC days whether the length is
!     86399, 86400 or 86401 SI seconds.
!
!  3) The warning status "dubious year" flags UTCs that predate the
!     introduction of the time scale or that are too far in the future
!     to be trusted.  See DAT for further details.
!
!  4) The routine DTF2D converts from calendar date and time of day
!     into 2-part Julian Date, and in the case of UTC implements the
!     leap-second-ambiguity convention described above.
!
!  5) Delta UT1 can be obtained from tabulations provided by the
!     International Earth Rotation and Reference Systems Service.
!     It is the caller's responsibility to supply a DUT1 argument
!     containing the UT1-UTC value that matches the given UTC.
!
!  6) The returned UT11,UT12 are such that their sum is the UT1 Julian
!     Date.
!
!  References:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!     Explanatory Supplement to the Astronomical Almanac,
!     P. Kenneth Seidelmann (ed), University Science Books (1992)
!
!  Called:
!     JD2CAL   JD to Gregorian calendar
!     DAT      delta(AT) = TAI-UTC
!     UTCTAI   UTC to TAI
!     TAIUT1   TAI to UT1
!
!  This revision:  2013 August 12
!
!  * 11/21/2019: for astro_module, renamed the local variable
!    'dat' to 'd' so as not to conflict with the subroutine DAT.
!
!-----------------------------------------------------------------------

implicit none
double precision utc1, utc2, dut1, ut11, ut12
integer j

integer iy, im, id, js, jw
double precision w, d, dta, tai1, tai2

!  Look up TAI-UTC.
call JD2CAL ( utc1, utc2, iy, im, id, w, js )
if ( js/=0 ) go to 9
call DAT ( iy, im, id, 0d0, d, js )
if ( js<0 ) go to 9

!  Form UT1-TAI.
dta = dut1 - d

!  UTC to TAI to UT1.
call UTCTAI ( utc1, utc2, tai1, tai2, jw )
if ( jw<0 ) then
   js = jw
   go to 9
end if
call TAIUT1 ( tai1, tai2, dta, ut11, ut12, jw )

!  Return the status.
9 continue
j = js

end subroutine UTCUT1
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine XY06 ( date1, date2, x, y )
!>
!  X,Y coordinates of celestial intermediate pole from series based
!  on IAU 2006 precession and IAU 2000A nutation.
!
!  Status:  canonical model.
!
!  Given:
!     DATE1,DATE2    d       TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     X,Y            d       CIP X,Y coordinates (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The X,Y coordinates are those of the unit vector towards the
!     celestial intermediate pole.  They represent the combined effects
!     of frame bias, precession and nutation.
!
!  3) The fundamental arguments used are as adopted in IERS Conventions
!     (2003) and are from Simon et al. (1994) and Souchay et al. (1999).
!
!  4) This is an alternative to the angles-based method, via the SOFA
!     routine FW2XY and as used in XYS06A for example.  The
!     two methods agree at the 1 microarcsecond level (at present),
!     a negligible amount compared with the intrinsic accuracy of the
!     models.  However, it would be unwise to mix the two methods
!     (angles-based and series-based) in a single application.
!
!  Called:
!     FAL03    mean anomaly of the Moon
!     FALP03   mean anomaly of the Sun
!     FAF03    mean argument of the latitude of the Moon
!     FAD03    mean elongation of the Moon from the Sun
!     FAOM03   mean longitude of the Moon's ascending node
!     FAME03   mean longitude of Mercury
!     FAVE03   mean longitude of Venus
!     FAE03    mean longitude of Earth
!     FAMA03   mean longitude of Mars
!     FAJU03   mean longitude of Jupiter
!     FASA03   mean longitude of Saturn
!     FAUR03   mean longitude of Uranus
!     FANE03   mean longitude of Neptune
!     FAPA03   general accumulated precession in longitude
!
!  References:
!
!     Capitaine, N., Wallace, P.T. & Chapront, J., 2003,
!     Astron.Astrophys., 412, 567
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!     McCarthy, D. D., Petit, G. (eds.), 2004, IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG
!
!     Simon, J.L., Bretagnon, P., Chapront, J., Chapront-Touze, M.,
!     Francou, G. & Laskar, J., Astron.Astrophys., 1994, 282, 663
!
!     Souchay, J., Loysel, B., Kinoshita, H., Folgueira, M., 1999,
!     Astron.Astrophys.Supp.Ser. 135, 111
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2013 December 2
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, x, y

!  Arcseconds to radians
double precision das2r
parameter ( das2r = 4.848136811095359935899141d-6 )

!  Reference epoch (J2000.0), JD
double precision dj00
parameter ( dj00 = 2451545d0 )

!  Days per Julian century
double precision djc
parameter ( djc = 36525d0 )

!  Maximum power of T in the polynomials for X and Y
integer maxpt
parameter ( maxpt = 5 )

!  Numbers of frequencies:  luni-solar, planetary, total
integer nfls, nfpl, nf
parameter ( nfls = 653, nfpl = 656, nf = nfls+nfpl )

!  Number of amplitude coefficients
integer na
parameter ( na = 4755 )

!  Polynomial coefficients
double precision xyp(0:maxpt,0:1)

!  Fundamental-argument multipliers:  luni-solar and planetary terms
integer mfals(5,nfls), mfapl(14,nfpl)

!  Pointers into amplitudes array, one pointer per frequency
integer nc(nf)

!  Amplitude coefficients (microarcsec);  indexed using the NC array
double precision a(na)

!  Amplitude usage
integer jaxy(0:maxpt*4-1), jasc(0:maxpt*4-1), japt(0:maxpt*4-1)

!  Miscellaneous
double precision t, w, pt(0:maxpt), fa(14), xypr(0:1), xypl(0:1), &
                 xyls(0:1), arg, sc(0:1)
integer jpt, i, j, jxy, ialast, ifreq, m, ia, jsc

!  Functions
!     DOUBLE PRECISION FAL03, FALP03, FAF03, FAD03,
!    :                 FAOM03, FAME03, FAVE03, FAE03,
!    :                 FAMA03, FAJU03, FASA03, FAUR03,
!    :                 FANE03, FAPA03

!  Polynomial coefficients (arcsec).
data ((xyp(i,jxy),i=0,maxpt),jxy=0,1) / &
             -0.016617d0, &
          +2004.191898d0, &
             -0.4297829d0, &
             -0.19861834d0, &
             +0.000007578d0, &
             +0.0000059285d0, &
             -0.006951d0, &
             -0.025896d0, &
            -22.4072747d0, &
             +0.00190059d0, &
             +0.001112526d0, &
             +0.0000001358d0 /

!  Fundamental-argument multipliers:  luni-solar terms.
data ((mfals(i,j),i=1,5),j=1,10) / &
   0,  0,  0,  0,  1, &
   0,  0,  2, -2,  2, &
   0,  0,  2,  0,  2, &
   0,  0,  0,  0,  2, &
   0,  1,  0,  0,  0, &
   0,  1,  2, -2,  2, &
   1,  0,  0,  0,  0, &
   0,  0,  2,  0,  1, &
   1,  0,  2,  0,  2, &
   0,  1, -2,  2, -2 /
data ((mfals(i,j),i=1,5),j=11,20) / &
   0,  0,  2, -2,  1, &
   1,  0, -2,  0, -2, &
   1,  0,  0, -2,  0, &
   1,  0,  0,  0,  1, &
   1,  0,  0,  0, -1, &
   1,  0, -2, -2, -2, &
   1,  0,  2,  0,  1, &
   2,  0, -2,  0, -1, &
   0,  0,  0,  2,  0, &
   0,  0,  2,  2,  2 /
data ((mfals(i,j),i=1,5),j=21,30) / &
   2,  0,  0, -2,  0, &
   0,  2, -2,  2, -2, &
   2,  0,  2,  0,  2, &
   1,  0,  2, -2,  2, &
   1,  0, -2,  0, -1, &
   2,  0,  0,  0,  0, &
   0,  0,  2,  0,  0, &
   0,  1,  0,  0,  1, &
   1,  0,  0, -2, -1, &
   0,  2,  2, -2,  2 /
data ((mfals(i,j),i=1,5),j=31,40) / &
   0,  0,  2, -2,  0, &
   1,  0,  0, -2,  1, &
   0,  1,  0,  0, -1, &
   0,  2,  0,  0,  0, &
   1,  0, -2, -2, -1, &
   1,  0,  2,  2,  2, &
   0,  1,  2,  0,  2, &
   2,  0, -2,  0,  0, &
   0,  0,  2,  2,  1, &
   0,  1, -2,  0, -2 /
data ((mfals(i,j),i=1,5),j=41,50) / &
   0,  0,  0,  2,  1, &
   1,  0,  2, -2,  1, &
   2,  0,  0, -2, -1, &
   2,  0,  2, -2,  2, &
   2,  0,  2,  0,  1, &
   0,  0,  0,  2, -1, &
   0,  1, -2,  2, -1, &
   1,  1,  0, -2,  0, &
   2,  0,  0, -2,  1, &
   1,  0,  0,  2,  0 /
data ((mfals(i,j),i=1,5),j=51,60) / &
   0,  1,  2, -2,  1, &
   1, -1,  0,  0,  0, &
   0,  1, -1,  1, -1, &
   2,  0, -2,  0, -2, &
   0,  1,  0, -2,  0, &
   1,  0,  0, -1,  0, &
   3,  0,  2,  0,  2, &
   0,  0,  0,  1,  0, &
   1, -1,  2,  0,  2, &
   1,  1, -2, -2, -2 /
data ((mfals(i,j),i=1,5),j=61,70) / &
   1,  0, -2,  0,  0, &
   2,  0,  0,  0, -1, &
   0,  1, -2, -2, -2, &
   1,  1,  2,  0,  2, &
   2,  0,  0,  0,  1, &
   1,  1,  0,  0,  0, &
   1,  0, -2,  2, -1, &
   1,  0,  2,  0,  0, &
   1, -1,  0, -1,  0, &
   1,  0,  0,  0,  2 /
data ((mfals(i,j),i=1,5),j=71,80) / &
   1,  0, -1,  0, -1, &
   0,  0,  2,  1,  2, &
   1,  0, -2, -4, -2, &
   1, -1,  0, -1, -1, &
   1,  0,  2,  2,  1, &
   0,  2, -2,  2, -1, &
   1,  0,  0,  0, -2, &
   2,  0, -2, -2, -2, &
   1,  1,  2, -2,  2, &
   2,  0, -2, -4, -2 /
data ((mfals(i,j),i=1,5),j=81,90) / &
   1,  0, -4,  0, -2, &
   2,  0,  2, -2,  1, &
   1,  0,  0, -1, -1, &
   2,  0,  2,  2,  2, &
   3,  0,  0,  0,  0, &
   1,  0,  0,  2,  1, &
   0,  0,  2, -2, -1, &
   3,  0,  2, -2,  2, &
   0,  0,  4, -2,  2, &
   1,  0,  0, -4,  0 /
data ((mfals(i,j),i=1,5),j=91,100) / &
   0,  1,  2,  0,  1, &
   2,  0,  0, -4,  0, &
   1,  1,  0, -2, -1, &
   2,  0, -2,  0,  1, &
   0,  0,  2,  0, -1, &
   0,  1, -2,  0, -1, &
   0,  1,  0,  0,  2, &
   0,  0,  2, -1,  2, &
   0,  0,  2,  4,  2, &
   2,  1,  0, -2,  0 /
data ((mfals(i,j),i=1,5),j=101,110) / &
   1,  1,  0, -2,  1, &
   1, -1,  0, -2,  0, &
   1, -1,  0, -1, -2, &
   1, -1,  0,  0,  1, &
   0,  1, -2,  2,  0, &
   0,  1,  0,  0, -2, &
   1, -1,  2,  2,  2, &
   1,  0,  0,  2, -1, &
   1, -1, -2, -2, -2, &
   3,  0,  2,  0,  1 /
data ((mfals(i,j),i=1,5),j=111,120) / &
   0,  1,  2,  2,  2, &
   1,  0,  2, -2,  0, &
   1,  1, -2, -2, -1, &
   1,  0,  2, -4,  1, &
   0,  1, -2, -2, -1, &
   2, -1,  2,  0,  2, &
   0,  0,  0,  2,  2, &
   1, -1,  2,  0,  1, &
   1, -1, -2,  0, -2, &
   0,  1,  0,  2,  0 /
data ((mfals(i,j),i=1,5),j=121,130) / &
   0,  1,  2, -2,  0, &
   0,  0,  0,  1,  1, &
   1,  0, -2, -2,  0, &
   0,  3,  2, -2,  2, &
   2,  1,  2,  0,  2, &
   1,  1,  0,  0,  1, &
   2,  0,  0,  2,  0, &
   1,  1,  2,  0,  1, &
   1,  0,  0, -2, -2, &
   1,  0, -2,  2,  0 /
data ((mfals(i,j),i=1,5),j=131,140) / &
   1,  0, -1,  0, -2, &
   0,  1,  0, -2,  1, &
   0,  1,  0,  1,  0, &
   0,  0,  0,  1, -1, &
   1,  0, -2,  2, -2, &
   1, -1,  0,  0, -1, &
   0,  0,  0,  4,  0, &
   1, -1,  0,  2,  0, &
   1,  0,  2,  1,  2, &
   1,  0,  2, -1,  2 /
data ((mfals(i,j),i=1,5),j=141,150) / &
   0,  0,  2,  1,  1, &
   1,  0,  0, -2,  2, &
   1,  0, -2,  0,  1, &
   1,  0, -2, -4, -1, &
   0,  0,  2,  2,  0, &
   1,  1,  2, -2,  1, &
   1,  0, -2,  1, -1, &
   0,  0,  1,  0,  1, &
   2,  0, -2, -2, -1, &
   4,  0,  2,  0,  2 /
data ((mfals(i,j),i=1,5),j=151,160) / &
   2, -1,  0,  0,  0, &
   2,  1,  2, -2,  2, &
   0,  1,  2,  1,  2, &
   1,  0,  4, -2,  2, &
   1,  1,  0,  0, -1, &
   2,  0,  2,  0,  0, &
   2,  0, -2, -4, -1, &
   1,  0, -1,  0,  0, &
   1,  0,  0,  1,  0, &
   0,  1,  0,  2,  1 /
data ((mfals(i,j),i=1,5),j=161,170) / &
   1,  0, -4,  0, -1, &
   1,  0,  0, -4, -1, &
   2,  0,  2,  2,  1, &
   2,  1,  0,  0,  0, &
   0,  0,  2, -3,  2, &
   1,  2,  0, -2,  0, &
   0,  3,  0,  0,  0, &
   0,  0,  4,  0,  2, &
   0,  0,  2, -4,  1, &
   2,  0,  0, -2, -2 /
data ((mfals(i,j),i=1,5),j=171,180) / &
   1,  1, -2, -4, -2, &
   0,  1,  0, -2, -1, &
   0,  0,  0,  4,  1, &
   3,  0,  2, -2,  1, &
   1,  0,  2,  4,  2, &
   1,  1, -2,  0, -2, &
   0,  0,  4, -2,  1, &
   2, -2,  0, -2,  0, &
   2,  1,  0, -2, -1, &
   0,  2,  0, -2,  0 /
data ((mfals(i,j),i=1,5),j=181,190) / &
   1,  0,  0, -1,  1, &
   1,  1,  2,  2,  2, &
   3,  0,  0,  0, -1, &
   2,  0,  0, -4, -1, &
   3,  0,  2,  2,  2, &
   0,  0,  2,  4,  1, &
   0,  2, -2, -2, -2, &
   1, -1,  0, -2, -1, &
   0,  0,  2, -1,  1, &
   2,  0,  0,  2,  1 /
data ((mfals(i,j),i=1,5),j=191,200) / &
   1, -1, -2,  2, -1, &
   0,  0,  0,  2, -2, &
   2,  0,  0, -4,  1, &
   1,  0,  0, -4,  1, &
   2,  0,  2, -4,  1, &
   4,  0,  2, -2,  2, &
   2,  1, -2,  0, -1, &
   2,  1, -2, -4, -2, &
   3,  0,  0, -4,  0, &
   1, -1,  2,  2,  1 /
data ((mfals(i,j),i=1,5),j=201,210) / &
   1, -1, -2,  0, -1, &
   0,  2,  0,  0,  1, &
   1,  2, -2, -2, -2, &
   1,  1,  0, -4,  0, &
   2,  0,  0, -2,  2, &
   0,  2,  2, -2,  1, &
   1,  0,  2,  0, -1, &
   2,  1,  0, -2,  1, &
   2, -1, -2,  0, -1, &
   1, -1, -2, -2, -1 /
data ((mfals(i,j),i=1,5),j=211,220) / &
   0,  1, -2,  1, -2, &
   1,  0, -4,  2, -2, &
   0,  1,  2,  2,  1, &
   3,  0,  0,  0,  1, &
   2, -1,  2,  2,  2, &
   0,  1, -2, -4, -2, &
   1,  0, -2, -3, -2, &
   2,  0,  0,  0,  2, &
   1, -1,  0, -2, -2, &
   2,  0, -2,  2, -1 /
data ((mfals(i,j),i=1,5),j=221,230) / &
   0,  2, -2,  0, -2, &
   3,  0, -2,  0, -1, &
   2, -1,  2,  0,  1, &
   1,  0, -2, -1, -2, &
   0,  0,  2,  0,  3, &
   2,  0, -4,  0, -2, &
   2,  1,  0, -4,  0, &
   1,  1, -2,  1, -1, &
   0,  2,  2,  0,  2, &
   1, -1,  2, -2,  2 /
data ((mfals(i,j),i=1,5),j=231,240) / &
   1, -1,  0, -2,  1, &
   2,  1,  2,  0,  1, &
   1,  0,  2, -4,  2, &
   1,  1, -2,  0, -1, &
   1,  1,  0,  2,  0, &
   1,  0,  0, -3,  0, &
   2,  0,  2, -1,  2, &
   0,  2,  0,  0, -1, &
   2, -1,  0, -2,  0, &
   4,  0,  0,  0,  0 /
data ((mfals(i,j),i=1,5),j=241,250) / &
   2,  1, -2, -2, -2, &
   0,  2, -2,  2,  0, &
   1,  0,  2,  1,  1, &
   1,  0, -1,  0, -3, &
   3, -1,  2,  0,  2, &
   2,  0,  2, -2,  0, &
   1, -2,  0,  0,  0, &
   2,  0,  0,  0, -2, &
   1,  0,  0,  4,  0, &
   0,  1,  0,  1,  1 /
data ((mfals(i,j),i=1,5),j=251,260) / &
   1,  0,  2,  2,  0, &
   0,  1,  0,  2, -1, &
   0,  1,  0,  1, -1, &
   0,  0,  2, -2,  3, &
   3,  1,  2,  0,  2, &
   1,  1,  2,  1,  2, &
   1,  1, -2,  2, -1, &
   2, -1,  2, -2,  2, &
   1, -2,  2,  0,  2, &
   1,  0,  2, -4,  0 /
data ((mfals(i,j),i=1,5),j=261,270) / &
   0,  0,  1,  0,  0, &
   1,  0,  2, -3,  1, &
   1, -2,  0, -2,  0, &
   2,  0,  0,  2, -1, &
   1,  1,  2, -4,  1, &
   4,  0,  2,  0,  1, &
   0,  1,  2,  1,  1, &
   1,  2,  2, -2,  2, &
   2,  0,  2,  1,  2, &
   2,  1,  2, -2,  1 /
data ((mfals(i,j),i=1,5),j=271,280) / &
   1,  0,  2, -1,  1, &
   1,  0,  4, -2,  1, &
   1, -1,  2, -2,  1, &
   0,  1,  0, -4,  0, &
   3,  0, -2, -2, -2, &
   0,  0,  4, -4,  2, &
   2,  0, -4, -2, -2, &
   2, -2,  0, -2, -1, &
   1,  0,  2, -2, -1, &
   2,  0, -2, -6, -2 /
data ((mfals(i,j),i=1,5),j=281,290) / &
   1,  0, -2,  1, -2, &
   1,  0, -2,  2,  1, &
   1, -1,  0,  2, -1, &
   1,  0, -2,  1,  0, &
   2, -1,  0, -2,  1, &
   1, -1,  0,  2,  1, &
   2,  0, -2, -2,  0, &
   1,  0,  2, -3,  2, &
   0,  0,  0,  4, -1, &
   2, -1,  0,  0,  1 /
data ((mfals(i,j),i=1,5),j=291,300) / &
   2,  0,  4, -2,  2, &
   0,  0,  2,  3,  2, &
   0,  1,  4, -2,  2, &
   0,  1, -2,  2,  1, &
   1,  1,  0,  2,  1, &
   1,  0,  0,  4,  1, &
   0,  0,  4,  0,  1, &
   2,  0,  0, -3,  0, &
   1,  0,  0, -1, -2, &
   1, -2, -2, -2, -2 /
data ((mfals(i,j),i=1,5),j=301,310) / &
   3,  0,  0,  2,  0, &
   2,  0,  2, -4,  2, &
   1,  1, -2, -4, -1, &
   1,  0, -2, -6, -2, &
   2, -1,  0,  0, -1, &
   2, -1,  0,  2,  0, &
   0,  1,  2, -2, -1, &
   1,  1,  0,  1,  0, &
   1,  2,  0, -2, -1, &
   1,  0,  0,  1, -1 /
data ((mfals(i,j),i=1,5),j=311,320) / &
   0,  0,  1,  0,  2, &
   3,  1,  2, -2,  2, &
   1,  0, -4, -2, -2, &
   1,  0,  2,  4,  1, &
   1, -2,  2,  2,  2, &
   1, -1, -2, -4, -2, &
   0,  0,  2, -4,  2, &
   0,  0,  2, -3,  1, &
   2,  1, -2,  0,  0, &
   3,  0, -2, -2, -1 /
data ((mfals(i,j),i=1,5),j=321,330) / &
   2,  0,  2,  4,  2, &
   0,  0,  0,  0,  3, &
   2, -1, -2, -2, -2, &
   2,  0,  0, -1,  0, &
   3,  0,  2, -4,  2, &
   2,  1,  2,  2,  2, &
   0,  0,  3,  0,  3, &
   1,  1,  2,  2,  1, &
   2,  1,  0,  0, -1, &
   1,  2,  0, -2,  1 /
data ((mfals(i,j),i=1,5),j=331,340) / &
   3,  0,  2,  2,  1, &
   1, -1, -2,  2, -2, &
   1,  1,  0, -1,  0, &
   1,  2,  0,  0,  0, &
   1,  0,  4,  0,  2, &
   1, -1,  2,  4,  2, &
   2,  1,  0,  0,  1, &
   1,  0,  0,  2,  2, &
   1, -1, -2,  2,  0, &
   0,  2, -2, -2, -1 /
data ((mfals(i,j),i=1,5),j=341,350) / &
   2,  0, -2,  0,  2, &
   5,  0,  2,  0,  2, &
   3,  0, -2, -6, -2, &
   1, -1,  2, -1,  2, &
   3,  0,  0, -4, -1, &
   1,  0,  0,  1,  1, &
   1,  0, -4,  2, -1, &
   0,  1,  2, -4,  1, &
   1,  2,  2,  0,  2, &
   0,  1,  0, -2, -2 /
data ((mfals(i,j),i=1,5),j=351,360) / &
   0,  0,  2, -1,  0, &
   1,  0,  1,  0,  1, &
   0,  2,  0, -2,  1, &
   3,  0,  2,  0,  0, &
   1,  1, -2,  1,  0, &
   2,  1, -2, -4, -1, &
   3, -1,  0,  0,  0, &
   2, -1, -2,  0,  0, &
   4,  0,  2, -2,  1, &
   2,  0, -2,  2,  0 /
data ((mfals(i,j),i=1,5),j=361,370) / &
   1,  1,  2, -2,  0, &
   1,  0, -2,  4, -1, &
   1,  0, -2, -2,  1, &
   2,  0,  2, -4,  0, &
   1,  1,  0, -2, -2, &
   1,  1, -2, -2,  0, &
   1,  0,  1, -2,  1, &
   2, -1, -2, -4, -2, &
   3,  0, -2,  0, -2, &
   0,  1, -2, -2,  0 /
data ((mfals(i,j),i=1,5),j=371,380) / &
   3,  0,  0, -2, -1, &
   1,  0, -2, -3, -1, &
   0,  1,  0, -4, -1, &
   1, -2,  2, -2,  1, &
   0,  1, -2,  1, -1, &
   1, -1,  0,  0,  2, &
   2,  0,  0,  1,  0, &
   1, -2,  0,  2,  0, &
   1,  2, -2, -2, -1, &
   0,  0,  4, -4,  1 /
data ((mfals(i,j),i=1,5),j=381,390) / &
   0,  1,  2,  4,  2, &
   0,  1, -4,  2, -2, &
   3,  0, -2,  0,  0, &
   2, -1,  2,  2,  1, &
   0,  1, -2, -4, -1, &
   4,  0,  2,  2,  2, &
   2,  0, -2, -3, -2, &
   2,  0,  0, -6,  0, &
   1,  0,  2,  0,  3, &
   3,  1,  0,  0,  0 /
data ((mfals(i,j),i=1,5),j=391,400) / &
   3,  0,  0, -4,  1, &
   1, -1,  2,  0,  0, &
   1, -1,  0, -4,  0, &
   2,  0, -2,  2, -2, &
   1,  1,  0, -2,  2, &
   4,  0,  0, -2,  0, &
   2,  2,  0, -2,  0, &
   0,  1,  2,  0,  0, &
   1,  1,  0, -4,  1, &
   1,  0,  0, -4, -2 /
data ((mfals(i,j),i=1,5),j=401,410) / &
   0,  0,  0,  1,  2, &
   3,  0,  0,  2,  1, &
   1,  1,  0, -4, -1, &
   0,  0,  2,  2, -1, &
   1,  1,  2,  0,  0, &
   1, -1,  2, -4,  1, &
   1,  1,  0,  0,  2, &
   0,  0,  2,  6,  2, &
   4,  0, -2, -2, -1, &
   2,  1,  0, -4, -1 /
data ((mfals(i,j),i=1,5),j=411,420) / &
   0,  0,  0,  3,  1, &
   1, -1, -2,  0,  0, &
   0,  0,  2,  1,  0, &
   1,  0,  0,  2, -2, &
   3, -1,  2,  2,  2, &
   3, -1,  2, -2,  2, &
   1,  0,  0, -1,  2, &
   1, -2,  2, -2,  2, &
   0,  1,  0,  2,  2, &
   0,  1, -2, -1, -2 /
data ((mfals(i,j),i=1,5),j=421,430) / &
   1,  1, -2,  0,  0, &
   0,  2,  2, -2,  0, &
   3, -1, -2, -1, -2, &
   1,  0,  0, -6,  0, &
   1,  0, -2, -4,  0, &
   2,  1,  0, -4,  1, &
   2,  0,  2,  0, -1, &
   2,  0, -4,  0, -1, &
   0,  0,  3,  0,  2, &
   2,  1, -2, -2, -1 /
data ((mfals(i,j),i=1,5),j=431,440) / &
   1, -2,  0,  0,  1, &
   2, -1,  0, -4,  0, &
   0,  0,  0,  3,  0, &
   5,  0,  2, -2,  2, &
   1,  2, -2, -4, -2, &
   1,  0,  4, -4,  2, &
   0,  0,  4, -1,  2, &
   3,  1,  0, -4,  0, &
   3,  0,  0, -6,  0, &
   2,  0,  0,  2,  2 /
data ((mfals(i,j),i=1,5),j=441,450) / &
   2, -2,  2,  0,  2, &
   1,  0,  0, -3,  1, &
   1, -2, -2,  0, -2, &
   1, -1, -2, -3, -2, &
   0,  0,  2, -2, -2, &
   2,  0, -2, -4,  0, &
   1,  0, -4,  0,  0, &
   0,  1,  0, -1,  0, &
   4,  0,  0,  0, -1, &
   3,  0,  2, -1,  2 /
data ((mfals(i,j),i=1,5),j=451,460) / &
   3, -1,  2,  0,  1, &
   2,  0,  2, -1,  1, &
   1,  2,  2, -2,  1, &
   1,  1,  0,  2, -1, &
   0,  2,  2,  0,  1, &
   3,  1,  2,  0,  1, &
   1,  1,  2,  1,  1, &
   1,  1,  0, -1,  1, &
   1, -2,  0, -2, -1, &
   4,  0,  0, -4,  0 /
data ((mfals(i,j),i=1,5),j=461,470) / &
   2,  1,  0,  2,  0, &
   1, -1,  0,  4,  0, &
   0,  1,  0, -2,  2, &
   0,  0,  2,  0, -2, &
   1,  0, -1,  0,  1, &
   3,  0,  2, -2,  0, &
   2,  0,  2,  2,  0, &
   1,  2,  0, -4,  0, &
   1, -1,  0, -3,  0, &
   0,  1,  0,  4,  0 /
data ((mfals(i,j),i=1,5),j=471,480) / &
   0,  1, -2,  0,  0, &
   2,  2,  2, -2,  2, &
   0,  0,  0,  1, -2, &
   0,  2, -2,  0, -1, &
   4,  0,  2, -4,  2, &
   2,  0, -4,  2, -2, &
   2, -1, -2,  0, -2, &
   1,  1,  4, -2,  2, &
   1,  1,  2, -4,  2, &
   1,  0,  2,  3,  2 /
data ((mfals(i,j),i=1,5),j=481,490) / &
   1,  0,  0,  4, -1, &
   0,  0,  0,  4,  2, &
   2,  0,  0,  4,  0, &
   1,  1, -2,  2,  0, &
   2,  1,  2,  1,  2, &
   2,  1,  2, -4,  1, &
   2,  0,  2,  1,  1, &
   2,  0, -4, -2, -1, &
   2,  0, -2, -6, -1, &
   2, -1,  2, -1,  2 /
data ((mfals(i,j),i=1,5),j=491,500) / &
   1, -2,  2,  0,  1, &
   1, -2,  0, -2,  1, &
   1, -1,  0, -4, -1, &
   0,  2,  2,  2,  2, &
   0,  2, -2, -4, -2, &
   0,  1,  2,  3,  2, &
   0,  1,  0, -4,  1, &
   3,  0,  0, -2,  1, &
   2,  1, -2,  0,  1, &
   2,  0,  4, -2,  1 /
data ((mfals(i,j),i=1,5),j=501,510) / &
   2,  0,  0, -3, -1, &
   2, -2,  0, -2,  1, &
   2, -1,  2, -2,  1, &
   1,  0,  0, -6, -1, &
   1, -2,  0,  0, -1, &
   1, -2, -2, -2, -1, &
   0,  1,  4, -2,  1, &
   0,  0,  2,  3,  1, &
   2, -1,  0, -1,  0, &
   1,  3,  0, -2,  0 /
data ((mfals(i,j),i=1,5),j=511,520) / &
   0,  3,  0, -2,  0, &
   2, -2,  2, -2,  2, &
   0,  0,  4, -2,  0, &
   4, -1,  2,  0,  2, &
   2,  2, -2, -4, -2, &
   4,  1,  2,  0,  2, &
   4, -1, -2, -2, -2, &
   2,  1,  0, -2, -2, &
   2,  1, -2, -6, -2, &
   2,  0,  0, -1,  1 /
data ((mfals(i,j),i=1,5),j=521,530) / &
   2, -1, -2,  2, -1, &
   1,  1, -2,  2, -2, &
   1,  1, -2, -3, -2, &
   1,  0,  3,  0,  3, &
   1,  0, -2,  1,  1, &
   1,  0, -2,  0,  2, &
   1, -1,  2,  1,  2, &
   1, -1,  0,  0, -2, &
   1, -1, -4,  2, -2, &
   0,  3, -2, -2, -2 /
data ((mfals(i,j),i=1,5),j=531,540) / &
   0,  1,  0,  4,  1, &
   0,  0,  4,  2,  2, &
   3,  0, -2, -2,  0, &
   2, -2,  0,  0,  0, &
   1,  1,  2, -4,  0, &
   1,  1,  0, -3,  0, &
   1,  0,  2, -3,  0, &
   1, -1,  2, -2,  0, &
   0,  2,  0,  2,  0, &
   0,  0,  2,  4,  0 /
data ((mfals(i,j),i=1,5),j=541,550) / &
   1,  0,  1,  0,  0, &
   3,  1,  2, -2,  1, &
   3,  0,  4, -2,  2, &
   3,  0,  2,  1,  2, &
   3,  0,  0,  2, -1, &
   3,  0,  0,  0,  2, &
   3,  0, -2,  2, -1, &
   2,  0,  4, -4,  2, &
   2,  0,  2, -3,  2, &
   2,  0,  0,  4,  1 /
data ((mfals(i,j),i=1,5),j=551,560) / &
   2,  0,  0, -3,  1, &
   2,  0, -4,  2, -1, &
   2,  0, -2, -2,  1, &
   2, -2,  2,  2,  2, &
   2, -2,  0, -2, -2, &
   2, -1,  0,  2,  1, &
   2, -1,  0,  2, -1, &
   1,  1,  2,  4,  2, &
   1,  1,  0,  1,  1, &
   1,  1,  0,  1, -1 /
data ((mfals(i,j),i=1,5),j=561,570) / &
   1,  1, -2, -6, -2, &
   1,  0,  0, -3, -1, &
   1,  0, -4, -2, -1, &
   1,  0, -2, -6, -1, &
   1, -2,  2,  2,  1, &
   1, -2, -2,  2, -1, &
   1, -1, -2, -4, -1, &
   0,  2,  0,  0,  2, &
   0,  1,  2, -4,  2, &
   0,  1, -2,  4, -1 /
data ((mfals(i,j),i=1,5),j=571,580) / &
   5,  0,  0,  0,  0, &
   3,  0,  0, -3,  0, &
   2,  2,  0, -4,  0, &
   1, -1,  2,  2,  0, &
   0,  1,  0,  3,  0, &
   4,  0, -2,  0, -1, &
   3,  0, -2, -6, -1, &
   3,  0, -2, -1, -1, &
   2,  1,  2,  2,  1, &
   2,  1,  0,  2,  1 /
data ((mfals(i,j),i=1,5),j=581,590) / &
   2,  0,  2,  4,  1, &
   2,  0,  2, -6,  1, &
   2,  0,  2, -2, -1, &
   2,  0,  0, -6, -1, &
   2, -1, -2, -2, -1, &
   1,  2,  2,  0,  1, &
   1,  2,  0,  0,  1, &
   1,  0,  4,  0,  1, &
   1,  0,  2, -6,  1, &
   1,  0,  2, -4, -1 /
data ((mfals(i,j),i=1,5),j=591,600) / &
   1,  0, -1, -2, -1, &
   1, -1,  2,  4,  1, &
   1, -1,  2, -3,  1, &
   1, -1,  0,  4,  1, &
   1, -1, -2,  1, -1, &
   0,  1,  2, -2,  3, &
   3,  0,  0, -2,  0, &
   1,  0,  1, -2,  0, &
   0,  2,  0, -4,  0, &
   0,  0,  2, -4,  0 /
data ((mfals(i,j),i=1,5),j=601,610) / &
   0,  0,  1, -1,  0, &
   0,  0,  0,  6,  0, &
   0,  2,  0,  0, -2, &
   0,  1, -2,  2, -3, &
   4,  0,  0,  2,  0, &
   3,  0,  0, -1,  0, &
   3, -1,  0,  2,  0, &
   2,  1,  0,  1,  0, &
   2,  1,  0, -6,  0, &
   2, -1,  2,  0,  0 /
data ((mfals(i,j),i=1,5),j=611,620) / &
   1,  0,  2, -1,  0, &
   1, -1,  0,  1,  0, &
   1, -1, -2, -2,  0, &
   0,  1,  2,  2,  0, &
   0,  0,  2, -3,  0, &
   2,  2,  0, -2, -1, &
   2, -1, -2,  0,  1, &
   1,  2,  2, -4,  1, &
   0,  1,  4, -4,  2, &
   0,  0,  0,  3,  2 /
data ((mfals(i,j),i=1,5),j=621,630) / &
   5,  0,  2,  0,  1, &
   4,  1,  2, -2,  2, &
   4,  0, -2, -2,  0, &
   3,  1,  2,  2,  2, &
   3,  1,  0, -2,  0, &
   3,  1, -2, -6, -2, &
   3,  0,  0,  0, -2, &
   3,  0, -2, -4, -2, &
   3, -1,  0, -3,  0, &
   3, -1,  0, -2,  0 /
data ((mfals(i,j),i=1,5),j=631,640) / &
   2,  1,  2,  0,  0, &
   2,  1,  2, -4,  2, &
   2,  1,  2, -2,  0, &
   2,  1,  0, -3,  0, &
   2,  1, -2,  0, -2, &
   2,  0,  0, -4,  2, &
   2,  0,  0, -4, -2, &
   2,  0, -2, -5, -2, &
   2, -1,  2,  4,  2, &
   2, -1,  0, -2,  2 /
data ((mfals(i,j),i=1,5),j=641,650) / &
   1,  3, -2, -2, -2, &
   1,  1,  0,  0, -2, &
   1,  1,  0, -6,  0, &
   1,  1, -2,  1, -2, &
   1,  1, -2, -1, -2, &
   1,  0,  2,  1,  0, &
   1,  0,  0,  3,  0, &
   1,  0,  0, -4,  2, &
   1,  0, -2,  4, -2, &
   1, -2,  0, -1,  0 /
data ((mfals(i,j),i=1,5),j=651,nfls) / &
   0,  1, -4,  2, -1, &
   1,  0, -2,  0, -3, &
   0,  0,  4, -4,  4 /

!  Fundamental-argument multipliers:  planetary terms.
data ((mfapl(i,j),i=1,14),j=1,10) / &
   0,  0,  1, -1,  1,  0,  0, -1,  0, -2,  5,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -5,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0,  0, -2, &
   0,  0,  1, -1,  1,  0, -8, 12,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  8,-16,  4,  5,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0, -1,  2,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=11,20) / &
   0,  0,  0,  0,  0,  0,  8,-13,  0,  0,  0,  0,  0, -1, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  2, -5,  0,  0,  0, &
   0,  0,  2, -2,  1,  0, -5,  6,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  4, -6,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  3,  0, -1,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  2, -8,  3,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  6, -8,  3,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  2, -3,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=21,30) / &
   0,  0,  0,  0,  0,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  1,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -5,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  2, &
   0,  0,  1, -1,  1,  0,  0,  0, -2,  0,  0,  0,  0,  0, &
   2,  0,  0, -2, -1,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1, &
   2,  0,  0, -2,  0,  0,  0, -2,  0,  2,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=31,40) / &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  8,-13,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  5, -8,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  2, -2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -5,  0,  0,  1, &
   2,  0,  0, -2,  0,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0, -1,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -4,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  0, -1,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=41,50) / &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  5, -7,  0,  0,  0,  0,  0, -2, &
   0,  0,  1, -1,  0,  0,  0,  0, -2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  4,  0, -2,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  8,-13,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  2, -1,  0,  0,  0,  0,  0,  2, &
   1,  0,  0,  0,  0,  0,-18, 16,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  1,  0,  0,  0,  2 /
data ((mfapl(i,j),i=1,14),j=51,60) / &
   0,  0,  1, -1,  1,  0, -5,  7,  0,  0,  0,  0,  0,  0, &
   1,  0,  0,  0,  0,  0,-10,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  0,  0, -5,  6,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -1,  0,  0,  0,  2, &
   1,  0,  2,  0,  2,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  4, -2,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  1, &
   1,  0, -2,  0, -2,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  2,  0,  0,  0, &
   0,  0,  2, -2,  1,  0, -3,  3,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=61,70) / &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  8,-16,  4,  5,  0,  0, -2, &
   0,  0,  1, -1,  1,  0,  0,  3, -8,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  8,-11,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  8,-16,  4,  5,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  4, -6,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -3,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=71,80) / &
   0,  0,  0,  0,  0,  0,  6, -8,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  3, -2,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  8,-15,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  2, -5,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  1, -3,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  3,  0, -2,  0,  0,  0,  2, &
   0,  0,  1, -1,  1,  0,  0, -5,  8, -3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  2,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  3, -2,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=81,90) / &
   2,  0,  0, -2,  1,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  5, -8,  0,  0,  0,  0,  0, -1, &
   2,  0,  0, -2,  0,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  8,-13,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  0,  0, -2,  5,  0,  0,  0, &
   1,  0,  0, -1,  0,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  2, &
   1,  0,  0,  0, -1,  0,-18, 16,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  0,  0,  2, -5,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=91,100) / &
   1,  0,  0, -2,  0,  0, 19,-21,  3,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0, -8, 13,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  1,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  7, -9,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  2, &
   1,  0,  0,  0,  1,  0,-18, 16,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  6,-16,  4,  5,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  4, -7,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  3, -7,  0,  0,  0,  0,  0, -2 /
data ((mfapl(i,j),i=1,14),j=101,110) / &
   0,  0,  0,  0,  0,  0,  2, -2,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1, &
   2,  0,  0, -2,  1,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  3, -4,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  0,  0, &
   2,  0,  0, -2, -1,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  2,  0,  0,  0,  2 /
data ((mfapl(i,j),i=1,14),j=111,120) / &
   0,  0,  0,  0,  1,  0,  0,  1, -2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  2, &
   0,  0,  2, -2,  1,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0,  0, -1,  0, -1,  0,  0,  0,  0, &
   2,  0,  0, -2,  0,  0, -6,  8,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -2,  2,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=121,130) / &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  2, -3,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  0, -1,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  8,-10,  0,  0,  0,  0,  0, -2, &
   0,  0,  1, -1,  1,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  6, -9,  0,  0,  0,  0,  0, -2, &
   1,  0,  0, -1,  1,  0,  0, -1,  0,  2,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=131,140) / &
   0,  0,  0,  0,  0,  0,  5, -7,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  5, -5,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  4,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  4,  0, -3,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  1,  0,  2, -3,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=141,150) / &
   1,  0,  0, -1,  0,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1, -3,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  5, -4,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  9,-11,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  2, -3,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  8,-15,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0, -4,  5,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  4, -6,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  4,  0, -1,  0,  0,  0,  2 /
data ((mfapl(i,j),i=1,14),j=151,160) / &
   1,  0,  0, -1,  1,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
   0,  0,  1,  1,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0, -4, 10,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0,  0, -1,  0,  0, -1,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -1,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -4,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -5,  0,  0, -2, &
   0,  0,  2, -2,  1,  0, -4,  4,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=161,170) / &
   0,  0,  0,  0,  0,  0,  0,  3,  0,  0, -1,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  4, -3,  0,  0,  0,  0,  2, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  0,  0,  2,  0, &
   0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  5, -8,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -9, 13,  0,  0,  0,  0,  0, &
   2,  0,  2,  0,  2,  0,  0,  2,  0, -3,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=171,180) / &
   0,  0,  0,  0,  0,  0,  3, -6,  0,  0,  0,  0,  0, -2, &
   0,  0,  1, -1,  2,  0,  0, -1,  0,  0,  2,  0,  0,  0, &
   1,  0,  0, -1, -1,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3, -6,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  6, -6,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  1, &
   1,  0,  2,  0,  1,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   1,  0, -2,  0, -1,  0,  0, -1,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0, -2,  4,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=181,190) / &
   0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  1, &
   0,  0,  2,  0,  2,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1, -8,  3,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  6,-10,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  7, -8,  3,  0,  0,  0,  2, &
   0,  0,  0,  0,  1,  0, -3,  5,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0, -1,  0,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0, -5,  7,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -2,  0,  0,  0,  1 /
data ((mfapl(i,j),i=1,14),j=191,200) / &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -1,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  7,-10,  0,  0,  0,  0,  0, -2, &
   1,  0,  0, -2,  0,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  2, -5,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  6, -8,  0,  0,  0,  0,  0, -1, &
   0,  0,  1, -1,  1,  0,  0, -9, 15,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0, -2,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0, -1,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3, -6,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=201,210) / &
   0,  0,  0,  0,  0,  0,  0,  1, -4,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  0, -1,  0,  0,  2, &
   2,  0,  0, -2,  1,  0, -6,  8,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  5, -5,  0,  0,  0,  0,  0, -1, &
   0,  0,  1, -1,  1,  0,  3, -6,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  8,-14,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=211,220) / &
   0,  0,  0,  0,  1,  0,  0,  8,-15,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  4, -6,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  7, -7,  0,  0,  0,  0,  0,  0, &
   2,  0,  0, -2,  1,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3, -1,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  1,  0,  0,  2, &
   2,  0, -1, -1,  0,  0,  0,  3, -7,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  4, -7,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -3,  4,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=221,230) / &
   2,  0,  0, -2,  0,  0,  0, -6,  8,  0,  0,  0,  0,  0, &
   2,  0,  0, -2,  0,  0,  0, -5,  6,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  0,  0, -1,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  1,  2,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  1,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -9,  4,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0, -2 /
data ((mfapl(i,j),i=1,14),j=231,240) / &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -4,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  1, &
   0,  0,  0,  0,  0,  0,  7,-11,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  3, -5,  4,  0,  0,  0,  0,  2, &
   0,  0,  1, -1,  0,  0,  0, -1,  0, -1,  1,  0,  0,  0, &
   2,  0,  0,  0,  0,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  8,-15,  0,  0,  0,  0, -2, &
   0,  0,  1, -1,  2,  0,  0, -2,  2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  6, -6,  0,  0,  0,  0,  0, -1 /
data ((mfapl(i,j),i=1,14),j=241,250) / &
   0,  0,  1, -1,  1,  0,  0, -1,  0, -1,  1,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  2, -2,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  0,  4, -7,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3, -8,  3,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  2, -4,  0, -3,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  3, -5,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3,  0, -3,  0,  0,  0,  2, &
   0,  0,  2, -2,  2,  0, -8, 11,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5, -8,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  0, -2,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=251,260) / &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  5, -9,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  5, -5,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  7, -9,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  4, -7,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  2, -1,  0,  0,  0,  0,  0,  0, &
   1,  0, -2, -2, -2,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -2,  5,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  3, -3,  0,  0,  0,  0,  0,  1 /
data ((mfapl(i,j),i=1,14),j=261,270) / &
   0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  2, -5,  0,  0,  2, &
   2,  0,  0, -2, -1,  0,  0, -2,  0,  0,  5,  0,  0,  0, &
   2,  0,  0, -2, -1,  0, -6,  8,  0,  0,  0,  0,  0,  0, &
   1,  0,  0, -2,  0,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  8, -8,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3,  0,  2, -5,  0,  0,  2, &
   0,  0,  0,  0,  1,  0,  3, -7,  4,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0, -1,  0,  1,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=271,280) / &
   0,  0,  1, -1,  0,  0,  0, -1,  0, -2,  5,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3,  0, -3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -1,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  2, -3,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  6,-15,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  3,  0,  1,  0,  0,  0,  2, &
   1,  0,  0, -1,  0,  0,  0, -3,  4,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0, -3,  7, -4,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5,  0, -2,  0,  0,  0,  2 /
data ((mfapl(i,j),i=1,14),j=281,290) / &
   0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0,  0,  1, &
   0,  0,  2, -2,  2,  0, -5,  6,  0,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  2,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  4, -8,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  4, -5,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  5, -7,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  6,-11,  0,  0,  0,  0, -2 /
data ((mfapl(i,j),i=1,14),j=291,300) / &
   0,  0,  0,  0,  0,  0,  0,  1, -3,  0,  0,  0,  0, -2, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  3,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  9,-12,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0,  1, &
   0,  0,  1, -1,  0,  0, -8, 12,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0, -2,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  7, -7,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  3, -6,  0,  0,  0,  0, -1 /
data ((mfapl(i,j),i=1,14),j=301,310) / &
   0,  0,  0,  0,  0,  0,  0,  6, -6,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  1,  0, -4,  0,  0,  0,  0,  0, -2, &
   0,  0,  1, -1,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  6, -9,  0,  0,  0,  0,  0, -1, &
   0,  0,  1, -1, -1,  0,  0,  0, -2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1, -5,  0,  0,  0,  0, -2, &
   2,  0,  0, -2,  0,  0,  0, -2,  0,  3, -1,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  0, -2,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5, -9,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  0,  2 /
data ((mfapl(i,j),i=1,14),j=311,320) / &
   0,  0,  0,  0,  0,  0,  9, -9,  0,  0,  0,  0,  0, -1, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  3,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  2, -4,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  5, -3,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  1, &
   0,  0,  1, -1,  2,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  5, -9,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  5, -3,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  4,  0,  0,  0,  2, &
   0,  0,  2,  0,  2,  0,  0,  4, -8,  3,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=321,330) / &
   0,  0,  2,  0,  2,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5,  0, -3,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0, &
   2,  0, -1, -1, -1,  0,  0, -1,  0,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  4, -3,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  4, -2,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  5,-10,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  8,-13,  0,  0,  0,  0,  0,  1, &
   0,  0,  2, -2,  1, -1,  0,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  0,  2,  0,  0 /
data ((mfapl(i,j),i=1,14),j=331,340) / &
   0,  0,  0,  0,  1,  0,  3, -5,  0,  0,  0,  0,  0,  0, &
   1,  0,  0, -2,  0,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   0,  0,  2, -2,  0,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  9, -9,  0,  0,  0,  0,  0,  0, &
   0,  0,  2,  0,  2,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -8, 11,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -2,  0,  0,  2,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0, -1,  2,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  5, -5,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  2, -6,  0,  0,  0,  0,  0, -2 /
data ((mfapl(i,j),i=1,14),j=341,350) / &
   0,  0,  0,  0,  0,  0,  0,  8,-15,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  5, -2,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  7,-13,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  3,  0, -2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  3,  0,  0,  0,  2, &
   0,  0,  2, -2,  1,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  8, -8,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  8,-10,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  4, -2,  0,  0,  0,  0,  0,  1 /
data ((mfapl(i,j),i=1,14),j=351,360) / &
   0,  0,  0,  0,  0,  0,  3, -6,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  3, -4,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -5,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -4,  0,  0,  0,  0, &
   2,  0,  0, -2, -1,  0,  0, -5,  6,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2, -5,  0,  0,  0,  0, -2, &
   2,  0, -1, -1, -1,  0,  0,  3, -7,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5, -8,  0,  0,  0,  0,  0, &
   0,  0,  2,  0,  2,  0, -1,  1,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=361,370) / &
   2,  0,  0, -2,  0,  0,  0, -2,  0,  4, -3,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  6,-11,  0,  0,  0,  0,  0, &
   2,  0,  0, -2,  1,  0,  0, -6,  8,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  4, -8,  1,  5,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  6, -5,  0,  0,  0,  0,  2, &
   1,  0, -2, -2, -2,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  2,  0,  0,  0, -2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  2,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
   0,  0,  0,  0,  2,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  6,  0,  0,  0,  0,  0,  1 /
data ((mfapl(i,j),i=1,14),j=371,380) / &
   0,  0,  0,  0,  0,  0,  0,  6, -7,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  4,  0,  0, -2,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  3,  0,  0, -2,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -1,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  0,  1, -6,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  4, -5,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  2, &
   0,  0,  0,  0,  0,  0,  3, -5,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  7,-13,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -2,  0,  0,  0,  2 /
data ((mfapl(i,j),i=1,14),j=381,390) / &
   0,  0,  1, -1,  0,  0,  0, -1,  0,  0,  2,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0, -8, 15,  0,  0,  0,  0,  0, &
   2,  0,  0, -2, -2,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   2,  0, -1, -1, -1,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
   1,  0,  2, -2,  2,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   1,  0, -1,  1, -1,  0,-18, 17,  0,  0,  0,  0,  0,  0, &
   0,  0,  2,  0,  2,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
   0,  0,  2,  0,  2,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
   0,  0,  2, -2, -1,  0, -5,  6,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  2,  0,  0, -1,  0,  1,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=391,400) / &
   0,  0,  0,  0,  1,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  8,-16,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  5,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  2, &
   0,  0,  0,  0,  2,  0,  0, -1,  2,  0,  0,  0,  0,  0, &
   2,  0, -1, -1, -2,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  6,-10,  0,  0,  0,  0,  0, -1, &
   0,  0,  1, -1,  1,  0,  0, -1,  0, -2,  4,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2,  2,  0,  0,  0,  0,  2, &
   2,  0,  0, -2, -1,  0,  0, -2,  0,  4, -5,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=401,410) / &
   2,  0,  0, -2, -1,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   2,  0, -1, -1, -1,  0,  0, -1,  0,  0,  0,  0,  0,  0, &
   1,  0,  1, -1,  1,  0,  0, -1,  0,  0,  0,  0,  0,  0, &
   1,  0,  0, -1, -1,  0,  0, -2,  2,  0,  0,  0,  0,  0, &
   1,  0, -1, -1, -1,  0, 20,-20,  0,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  1, -2,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0, -2,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  5, -8,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  0,  0,  0, -1,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=411,420) / &
   0,  0,  0,  0,  0,  0,  9,-11,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  5, -3,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -3,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  1, &
   0,  0,  0,  0,  0,  0,  6, -7,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3, -2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  0, -2, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  0, -2,  0,  0,  0, &
   0,  0,  1, -1,  2,  0,  0, -1,  0, -2,  5,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5, -7,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=421,430) / &
   0,  0,  0,  0,  0,  0,  1, -3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5, -8,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  2, -6,  0,  0,  0,  0, -2, &
   1,  0,  0, -2,  0,  0, 20,-21,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  8,-12,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  4, -4,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  2,  0,  0, -1,  0, -1,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  8,-12,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  9,-17,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=431,440) / &
   0,  0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  4, -8,  1,  5,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  4, -6,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  2, -7,  0,  0,  0,  0, -2, &
   1,  0,  0, -1,  1,  0,  0, -3,  4,  0,  0,  0,  0,  0, &
   1,  0, -2,  0, -2,  0,-10,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0, -9, 17,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1, -4,  0,  0,  0,  0,  0, -2, &
   1,  0, -2, -2, -2,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   1,  0, -1,  1, -1,  0,  0,  1,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=441,450) / &
   0,  0,  2, -2,  2,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   0,  0,  1, -1,  2,  0,  0, -1,  0,  0,  1,  0,  0,  0, &
   0,  0,  1, -1,  2,  0, -5,  7,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  2, -2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  4, -5,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  3, -4,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5,-10,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  4,  0, -4,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  2,  0, -5,  0,  0,  0, -2 /
data ((mfapl(i,j),i=1,14),j=451,460) / &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -5,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -2,  5,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -2,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  2, -3,  0,  0,  0,  0,  0,  1, &
   1,  0,  0, -2,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -7,  4,  0,  0,  0,  0,  0, &
   2,  0,  2,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1, -1,  0,  0, -1,  0, -1,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  1,  0, -2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  6,-10,  0,  0,  0,  0, -2 /
data ((mfapl(i,j),i=1,14),j=461,470) / &
   1,  0,  0, -1,  1,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -3,  0,  3,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0, -5,  5,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  1, -3,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -4,  6,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  0,  0, -1,  0,  0, &
   0,  0,  1, -1,  1,  0, -5,  6,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=471,480) / &
   0,  0,  0,  0,  1,  0,  3, -4,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  7,-10,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  5, -5,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  4, -5,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  3, -8,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  2, -5,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  7, -9,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  7, -8,  0,  0,  0,  0,  2 /
data ((mfapl(i,j),i=1,14),j=481,490) / &
   0,  0,  0,  0,  0,  0,  0,  3,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  3, -8,  3,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  0, -2,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  0,  2, -4,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -1,  0,  0,  0, -1, &
   2,  0,  0, -2, -1,  0,  0, -6,  8,  0,  0,  0,  0,  0, &
   2,  0, -1, -1,  1,  0,  0,  3, -7,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -7,  9,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0,  0, -1 /
data ((mfapl(i,j),i=1,14),j=491,500) / &
   0,  0,  1, -1,  2,  0, -8, 12,  0,  0,  0,  0,  0,  0, &
   1,  0,  0,  0,  0,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   1,  0,  0, -2,  0,  0,  2, -2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  7, -8,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0, &
   2,  0,  0, -2,  1,  0,  0, -5,  6,  0,  0,  0,  0,  0, &
   2,  0,  0, -2, -1,  0,  0, -2,  0,  3, -1,  0,  0,  0, &
   1,  0,  1,  1,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   1,  0,  0, -2,  1,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   1,  0,  0, -2, -1,  0,  0, -2,  0,  2,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=501,510) / &
   1,  0,  0, -1, -1,  0,  0, -3,  4,  0,  0,  0,  0,  0, &
   1,  0, -1,  0, -1,  0, -3,  5,  0,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -4,  4,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -2,  0,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0, -8, 11,  0,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  0,  0,  0, -9, 13,  0,  0,  0,  0,  0, &
   0,  0,  1,  1,  2,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0,  1, -4,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0,  0, -1,  0,  1, -3,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0,  7,-13,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=511,520) / &
   0,  0,  0,  0,  1,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0, -2,  2,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  1,  0, -4,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  7,-11,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  6, -6,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  6, -4,  0,  0,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  4, -2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -4,  0,  0,  0,  0,  0,  1 /
data ((mfapl(i,j),i=1,14),j=521,530) / &
   0,  0,  0,  0,  0,  0,  1, -4,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  9,-17,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  7, -7,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  4, -8,  3,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  0,  4, -8,  3,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  4, -8,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  4, -7,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  1,  0,  0,  0,  1, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -4,  0,  0,  0,  0, &
   2,  0,  0, -2,  0,  0,  0, -4,  8, -3,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=531,540) / &
   2,  0,  0, -2,  0,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
   1,  0,  0,  0,  0,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
   1,  0,  0,  0,  0,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
   1,  0,  0,  0,  0,  0, -1,  1,  0,  0,  0,  0,  0,  0, &
   1,  0,  0, -2,  0,  0, 17,-16,  0, -2,  0,  0,  0,  0, &
   1,  0,  0, -1,  0,  0,  0, -2,  2,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  0,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  6, -9,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  4,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  3,  0, -4,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=541,550) / &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1, -2, -2, &
   0,  0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  0,  2, &
   2,  0,  0, -2,  0,  0,  0, -4,  4,  0,  0,  0,  0,  0, &
   2,  0,  0, -2,  0,  0,  0, -2,  0,  2,  2,  0,  0,  0, &
   1,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
   1,  0,  0,  0,  0,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
   1,  0,  0,  0,  0,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   1,  0,  0, -2,  0,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
   1,  0,  0, -2,  0,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
   1,  0,  0, -2,  0,  0,  0, -4,  8, -3,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=551,560) / &
   1,  0,  0, -2,  0,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  0,  0, -4,  4,  0,  0,  0,  0,  0,  0, &
   0,  0,  1,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0,  3, -6,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0,  0, -2,  2,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0,  0, -1,  0,  1,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0,  0, -1,  0,  0,  1,  0,  0,  0, &
   0,  0,  1, -1,  0,  0, -4,  5,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  2,  0,  0,  0, -1,  0,  1,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=561,570) / &
   0,  0,  0,  0,  0,  0,  8, -9,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -6,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  3, -5,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -2,  0,  0,  0, &
   2,  0, -2, -2, -2,  0,  0, -2,  0,  2,  0,  0,  0,  0, &
   1,  0,  0,  0,  1,  0,-10,  3,  0,  0,  0,  0,  0,  0, &
   1,  0,  0,  0, -1,  0,-10,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  2,  0,  2,  0,  2, -3,  0,  0,  0,  0,  0,  0, &
   0,  0,  2,  0,  2,  0,  2, -2,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=571,580) / &
   0,  0,  2,  0,  2,  0, -2,  3,  0,  0,  0,  0,  0,  0, &
   0,  0,  2,  0,  2,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  2,  0,  0,  0,  0,  1,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0,  0, -1,  0,  2,  0,  0,  0,  0, &
   2,  0,  2, -2,  2,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   2,  0,  1, -3,  1,  0, -6,  7,  0,  0,  0,  0,  0,  0, &
   2,  0,  0, -2,  0,  0,  2, -5,  0,  0,  0,  0,  0,  0, &
   2,  0,  0, -2,  0,  0,  0, -2,  0,  5, -5,  0,  0,  0, &
   2,  0,  0, -2,  0,  0,  0, -2,  0,  1,  5,  0,  0,  0, &
   2,  0,  0, -2,  0,  0,  0, -2,  0,  0,  5,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=581,590) / &
   2,  0,  0, -2,  0,  0,  0, -2,  0,  0,  2,  0,  0,  0, &
   2,  0,  0, -2,  0,  0, -4,  4,  0,  0,  0,  0,  0,  0, &
   2,  0, -2,  0, -2,  0,  0,  5, -9,  0,  0,  0,  0,  0, &
   2,  0, -1, -1,  0,  0,  0, -1,  0,  3,  0,  0,  0,  0, &
   1,  0,  2,  0,  2,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
   1,  0,  2,  0,  2,  0,  0,  4, -8,  3,  0,  0,  0,  0, &
   1,  0,  2,  0,  2,  0,  0, -4,  8, -3,  0,  0,  0,  0, &
   1,  0,  2,  0,  2,  0, -1,  1,  0,  0,  0,  0,  0,  0, &
   1,  0,  2, -2,  2,  0, -3,  3,  0,  0,  0,  0,  0,  0, &
   1,  0,  0,  0,  0,  0,  0,  1,  0, -1,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=591,600) / &
   1,  0,  0,  0,  0,  0,  0, -2,  0,  3,  0,  0,  0,  0, &
   1,  0,  0, -2,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
   1,  0, -2, -2, -2,  0,  0,  1,  0, -1,  0,  0,  0,  0, &
   1,  0, -1,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   1,  0, -1, -1,  0,  0,  0,  8,-15,  0,  0,  0,  0,  0, &
   0,  0,  2,  2,  2,  0,  0,  2,  0, -2,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  1, -1,  0,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0, -2,  0,  1,  0,  0,  0,  0, &
   0,  0,  2, -2,  1,  0,  0,-10, 15,  0,  0,  0,  0,  0, &
   0,  0,  2, -2,  0, -1,  0,  2,  0,  0,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=601,610) / &
   0,  0,  1, -1,  2,  0,  0, -1,  0,  0, -1,  0,  0,  0, &
   0,  0,  1, -1,  2,  0, -3,  4,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0, -4,  6,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  1,  0, -1,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0,  0, -1,  0,  0, -2,  0,  0,  0, &
   0,  0,  1, -1,  0,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1,  0,  0, -1,  0,  0,  0,  0,  0,  0,  0, &
   0,  0,  1, -1, -1,  0, -5,  7,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  2,  0,  0,  0,  2,  0, -2,  0,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=611,620) / &
   0,  0,  0,  2,  0,  0, -2,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  2,  0, -3,  5,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  1,  0, -1,  2,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  9,-13,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  8,-14,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  8,-11,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  6, -9,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  6, -8,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  6, -7,  0,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  0, -2 /
data ((mfapl(i,j),i=1,14),j=621,630) / &
   0,  0,  0,  0,  0,  0,  5, -6, -4,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  5, -4,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  4, -8,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  4, -5,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  3, -3,  0,  2,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  3, -1,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  1, -1,  0,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  7,-12,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  6, -9,  0,  0,  0,  0, -2 /
data ((mfapl(i,j),i=1,14),j=631,640) / &
   0,  0,  0,  0,  0,  0,  0,  6, -8,  1,  5,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  6, -4,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  6,-10,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5,  0, -4,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  5, -9,  0,  0,  0,  0, -1, &
   0,  0,  0,  0,  0,  0,  0,  5, -8,  3,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  5, -7,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  5, -6,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  5,-16,  4,  5,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  5,-13,  0,  0,  0,  0, -2 /
data ((mfapl(i,j),i=1,14),j=641,650) / &
   0,  0,  0,  0,  0,  0,  0,  3,  0, -5,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  3, -9,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  3, -7,  0,  0,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  2,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  2,  0,  0, -3,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  2, -8,  1,  5,  0,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  1, -5,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  2,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  1,  0,  0, -3,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  1,  0, -3,  5,  0,  0,  0 /
data ((mfapl(i,j),i=1,14),j=651,nfpl) / &
   0,  0,  0,  0,  0,  0,  0,  1, -3,  0,  0,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  2, -6,  3,  0, -2, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  1, -2,  0,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0, &
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  2, &
   0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0 /

!  Pointers into amplitudes array, one pointer per frequency.
data (nc(i),i=1,100) / &
    1,   21,   37,   51,   65,   79,   91,  103,  115,  127, &
  139,  151,  163,  172,  184,  196,  207,  219,  231,  240, &
  252,  261,  273,  285,  297,  309,  318,  327,  339,  351, &
  363,  372,  384,  396,  405,  415,  423,  435,  444,  452, &
  460,  467,  474,  482,  490,  498,  506,  513,  521,  528, &
  536,  543,  551,  559,  566,  574,  582,  590,  597,  605, &
  613,  620,  628,  636,  644,  651,  658,  666,  674,  680, &
  687,  695,  702,  710,  717,  725,  732,  739,  746,  753, &
  760,  767,  774,  782,  790,  798,  805,  812,  819,  826, &
  833,  840,  846,  853,  860,  867,  874,  881,  888,  895 /
data (nc(i),i=101,200) / &
  901,  908,  914,  921,  928,  934,  941,  948,  955,  962, &
  969,  976,  982,  989,  996, 1003, 1010, 1017, 1024, 1031, &
 1037, 1043, 1050, 1057, 1064, 1071, 1078, 1084, 1091, 1098, &
 1104, 1112, 1118, 1124, 1131, 1138, 1145, 1151, 1157, 1164, &
 1171, 1178, 1185, 1192, 1199, 1205, 1212, 1218, 1226, 1232, &
 1239, 1245, 1252, 1259, 1266, 1272, 1278, 1284, 1292, 1298, &
 1304, 1310, 1316, 1323, 1329, 1335, 1341, 1347, 1353, 1359, &
 1365, 1371, 1377, 1383, 1389, 1396, 1402, 1408, 1414, 1420, &
 1426, 1434, 1440, 1446, 1452, 1459, 1465, 1471, 1477, 1482, &
 1488, 1493, 1499, 1504, 1509, 1514, 1520, 1527, 1532, 1538 /
data (nc(i),i=201,300) / &
 1543, 1548, 1553, 1558, 1564, 1569, 1574, 1579, 1584, 1589, &
 1594, 1596, 1598, 1600, 1602, 1605, 1608, 1610, 1612, 1617, &
 1619, 1623, 1625, 1627, 1629, 1632, 1634, 1640, 1642, 1644, &
 1646, 1648, 1650, 1652, 1654, 1658, 1660, 1662, 1664, 1668, &
 1670, 1672, 1673, 1675, 1679, 1681, 1683, 1684, 1686, 1688, &
 1690, 1693, 1695, 1697, 1701, 1703, 1705, 1707, 1709, 1711, &
 1712, 1715, 1717, 1721, 1723, 1725, 1727, 1729, 1731, 1733, &
 1735, 1737, 1739, 1741, 1743, 1745, 1747, 1749, 1751, 1753, &
 1755, 1757, 1759, 1761, 1762, 1764, 1766, 1768, 1769, 1771, &
 1773, 1775, 1777, 1779, 1781, 1783, 1785, 1787, 1788, 1790 /
data (nc(i),i=301,400) / &
 1792, 1794, 1796, 1798, 1800, 1802, 1804, 1806, 1807, 1809, &
 1811, 1815, 1817, 1819, 1821, 1823, 1825, 1827, 1829, 1831, &
 1833, 1835, 1837, 1839, 1840, 1842, 1844, 1848, 1850, 1852, &
 1854, 1856, 1858, 1859, 1860, 1862, 1864, 1866, 1868, 1869, &
 1871, 1873, 1875, 1877, 1879, 1881, 1883, 1885, 1887, 1889, &
 1891, 1892, 1896, 1898, 1900, 1901, 1903, 1905, 1907, 1909, &
 1910, 1911, 1913, 1915, 1919, 1921, 1923, 1927, 1929, 1931, &
 1933, 1935, 1937, 1939, 1943, 1945, 1947, 1948, 1949, 1951, &
 1953, 1955, 1957, 1958, 1960, 1962, 1964, 1966, 1968, 1970, &
 1971, 1973, 1974, 1975, 1977, 1979, 1980, 1981, 1982, 1984 /
data (nc(i),i=401,500) / &
 1986, 1988, 1990, 1992, 1994, 1995, 1997, 1999, 2001, 2003, &
 2005, 2007, 2008, 2009, 2011, 2013, 2015, 2017, 2019, 2021, &
 2023, 2024, 2025, 2027, 2029, 2031, 2033, 2035, 2037, 2041, &
 2043, 2045, 2046, 2047, 2049, 2051, 2053, 2055, 2056, 2057, &
 2059, 2061, 2063, 2065, 2067, 2069, 2070, 2071, 2072, 2074, &
 2076, 2078, 2080, 2082, 2084, 2086, 2088, 2090, 2092, 2094, &
 2095, 2096, 2097, 2099, 2101, 2105, 2106, 2107, 2108, 2109, &
 2110, 2111, 2113, 2115, 2119, 2121, 2123, 2125, 2127, 2129, &
 2131, 2133, 2135, 2136, 2137, 2139, 2141, 2143, 2145, 2147, &
 2149, 2151, 2153, 2155, 2157, 2159, 2161, 2163, 2165, 2167 /
data (nc(i),i=501,600) / &
 2169, 2171, 2173, 2175, 2177, 2179, 2181, 2183, 2185, 2186, &
 2187, 2188, 2192, 2193, 2195, 2197, 2199, 2201, 2203, 2205, &
 2207, 2209, 2211, 2213, 2217, 2219, 2221, 2223, 2225, 2227, &
 2229, 2231, 2233, 2234, 2235, 2236, 2237, 2238, 2239, 2240, &
 2241, 2244, 2246, 2248, 2250, 2252, 2254, 2256, 2258, 2260, &
 2262, 2264, 2266, 2268, 2270, 2272, 2274, 2276, 2278, 2280, &
 2282, 2284, 2286, 2288, 2290, 2292, 2294, 2296, 2298, 2300, &
 2302, 2303, 2304, 2305, 2306, 2307, 2309, 2311, 2313, 2315, &
 2317, 2319, 2321, 2323, 2325, 2327, 2329, 2331, 2333, 2335, &
 2337, 2341, 2343, 2345, 2347, 2349, 2351, 2352, 2355, 2356 /
data (nc(i),i=601,700) / &
 2357, 2358, 2359, 2361, 2363, 2364, 2365, 2366, 2367, 2368, &
 2369, 2370, 2371, 2372, 2373, 2374, 2376, 2378, 2380, 2382, &
 2384, 2385, 2386, 2387, 2388, 2389, 2390, 2391, 2392, 2393, &
 2394, 2395, 2396, 2397, 2398, 2399, 2400, 2401, 2402, 2403, &
 2404, 2405, 2406, 2407, 2408, 2409, 2410, 2411, 2412, 2413, &
 2414, 2415, 2417, 2418, 2430, 2438, 2445, 2453, 2460, 2468, &
 2474, 2480, 2488, 2496, 2504, 2512, 2520, 2527, 2535, 2543, &
 2550, 2558, 2566, 2574, 2580, 2588, 2596, 2604, 2612, 2619, &
 2627, 2634, 2642, 2648, 2656, 2664, 2671, 2679, 2685, 2693, &
 2701, 2709, 2717, 2725, 2733, 2739, 2747, 2753, 2761, 2769 /
data (nc(i),i=701,800) / &
 2777, 2785, 2793, 2801, 2809, 2817, 2825, 2833, 2841, 2848, &
 2856, 2864, 2872, 2878, 2884, 2892, 2898, 2906, 2914, 2922, &
 2930, 2938, 2944, 2952, 2958, 2966, 2974, 2982, 2988, 2996, &
 3001, 3009, 3017, 3025, 3032, 3039, 3045, 3052, 3059, 3067, &
 3069, 3076, 3083, 3090, 3098, 3105, 3109, 3111, 3113, 3120, &
 3124, 3128, 3132, 3136, 3140, 3144, 3146, 3150, 3158, 3161, &
 3165, 3166, 3168, 3172, 3176, 3180, 3182, 3185, 3189, 3193, &
 3194, 3197, 3200, 3204, 3208, 3212, 3216, 3219, 3221, 3222, &
 3226, 3230, 3234, 3238, 3242, 3243, 3247, 3251, 3254, 3258, &
 3262, 3266, 3270, 3274, 3275, 3279, 3283, 3287, 3289, 3293 /
data (nc(i),i=801,900) / &
 3296, 3300, 3303, 3307, 3311, 3315, 3319, 3321, 3324, 3327, &
 3330, 3334, 3338, 3340, 3342, 3346, 3350, 3354, 3358, 3361, &
 3365, 3369, 3373, 3377, 3381, 3385, 3389, 3393, 3394, 3398, &
 3402, 3406, 3410, 3413, 3417, 3421, 3425, 3429, 3433, 3435, &
 3439, 3443, 3446, 3450, 3453, 3457, 3458, 3461, 3464, 3468, &
 3472, 3476, 3478, 3481, 3485, 3489, 3493, 3497, 3501, 3505, &
 3507, 3511, 3514, 3517, 3521, 3524, 3525, 3527, 3529, 3533, &
 3536, 3540, 3541, 3545, 3548, 3551, 3555, 3559, 3563, 3567, &
 3569, 3570, 3574, 3576, 3578, 3582, 3586, 3590, 3593, 3596, &
 3600, 3604, 3608, 3612, 3616, 3620, 3623, 3626, 3630, 3632 /
data (nc(i),i=901,1000) / &
 3636, 3640, 3643, 3646, 3648, 3652, 3656, 3660, 3664, 3667, &
 3669, 3671, 3675, 3679, 3683, 3687, 3689, 3693, 3694, 3695, &
 3699, 3703, 3705, 3707, 3710, 3713, 3717, 3721, 3725, 3729, &
 3733, 3736, 3740, 3744, 3748, 3752, 3754, 3757, 3759, 3763, &
 3767, 3770, 3773, 3777, 3779, 3783, 3786, 3790, 3794, 3798, &
 3801, 3805, 3809, 3813, 3817, 3821, 3825, 3827, 3831, 3835, &
 3836, 3837, 3840, 3844, 3848, 3852, 3856, 3859, 3863, 3867, &
 3869, 3871, 3875, 3879, 3883, 3887, 3890, 3894, 3898, 3901, &
 3905, 3909, 3913, 3917, 3921, 3922, 3923, 3924, 3926, 3930, &
 3932, 3936, 3938, 3940, 3944, 3948, 3952, 3956, 3959, 3963 /
data (nc(i),i=1001,1100) / &
 3965, 3969, 3973, 3977, 3979, 3981, 3982, 3986, 3989, 3993, &
 3997, 4001, 4004, 4006, 4009, 4012, 4016, 4020, 4024, 4026, &
 4028, 4032, 4036, 4040, 4044, 4046, 4050, 4054, 4058, 4060, &
 4062, 4063, 4064, 4068, 4071, 4075, 4077, 4081, 4083, 4087, &
 4089, 4091, 4095, 4099, 4101, 4103, 4105, 4107, 4111, 4115, &
 4119, 4123, 4127, 4129, 4131, 4135, 4139, 4141, 4143, 4145, &
 4149, 4153, 4157, 4161, 4165, 4169, 4173, 4177, 4180, 4183, &
 4187, 4191, 4195, 4198, 4201, 4205, 4209, 4212, 4213, 4216, &
 4217, 4221, 4223, 4226, 4230, 4234, 4236, 4240, 4244, 4248, &
 4252, 4256, 4258, 4262, 4264, 4266, 4268, 4270, 4272, 4276 /
data (nc(i),i=1101,1200) / &
 4279, 4283, 4285, 4287, 4289, 4293, 4295, 4299, 4300, 4301, &
 4305, 4309, 4313, 4317, 4319, 4323, 4325, 4329, 4331, 4333, &
 4335, 4337, 4341, 4345, 4349, 4351, 4353, 4357, 4361, 4365, &
 4367, 4369, 4373, 4377, 4381, 4383, 4387, 4389, 4391, 4395, &
 4399, 4403, 4407, 4411, 4413, 4414, 4415, 4418, 4419, 4421, &
 4423, 4427, 4429, 4431, 4433, 4435, 4437, 4439, 4443, 4446, &
 4450, 4452, 4456, 4458, 4460, 4462, 4466, 4469, 4473, 4477, &
 4481, 4483, 4487, 4489, 4491, 4493, 4497, 4499, 4501, 4504, &
 4506, 4510, 4513, 4514, 4515, 4518, 4521, 4522, 4525, 4526, &
 4527, 4530, 4533, 4534, 4537, 4541, 4542, 4543, 4544, 4545 /
data (nc(i),i=1201,1300) / &
 4546, 4547, 4550, 4553, 4554, 4555, 4558, 4561, 4564, 4567, &
 4568, 4571, 4574, 4575, 4578, 4581, 4582, 4585, 4586, 4588, &
 4590, 4592, 4596, 4598, 4602, 4604, 4608, 4612, 4613, 4616, &
 4619, 4622, 4623, 4624, 4625, 4626, 4629, 4632, 4633, 4636, &
 4639, 4640, 4641, 4642, 4643, 4644, 4645, 4648, 4649, 4650, &
 4651, 4652, 4653, 4656, 4657, 4660, 4661, 4664, 4667, 4670, &
 4671, 4674, 4675, 4676, 4677, 4678, 4681, 4682, 4683, 4684, &
 4687, 4688, 4689, 4692, 4693, 4696, 4697, 4700, 4701, 4702, &
 4703, 4704, 4707, 4708, 4711, 4712, 4715, 4716, 4717, 4718, &
 4719, 4720, 4721, 4722, 4723, 4726, 4729, 4730, 4733, 4736 /
data (nc(i),i=1301,nf) / &
 4737, 4740, 4741, 4742, 4745, 4746, 4749, 4752, 4753 /

!  Amplitude coefficients (microarcsec);  indexed using the NC array.
data (a(i),i=1,133) / &
-6844318.44d0,9205236.26d0,1328.67d0,1538.18d0,205833.11d0, &
153041.79d0,-3309.73d0,853.32d0,2037.98d0,-2301.27d0,81.46d0, &
120.56d0,-20.39d0,-15.22d0,1.73d0,-1.61d0,-0.1d0,0.11d0,-0.02d0, &
-0.02d0,-523908.04d0,573033.42d0,-544.75d0,-458.66d0,12814.01d0, &
11714.49d0,198.97d0,-290.91d0,155.74d0,-143.27d0,-2.75d0,-1.03d0, &
-1.27d0,-1.16d0,    0d0,-0.01d0,-90552.22d0,97846.69d0,111.23d0, &
137.41d0,2187.91d0,2024.68d0,41.44d0,-51.26d0,26.92d0,-24.46d0, &
-0.46d0,-0.28d0,-0.22d0, -0.2d0,82168.76d0,-89618.24d0,-27.64d0, &
-29.05d0,-2004.36d0,-1837.32d0,-36.07d0,48d0,-24.43d0,22.41d0, &
 0.47d0, 0.24d0,  0.2d0, 0.18d0,58707.02d0,7387.02d0,470.05d0, &
-192.4d0,164.33d0,-1312.21d0,-179.73d0,-28.93d0,-17.36d0,-1.83d0, &
 -0.5d0, 3.57d0,    0d0, 0.13d0,-20557.78d0,22438.42d0,-20.84d0, &
-17.4d0,501.82d0,459.68d0,59.2d0,-67.3d0,6.08d0,-5.61d0,-1.36d0, &
-1.19d0,28288.28d0,-674.99d0,-34.69d0,35.8d0,-15.07d0,-632.54d0, &
-11.19d0,0.78d0,-8.41d0, 0.17d0, 0.01d0, 0.07d0,-15406.85d0, &
20069.5d0,15.12d0,31.8d0,448.76d0,344.5d0,-5.77d0,1.41d0,4.59d0, &
-5.02d0, 0.17d0, 0.24d0,-11991.74d0,12902.66d0,32.46d0,36.7d0, &
288.49d0,268.14d0,5.7d0,-7.06d0, 3.57d0,-3.23d0,-0.06d0,-0.04d0, &
-8584.95d0,-9592.72d0,4.42d0,-13.2d0,-214.5d0,192.06d0,23.87d0 /
data (a(i),i=134,273) / &
29.83d0, 2.54d0,  2.4d0,  0.6d0,-0.48d0,5095.5d0,-6918.22d0, &
 7.19d0, 3.92d0,-154.91d0,-113.94d0,2.86d0,-1.04d0,-1.52d0, &
 1.73d0,-0.07d0, -0.1d0,-4910.93d0,-5331.13d0,0.76d0,0.4d0, &
-119.21d0,109.81d0,2.16d0,3.2d0, 1.46d0, 1.33d0, 0.04d0,-0.02d0, &
-6245.02d0,-123.48d0,-6.68d0,-8.2d0,-2.76d0,139.64d0,2.71d0, &
 0.15d0, 1.86d0,2511.85d0,-3323.89d0,1.07d0,-0.9d0,-74.33d0, &
-56.17d0,1.16d0,-0.01d0,-0.75d0, 0.83d0,-0.02d0,-0.04d0, &
2307.58d0,3143.98d0,-7.52d0,7.5d0,70.31d0,-51.6d0,1.46d0,0.16d0, &
-0.69d0,-0.79d0, 0.02d0,-0.05d0,2372.58d0,2554.51d0,5.93d0, &
 -6.6d0,57.12d0,-53.05d0,-0.96d0,-1.24d0,-0.71d0,-0.64d0,-0.01d0, &
-2053.16d0,2636.13d0,5.13d0,7.8d0,58.94d0,45.91d0,-0.42d0, &
-0.12d0, 0.61d0,-0.66d0, 0.02d0, 0.03d0,-1825.49d0,-2423.59d0, &
 1.23d0,   -2d0,-54.19d0,40.82d0,-1.07d0,-1.02d0,0.54d0, 0.61d0, &
-0.04d0, 0.04d0,2521.07d0,-122.28d0,-5.97d0,2.9d0,-2.73d0, &
-56.37d0,-0.82d0,0.13d0,-0.75d0,-1534.09d0,1645.01d0,6.29d0, &
  6.8d0,36.78d0, 34.3d0, 0.92d0,-1.25d0, 0.46d0,-0.41d0,-0.02d0, &
-0.01d0,1898.27d0,47.7d0,-0.72d0, 2.5d0, 1.07d0,-42.45d0,-0.94d0, &
 0.02d0,-0.56d0,-1292.02d0,-1387d0, 0d0,    0d0,-31.01d0,28.89d0, &
 0.68d0,    0d0, 0.38d0, 0.35d0,-0.01d0,-0.01d0,-1234.96d0 /
data (a(i),i=274,415) / &
1323.81d0,5.21d0, 5.9d0, 29.6d0,27.61d0, 0.74d0,-1.22d0, 0.37d0, &
-0.33d0,-0.02d0,-0.01d0,1137.48d0,-1233.89d0,-0.04d0,-0.3d0, &
-27.59d0,-25.43d0,-0.61d0,  1d0,-0.34d0, 0.31d0, 0.01d0, 0.01d0, &
-813.13d0,-1075.6d0,0.4d0,0.3d0,-24.05d0,18.18d0,-0.4d0,-0.01d0, &
 0.24d0, 0.27d0,-0.01d0, 0.01d0,1163.22d0,-60.9d0,-2.94d0,1.3d0, &
-1.36d0,-26.01d0,-0.58d0,0.07d0,-0.35d0,1029.7d0,-55.55d0, &
-2.63d0,  1.1d0,-1.25d0,-23.02d0,-0.52d0,0.06d0,-0.31d0, &
-556.26d0,852.85d0,3.16d0,-4.48d0,19.06d0,12.44d0,-0.81d0, &
-0.27d0, 0.17d0,-0.21d0,    0d0, 0.02d0,-603.52d0,-800.34d0, &
 0.44d0,  0.1d0,-17.9d0,13.49d0,-0.08d0,-0.01d0, 0.18d0,  0.2d0, &
-0.01d0, 0.01d0,-628.24d0,684.99d0,-0.64d0,-0.5d0,15.32d0, &
14.05d0, 3.18d0,-4.19d0, 0.19d0,-0.17d0,-0.09d0,-0.07d0, &
-866.48d0,-16.26d0,0.52d0,-1.3d0,-0.36d0,19.37d0,0.43d0,-0.01d0, &
 0.26d0,-512.37d0,695.54d0,-1.47d0,-1.4d0,15.55d0,11.46d0, &
-0.16d0, 0.03d0, 0.15d0,-0.17d0, 0.01d0, 0.01d0,506.65d0, &
643.75d0,2.54d0,-2.62d0, 14.4d0,-11.33d0,-0.77d0,-0.06d0,-0.15d0, &
-0.16d0,    0d0, 0.01d0,664.57d0,16.81d0,-0.4d0,    1d0, 0.38d0, &
-14.86d0,-3.71d0,-0.09d0,-0.2d0,405.91d0,522.11d0,0.99d0,-1.5d0, &
11.67d0,-9.08d0,-0.25d0,-0.02d0,-0.12d0,-0.13d0,-305.78d0 /
data (a(i),i=416,566) / &
326.6d0, 1.75d0,  1.9d0,  7.3d0, 6.84d0,  0.2d0,-0.04d0,300.99d0, &
-325.03d0,-0.44d0,-0.5d0,-7.27d0,-6.73d0,-1.01d0,0.01d0,    0d0, &
 0.08d0,    0d0, 0.02d0,438.51d0,10.47d0,-0.56d0,-0.2d0, 0.24d0, &
-9.81d0,-0.24d0, 0.01d0,-0.13d0,-264.02d0,335.24d0,0.99d0,1.4d0, &
 7.49d0,  5.9d0,-0.27d0,-0.02d0,284.09d0,307.03d0,0.32d0,-0.4d0, &
 6.87d0,-6.35d0,-0.99d0,-0.01d0,-250.54d0,327.11d0,0.08d0,0.4d0, &
 7.31d0,  5.6d0, -0.3d0,230.72d0,-304.46d0,0.08d0,-0.1d0,-6.81d0, &
-5.16d0, 0.27d0,229.78d0,304.17d0,-0.6d0, 0.5d0,  6.8d0,-5.14d0, &
 0.33d0, 0.01d0,256.3d0,-276.81d0,-0.28d0,-0.4d0,-6.19d0,-5.73d0, &
-0.14d0, 0.01d0,-212.82d0,269.45d0,0.84d0,1.2d0, 6.02d0, 4.76d0, &
 0.14d0,-0.02d0,196.64d0,272.05d0,-0.84d0,0.9d0, 6.08d0, -4.4d0, &
 0.35d0, 0.02d0,188.95d0,272.22d0,-0.12d0,0.3d0, 6.09d0,-4.22d0, &
 0.34d0,-292.37d0,-5.1d0,-0.32d0,-0.4d0,-0.11d0, 6.54d0, 0.14d0, &
 0.01d0,161.79d0,-220.67d0,0.24d0,0.1d0,-4.93d0,-3.62d0,-0.08d0, &
261.54d0,-19.94d0,-0.95d0,0.2d0,-0.45d0,-5.85d0,-0.13d0, 0.02d0, &
142.16d0,-190.79d0,0.2d0, 0.1d0,-4.27d0,-3.18d0,-0.07d0,187.95d0, &
-4.11d0,-0.24d0,  0.3d0,-0.09d0, -4.2d0,-0.09d0, 0.01d0,    0d0, &
    0d0,-79.08d0,167.9d0,0.04d0,    0d0, 3.75d0, 1.77d0,121.98d0, &
131.04d0,-0.08d0, 0.1d0, 2.93d0,-2.73d0,-0.06d0,-172.95d0 /
data (a(i),i=567,713) / &
-8.11d0, -0.4d0, -0.2d0,-0.18d0, 3.87d0, 0.09d0, 0.01d0, &
-160.15d0,-55.3d0,-14.04d0,13.9d0,-1.23d0,3.58d0, 0.4d0, 0.31d0, &
-115.4d0,123.2d0, 0.6d0,  0.7d0, 2.75d0, 2.58d0, 0.08d0,-0.01d0, &
-168.26d0, -2d0,  0.2d0, -0.2d0,-0.04d0, 3.76d0, 0.08d0, &
-114.49d0,123.2d0,0.32d0, 0.4d0, 2.75d0, 2.56d0, 0.07d0,-0.01d0, &
112.14d0,120.7d0,0.28d0, -0.3d0,  2.7d0,-2.51d0,-0.07d0,-0.01d0, &
161.34d0,4.03d0,  0.2d0,  0.2d0, 0.09d0,-3.61d0,-0.08d0,91.31d0, &
126.64d0,-0.4d0,  0.4d0, 2.83d0,-2.04d0,-0.04d0, 0.01d0,105.29d0, &
112.9d0, 0.44d0, -0.5d0, 2.52d0,-2.35d0,-0.07d0,-0.01d0,98.69d0, &
-106.2d0,-0.28d0,-0.3d0,-2.37d0,-2.21d0,-0.06d0, 0.01d0,86.74d0, &
-112.94d0,-0.08d0,-0.2d0,-2.53d0,-1.94d0,-0.05d0,-134.81d0, &
 3.51d0,  0.2d0, -0.2d0, 0.08d0, 3.01d0, 0.07d0,79.03d0,107.31d0, &
-0.24d0,  0.2d0,  2.4d0,-1.77d0,-0.04d0, 0.01d0,132.81d0, &
-10.77d0,-0.52d0, 0.1d0,-0.24d0,-2.97d0,-0.07d0, 0.01d0, &
-130.31d0,-0.9d0,0.04d0,    0d0,    0d0, 2.91d0,-78.56d0,85.32d0, &
    0d0,    0d0, 1.91d0, 1.76d0, 0.04d0,    0d0,    0d0,-41.53d0, &
 89.1d0, 0.02d0,    0d0, 1.99d0, 0.93d0,66.03d0,  -71d0, -0.2d0, &
 -0.2d0,-1.59d0,-1.48d0,-0.04d0, 60.5d0, 64.7d0, 0.36d0, -0.4d0, &
 1.45d0,-1.35d0,-0.04d0,-0.01d0,-52.27d0,-70.01d0,  0d0,    0d0 /
data (a(i),i=714,865) / &
-1.57d0, 1.17d0, 0.03d0,-52.95d0,66.29d0,0.32d0,  0.4d0, 1.48d0, &
 1.18d0, 0.04d0,-0.01d0,51.02d0,67.25d0,    0d0,    0d0,  1.5d0, &
-1.14d0,-0.03d0,-55.66d0,-60.92d0,0.16d0,-0.2d0,-1.36d0, 1.24d0, &
 0.03d0,-54.81d0,-59.2d0,-0.08d0, 0.2d0,-1.32d0, 1.23d0, 0.03d0, &
51.32d0,-55.6d0,    0d0,    0d0,-1.24d0,-1.15d0,-0.03d0,48.29d0, &
 51.8d0,  0.2d0, -0.2d0, 1.16d0,-1.08d0,-0.03d0,-45.59d0, -49d0, &
-0.12d0,  0.1d0, -1.1d0, 1.02d0, 0.03d0,40.54d0,-52.69d0,-0.04d0, &
 -0.1d0,-1.18d0,-0.91d0,-0.02d0,-40.58d0,-49.51d0, -1d0,    1d0, &
-1.11d0, 0.91d0, 0.04d0, 0.02d0,-43.76d0,46.5d0, 0.36d0,  0.4d0, &
 1.04d0, 0.98d0, 0.03d0,-0.01d0,62.65d0,   -5d0,-0.24d0,    0d0, &
-0.11d0, -1.4d0,-0.03d0, 0.01d0,-38.57d0,49.59d0,0.08d0,  0.1d0, &
 1.11d0, 0.86d0, 0.02d0,-33.22d0,-44.04d0,0.08d0,-0.1d0,-0.98d0, &
 0.74d0, 0.02d0,37.15d0,-39.9d0,-0.12d0, -0.1d0,-0.89d0,-0.83d0, &
-0.02d0,36.68d0,-39.5d0,-0.04d0, -0.1d0,-0.88d0,-0.82d0,-0.02d0, &
-53.22d0,-3.91d0,-0.2d0,    0d0,-0.09d0, 1.19d0, 0.03d0,32.43d0, &
-42.19d0,-0.04d0,-0.1d0,-0.94d0,-0.73d0,-0.02d0,  -51d0, -2.3d0, &
-0.12d0, -0.1d0,    0d0, 1.14d0,-29.53d0,-39.11d0,0.04d0,   0d0, &
-0.87d0, 0.66d0, 0.02d0, 28.5d0,-38.92d0,-0.08d0,-0.1d0,-0.87d0, &
-0.64d0,-0.02d0,26.54d0,36.95d0,-0.12d0,  0.1d0, 0.83d0,-0.59d0 /
data (a(i),i=866,1017) / &
-0.01d0,26.54d0,34.59d0, 0.04d0, -0.1d0, 0.77d0,-0.59d0,-0.02d0, &
28.35d0,-32.55d0,-0.16d0, 0.2d0,-0.73d0,-0.63d0,-0.01d0,  -28d0, &
 30.4d0,    0d0,    0d0, 0.68d0, 0.63d0, 0.01d0,-27.61d0,29.4d0, &
  0.2d0,  0.2d0, 0.66d0, 0.62d0, 0.02d0,40.33d0,  0.4d0,-0.04d0, &
  0.1d0,    0d0, -0.9d0,-23.28d0,31.61d0,-0.08d0,-0.1d0, 0.71d0, &
 0.52d0, 0.01d0,37.75d0,  0.8d0, 0.04d0,  0.1d0,    0d0,-0.84d0, &
23.66d0, 25.8d0,    0d0,    0d0, 0.58d0,-0.53d0,-0.01d0,21.01d0, &
-27.91d0,   0d0,    0d0,-0.62d0,-0.47d0,-0.01d0,-34.81d0,2.89d0, &
 0.04d0,    0d0,    0d0, 0.78d0,-23.49d0,-25.31d0,  0d0,    0d0, &
-0.57d0, 0.53d0, 0.01d0,-23.47d0,25.2d0, 0.16d0,  0.2d0, 0.56d0, &
 0.52d0, 0.02d0,19.58d0, 27.5d0,-0.12d0,  0.1d0, 0.62d0,-0.44d0, &
-0.01d0,-22.67d0,-24.4d0,-0.08d0, 0.1d0,-0.55d0, 0.51d0, 0.01d0, &
-19.97d0,  25d0, 0.12d0,  0.2d0, 0.56d0, 0.45d0, 0.01d0,21.28d0, &
-22.8d0,-0.08d0, -0.1d0,-0.51d0,-0.48d0,-0.01d0,-30.47d0,0.91d0, &
 0.04d0,    0d0,    0d0, 0.68d0,18.58d0,   24d0, 0.04d0, -0.1d0, &
 0.54d0,-0.42d0,-0.01d0,-18.02d0,24.4d0,-0.04d0, -0.1d0, 0.55d0, &
  0.4d0, 0.01d0,17.74d0, 22.5d0, 0.08d0, -0.1d0,  0.5d0, -0.4d0, &
-0.01d0,-19.41d0,20.7d0, 0.08d0,  0.1d0, 0.46d0, 0.43d0, 0.01d0, &
-18.64d0,20.11d0,   0d0,    0d0, 0.45d0, 0.42d0, 0.01d0,-16.75d0 /
data (a(i),i=1018,1169) / &
 21.6d0, 0.04d0,  0.1d0, 0.48d0, 0.37d0, 0.01d0,-18.42d0, -20d0, &
    0d0,    0d0,-0.45d0, 0.41d0, 0.01d0,-26.77d0,1.41d0, 0.08d0, &
    0d0,    0d0,  0.6d0,-26.17d0,-0.19d0,   0d0,    0d0,    0d0, &
 0.59d0,-15.52d0,20.51d0,   0d0,    0d0, 0.46d0, 0.35d0, 0.01d0, &
-25.42d0,-1.91d0,-0.08d0,   0d0,-0.04d0, 0.57d0, 0.45d0,-17.42d0, &
 18.1d0,    0d0,    0d0,  0.4d0, 0.39d0, 0.01d0,16.39d0,-17.6d0, &
-0.08d0, -0.1d0,-0.39d0,-0.37d0,-0.01d0,-14.37d0,18.91d0,   0d0, &
    0d0, 0.42d0, 0.32d0, 0.01d0,23.39d0, -2.4d0,-0.12d0,    0d0, &
    0d0,-0.52d0,14.32d0,-18.5d0,-0.04d0, -0.1d0,-0.41d0,-0.32d0, &
-0.01d0,15.69d0,17.08d0,    0d0,    0d0, 0.38d0,-0.35d0,-0.01d0, &
-22.99d0, 0.5d0, 0.04d0,    0d0,    0d0, 0.51d0,    0d0,    0d0, &
14.47d0,-17.6d0,-0.01d0,    0d0,-0.39d0,-0.32d0,-13.33d0,18.4d0, &
-0.04d0, -0.1d0, 0.41d0,  0.3d0,22.47d0, -0.6d0,-0.04d0,    0d0, &
    0d0, -0.5d0,-12.78d0,-17.41d0,0.04d0,   0d0,-0.39d0, 0.29d0, &
 0.01d0,-14.1d0,-15.31d0,0.04d0,    0d0,-0.34d0, 0.32d0, 0.01d0, &
11.98d0,16.21d0,-0.04d0,    0d0, 0.36d0,-0.27d0,-0.01d0,19.65d0, &
 -1.9d0,-0.08d0,    0d0,    0d0,-0.44d0,19.61d0, -1.5d0,-0.08d0, &
    0d0,    0d0,-0.44d0,13.41d0,-14.3d0,-0.04d0, -0.1d0,-0.32d0, &
 -0.3d0,-0.01d0,-13.29d0,14.4d0,    0d0,    0d0, 0.32d0,  0.3d0 /
data (a(i),i=1170,1321) / &
 0.01d0,11.14d0,-14.4d0,-0.04d0,    0d0,-0.32d0,-0.25d0,-0.01d0, &
12.24d0,-13.38d0,0.04d0,    0d0, -0.3d0,-0.27d0,-0.01d0,10.07d0, &
-13.81d0,0.04d0,    0d0,-0.31d0,-0.23d0,-0.01d0,10.46d0, 13.1d0, &
 0.08d0, -0.1d0, 0.29d0,-0.23d0,-0.01d0,16.55d0,-1.71d0,-0.08d0, &
    0d0,    0d0,-0.37d0, 9.75d0,-12.8d0,    0d0,    0d0,-0.29d0, &
-0.22d0,-0.01d0, 9.11d0, 12.8d0,    0d0,    0d0, 0.29d0, -0.2d0, &
    0d0,    0d0,-6.44d0,-13.8d0,    0d0,    0d0,-0.31d0, 0.14d0, &
-9.19d0,  -12d0,    0d0,    0d0,-0.27d0, 0.21d0,-10.3d0, 10.9d0, &
 0.08d0,  0.1d0, 0.24d0, 0.23d0, 0.01d0,14.92d0, -0.8d0,-0.04d0, &
    0d0,    0d0,-0.33d0,10.02d0,-10.8d0,    0d0,    0d0,-0.24d0, &
-0.22d0,-0.01d0,-9.75d0, 10.4d0, 0.04d0,    0d0, 0.23d0, 0.22d0, &
 0.01d0, 9.67d0,-10.4d0,-0.04d0,    0d0,-0.23d0,-0.22d0,-0.01d0, &
-8.28d0,-11.2d0, 0.04d0,    0d0,-0.25d0, 0.19d0,13.32d0,-1.41d0, &
-0.08d0,    0d0,    0d0, -0.3d0, 8.27d0, 10.5d0, 0.04d0,    0d0, &
 0.23d0,-0.19d0,    0d0,    0d0,13.13d0,    0d0,    0d0,    0d0, &
    0d0,-0.29d0,-12.93d0, 0.7d0, 0.04d0,    0d0,    0d0, 0.29d0, &
 7.91d0,-10.2d0,    0d0,    0d0,-0.23d0,-0.18d0,-7.84d0,  -10d0, &
-0.04d0,    0d0,-0.22d0, 0.18d0, 7.44d0,  9.6d0,    0d0,    0d0, &
 0.21d0,-0.17d0,-7.64d0,  9.4d0, 0.08d0,  0.1d0, 0.21d0, 0.17d0 /
data (a(i),i=1322,1473) / &
 0.01d0,-11.38d0, 0.6d0, 0.04d0,    0d0,    0d0, 0.25d0,-7.48d0, &
  8.3d0,    0d0,    0d0, 0.19d0, 0.17d0,-10.98d0,-0.2d0,    0d0, &
    0d0,    0d0, 0.25d0,10.98d0,  0.2d0,    0d0,    0d0,    0d0, &
-0.25d0,  7.4d0, -7.9d0,-0.04d0,    0d0,-0.18d0,-0.17d0,-6.09d0, &
  8.4d0,-0.04d0,    0d0, 0.19d0, 0.14d0,-6.94d0,-7.49d0,    0d0, &
    0d0,-0.17d0, 0.16d0, 6.92d0,  7.5d0, 0.04d0,    0d0, 0.17d0, &
-0.15d0,  6.2d0, 8.09d0,    0d0,    0d0, 0.18d0,-0.14d0,-6.12d0, &
  7.8d0, 0.04d0,    0d0, 0.17d0, 0.14d0, 5.85d0, -7.5d0,    0d0, &
    0d0,-0.17d0,-0.13d0,-6.48d0,  6.9d0, 0.08d0,  0.1d0, 0.15d0, &
 0.14d0, 0.01d0, 6.32d0,  6.9d0,    0d0,    0d0, 0.15d0,-0.14d0, &
 5.61d0, -7.2d0,    0d0,    0d0,-0.16d0,-0.13d0, 9.07d0,    0d0, &
    0d0,    0d0,    0d0, -0.2d0, 5.25d0,  6.9d0,    0d0,    0d0, &
 0.15d0,-0.12d0,-8.47d0, -0.4d0,    0d0,    0d0,    0d0, 0.19d0, &
 6.32d0,-5.39d0,-1.11d0,  1.1d0,-0.12d0,-0.14d0, 0.02d0, 0.02d0, &
 5.73d0, -6.1d0,-0.04d0,    0d0,-0.14d0,-0.13d0,  4.7d0,  6.6d0, &
-0.04d0,    0d0, 0.15d0,-0.11d0, -4.9d0, -6.4d0,    0d0,    0d0, &
-0.14d0, 0.11d0,-5.33d0,  5.6d0, 0.04d0,  0.1d0, 0.13d0, 0.12d0, &
 0.01d0,-4.81d0,    6d0, 0.04d0,    0d0, 0.13d0, 0.11d0, 5.13d0, &
  5.5d0, 0.04d0,    0d0, 0.12d0,-0.11d0,  4.5d0,  5.9d0,    0d0 /
data (a(i),i=1474,1625) / &
    0d0, 0.13d0, -0.1d0,-4.22d0,  6.1d0,    0d0,    0d0, 0.14d0, &
-4.53d0,  5.7d0,    0d0,    0d0, 0.13d0,  0.1d0, 4.18d0,  5.7d0, &
    0d0,    0d0, 0.13d0,-4.75d0,-5.19d0,    0d0,    0d0,-0.12d0, &
 0.11d0,-4.06d0,  5.6d0,    0d0,    0d0, 0.13d0,-3.98d0,  5.6d0, &
-0.04d0,    0d0, 0.13d0, 4.02d0, -5.4d0,    0d0,    0d0,-0.12d0, &
 4.49d0, -4.9d0,-0.04d0,    0d0,-0.11d0, -0.1d0,-3.62d0, -5.4d0, &
-0.16d0,  0.2d0,-0.12d0,    0d0, 0.01d0, 4.38d0,  4.8d0,    0d0, &
    0d0, 0.11d0, -6.4d0, -0.1d0,    0d0,    0d0,    0d0, 0.14d0, &
-3.98d0,    5d0, 0.04d0,    0d0, 0.11d0,-3.82d0,   -5d0,    0d0, &
    0d0,-0.11d0,-3.71d0, 5.07d0,    0d0,    0d0, 0.11d0, 4.14d0, &
  4.4d0,    0d0,    0d0,  0.1d0,-6.01d0, -0.5d0,-0.04d0,    0d0, &
    0d0, 0.13d0,-4.04d0, 4.39d0,    0d0,    0d0,  0.1d0, 3.45d0, &
-4.72d0,    0d0,    0d0,-0.11d0, 3.31d0, 4.71d0,    0d0,    0d0, &
 0.11d0, 3.26d0, -4.5d0,    0d0,    0d0, -0.1d0,-3.26d0, -4.5d0, &
    0d0,    0d0, -0.1d0,-3.34d0, -4.4d0,    0d0,    0d0, -0.1d0, &
-3.74d0,   -4d0,  3.7d0,    4d0, 3.34d0, -4.3d0,  3.3d0, -4.3d0, &
-3.66d0,  3.9d0, 0.04d0, 3.66d0,  3.9d0, 0.04d0,-3.62d0, -3.9d0, &
-3.61d0,  3.9d0, -0.2d0,  5.3d0,    0d0,    0d0, 0.12d0, 3.06d0, &
  4.3d0,  3.3d0,    4d0,  0.4d0,  0.2d0,  3.1d0,  4.1d0,-3.06d0 /
data (a(i),i=1626,1777) / &
  3.9d0, -3.3d0, -3.6d0, -3.3d0, 3.36d0, 0.01d0, 3.14d0,  3.4d0, &
-4.57d0, -0.2d0,    0d0,    0d0,    0d0,  0.1d0, -2.7d0, -3.6d0, &
 2.94d0, -3.2d0, -2.9d0,  3.2d0, 2.47d0, -3.4d0, 2.55d0, -3.3d0, &
  2.8d0,-3.08d0, 2.51d0,  3.3d0, -4.1d0,  0.3d0,-0.12d0, -0.1d0, &
  4.1d0,  0.2d0,-2.74d0,    3d0, 2.46d0, 3.23d0,-3.66d0,  1.2d0, &
 -0.2d0,  0.2d0, 3.74d0, -0.4d0,-2.51d0, -2.8d0,-3.74d0, 2.27d0, &
 -2.9d0,    0d0,    0d0, -2.5d0,  2.7d0,-2.51d0,  2.6d0, -3.5d0, &
  0.2d0, 3.38d0,-2.22d0, -2.5d0, 3.26d0, -0.4d0, 1.95d0, -2.6d0, &
 3.22d0, -0.4d0,-0.04d0,-1.79d0, -2.6d0, 1.91d0,  2.5d0, 0.74d0, &
 3.05d0,-0.04d0, 0.08d0, 2.11d0, -2.3d0,-2.11d0,  2.2d0,-1.87d0, &
 -2.4d0, 2.03d0, -2.2d0,-2.03d0,  2.2d0, 2.98d0,    0d0,    0d0, &
 2.98d0,-1.71d0,  2.4d0, 2.94d0, -0.1d0,-0.12d0,  0.1d0, 1.67d0, &
  2.4d0,-1.79d0,  2.3d0,-1.79d0,  2.2d0,-1.67d0,  2.2d0, 1.79d0, &
   -2d0, 1.87d0, -1.9d0, 1.63d0, -2.1d0,-1.59d0,  2.1d0, 1.55d0, &
 -2.1d0,-1.55d0,  2.1d0,-2.59d0, -0.2d0,-1.75d0, -1.9d0,-1.75d0, &
  1.9d0,-1.83d0, -1.8d0, 1.51d0,    2d0,-1.51d0,   -2d0, 1.71d0, &
  1.8d0, 1.31d0,  2.1d0,-1.43d0,    2d0, 1.43d0,    2d0,-2.43d0, &
-1.51d0,  1.9d0,-1.47d0,  1.9d0, 2.39d0,  0.2d0,-2.39d0, 1.39d0, &
  1.9d0, 1.39d0, -1.8d0, 1.47d0, -1.6d0, 1.47d0, -1.6d0, 1.43d0 /
data (a(i),i=1778,1929) / &
 -1.5d0,-1.31d0,  1.6d0, 1.27d0, -1.6d0,-1.27d0,  1.6d0, 1.27d0, &
 -1.6d0, 2.03d0, 1.35d0,  1.5d0,-1.39d0, -1.4d0, 1.95d0, -0.2d0, &
-1.27d0, 1.49d0, 1.19d0,  1.5d0, 1.27d0,  1.4d0, 1.15d0,  1.5d0, &
 1.87d0, -0.1d0,-1.12d0, -1.5d0, 1.87d0,-1.11d0, -1.5d0,-1.11d0, &
 -1.5d0,    0d0,    0d0, 1.19d0,  1.4d0, 1.27d0, -1.3d0,-1.27d0, &
 -1.3d0,-1.15d0,  1.4d0,-1.23d0,  1.3d0,-1.23d0, -1.3d0, 1.22d0, &
-1.29d0, 1.07d0, -1.4d0, 1.75d0, -0.2d0,-1.03d0, -1.4d0,-1.07d0, &
  1.2d0,-1.03d0, 1.15d0, 1.07d0,  1.1d0, 1.51d0,-1.03d0,  1.1d0, &
 1.03d0, -1.1d0,    0d0,    0d0,-1.03d0, -1.1d0, 0.91d0, -1.2d0, &
-0.88d0, -1.2d0,-0.88d0,  1.2d0,-0.95d0,  1.1d0,-0.95d0, -1.1d0, &
 1.43d0,-1.39d0, 0.95d0,   -1d0,-0.95d0,    1d0, -0.8d0,  1.1d0, &
 0.91d0,   -1d0,-1.35d0, 0.88d0,    1d0,-0.83d0,    1d0,-0.91d0, &
  0.9d0, 0.91d0,  0.9d0, 0.88d0, -0.9d0,-0.76d0,   -1d0,-0.76d0, &
    1d0, 0.76d0,    1d0,-0.72d0,    1d0, 0.84d0, -0.9d0, 0.84d0, &
  0.9d0, 1.23d0,    0d0,    0d0,-0.52d0, -1.1d0,-0.68d0,    1d0, &
 1.19d0, -0.2d0, 1.19d0, 0.76d0,  0.9d0, 1.15d0, -0.1d0, 1.15d0, &
 -0.1d0, 0.72d0, -0.9d0,-1.15d0,-1.15d0, 0.68d0,  0.9d0,-0.68d0, &
  0.9d0,-1.11d0,    0d0,    0d0,  0.2d0, 0.79d0,  0.8d0,-1.11d0, &
 -0.1d0,    0d0,    0d0,-0.48d0,   -1d0,-0.76d0, -0.8d0,-0.72d0 /
data (a(i),i=1930,2081) / &
 -0.8d0,-1.07d0, -0.1d0, 0.64d0,  0.8d0,-0.64d0, -0.8d0, 0.64d0, &
  0.8d0,  0.4d0,  0.6d0, 0.52d0, -0.5d0, -0.6d0, -0.8d0,-0.71d0, &
  0.7d0,-0.99d0, 0.99d0, 0.56d0,  0.8d0,-0.56d0,  0.8d0, 0.68d0, &
 -0.7d0, 0.68d0,  0.7d0,-0.95d0,-0.64d0,  0.7d0, 0.64d0,  0.7d0, &
 -0.6d0,  0.7d0, -0.6d0, -0.7d0,-0.91d0, -0.1d0,-0.51d0, 0.76d0, &
-0.91d0,-0.56d0,  0.7d0, 0.88d0, 0.88d0,-0.63d0, -0.6d0, 0.55d0, &
 -0.6d0, -0.8d0,  0.8d0, -0.8d0,-0.52d0,  0.6d0, 0.52d0,  0.6d0, &
 0.52d0, -0.6d0,-0.48d0,  0.6d0, 0.48d0,  0.6d0, 0.48d0,  0.6d0, &
-0.76d0, 0.44d0, -0.6d0, 0.52d0, -0.5d0,-0.52d0,  0.5d0,  0.4d0, &
  0.6d0, -0.4d0, -0.6d0,  0.4d0, -0.6d0, 0.72d0,-0.72d0,-0.51d0, &
 -0.5d0,-0.48d0,  0.5d0, 0.48d0, -0.5d0,-0.48d0,  0.5d0,-0.48d0, &
  0.5d0, 0.48d0, -0.5d0,-0.48d0, -0.5d0,-0.68d0,-0.68d0, 0.44d0, &
  0.5d0,-0.64d0, -0.1d0,-0.64d0, -0.1d0, -0.4d0,  0.5d0,  0.4d0, &
  0.5d0,  0.4d0,  0.5d0,    0d0,    0d0, -0.4d0, -0.5d0,-0.36d0, &
 -0.5d0, 0.36d0, -0.5d0,  0.6d0, -0.6d0,  0.4d0, -0.4d0,  0.4d0, &
  0.4d0, -0.4d0,  0.4d0, -0.4d0,  0.4d0,-0.56d0,-0.56d0, 0.36d0, &
 -0.4d0,-0.36d0,  0.4d0, 0.36d0, -0.4d0,-0.36d0, -0.4d0, 0.36d0, &
  0.4d0, 0.36d0,  0.4d0,-0.52d0, 0.52d0, 0.52d0, 0.32d0,  0.4d0, &
-0.32d0,  0.4d0,-0.32d0,  0.4d0,-0.32d0,  0.4d0, 0.32d0, -0.4d0 /
data (a(i),i=2082,2233) / &
-0.32d0, -0.4d0, 0.32d0, -0.4d0, 0.28d0, -0.4d0,-0.28d0,  0.4d0, &
 0.28d0, -0.4d0, 0.28d0,  0.4d0, 0.48d0,-0.48d0, 0.48d0, 0.36d0, &
 -0.3d0,-0.36d0, -0.3d0,    0d0,    0d0,  0.2d0,  0.4d0,-0.44d0, &
 0.44d0,-0.44d0,-0.44d0,-0.44d0,-0.44d0, 0.32d0, -0.3d0, 0.32d0, &
  0.3d0, 0.24d0,  0.3d0,-0.12d0, -0.1d0,-0.28d0,  0.3d0, 0.28d0, &
  0.3d0, 0.28d0,  0.3d0, 0.28d0, -0.3d0, 0.28d0, -0.3d0, 0.28d0, &
 -0.3d0, 0.28d0,  0.3d0,-0.28d0,  0.3d0,  0.4d0,  0.4d0,-0.24d0, &
  0.3d0, 0.24d0, -0.3d0, 0.24d0, -0.3d0,-0.24d0, -0.3d0, 0.24d0, &
  0.3d0, 0.24d0, -0.3d0,-0.24d0,  0.3d0, 0.24d0, -0.3d0,-0.24d0, &
 -0.3d0, 0.24d0, -0.3d0, 0.24d0,  0.3d0,-0.24d0,  0.3d0,-0.24d0, &
  0.3d0,  0.2d0, -0.3d0,  0.2d0, -0.3d0,  0.2d0, -0.3d0,  0.2d0, &
  0.3d0,  0.2d0, -0.3d0,  0.2d0, -0.3d0,  0.2d0,  0.3d0,  0.2d0, &
  0.3d0, -0.2d0, -0.3d0,  0.2d0, -0.3d0,  0.2d0, -0.3d0,-0.36d0, &
-0.36d0,-0.36d0,-0.04d0,  0.3d0, 0.12d0, -0.1d0,-0.32d0,-0.24d0, &
  0.2d0, 0.24d0,  0.2d0,  0.2d0, -0.2d0, -0.2d0, -0.2d0, -0.2d0, &
 -0.2d0,  0.2d0,  0.2d0,  0.2d0, -0.2d0,  0.2d0,  0.2d0,  0.2d0, &
  0.2d0, -0.2d0, -0.2d0,    0d0,    0d0, -0.2d0, -0.2d0, -0.2d0, &
  0.2d0, -0.2d0,  0.2d0,  0.2d0, -0.2d0, -0.2d0, -0.2d0,  0.2d0, &
  0.2d0,  0.2d0,  0.2d0,  0.2d0, -0.2d0,  0.2d0, -0.2d0, 0.28d0 /
data (a(i),i=2234,2385) / &
 0.28d0, 0.28d0, 0.28d0, 0.28d0, 0.28d0,-0.28d0, 0.28d0, 0.12d0, &
    0d0, 0.24d0, 0.16d0, -0.2d0, 0.16d0, -0.2d0, 0.16d0, -0.2d0, &
 0.16d0,  0.2d0,-0.16d0,  0.2d0, 0.16d0,  0.2d0,-0.16d0,  0.2d0, &
-0.16d0,  0.2d0,-0.16d0,  0.2d0, 0.16d0, -0.2d0, 0.16d0,  0.2d0, &
 0.16d0, -0.2d0,-0.16d0,  0.2d0,-0.16d0, -0.2d0,-0.16d0,  0.2d0, &
 0.16d0,  0.2d0, 0.16d0, -0.2d0, 0.16d0, -0.2d0, 0.16d0,  0.2d0, &
 0.16d0,  0.2d0, 0.16d0,  0.2d0,-0.16d0, -0.2d0, 0.16d0,  0.2d0, &
-0.16d0,  0.2d0, 0.16d0,  0.2d0,-0.16d0, -0.2d0, 0.16d0, -0.2d0, &
 0.16d0, -0.2d0,-0.16d0, -0.2d0, 0.24d0,-0.24d0,-0.24d0, 0.24d0, &
 0.24d0, 0.12d0,  0.2d0, 0.12d0,  0.2d0,-0.12d0, -0.2d0, 0.12d0, &
 -0.2d0, 0.12d0, -0.2d0,-0.12d0,  0.2d0,-0.12d0,  0.2d0,-0.12d0, &
 -0.2d0, 0.12d0,  0.2d0, 0.12d0,  0.2d0, 0.12d0, -0.2d0,-0.12d0, &
  0.2d0, 0.12d0, -0.2d0,-0.12d0,  0.2d0, 0.12d0,  0.2d0,    0d0, &
    0d0,-0.12d0,  0.2d0,-0.12d0,  0.2d0, 0.12d0, -0.2d0,-0.12d0, &
  0.2d0, 0.12d0,  0.2d0,    0d0,-0.21d0, -0.2d0,    0d0,    0d0, &
  0.2d0, -0.2d0, -0.2d0, -0.2d0,  0.2d0,-0.16d0, -0.1d0,    0d0, &
 0.17d0, 0.16d0, 0.16d0, 0.16d0, 0.16d0,-0.16d0, 0.16d0, 0.16d0, &
-0.16d0, 0.16d0,-0.16d0, 0.16d0, 0.12d0,  0.1d0, 0.12d0, -0.1d0, &
-0.12d0,  0.1d0,-0.12d0,  0.1d0, 0.12d0, -0.1d0,-0.12d0, 0.12d0 /
data (a(i),i=2386,2537) / &
-0.12d0, 0.12d0,-0.12d0, 0.12d0,-0.12d0,-0.12d0,-0.12d0,-0.12d0, &
-0.12d0,-0.12d0,-0.12d0, 0.12d0, 0.12d0, 0.12d0, 0.12d0,-0.12d0, &
-0.12d0, 0.12d0, 0.12d0, 0.12d0,-0.12d0, 0.12d0,-0.12d0,-0.12d0, &
-0.12d0, 0.12d0,-0.12d0,-0.12d0, 0.12d0,    0d0, 0.11d0, 0.11d0, &
-122.67d0,164.7d0,203.78d0,273.5d0,3.58d0,2.74d0,6.18d0,-4.56d0, &
    0d0,-0.04d0,    0d0,-0.07d0,57.44d0,-77.1d0,95.82d0,128.6d0, &
-1.77d0,-1.28d0, 2.85d0,-2.14d0,82.14d0, 89.5d0,    0d0,    0d0, &
    2d0,-1.84d0,-0.04d0,47.73d0,-64.1d0,23.79d0, 31.9d0,-1.45d0, &
-1.07d0, 0.69d0,-0.53d0,-46.38d0,50.5d0,    0d0,    0d0, 1.13d0, &
 1.04d0, 0.02d0,-18.38d0,   0d0, 63.8d0,    0d0,    0d0, 0.41d0, &
    0d0,-1.43d0,59.07d0,    0d0,    0d0,    0d0,    0d0,-1.32d0, &
57.28d0,    0d0,    0d0,    0d0,    0d0,-1.28d0,-48.65d0,   0d0, &
-1.15d0,    0d0,    0d0, 1.09d0,    0d0, 0.03d0,-18.3d0, 24.6d0, &
-17.3d0,-23.2d0, 0.56d0, 0.41d0,-0.51d0, 0.39d0,-16.91d0,26.9d0, &
 8.43d0, 13.3d0,  0.6d0, 0.38d0, 0.31d0,-0.19d0, 1.23d0, -1.7d0, &
-19.13d0,-25.7d0,-0.03d0,-0.03d0,-0.58d0,0.43d0,-0.72d0,  0.9d0, &
-17.34d0,-23.3d0,0.03d0, 0.02d0,-0.52d0, 0.39d0,-19.49d0,-21.3d0, &
    0d0,    0d0,-0.48d0, 0.44d0, 0.01d0,20.57d0,-20.1d0, 0.64d0, &
  0.7d0,-0.45d0,-0.46d0,    0d0,-0.01d0, 4.89d0,  5.9d0,-16.55d0 /
data (a(i),i=2538,2689) / &
 19.9d0, 0.14d0,-0.11d0, 0.44d0, 0.37d0,18.22d0, 19.8d0,    0d0, &
    0d0, 0.44d0,-0.41d0,-0.01d0, 4.89d0, -5.3d0,-16.51d0, -18d0, &
-0.11d0,-0.11d0,-0.41d0, 0.37d0,-17.86d0,   0d0, 17.1d0,    0d0, &
    0d0,  0.4d0,    0d0,-0.38d0, 0.32d0,    0d0,24.42d0,    0d0, &
    0d0,-0.01d0,    0d0,-0.55d0,-23.79d0,   0d0,    0d0,    0d0, &
    0d0, 0.53d0,14.72d0,  -16d0,-0.32d0,    0d0,-0.36d0,-0.33d0, &
-0.01d0, 0.01d0, 3.34d0, -4.5d0,11.86d0, 15.9d0,-0.11d0,-0.07d0, &
 0.35d0,-0.27d0,-3.26d0,  4.4d0,11.62d0, 15.6d0, 0.09d0, 0.07d0, &
 0.35d0,-0.26d0,-19.53d0,   0d0, 5.09d0,    0d0,    0d0, 0.44d0, &
    0d0,-0.11d0,-13.48d0,14.7d0,    0d0,    0d0, 0.33d0,  0.3d0, &
 0.01d0,10.86d0,-14.6d0, 3.18d0,  4.3d0,-0.33d0,-0.24d0, 0.09d0, &
-0.07d0,-11.3d0,-15.1d0,    0d0,    0d0,-0.34d0, 0.25d0, 0.01d0, &
 2.03d0, -2.7d0,10.82d0, 14.5d0,-0.07d0,-0.05d0, 0.32d0,-0.24d0, &
17.46d0,    0d0,    0d0,    0d0,    0d0,-0.39d0,16.43d0,    0d0, &
 0.52d0,    0d0,    0d0,-0.37d0,    0d0,-0.01d0, 9.35d0,    0d0, &
13.29d0,    0d0,    0d0,-0.21d0,    0d0, -0.3d0,-10.42d0,11.4d0, &
    0d0,    0d0, 0.25d0, 0.23d0, 0.01d0, 0.44d0,  0.5d0,-10.38d0, &
 11.3d0, 0.02d0,-0.01d0, 0.25d0, 0.23d0,-14.64d0,   0d0,    0d0, &
    0d0,    0d0, 0.33d0, 0.56d0,  0.8d0,-8.67d0, 11.7d0, 0.02d0 /
data (a(i),i=2690,2841) / &
-0.01d0, 0.26d0, 0.19d0,13.88d0,    0d0,-2.47d0,    0d0,    0d0, &
-0.31d0,    0d0, 0.06d0,-1.99d0,  2.7d0, 7.72d0, 10.3d0, 0.06d0, &
 0.04d0, 0.23d0,-0.17d0, -0.2d0,    0d0,13.05d0,    0d0,    0d0, &
    0d0,    0d0,-0.29d0, 6.92d0, -9.3d0, 3.34d0,  4.5d0,-0.21d0, &
-0.15d0,  0.1d0,-0.07d0, -6.6d0,    0d0, 10.7d0,    0d0,    0d0, &
 0.15d0,    0d0,-0.24d0,-8.04d0, -8.7d0,    0d0,    0d0,-0.19d0, &
 0.18d0,-10.58d0,   0d0, -3.1d0,    0d0,    0d0, 0.24d0,    0d0, &
 0.07d0,-7.32d0,    8d0,-0.12d0, -0.1d0, 0.18d0, 0.16d0, 1.63d0, &
  1.7d0, 6.96d0, -7.6d0, 0.03d0,-0.04d0,-0.17d0,-0.16d0,-3.62d0, &
    0d0, 9.86d0,    0d0,    0d0, 0.08d0,    0d0,-0.22d0,  0.2d0, &
 -0.2d0,-6.88d0, -7.5d0,    0d0,    0d0,-0.17d0, 0.15d0,-8.99d0, &
    0d0, 4.02d0,    0d0,    0d0,  0.2d0,    0d0,-0.09d0,-1.07d0, &
  1.4d0,-5.69d0, -7.7d0, 0.03d0, 0.02d0,-0.17d0, 0.13d0, 6.48d0, &
 -7.2d0,-0.48d0, -0.5d0,-0.16d0,-0.14d0,-0.01d0, 0.01d0, 5.57d0, &
 -7.5d0, 1.07d0,  1.4d0,-0.17d0,-0.12d0, 0.03d0,-0.02d0, 8.71d0, &
    0d0, 3.54d0,    0d0,    0d0,-0.19d0,    0d0,-0.08d0,  0.4d0, &
    0d0, 9.27d0,    0d0,    0d0,-0.01d0,    0d0,-0.21d0,-6.13d0, &
  6.7d0,-1.19d0, -1.3d0, 0.15d0, 0.14d0,-0.03d0, 0.03d0, 5.21d0, &
 -5.7d0,-2.51d0, -2.6d0,-0.13d0,-0.12d0,-0.06d0, 0.06d0, 5.69d0 /
data (a(i),i=2842,2993) / &
 -6.2d0,-0.12d0, -0.1d0,-0.14d0,-0.13d0,-0.01d0, 2.03d0, -2.7d0, &
 4.53d0,  6.1d0,-0.06d0,-0.05d0, 0.14d0, -0.1d0, 5.01d0,  5.5d0, &
-2.51d0,  2.7d0, 0.12d0,-0.11d0, 0.06d0, 0.06d0,-1.91d0,  2.6d0, &
-4.38d0, -5.9d0, 0.06d0, 0.04d0,-0.13d0,  0.1d0, 4.65d0, -6.3d0, &
    0d0,    0d0,-0.14d0, -0.1d0,-5.29d0,  5.7d0,    0d0,    0d0, &
 0.13d0, 0.12d0,-2.23d0,   -4d0,-4.65d0,  4.2d0,-0.09d0, 0.05d0, &
  0.1d0,  0.1d0,-4.53d0,  6.1d0,    0d0,    0d0, 0.14d0,  0.1d0, &
 2.47d0,  2.7d0,-4.46d0,  4.9d0, 0.06d0,-0.06d0, 0.11d0,  0.1d0, &
-5.05d0,  5.5d0, 0.84d0,  0.9d0, 0.12d0, 0.11d0, 0.02d0,-0.02d0, &
 4.97d0, -5.4d0,-1.71d0,    0d0,-0.12d0,-0.11d0,    0d0, 0.04d0, &
-0.99d0, -1.3d0, 4.22d0, -5.7d0,-0.03d0, 0.02d0,-0.13d0,-0.09d0, &
 0.99d0,  1.4d0, 4.22d0, -5.6d0, 0.03d0,-0.02d0,-0.13d0,-0.09d0, &
-4.69d0, -5.2d0,    0d0,    0d0,-0.12d0,  0.1d0,-3.42d0,    0d0, &
 6.09d0,    0d0,    0d0, 0.08d0,    0d0,-0.14d0,-4.65d0, -5.1d0, &
    0d0,    0d0,-0.11d0,  0.1d0,    0d0,    0d0,-4.53d0,   -5d0, &
    0d0,    0d0,-0.11d0,  0.1d0,-2.43d0, -2.7d0,-3.82d0,  4.2d0, &
-0.06d0, 0.05d0,  0.1d0, 0.09d0,    0d0,    0d0,-4.53d0,  4.9d0, &
    0d0,    0d0, 0.11d0,  0.1d0,-4.49d0, -4.9d0,    0d0,    0d0, &
-0.11d0,  0.1d0, 2.67d0, -2.9d0,-3.62d0, -3.9d0,-0.06d0,-0.06d0 /
data (a(i),i=2994,3145) / &
-0.09d0, 0.08d0, 3.94d0, -5.3d0,    0d0,    0d0,-0.12d0,-3.38d0, &
  3.7d0,-2.78d0, -3.1d0, 0.08d0, 0.08d0,-0.07d0, 0.06d0, 3.18d0, &
 -3.5d0,-2.82d0, -3.1d0,-0.08d0,-0.07d0,-0.07d0, 0.06d0,-5.77d0, &
    0d0, 1.87d0,    0d0,    0d0, 0.13d0,    0d0,-0.04d0, 3.54d0, &
 -4.8d0,-0.64d0, -0.9d0,-0.11d0,    0d0,-0.02d0, -3.5d0, -4.7d0, &
 0.68d0, -0.9d0,-0.11d0,    0d0,-0.02d0, 5.49d0,    0d0,    0d0, &
    0d0,    0d0,-0.12d0, 1.83d0, -2.5d0, 2.63d0,  3.5d0,-0.06d0, &
    0d0, 0.08d0, 3.02d0, -4.1d0, 0.68d0,  0.9d0,-0.09d0,    0d0, &
 0.02d0,    0d0,    0d0, 5.21d0,    0d0,    0d0,    0d0,    0d0, &
-0.12d0,-3.54d0,  3.8d0,  2.7d0,  3.6d0,-1.35d0,  1.8d0, 0.08d0, &
    0d0, 0.04d0, -2.9d0,  3.9d0, 0.68d0,  0.9d0, 0.09d0,    0d0, &
 0.02d0,  0.8d0, -1.1d0,-2.78d0, -3.7d0,-0.02d0,    0d0,-0.08d0, &
  4.1d0,    0d0,-2.39d0,    0d0,    0d0,-0.09d0,    0d0, 0.05d0, &
-1.59d0,  2.1d0, 2.27d0,    3d0, 0.05d0,    0d0, 0.07d0,-2.63d0, &
  3.5d0,-0.48d0, -0.6d0,-2.94d0, -3.2d0,-2.94d0,  3.2d0, 2.27d0, &
   -3d0,-1.11d0, -1.5d0,-0.07d0,    0d0,-0.03d0,-0.56d0, -0.8d0, &
-2.35d0,  3.1d0,    0d0, -0.6d0,-3.42d0,  1.9d0,-0.12d0, -0.1d0, &
 2.63d0, -2.9d0, 2.51d0,  2.8d0,-0.64d0,  0.7d0,-0.48d0, -0.6d0, &
 2.19d0, -2.9d0, 0.24d0, -0.3d0, 2.15d0,  2.9d0, 2.15d0, -2.9d0 /
data (a(i),i=3146,3297) / &
 0.52d0,  0.7d0, 2.07d0, -2.8d0, -3.1d0,    0d0, 1.79d0,    0d0, &
    0d0, 0.07d0,    0d0,-0.04d0, 0.88d0,    0d0,-3.46d0, 2.11d0, &
  2.8d0,-0.36d0,  0.5d0, 3.54d0, -0.2d0, -3.5d0,-1.39d0,  1.5d0, &
-1.91d0, -2.1d0,-1.47d0,    2d0, 1.39d0,  1.9d0, 2.07d0, -2.3d0, &
 0.91d0,    1d0, 1.99d0, -2.7d0,  3.3d0,    0d0,  0.6d0,-0.44d0, &
 -0.7d0,-1.95d0,  2.6d0, 2.15d0, -2.4d0, -0.6d0, -0.7d0,  3.3d0, &
 0.84d0,    0d0, -3.1d0, -3.1d0,    0d0,-0.72d0,-0.32d0,  0.4d0, &
-1.87d0, -2.5d0, 1.87d0, -2.5d0, 0.32d0,  0.4d0,-0.24d0,  0.3d0, &
-1.87d0, -2.5d0,-0.24d0, -0.3d0, 1.87d0, -2.5d0, -2.7d0,    0d0, &
 1.55d0, 2.03d0,  2.2d0,-2.98d0,-1.99d0, -2.2d0, 0.12d0, -0.1d0, &
 -0.4d0,  0.5d0, 1.59d0,  2.1d0,    0d0,    0d0,-1.79d0,    2d0, &
-1.03d0,  1.4d0,-1.15d0, -1.6d0, 0.32d0,  0.5d0, 1.39d0, -1.9d0, &
 2.35d0,-1.27d0,  1.7d0,  0.6d0,  0.8d0,-0.32d0, -0.4d0, 1.35d0, &
 -1.8d0, 0.44d0,    0d0, 2.23d0,-0.84d0,  0.9d0,-1.27d0, -1.4d0, &
-1.47d0,  1.6d0,-0.28d0, -0.3d0,-0.28d0,  0.4d0,-1.27d0, -1.7d0, &
 0.28d0, -0.4d0,-1.43d0, -1.5d0,    0d0,    0d0,-1.27d0, -1.7d0, &
 2.11d0,-0.32d0, -0.4d0,-1.23d0,  1.6d0, 1.19d0, -1.3d0,-0.72d0, &
 -0.8d0, 0.72d0, -0.8d0,-1.15d0, -1.3d0,-1.35d0, -1.5d0,-1.19d0, &
 -1.6d0,-0.12d0,  0.2d0, 1.79d0,    0d0,-0.88d0,-0.28d0,  0.4d0 /
data (a(i),i=3298,3449) / &
 1.11d0,  1.5d0,-1.83d0,    0d0, 0.56d0,-0.12d0,  0.1d0,-1.27d0, &
 -1.4d0,    0d0,    0d0, 1.15d0,  1.5d0,-0.12d0,  0.2d0, 1.11d0, &
  1.5d0, 0.36d0, -0.5d0,-1.07d0, -1.4d0,-1.11d0,  1.5d0, 1.67d0, &
    0d0,  0.8d0,-1.11d0,    0d0, 1.43d0, 1.23d0, -1.3d0,-0.24d0, &
-1.19d0, -1.3d0,-0.24d0,  0.2d0,-0.44d0, -0.9d0,-0.95d0,  1.1d0, &
 1.07d0, -1.4d0, 1.15d0, -1.3d0, 1.03d0, -1.1d0,-0.56d0, -0.6d0, &
-0.68d0,  0.9d0,-0.76d0,   -1d0,-0.24d0, -0.3d0, 0.95d0, -1.3d0, &
 0.56d0,  0.7d0, 0.84d0, -1.1d0,-0.56d0,    0d0,-1.55d0, 0.91d0, &
 -1.3d0, 0.28d0,  0.3d0, 0.16d0, -0.2d0, 0.95d0,  1.3d0,  0.4d0, &
 -0.5d0,-0.88d0, -1.2d0, 0.95d0, -1.1d0,-0.48d0, -0.5d0,    0d0, &
    0d0,-1.07d0,  1.2d0, 0.44d0, -0.5d0, 0.95d0,  1.1d0,    0d0, &
    0d0, 0.92d0, -1.3d0, 0.95d0,    1d0,-0.52d0,  0.6d0, 1.59d0, &
 0.24d0, -0.4d0, 0.91d0,  1.2d0, 0.84d0, -1.1d0,-0.44d0, -0.6d0, &
 0.84d0,  1.1d0,-0.44d0,  0.6d0,-0.44d0,  0.6d0,-0.84d0, -1.1d0, &
 -0.8d0,    0d0, 1.35d0, 0.76d0,  0.2d0,-0.91d0,   -1d0,  0.2d0, &
 -0.3d0,-0.91d0, -1.2d0,-0.95d0,    1d0,-0.48d0, -0.5d0, 0.88d0, &
    1d0, 0.48d0, -0.5d0,-0.95d0, -1.1d0,  0.2d0, -0.2d0,-0.99d0, &
  1.1d0,-0.84d0,  1.1d0,-0.24d0, -0.3d0,  0.2d0, -0.3d0, 0.84d0, &
  1.1d0,-1.39d0,    0d0,-0.28d0,-0.16d0,  0.2d0, 0.84d0,  1.1d0 /
data (a(i),i=3450,3601) / &
    0d0,    0d0, 1.39d0,    0d0,    0d0,-0.95d0,    1d0, 1.35d0, &
-0.99d0,    0d0, 0.88d0,-0.52d0,    0d0,-1.19d0,  0.2d0,  0.2d0, &
 0.76d0,   -1d0,    0d0,    0d0, 0.76d0,    1d0,    0d0,    0d0, &
 0.76d0,    1d0,-0.76d0,    1d0,    0d0,    0d0, 1.23d0, 0.76d0, &
  0.8d0,-0.32d0,  0.4d0,-0.72d0,  0.8d0, -0.4d0, -0.4d0,    0d0, &
    0d0, -0.8d0, -0.9d0,-0.68d0,  0.9d0,-0.16d0, -0.2d0,-0.16d0, &
 -0.2d0, 0.68d0, -0.9d0,-0.36d0,  0.5d0,-0.56d0, -0.8d0, 0.72d0, &
 -0.9d0, 0.44d0, -0.6d0,-0.48d0, -0.7d0,-0.16d0,    0d0,-1.11d0, &
 0.32d0,    0d0,-1.07d0,  0.6d0, -0.8d0,-0.28d0, -0.4d0,-0.64d0, &
    0d0, 0.91d0, 1.11d0, 0.64d0, -0.9d0, 0.76d0, -0.8d0,    0d0, &
    0d0,-0.76d0, -0.8d0, 1.03d0,    0d0,-0.36d0,-0.64d0, -0.7d0, &
 0.36d0, -0.4d0, 1.07d0, 0.36d0, -0.5d0,-0.52d0, -0.7d0,  0.6d0, &
    0d0, 0.88d0, 0.95d0,    0d0, 0.48d0, 0.16d0, -0.2d0,  0.6d0, &
  0.8d0, 0.16d0, -0.2d0, -0.6d0, -0.8d0,    0d0,   -1d0, 0.12d0, &
  0.2d0, 0.16d0, -0.2d0, 0.68d0,  0.7d0, 0.59d0, -0.8d0,-0.99d0, &
-0.56d0, -0.6d0, 0.36d0, -0.4d0,-0.68d0, -0.7d0,-0.68d0, -0.7d0, &
-0.36d0, -0.5d0,-0.44d0,  0.6d0, 0.64d0,  0.7d0,-0.12d0,  0.1d0, &
-0.52d0,  0.6d0, 0.36d0,  0.4d0,    0d0,    0d0, 0.95d0,-0.84d0, &
    0d0, 0.44d0, 0.56d0,  0.6d0, 0.32d0, -0.3d0,    0d0,    0d0 /
data (a(i),i=3602,3753) / &
  0.6d0,  0.7d0,    0d0,    0d0,  0.6d0,  0.7d0,-0.12d0, -0.2d0, &
 0.52d0, -0.7d0,    0d0,    0d0, 0.56d0,  0.7d0,-0.12d0,  0.1d0, &
-0.52d0, -0.7d0,    0d0,    0d0, 0.88d0,-0.76d0,    0d0,-0.44d0, &
    0d0,    0d0,-0.52d0, -0.7d0, 0.52d0, -0.7d0, 0.36d0, -0.4d0, &
-0.44d0, -0.5d0,    0d0,    0d0,  0.6d0,  0.6d0, 0.84d0,    0d0, &
 0.12d0,-0.24d0,    0d0,  0.8d0,-0.56d0,  0.6d0,-0.32d0, -0.3d0, &
 0.48d0, -0.5d0, 0.28d0, -0.3d0,-0.48d0, -0.5d0, 0.12d0,  0.2d0, &
 0.48d0, -0.6d0, 0.48d0,  0.6d0,-0.12d0,  0.2d0, 0.24d0,    0d0, &
 0.76d0,-0.52d0, -0.6d0,-0.52d0,  0.6d0, 0.48d0, -0.5d0,-0.24d0, &
 -0.3d0, 0.12d0, -0.1d0, 0.48d0,  0.6d0, 0.52d0, -0.2d0, 0.36d0, &
  0.4d0,-0.44d0,  0.5d0,-0.24d0, -0.3d0,-0.48d0, -0.6d0,-0.44d0, &
 -0.6d0,-0.12d0,  0.1d0, 0.76d0, 0.76d0,  0.2d0, -0.2d0, 0.48d0, &
  0.5d0,  0.4d0, -0.5d0,-0.24d0, -0.3d0, 0.44d0, -0.6d0, 0.44d0, &
 -0.6d0, 0.36d0,    0d0,-0.64d0, 0.72d0,    0d0,-0.12d0,    0d0, &
 -0.1d0, -0.4d0, -0.6d0, -0.2d0, -0.2d0,-0.44d0,  0.5d0,-0.44d0, &
  0.5d0,  0.2d0,  0.2d0,-0.44d0, -0.5d0,  0.2d0, -0.2d0, -0.2d0, &
  0.2d0,-0.44d0, -0.5d0, 0.64d0,    0d0, 0.32d0,-0.36d0,  0.5d0, &
 -0.2d0, -0.3d0, 0.12d0, -0.1d0, 0.48d0,  0.5d0,-0.12d0,  0.3d0, &
-0.36d0, -0.5d0,    0d0,    0d0, 0.48d0,  0.5d0,-0.48d0,  0.5d0 /
data (a(i),i=3754,3905) / &
 0.68d0,    0d0,-0.12d0, 0.56d0, -0.4d0, 0.44d0, -0.5d0,-0.12d0, &
 -0.1d0, 0.24d0,  0.3d0, -0.4d0,  0.4d0, 0.64d0,    0d0,-0.24d0, &
 0.64d0,    0d0, -0.2d0,    0d0,    0d0, 0.44d0, -0.5d0, 0.44d0, &
  0.5d0,-0.12d0,  0.2d0,-0.36d0, -0.5d0, 0.12d0,    0d0, 0.64d0, &
 -0.4d0,  0.5d0,    0d0,  0.1d0,    0d0,    0d0, -0.4d0,  0.5d0, &
    0d0,    0d0, -0.4d0, -0.5d0, 0.56d0,    0d0, 0.28d0,    0d0, &
  0.1d0, 0.36d0,  0.5d0,    0d0, -0.1d0, 0.36d0, -0.5d0, 0.36d0, &
  0.5d0,    0d0, -0.1d0, 0.24d0, -0.2d0,-0.36d0, -0.4d0, 0.16d0, &
  0.2d0,  0.4d0, -0.4d0,    0d0,    0d0,-0.36d0, -0.5d0,-0.36d0, &
 -0.5d0,-0.32d0, -0.5d0,-0.12d0,  0.1d0,  0.2d0,  0.2d0,-0.36d0, &
  0.4d0, -0.6d0,  0.6d0, 0.28d0,    0d0, 0.52d0, 0.12d0, -0.1d0, &
  0.4d0,  0.4d0,    0d0, -0.5d0,  0.2d0, -0.2d0,-0.32d0,  0.4d0, &
 0.16d0,  0.2d0,-0.16d0,  0.2d0, 0.32d0,  0.4d0, 0.56d0,    0d0, &
-0.12d0, 0.32d0, -0.4d0,-0.16d0, -0.2d0,    0d0,    0d0,  0.4d0, &
  0.4d0, -0.4d0, -0.4d0, -0.4d0,  0.4d0,-0.36d0,  0.4d0, 0.12d0, &
  0.1d0,    0d0,  0.1d0, 0.36d0,  0.4d0,    0d0, -0.1d0, 0.36d0, &
  0.4d0,-0.36d0,  0.4d0,    0d0,  0.1d0, 0.32d0,    0d0, 0.44d0, &
 0.12d0,  0.2d0, 0.28d0, -0.4d0,    0d0,    0d0, 0.36d0,  0.4d0, &
 0.32d0, -0.4d0,-0.16d0, 0.12d0,  0.1d0, 0.32d0, -0.4d0,  0.2d0 /
data (a(i),i=3906,4057) / &
  0.3d0,-0.24d0,  0.3d0,    0d0,  0.1d0, 0.32d0,  0.4d0,    0d0, &
 -0.1d0,-0.32d0, -0.4d0,-0.32d0,  0.4d0,    0d0,  0.1d0,-0.52d0, &
-0.52d0, 0.52d0, 0.32d0, -0.4d0,    0d0,    0d0, 0.32d0,  0.4d0, &
 0.32d0, -0.4d0,    0d0,    0d0,-0.32d0, -0.4d0,-0.32d0,  0.4d0, &
 0.32d0,  0.4d0,    0d0,    0d0, 0.32d0,  0.4d0,    0d0,    0d0, &
-0.32d0, -0.4d0,    0d0,    0d0, 0.32d0,  0.4d0, 0.16d0,  0.2d0, &
 0.32d0, -0.3d0,-0.16d0,    0d0,-0.48d0, -0.2d0,  0.2d0,-0.28d0, &
 -0.3d0, 0.28d0, -0.4d0,    0d0,    0d0, 0.28d0, -0.4d0,    0d0, &
    0d0, 0.28d0, -0.4d0,    0d0,    0d0,-0.28d0, -0.4d0, 0.28d0, &
  0.4d0,-0.28d0, -0.4d0,-0.48d0, -0.2d0,  0.2d0, 0.24d0,  0.3d0, &
 0.44d0,    0d0, 0.16d0, 0.24d0,  0.3d0, 0.16d0, -0.2d0, 0.24d0, &
  0.3d0,-0.12d0,  0.2d0,  0.2d0,  0.3d0,-0.16d0,  0.2d0,    0d0, &
    0d0, 0.44d0,-0.32d0,  0.3d0, 0.24d0,    0d0,-0.36d0, 0.36d0, &
    0d0, 0.24d0, 0.12d0, -0.2d0,  0.2d0,  0.3d0,-0.12d0,    0d0, &
-0.28d0,  0.3d0,-0.24d0,  0.3d0, 0.12d0,  0.1d0,-0.28d0, -0.3d0, &
-0.28d0,  0.3d0,    0d0,    0d0,-0.28d0, -0.3d0,    0d0,    0d0, &
-0.28d0, -0.3d0,    0d0,    0d0, 0.28d0,  0.3d0,    0d0,    0d0, &
-0.28d0, -0.3d0,-0.28d0,  0.3d0,    0d0,    0d0,-0.28d0, -0.3d0, &
    0d0,    0d0, 0.28d0,  0.3d0,    0d0,    0d0,-0.28d0,  0.3d0 /
data (a(i),i=4058,4209) / &
 0.28d0, -0.3d0,-0.28d0,  0.3d0,  0.4d0,  0.4d0,-0.24d0,  0.3d0, &
    0d0, -0.1d0, 0.16d0,    0d0, 0.36d0, -0.2d0,  0.3d0,-0.12d0, &
 -0.1d0,-0.24d0, -0.3d0,    0d0,    0d0,-0.24d0,  0.3d0,-0.24d0, &
  0.3d0,    0d0,    0d0,-0.24d0,  0.3d0,-0.24d0,  0.3d0, 0.24d0, &
 -0.3d0,    0d0,    0d0, 0.24d0, -0.3d0,    0d0,    0d0, 0.24d0, &
  0.3d0, 0.24d0, -0.3d0, 0.24d0,  0.3d0,-0.24d0,  0.3d0,-0.24d0, &
  0.3d0, -0.2d0,  0.2d0,-0.16d0, -0.2d0,    0d0,    0d0,-0.32d0, &
  0.2d0,    0d0,  0.1d0,  0.2d0, -0.3d0,  0.2d0, -0.2d0, 0.12d0, &
  0.2d0,-0.16d0,  0.2d0, 0.16d0,  0.2d0,  0.2d0,  0.3d0,  0.2d0, &
  0.3d0,    0d0,    0d0, -0.2d0,  0.3d0,    0d0,    0d0,  0.2d0, &
  0.3d0, -0.2d0, -0.3d0, -0.2d0, -0.3d0,  0.2d0, -0.3d0,    0d0, &
    0d0,  0.2d0,  0.3d0,    0d0,    0d0,  0.2d0,  0.3d0,    0d0, &
    0d0,  0.2d0,  0.3d0,    0d0,    0d0,  0.2d0,  0.3d0,    0d0, &
    0d0,  0.2d0, -0.3d0,    0d0,    0d0, -0.2d0, -0.3d0,    0d0, &
    0d0, -0.2d0,  0.3d0,    0d0,    0d0, -0.2d0,  0.3d0,    0d0, &
    0d0, 0.36d0,    0d0,    0d0, 0.36d0, 0.12d0,  0.1d0,-0.24d0, &
  0.2d0, 0.12d0, -0.2d0,-0.16d0, -0.2d0,-0.13d0,  0.1d0, 0.22d0, &
 0.21d0,  0.2d0,    0d0,-0.28d0, 0.32d0,    0d0,-0.12d0, -0.2d0, &
 -0.2d0, 0.12d0, -0.1d0, 0.12d0,  0.1d0, -0.2d0,  0.2d0,    0d0 /
data (a(i),i=4210,4361) / &
    0d0,-0.32d0, 0.32d0,    0d0,    0d0, 0.32d0, 0.32d0,    0d0, &
    0d0,-0.24d0, -0.2d0, 0.24d0,  0.2d0,  0.2d0,    0d0,-0.24d0, &
    0d0,    0d0,-0.24d0, -0.2d0,    0d0,    0d0, 0.24d0,  0.2d0, &
-0.24d0, -0.2d0,    0d0,    0d0,-0.24d0,  0.2d0, 0.16d0, -0.2d0, &
 0.12d0,  0.1d0,  0.2d0,  0.2d0,    0d0, -0.1d0,-0.12d0,  0.1d0, &
-0.16d0, -0.2d0,-0.12d0, -0.1d0,-0.16d0,  0.2d0,  0.2d0,  0.2d0, &
    0d0,    0d0, -0.2d0,  0.2d0, -0.2d0,  0.2d0, -0.2d0,  0.2d0, &
 -0.2d0,  0.2d0,  0.2d0, -0.2d0, -0.2d0, -0.2d0,    0d0,    0d0, &
 -0.2d0,  0.2d0,  0.2d0,    0d0, -0.2d0,    0d0,    0d0, -0.2d0, &
  0.2d0, -0.2d0,  0.2d0, -0.2d0, -0.2d0, -0.2d0, -0.2d0,    0d0, &
    0d0,  0.2d0,  0.2d0,  0.2d0,  0.2d0, 0.12d0, -0.2d0,-0.12d0, &
 -0.1d0, 0.28d0,-0.28d0, 0.16d0, -0.2d0,    0d0, -0.1d0,    0d0, &
  0.1d0,-0.16d0,  0.2d0,    0d0, -0.1d0,-0.16d0, -0.2d0,    0d0, &
 -0.1d0, 0.16d0, -0.2d0, 0.16d0, -0.2d0,    0d0,    0d0, 0.16d0, &
  0.2d0,-0.16d0,  0.2d0,    0d0,    0d0, 0.16d0,  0.2d0, 0.16d0, &
 -0.2d0, 0.16d0, -0.2d0,-0.16d0,  0.2d0, 0.16d0, -0.2d0,    0d0, &
    0d0, 0.16d0,  0.2d0,    0d0,    0d0, 0.16d0,  0.2d0,    0d0, &
    0d0,-0.16d0, -0.2d0, 0.16d0, -0.2d0,-0.16d0, -0.2d0,    0d0, &
    0d0,-0.16d0, -0.2d0,    0d0,    0d0,-0.16d0,  0.2d0,    0d0 /
data (a(i),i=4362,4513) / &
    0d0, 0.16d0, -0.2d0, 0.16d0,  0.2d0, 0.16d0,  0.2d0,    0d0, &
    0d0,-0.16d0, -0.2d0,    0d0,    0d0,-0.16d0, -0.2d0,    0d0, &
    0d0, 0.16d0,  0.2d0, 0.16d0,  0.2d0,    0d0,    0d0, 0.16d0, &
  0.2d0, 0.16d0, -0.2d0, 0.16d0,  0.2d0,    0d0,    0d0,-0.16d0, &
  0.2d0,    0d0,  0.1d0, 0.12d0, -0.2d0, 0.12d0, -0.2d0,    0d0, &
 -0.1d0,    0d0, -0.1d0, 0.12d0,  0.2d0,    0d0, -0.1d0,-0.12d0, &
  0.2d0,-0.15d0,  0.2d0,-0.24d0, 0.24d0,    0d0,    0d0, 0.24d0, &
 0.24d0, 0.12d0, -0.2d0,-0.12d0, -0.2d0,    0d0,    0d0, 0.12d0, &
  0.2d0, 0.12d0, -0.2d0, 0.12d0,  0.2d0, 0.12d0,  0.2d0, 0.12d0, &
  0.2d0, 0.12d0, -0.2d0,-0.12d0,  0.2d0,    0d0,    0d0, 0.12d0, &
  0.2d0, 0.12d0,    0d0, -0.2d0,    0d0,    0d0,-0.12d0, -0.2d0, &
 0.12d0, -0.2d0,    0d0,    0d0, 0.12d0,  0.2d0,-0.12d0,  0.2d0, &
-0.12d0,  0.2d0, 0.12d0, -0.2d0,    0d0,    0d0, 0.12d0,  0.2d0, &
  0.2d0,    0d0, 0.12d0,    0d0,    0d0,-0.12d0,  0.2d0,    0d0, &
    0d0,-0.12d0, -0.2d0,    0d0,    0d0,-0.12d0, -0.2d0,-0.12d0, &
 -0.2d0,    0d0,    0d0, 0.12d0, -0.2d0, 0.12d0, -0.2d0, 0.12d0, &
  0.2d0,-0.12d0, -0.2d0,    0d0,    0d0, 0.12d0, -0.2d0, 0.12d0, &
 -0.2d0, 0.12d0,  0.2d0, 0.12d0,    0d0,  0.2d0,-0.12d0, -0.2d0, &
    0d0,    0d0, 0.12d0,  0.2d0,-0.16d0,    0d0, 0.16d0, -0.2d0 /
data (a(i),i=4514,4665) / &
  0.2d0,    0d0,    0d0, -0.2d0,    0d0,    0d0, -0.2d0,  0.2d0, &
    0d0,    0d0,  0.2d0,  0.2d0, -0.2d0,    0d0,    0d0, -0.2d0, &
 0.12d0,    0d0,-0.16d0,  0.2d0,    0d0,    0d0,  0.2d0, 0.12d0, &
 -0.1d0,    0d0,  0.1d0, 0.16d0,-0.16d0,-0.16d0,-0.16d0,-0.16d0, &
-0.16d0,    0d0,    0d0,-0.16d0,    0d0,    0d0,-0.16d0,-0.16d0, &
-0.16d0,    0d0,    0d0,-0.16d0,    0d0,    0d0, 0.16d0,    0d0, &
    0d0, 0.16d0,    0d0,    0d0, 0.16d0, 0.16d0,    0d0,    0d0, &
-0.16d0,    0d0,    0d0,-0.16d0,-0.16d0,    0d0,    0d0, 0.16d0, &
    0d0,    0d0,-0.16d0,-0.16d0,    0d0,    0d0,-0.16d0,-0.16d0, &
 0.12d0,  0.1d0, 0.12d0, -0.1d0, 0.12d0,  0.1d0,    0d0,    0d0, &
 0.12d0,  0.1d0,-0.12d0,  0.1d0,    0d0,    0d0, 0.12d0,  0.1d0, &
 0.12d0, -0.1d0,    0d0,    0d0,-0.12d0, -0.1d0,    0d0,    0d0, &
 0.12d0,  0.1d0, 0.12d0,    0d0,    0d0, 0.12d0,    0d0,    0d0, &
-0.12d0,    0d0,    0d0, 0.12d0, 0.12d0, 0.12d0, 0.12d0, 0.12d0, &
    0d0,    0d0, 0.12d0,    0d0,    0d0, 0.12d0, 0.12d0,    0d0, &
    0d0, 0.12d0,    0d0,    0d0, 0.12d0,-0.12d0,-0.12d0, 0.12d0, &
 0.12d0,-0.12d0,-0.12d0,    0d0,    0d0, 0.12d0,-0.12d0, 0.12d0, &
 0.12d0,-0.12d0,-0.12d0,    0d0,    0d0,-0.12d0,-0.12d0,    0d0, &
    0d0,-0.12d0, 0.12d0,    0d0,    0d0, 0.12d0,    0d0,    0d0 /
data (a(i),i=4666,na) / &
 0.12d0,    0d0,    0d0, 0.12d0,-0.12d0,    0d0,    0d0,-0.12d0, &
 0.12d0,-0.12d0,-0.12d0, 0.12d0,    0d0,    0d0, 0.12d0, 0.12d0, &
 0.12d0,-0.12d0,    0d0,    0d0,-0.12d0,-0.12d0,-0.12d0,    0d0, &
    0d0,-0.12d0,-0.12d0,    0d0,    0d0, 0.12d0, 0.12d0,    0d0, &
    0d0,-0.12d0,-0.12d0,-0.12d0,-0.12d0, 0.12d0,    0d0,    0d0, &
 0.12d0,-0.12d0,    0d0,    0d0,-0.12d0,-0.12d0,    0d0,    0d0, &
 0.12d0,-0.12d0,-0.12d0,-0.12d0,-0.12d0, 0.12d0, 0.12d0,-0.12d0, &
-0.12d0,    0d0,    0d0,-0.12d0,    0d0,    0d0,-0.12d0, 0.12d0, &
    0d0,    0d0, 0.12d0,    0d0,    0d0,-0.12d0,-0.12d0,    0d0, &
    0d0,-0.12d0,-0.12d0, 0.12d0,    0d0,    0d0, 0.12d0, 0.12d0, &
    0d0,    0d0, 0.12d0,    0d0,    0d0, 0.12d0, 0.12d0, 0.08d0, &
    0d0, 0.04d0 /

!  Amplitude usage: X or Y, sin or cos, power of T.
data jaxy / 0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1 /
data jasc / 0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0 /
data japt / 0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4 /

!  Interval between fundamental date J2000.0 and given date (JC).
t = ( ( date1-dj00 ) + date2 ) / djc

!  Powers of T.
w = 1d0
do 1 jpt=0,maxpt
   pt(jpt) = w
   w = w*t
1 continue

!
!  Luni-solar fundamental (Delaunay) arguments (IERS 2003)
!

!  Mean anomaly of the Moon.
fa(1) = FAL03 ( t )

!  Mean anomaly of the Sun.
fa(2) = FALP03 ( t )

!  Mean argument of the latitude of the Moon.
fa(3) = FAF03 ( t )

!  Mean elongation of the Moon from the Sun.
fa(4) = FAD03 ( t )

!  Mean longitude of the ascending node of the Moon.
fa(5) = FAOM03 ( t )

!  Planetary longitudes, Mercury through Neptune.
fa(6)  = FAME03 ( t )
fa(7)  = FAVE03 ( t )
fa(8)  = FAE03 ( t )
fa(9)  = FAMA03 ( t )
fa(10) = FAJU03 ( t )
fa(11) = FASA03 ( t )
fa(12) = FAUR03 ( t )
fa(13) = FANE03 ( t )

!  General accumulated precession in longitude.
fa(14) = FAPA03 ( t )

!  --------------------------------------
!  Polynomial part of precession-nutation
!  --------------------------------------

do 3 jxy=0,1
   xypr(jxy) = 0d0
   do 2 j=maxpt,0,-1
      xypr(jxy) = xypr(jxy) + xyp(j,jxy)*pt(j)
2    continue
3 continue

!  ----------------------------------
!  Nutation periodic terms, planetary
!  ----------------------------------

!  Initialize totals in X and Y.
do 4 jxy=0,1
   xypl(jxy) = 0d0
4 continue

!  Work backwards through the coefficients per frequency list.
ialast = na
do 7 ifreq=nfpl,1,-1

!     Obtain the argument functions.
   arg = 0d0
   do 5 i=1,14
      m = mfapl(i,ifreq)
      if ( m/=0 ) arg = arg + dble(m)*fa(i)
5    continue
   sc(0) = sin(arg)
   sc(1) = cos(arg)

!     Work backwards through the amplitudes at this frequency.
   ia = nc(ifreq+nfls)
   do 6 i=ialast,ia,-1

!        Coefficient number (0 = 1st).
      j = i-ia

!        X or Y.
      jxy = jaxy(j)

!        Sin or cos.
      jsc = jasc(j)

!        Power of T.
      jpt = japt(j)

!        Accumulate the component.
      xypl(jxy) = xypl(jxy) + a(i)*sc(jsc)*pt(jpt)
6    continue
   ialast = ia-1
7 continue

!  -----------------------------------
!  Nutation periodic terms, luni-solar
!  -----------------------------------

!  Initialize totals in X and Y.
do 8 jxy=0,1
   xyls(jxy) = 0d0
8 continue

!  Continue working backwards through the number of coefficients list.
do 11 ifreq=nfls,1,-1

!     Obtain the argument functions.
   arg = 0d0
   do 9 i=1,5
      m = mfals(i,ifreq)
      if ( m/=0 ) arg = arg + dble(m)*fa(i)
9    continue
   sc(0) = sin(arg)
   sc(1) = cos(arg)

!     Work backwards through the amplitudes at this frequency.
   ia = nc(ifreq)
   do 10 i=ialast,ia,-1

!        Coefficient number (0 = 1st).
      j = i-ia

!        X or Y.
      jxy = jaxy(j)

!        Sin or cos.
      jsc = jasc(j)

!        Power of T.
      jpt = japt(j)

!        Accumulate the component.
      xyls(jxy) = xyls(jxy) + a(i)*sc(jsc)*pt(jpt)
10    continue
   ialast = ia-1
11 continue

!  -------
!  Results
!  -------

!  CIP unit vector components.
x = das2r * ( xypr(0) + ( xyls(0) + xypl(0) )/1d6 )
y = das2r * ( xypr(1) + ( xyls(1) + xypl(1) )/1d6 )

end subroutine XY06
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine XYS00A ( date1, date2, x, y, s )
!>
!  For a given TT date, compute the X,Y coordinates of the Celestial
!  Intermediate Pole and the CIO locator s, using the IAU 2000A
!  precession-nutation model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d    TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     X,Y           d    Celestial Intermediate Pole (Note 2)
!     S             d    the CIO locator s (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The Celestial Intermediate Pole coordinates are the x,y components
!     of the unit vector in the Geocentric Celestial Reference System.
!
!  3) The CIO locator s (in radians) positions the Celestial
!     Intermediate Origin on the equator of the CIP.
!
!  4) A faster, but slightly less accurate result (about 1 mas for X,Y),
!     can be obtained by using instead the XYS00B routine.
!
!  Called:
!     PNM00A   classical NPB matrix, IAU 2000A
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     S00      the CIO locator s, given X,Y, IAU 2000A
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, x, y, s

double precision rbpn(3,3)

!     DOUBLE PRECISION S00

!  Form the bias-precession-nutation matrix, IAU 2000A.
call PNM00A ( date1, date2, rbpn )

!  Extract X,Y.
call BPN2XY ( rbpn, x, y )

!  Obtain s.
s = S00 ( date1, date2, x, y )

end subroutine XYS00A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine XYS00B ( date1, date2, x, y, s )
!>
!  For a given TT date, compute the X,Y coordinates of the Celestial
!  Intermediate Pole and the CIO locator s, using the IAU 2000B
!  precession-nutation model.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d    TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     X,Y           d    Celestial Intermediate Pole (Note 2)
!     S             d    the CIO locator s (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The Celestial Intermediate Pole coordinates are the x,y components
!     of the unit vector in the Geocentric Celestial Reference System.
!
!  3) The CIO locator s (in radians) positions the Celestial
!     Intermediate Origin on the equator of the CIP.
!
!  4) The present routine is faster, but slightly less accurate (about
!     1 mas in X,Y), than the XYS00A routine.
!
!  Called:
!     PNM00B   classical NPB matrix, IAU 2000B
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     S00      the CIO locator s, given X,Y, IAU 2000A
!
!  Reference:
!
!     McCarthy, D. D., Petit, G. (eds.), IERS Conventions (2003),
!     IERS Technical Note No. 32, BKG (2004)
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, x, y, s

double precision rbpn(3,3)

!     DOUBLE PRECISION S00

!  Form the bias-precession-nutation matrix, IAU 2000A.
call PNM00B ( date1, date2, rbpn )

!  Extract X,Y.
call BPN2XY ( rbpn, x, y )

!  Obtain s.
s = S00 ( date1, date2, x, y )

end subroutine XYS00B
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine XYS06A ( date1, date2, x, y, s )
!>
!  For a given TT date, compute the X,Y coordinates of the Celestial
!  Intermediate Pole and the CIO locator s, using the IAU 2006
!  precession and IAU 2000A nutation models.
!
!  Status:  support routine.
!
!  Given:
!     DATE1,DATE2   d    TT as a 2-part Julian Date (Note 1)
!
!  Returned:
!     X,Y           d    Celestial Intermediate Pole (Note 2)
!     S             d    the CIO locator s (Note 2)
!
!  Notes:
!
!  1) The TT date DATE1+DATE2 is a Julian Date, apportioned in any
!     convenient way between the two arguments.  For example,
!     JD(TT)=2450123.7 could be expressed in any of these ways,
!     among others:
!
!            DATE1          DATE2
!
!         2450123.7D0        0D0        (JD method)
!          2451545D0      -1421.3D0     (J2000 method)
!         2400000.5D0     50123.2D0     (MJD method)
!         2450123.5D0       0.2D0       (date & time method)
!
!     The JD method is the most natural and convenient to use in
!     cases where the loss of several decimal digits of resolution
!     is acceptable.  The J2000 method is best matched to the way
!     the argument is handled internally and will deliver the
!     optimum resolution.  The MJD method and the date & time methods
!     are both good compromises between resolution and convenience.
!
!  2) The Celestial Intermediate Pole coordinates are the x,y components
!     of the unit vector in the Geocentric Celestial Reference System.
!
!  3) The CIO locator s (in radians) positions the Celestial
!     Intermediate Origin on the equator of the CIP.
!
!  4) Series-based solutions for generating X and Y are also available:
!     see Capitaine & Wallace (2006) and XY06.
!
!  Called:
!     PNM06A   classical NPB matrix, IAU 2006/2000A
!     BPN2XY   extract CIP X,Y coordinates from NPB matrix
!     S06      the CIO locator s, given X,Y, IAU 2006
!
!  References:
!
!     Capitaine, N. & Wallace, P.T., 2006, Astron.Astrophys. 450, 855
!
!     Wallace, P.T. & Capitaine, N., 2006, Astron.Astrophys. 459, 981
!
!  This revision:  2013 May 14
!
!-----------------------------------------------------------------------

implicit none

double precision date1, date2, x, y, s

double precision rbpn(3,3)

!     DOUBLE PRECISION S06

!  Form the bias-precession-nutation matrix, IAU 2006/2000A.
call PNM06A ( date1, date2, rbpn )

!  Extract X,Y.
call BPN2XY ( rbpn, x, y )

!  Obtain s.
s = S06 ( date1, date2, x, y )

end subroutine XYS06A
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ZP ( p )
!>
!  Zero a p-vector.
!
!  Status:  vector/matrix support routine.
!
!  Returned:
!     P        d(3)      p-vector
!
!  This revision:  2000 November 25
!
!-----------------------------------------------------------------------

implicit none

double precision p(3)

integer i

do 1 i=1,3
   p(i) = 0d0
1 continue

end subroutine ZP
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ZPV ( pv )
!>
!  Zero a pv-vector.
!
!  Status:  vector/matrix support routine.
!
!  Returned:
!     PV       d(3,2)      pv-vector
!
!  Called:
!     ZP       zero p-vector
!
!  This revision:  2006 November 13
!
!-----------------------------------------------------------------------

implicit none

double precision pv(3,2)

integer i

do 1 i=1,2
   call ZP ( pv(1,i) )
1 continue

end subroutine ZPV
!-----------------------------------------------------------------------

!-----------------------------------------------------------------------
subroutine ZR ( r )
!>
!  Initialize an r-matrix to the null matrix.
!
!  Status:  vector/matrix support routine.
!
!  Returned:
!     R        d(3,3)    r-matrix
!
!  This revision:  2012 April 3
!
!-----------------------------------------------------------------------

implicit none

double precision r(3,3)

r(1,1) = 0d0
r(1,2) = 0d0
r(1,3) = 0d0
r(2,1) = 0d0
r(2,2) = 0d0
r(2,3) = 0d0
r(3,1) = 0d0
r(3,2) = 0d0
r(3,3) = 0d0

end subroutine ZR
!-----------------------------------------------------------------------

!********************************************************************************
end module astro_module
!********************************************************************************

